<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="robots" content="noindex"><meta><meta name="theme-color" content="#123456"><meta name="generator" content="Hexo 4.2.0"><title>åˆ†ç±»: CppDev - Hello, NilEra :-)</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Hello, NilEra :-)"><meta name="msapplication-TileImage" content="/img/StarLogo.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Hello, NilEra :-)"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="åŠªåŠ›åšè‡ªå·±å–œæ¬¢çš„äº‹"><meta property="og:type" content="blog"><meta property="og:title" content="Hello, NilEra :-)"><meta property="og:url" content="https://hello-nilera.com/"><meta property="og:site_name" content="Hello, NilEra :-)"><meta property="og:description" content="åŠªåŠ›åšè‡ªå·±å–œæ¬¢çš„äº‹"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://hello-nilera.com/img/og_image.png"><meta property="article:author" content="NilEra"><meta property="article:tag" content="Hello NilEra"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://hello-nilera.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://hello-nilera.com"},"headline":"Hello, NilEra :-)","image":["https://hello-nilera.com/img/og_image.png"],"author":{"@type":"Person","name":"NilEra"},"publisher":{"@type":"Organization","name":"Hello, NilEra :-)","logo":{"@type":"ImageObject","url":"https://hello-nilera.com/img/StarLogo.svg"}},"description":"åŠªåŠ›åšè‡ªå·±å–œæ¬¢çš„äº‹"}</script><link rel="icon" href="/img/StarLogo.svg"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/6.0.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/11.7.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?249654dcf9a3bf70708fdfc6e2b1ec2b";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><meta name="msvalidate.01" content="F6BD78C6BD0096D2218CF88334111125"><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdnjs.loli.net/ajax/libs/pace/1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/StarLogo.svg" alt="Hello, NilEra :-)" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">é¦–é¡µ</a><a class="navbar-item" href="/archives">å½’æ¡£</a><a class="navbar-item" href="/categories">ç›®å½•</a><a class="navbar-item" href="/tags">æ ‡ç­¾</a><a class="navbar-item" href="/about">å…³äº</a><a class="navbar-item" href="/me">æˆ‘</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/NilEra-K"><i class="fab fa-github"></i></a><a class="navbar-item search" title="æœç´¢" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/categories">åˆ†ç±»</a></li><li class="is-active"><a href="#" aria-current="page">CppDev</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-07-29T07:32:17.000Z" title="2024/7/29 15:32:17">2024-07-29</time>å‘è¡¨</span><span class="level-item"><time dateTime="2024-08-03T14:20:21.855Z" title="2024/8/3 22:20:21">2024-08-03</time>æ›´æ–°</span><span class="level-item"><a class="link-muted" href="/categories/CppDev/">CppDev</a><span>Â /Â </span><a class="link-muted" href="/categories/CppDev/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/">å¤šçº¿ç¨‹ç¼–ç¨‹</a></span><span class="level-item">1 å°æ—¶è¯»å®Œ (å¤§çº¦12932ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/07/29/Cpp-Muti-Threaded/">Cpp_Muti_Threaded</a></p><div class="content"><h2 id="ğŸ”±-C-å¤šçº¿ç¨‹ç¼–ç¨‹"><a href="#ğŸ”±-C-å¤šçº¿ç¨‹ç¼–ç¨‹" class="headerlink" title="ğŸ”± C++ å¤šçº¿ç¨‹ç¼–ç¨‹"></a>ğŸ”± C++ å¤šçº¿ç¨‹ç¼–ç¨‹</h2><p>[TOC]</p>
<h3 id="ğŸ§¶-1-è¿›ç¨‹å’Œçº¿ç¨‹çš„åŸºæœ¬æ¦‚å¿µ"><a href="#ğŸ§¶-1-è¿›ç¨‹å’Œçº¿ç¨‹çš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="ğŸ§¶ 1. è¿›ç¨‹å’Œçº¿ç¨‹çš„åŸºæœ¬æ¦‚å¿µ"></a>ğŸ§¶ 1. è¿›ç¨‹å’Œçº¿ç¨‹çš„åŸºæœ¬æ¦‚å¿µ</h3><h5 id="1-1-1-è¿›ç¨‹å’Œçº¿ç¨‹çš„æ¦‚å¿µ"><a href="#1-1-1-è¿›ç¨‹å’Œçº¿ç¨‹çš„æ¦‚å¿µ" class="headerlink" title="1.1.1 è¿›ç¨‹å’Œçº¿ç¨‹çš„æ¦‚å¿µ"></a>1.1.1 è¿›ç¨‹å’Œçº¿ç¨‹çš„æ¦‚å¿µ</h5><p><strong>è¿›ç¨‹æ˜¯ç³»ç»Ÿä¸­æ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªç¨‹åºï¼Œç¨‹åºä¸€æ—¦è¿è¡Œå°±æ˜¯è¿›ç¨‹ã€‚</strong>è¿›ç¨‹å¯ä»¥çœ‹æˆç¨‹åºæ‰§è¡Œçš„ä¸€ä¸ªå®ä¾‹ã€‚è¿›ç¨‹æ˜¯ç³»ç»Ÿèµ„æºåˆ†é…çš„ç‹¬ç«‹å®ä½“ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æ‹¥æœ‰ç‹¬ç«‹çš„åœ°å€ç©ºé—´ã€‚ä¸€ä¸ªè¿›ç¨‹æ— æ³•è®¿é—®å¦ä¸€ä¸ªè¿›ç¨‹çš„å˜é‡å’Œæ•°æ®ç»“æ„ï¼Œå¦‚æœæƒ³è®©ä¸€ä¸ªè¿›ç¨‹è®¿é—®å¦ä¸€ä¸ªè¿›ç¨‹çš„èµ„æºï¼Œéœ€è¦ä½¿ç”¨è¿›ç¨‹é—´é€šä¿¡ï¼Œæ¯”å¦‚ç®¡é“ã€æ–‡ä»¶ã€å¥—æ¥å­—ç­‰ã€‚</p>
<p><strong><u>çº¿ç¨‹</u>æ˜¯è¿›ç¨‹çš„è¿›ç¨‹ã€‚</strong>ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹ä½¿ç”¨å…¶æ‰€å±è¿›ç¨‹çš„æ ˆç©ºé—´ã€‚çº¿ç¨‹çš„æœ€å¤§æ•°é‡å–å†³äºCPUçš„æ ¸å¿ƒæ•°ã€‚</p>
<p>çº¿ç¨‹ä¸è¿›ç¨‹çš„ä¸€ä¸ªä¸»è¦åŒºåˆ«æ˜¯ï¼ŒåŒä¸€è¿›ç¨‹å†…çš„å¤šä¸ªçº¿ç¨‹ä¼šå…±äº«éƒ¨åˆ†çŠ¶æ€ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥è¯»å†™åŒä¸€å—å†…å­˜ï¼ˆä¸€ä¸ªè¿›ç¨‹æ— æ³•ç›´æ¥è®¿é—®å¦ä¸€è¿›ç¨‹çš„å†…å­˜ï¼‰ã€‚åŒæ—¶ï¼Œæ¯ä¸ªçº¿ç¨‹è¿˜æ‹¥æœ‰è‡ªå·±çš„å¯„å­˜å™¨å’Œæ ˆï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥è¯»å†™è¿™äº›æ ˆå†…å­˜ã€‚</p>
<p>çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå®ä½“ï¼Œæ˜¯è¿›ç¨‹çš„ä¸€æ¡æ‰§è¡Œè·¯å¾„ã€‚</p>
<p>çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€ä¸ªç‰¹å®šæ‰§è¡Œè·¯å¾„ã€‚å½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†è¿›ç¨‹çš„èµ„æºï¼Œå®ƒçš„å…„å¼Ÿçº¿ç¨‹å¯ä»¥ç«‹å³çœ‹åˆ°è¿™ç§å˜åŒ–ã€‚</p>
<h5 id="1-1-2-å¹¶å‘å’Œå¹¶è¡Œçš„æ¦‚å¿µ"><a href="#1-1-2-å¹¶å‘å’Œå¹¶è¡Œçš„æ¦‚å¿µ" class="headerlink" title="1.1.2 å¹¶å‘å’Œå¹¶è¡Œçš„æ¦‚å¿µ"></a>1.1.2 å¹¶å‘å’Œå¹¶è¡Œçš„æ¦‚å¿µ</h5><p><strong>å¹¶å‘ï¼ˆConcurrentï¼‰ï¼š</strong>å¹¶å‘æŒ‡åœ¨<strong>åŒä¸€æ—¶é—´æ®µå†…</strong>ï¼Œå¤šä¸ªä»»åŠ¡éƒ½åœ¨è¿›è¡Œä¸­ï¼Œä½†å¹¶ä¸ä¸€å®šåŒæ—¶æ‰§è¡Œã€‚åœ¨å•æ ¸ <code>CPU</code> ä¸Šï¼Œå¤šä¸ªä»»åŠ¡å ç”¨ä¸åŒçš„ <code>CPU</code> æ—¶é—´ç‰‡ï¼Œ<strong>ç‰©ç†ä¸Šè¿˜æ˜¯ä¸²è¡Œæ‰§è¡Œçš„</strong>ã€‚ä½†æ˜¯ç”±äºæ¯ä¸ªä»»åŠ¡æ‰€å ç”¨çš„ <code>CPU</code> æ—¶é—´ç‰‡éå¸¸çŸ­ï¼ˆå¦‚ï¼š<code>10ms</code>ï¼‰ï¼Œçœ‹èµ·æ¥å°±åƒæ˜¯å¤šä¸ªä»»åŠ¡åœ¨å…±åŒæ‰§è¡Œä¸€æ ·ï¼Œè¿™æ ·çš„åœºæ™¯å°±å«åš<strong>å¹¶å‘</strong>ã€‚</p>
<img src="./Cpp_Muti_Threaded/Concurrent.png" alt="å¹¶å‘" style="zoom: 50%;" >

<center>å¹¶å‘æ¦‚å¿µå›¾</center>

<p><strong>å¹¶è¡Œï¼ˆParallelï¼‰ï¼š</strong>å¹¶è¡Œæ˜¯æŒ‡åœ¨<strong>åŒä¸€æ—¶åˆ»</strong>ï¼Œå¤šä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œã€‚å¹¶è¡Œéœ€è¦å¤šæ ¸ <code>CPU</code> æˆ–è€…å¤šå¤„ç†å™¨ç³»ç»Ÿï¼Œè®©ä¸åŒçš„ä»»åŠ¡åœ¨ä¸åŒçš„æ ¸å¿ƒä¸ŠåŒæ—¶è¿è¡Œã€‚ä½†æ˜¯è¿™å¹¶ä¸æ„å‘³ç€æ¯ä¸ªæ ¸å¿ƒä¸Šåªè¿è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œæ¯ä¸ªæ ¸å¿ƒä¸Šçš„è¿è¡Œç­–ç•¥å…¶å®å’Œå•æ ¸ <code>CPU</code> æ²¡æœ‰å¤ªå¤§åŒºåˆ«ï¼ˆå³ä¹Ÿæ˜¯å¹¶å‘çš„ï¼‰ã€‚</p>
<img src="./Cpp_Muti_Threaded/Parallel.png" alt="å¹¶è¡Œæ¦‚å¿µå›¾" style="zoom:50%;" >

<center>å¹¶è¡Œæ¦‚å¿µå›¾</center>

<h3 id="ğŸ§¶-2-å¤šçº¿ç¨‹çš„è®¾è®¡"><a href="#ğŸ§¶-2-å¤šçº¿ç¨‹çš„è®¾è®¡" class="headerlink" title="ğŸ§¶ 2. å¤šçº¿ç¨‹çš„è®¾è®¡"></a>ğŸ§¶ 2. å¤šçº¿ç¨‹çš„è®¾è®¡</h3><p>å¼€å‘ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œè¦ä¸è¦å®ç°æˆå¹¶å‘ç¨‹åºå‘¢ï¼Ÿå¤šçº¿ç¨‹ä¸€å®šæ›´å¥½å—ï¼Ÿ</p>
<p>åœ¨æŸäº›æƒ…å†µä¸‹å¤šçº¿ç¨‹å…·æœ‰ä¸€å®šçš„ä¼˜åŠ¿ï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹å¤šçº¿ç¨‹å¹¶ä¸å…·æœ‰ä¼˜åŠ¿ï¼Œè¿™éœ€è¦æ ¹æ®å½“å‰ç¨‹åºçš„ç±»å‹è¿›è¡Œåˆ†æå’Œåˆ¤æ–­ã€‚</p>
<p>ç¨‹åºçš„ç±»å‹æœ‰ä»¥ä¸‹ä¸¤ç§ï¼šä¸€ç§æ˜¯ I&#x2F;Oå¯†é›†å‹ï¼›ä¸€ç§æ˜¯ CPU å¯†é›†å‹ã€‚</p>
<h4 id="2-1-I-O-å¯†é›†å‹ç¨‹åº"><a href="#2-1-I-O-å¯†é›†å‹ç¨‹åº" class="headerlink" title="2.1 I&#x2F;O å¯†é›†å‹ç¨‹åº"></a>2.1 I&#x2F;O å¯†é›†å‹ç¨‹åº</h4><p>I&#x2F;Oå¯†é›†å‹ï¼Œå³ç¨‹åºé‡Œé¢æŒ‡ä»¤çš„æ‰§è¡Œï¼Œæ¶‰åŠä¸€äº› I&#x2F;O æ“ä½œï¼Œæ¯”å¦‚è®¾å¤‡ã€æ–‡ä»¶ã€ç½‘ç»œæ“ä½œï¼ˆå¦‚ç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥ï¼‰ç­‰ï¼ŒI&#x2F;Oæ“ä½œæ˜¯å¯ä»¥å°†è¿›ç¨‹é˜»å¡ä½çš„ï¼Œå¦‚æœæˆ‘ä»¬å†ç»™è¿™æ ·çš„ç¨‹åºåˆ†é…æ—¶é—´ç‰‡ï¼Œå…¶å®å°±ç›¸å½“äº <code>CPU</code> ç©ºé—²ä¸‹æ¥äº†ã€‚</p>
<p>åœ¨ I&#x2F;O å¯†é›†å‹çš„ç¨‹åºåœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œåœ¨ I&#x2F;O æ“ä½œæ²¡æœ‰å‡†å¤‡å¥½æ—¶ï¼Œç¨‹åºæ˜¯ä¼šè¢«æ”¾åœ¨é˜»å¡é˜Ÿåˆ—ä¸­çš„ï¼Œåœ¨é˜»å¡é˜Ÿåˆ—ä¸­æ˜¯ä¸å—æ“ä½œç³»ç»Ÿè°ƒåº¦çš„ã€‚</p>
<p>æ­£å› å¦‚æ­¤ï¼ŒI&#x2F;O å¯†é›†å‹ç¨‹åºæ›´é€‚åˆè®¾è®¡æˆå¤šçº¿ç¨‹ç¨‹åºã€‚</p>
<p>I&#x2F;O å¯†é›†å‹ç¨‹åºä¸è®ºæ˜¯åœ¨å•æ ¸è¿˜æ˜¯å¤šæ ¸çš„æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯é€‚åˆè®¾è®¡æˆå¤šçº¿ç¨‹ç¨‹åºçš„ï¼Œå› ä¸ºä»–ä¸ä¼šé€ æˆ <code>CPU</code> èµ„æºçš„æµªè´¹ã€‚</p>
<h4 id="2-2-CPU-å¯†é›†å‹ç¨‹åº"><a href="#2-2-CPU-å¯†é›†å‹ç¨‹åº" class="headerlink" title="2.2 CPU å¯†é›†å‹ç¨‹åº"></a>2.2 CPU å¯†é›†å‹ç¨‹åº</h4><p>CPU å¯†é›†å‹ç¨‹åºï¼Œå³ç¨‹åºé‡Œé¢çš„æŒ‡ä»¤éƒ½æ˜¯ç”¨æ¥åšè®¡ç®—ç”¨çš„ï¼Œä¾‹å¦‚å¤§é‡çš„åŠ å‡ä¹˜é™¤ã€æ·±åº¦å­¦ä¹ éƒ½æ˜¯åœ¨è¿›è¡Œå¤§é‡çš„è®¡ç®—ã€‚</p>
<p>CPUå¯†é›†å‹ç¨‹åºï¼Œåœ¨<strong>å•æ ¸æƒ…å†µä¸‹æ˜¯ä¸é€‚åˆè®¾è®¡æˆå¤šçº¿ç¨‹ç¨‹åºçš„</strong>ï¼Œå› ä¸ºçº¿ç¨‹çš„è°ƒåº¦æœ‰é¢å¤–çš„èŠ±è´¹ï¼šçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆå½“å‰çº¿ç¨‹è°ƒåº¦å®Œäº†ï¼Œè¯¥è°ƒåº¦ä¸‹ä¸€ä¸ªçº¿ç¨‹ï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç›¸å½“äºåªæœ‰ä¸€ä¸ªè®¡ç®—å™¨ï¼Œå•çº¿ç¨‹æ˜¯ä¸€ä¸ªäººä¸€ç›´è®¡ç®—ï¼Œè€Œå¤šçº¿ç¨‹æ˜¯å¤šä¸ªäººä¸€äººç®—ä¸€æ®µã€‚ä½†æ˜¯ä¼ é€’è®¡ç®—å™¨çš„è¿‡ç¨‹ä¼šäº§ç”Ÿä¸€å®šçš„èŠ±é”€ã€‚è€Œå•çº¿ç¨‹è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ï¼Œè¦è·å–ä¹‹å‰è®¡ç®—åˆ°çš„ä¿¡æ¯ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ç¬”å¼€é”€ã€‚</p>
<p>ä½†æ˜¯å…¶åœ¨å¤šæ ¸æƒ…å†µä¸‹æ˜¯æ¯”è¾ƒé€‚åˆè®¾è®¡æˆå¤šçº¿ç¨‹ç¨‹åºçš„ã€‚</p>
<h3 id="ğŸ§¶-3-çº¿ç¨‹åŒæ­¥"><a href="#ğŸ§¶-3-çº¿ç¨‹åŒæ­¥" class="headerlink" title="ğŸ§¶ 3. çº¿ç¨‹åŒæ­¥"></a>ğŸ§¶ 3. çº¿ç¨‹åŒæ­¥</h3><p>çº¿ç¨‹åŒæ­¥æœ‰ä¸¤ç§åœºæ™¯ï¼šâ‘  çº¿ç¨‹äº’æ–¥ï¼›â‘¡ çº¿ç¨‹é€šä¿¡</p>
<p><strong>çº¿ç¨‹äº’æ–¥ï¼š</strong></p>
<ul>
<li>äº’æ–¥é” <code>mutex</code></li>
<li>åŸå­ç±»å‹ <code>atomic</code></li>
</ul>
<p><strong>çº¿ç¨‹é€šä¿¡ï¼š</strong></p>
<ul>
<li>æ¡ä»¶å˜é‡ <code>condition_variable</code></li>
<li>ä¿¡å·é‡ <code>semaphore</code></li>
</ul>
<h4 id="3-1-æ•°æ®ç«æ€"><a href="#3-1-æ•°æ®ç«æ€" class="headerlink" title="3.1 æ•°æ®ç«æ€"></a>3.1 æ•°æ®ç«æ€</h4><p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“æˆ‘ä»¬æœ‰å¤šä¸ªçº¿ç¨‹æƒ³è¦æ‰§è¡Œ <code>Code</code> æ—¶ï¼Œé‚£æˆ‘ä»¬å°±è¦è€ƒè™‘è¿™æ®µä»£ç èƒ½å¦åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ‰§è¡Œã€‚æ˜¯å¦èƒ½åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ‰§è¡Œä¸»è¦è¦çœ‹è¿™æ®µä»£ç æ˜¯å¦å­˜åœ¨æ•°æ®ç«æ€ï¼ˆæˆ–ç§°ç«æ€æ¡ä»¶ï¼‰ã€‚</p>
<p><strong>ç«æ€æ¡ä»¶ï¼š</strong>ä»£ç ç‰‡æ®µ <code>Code</code> åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ‰§è¡Œï¼Œéšç€çº¿ç¨‹çš„è°ƒåº¦é¡ºåºä¸åŒï¼Œè€Œå¾—åˆ°ä¸åŒçš„è¿è¡Œç»“æœï¼Œè¿™å°±è¯´æ˜è¿™æ®µä»£ç å­˜åœ¨ç«æ€æ¡ä»¶ã€‚ç®€å•æ¥è¯´å°±æ˜¯ï¼Œ$Thread1â†’Thread2â†’Thread3$ ä¼šå¾—åˆ°ä¸€ä¸ªç»“æœï¼Œè€Œ $Thread2â†’Thread1â†’Thread3$ å¯èƒ½æ˜¯å¦ä¸€ä¸ªç»“æœã€‚è¿™æ˜¯æˆ‘ä»¬ä¸æœŸå¾…çš„ã€‚</p>
<p>å­˜åœ¨ç«æ€æ¡ä»¶çš„ä»£ç ç‰‡æ®µç§°ä¸º<strong>ä¸´ç•ŒåŒºä»£ç æ®µ</strong>ã€‚</p>
<img src="./Cpp_Muti_Threaded/DataCompetitionStatus.png" style="zoom:50%;" >

<p>ä¸ºäº†ä¿è¯ä¸å‡ºç°ä¸´ç•ŒåŒºä»£ç æ®µï¼Œæˆ‘ä»¬åº”è¯¥è¦ä¿è¯ä»£ç çš„<strong>åŸå­æ“ä½œ</strong>ã€‚</p>
<p>å¦‚æœåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¸å­˜åœ¨ç«æ€æ¡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç§°è¿™æ®µä»£ç ç‰‡æ®µæ˜¯<em><strong>å¯é‡å…¥çš„ï¼ˆå°±æ˜¯ä¸€æ®µä»£ç åœ¨æ²¡æ‰§è¡Œå®Œçš„æƒ…å†µä¸‹åˆè¢«è¿è¡Œäº†ï¼‰</strong></em>ï¼Œå¦åˆ™æ˜¯<em><strong>ä¸å¯é‡å…¥</strong></em>çš„ã€‚</p>
<h3 id="ğŸ§¶-3-C-11-Windows-çº¿ç¨‹åº“çš„åŸºæœ¬ä½¿ç”¨"><a href="#ğŸ§¶-3-C-11-Windows-çº¿ç¨‹åº“çš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="ğŸ§¶ 3. C++ 11 Windows çº¿ç¨‹åº“çš„åŸºæœ¬ä½¿ç”¨"></a>ğŸ§¶ 3. C++ 11 Windows çº¿ç¨‹åº“çš„åŸºæœ¬ä½¿ç”¨</h3><p><strong>C++ 11 çº¿ç¨‹åº“å¤´æ–‡ä»¶</strong> <code>#include &lt;thread&gt;</code></p>
<ul>
<li><p>åˆ›å»ºçº¿ç¨‹</p>
<p>å¯ä»¥ä½¿ç”¨ <code>std::thread</code> æ¥åˆ›å»ºçº¿ç¨‹ï¼Œè¿™å…¶å®æ˜¯ä½¿ç”¨çº¿ç¨‹ç±» <code>std::thread</code> å£°æ˜ä¸€ä¸ªçº¿ç¨‹å®ä¾‹ <code>printThread</code> çš„è¿‡ç¨‹ã€‚è¿™é‡Œæˆ‘ä»¬ç›´æ¥è¿™æ ·åˆ›å»ºçº¿ç¨‹ï¼Œç”Ÿæˆåº”ç”¨ç¨‹åºä¹‹åè¿è¡Œè¾“å‡ºç»“æœï¼š<code>Hello World - I&#39;m NilEra @-@</code>ï¼Œä½†æ˜¯è¿è¡Œä¹‹åä¼šå‡ºç°é”™è¯¯ã€‚</p>
<p>è¿™é‡Œå‡ºç°é”™è¯¯çš„åŸå› æ˜¯ï¼šå½“æˆ‘ä»¬å¯åŠ¨äº† <code>thread_print</code> çº¿ç¨‹ï¼Œæ­¤æ—¶ç¨‹åºä¸ä¼šåœ¨è¿™é‡Œç­‰å¾…çº¿ç¨‹æ‰§è¡Œå®Œæˆï¼Œè€Œæ˜¯ä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œå¯¼è‡´å‡ºç°ç¨‹åºå·²ç»æ‰§è¡Œåˆ° <code>return 0</code> æ—¶ï¼Œçº¿ç¨‹è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæˆï¼Œå› æ­¤è¿™é‡Œä¼šäº§ç”ŸæŠ¥é”™ã€‚</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰çº¿ç¨‹éœ€è¦æ‰§è¡Œçš„å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printThread</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Hello World - I&#x27;m NilEra @-@&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">    <span class="function">std::thread <span class="title">thread_print</span><span class="params">(printThread)</span></span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>ä¸»ç¨‹åºç­‰å¾…çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</p>
<p>ä¸ºäº†è§£å†³ä¸Šè¿°å‡ºç°çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦è®©ä¸»ç¨‹åºç­‰å¾…çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•å†è¿›è¡Œé€€å‡ºï¼Œè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦ç”¨åˆ° <code>join()</code> å‡½æ•°ã€‚</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰çº¿ç¨‹éœ€è¦æ‰§è¡Œçš„å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printHelloWorld</span><span class="params">(std::string msg)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; msg &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">    <span class="function">std::thread <span class="title">thread_print</span><span class="params">(printHelloWorld, <span class="string">&quot;Hello Thread @-@ I&#x27;m NilEra...&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾…çº¿ç¨‹æ‰§è¡Œå®Œæˆ</span></span><br><span class="line">    thread_print.<span class="built_in">join</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>åˆ†ç¦»çº¿ç¨‹</p>
<p>ä¸Šè¿°çš„é—®é¢˜è¿˜å¯ä»¥ä½¿ç”¨ <code>detach()</code> å‡½æ•°æ¥è¿›è¡Œè§£å†³ã€‚å½“æ‰§è¡Œä¸‹é¢çš„ç¨‹åºæ—¶ï¼Œæ§åˆ¶å°ä¸ä¼šåˆä»»ä½•è¾“å‡ºï¼Œç›´æ¥é€€å‡ºç¨‹åºã€‚</p>
<p>è¿™æ˜¯å› ä¸ºçº¿ç¨‹æ‰§è¡Œå®Œçº¿ç¨‹çš„åˆ›å»ºä¹‹åï¼Œç´§æ¥ç€æ‰§è¡Œäº† <code>detach()</code>ï¼Œæ­¤æ—¶çº¿ç¨‹çš„å…·ä½“æ“ä½œè¿˜æœªæ¥å¾—åŠæ‰§è¡Œå°±è¿›è¡Œäº†çº¿ç¨‹çš„åˆ†ç¦»ã€‚è¿›ç¨‹ç»“æŸä¹‹åï¼Œ<code>thread_print</code> çº¿ç¨‹è¿˜åœ¨åå°è¿è¡Œã€‚ä½†æ˜¯å› ä¸ºæ­¤æ—¶è¿›ç¨‹å·²ç»ç»“æŸï¼Œçº¿ç¨‹æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¸ä¼šæœ‰è¾“å‡ºã€‚</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰çº¿ç¨‹éœ€è¦æ‰§è¡Œçš„å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printHelloWorld</span><span class="params">(std::string msg)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; msg &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">    <span class="function">std::thread <span class="title">thread_print</span><span class="params">(printHelloWorld, <span class="string">&quot;Hello Thread @-@ I&#x27;m NilEra...&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çº¿ç¨‹åˆ†ç¦»</span></span><br><span class="line">    thread_print.<span class="built_in">detach</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä½¿ç”¨å¦‚ä¸‹ä»£ç å¯ä»¥æ›´æ¸…æ™°çš„çœ‹åˆ°æ‰§è¡Œ detach() çš„æ•ˆæœ, ä»¥åŠ join() å’Œ detach() çš„åŒºåˆ«</span></span><br><span class="line"><span class="comment">// join() æ˜¯é˜»å¡çš„</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰çº¿ç¨‹éœ€è¦æ‰§è¡Œçš„å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printHelloWorld</span><span class="params">(std::string msg)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; msg &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">        std::cout &lt;&lt; i &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">    <span class="function">std::thread <span class="title">thread_print</span><span class="params">(printHelloWorld, <span class="string">&quot;Hello Thread @-@ I&#x27;m NilEra...&quot;</span>)</span></span>;</span><br><span class="line">    <span class="built_in">Sleep</span>(<span class="number">100</span>);</span><br><span class="line">    thread_print.<span class="built_in">detach</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å¯ä»¥åˆå¹¶</p>
<p>æœ‰æ—¶æˆ‘ä»¬éœ€è¦å¯¹çº¿ç¨‹åˆ¤æ–­å…¶æ˜¯å¦å¯ä»¥è¿›è¡Œ <code>join()</code> æ“ä½œï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥è°ƒç”¨ <code>joinable()</code> å‡½æ•°ï¼Œ<code>joinable()</code> ä¼šè¿”å›ä¸€ä¸ª <code>bool</code> å€¼ï¼Œç”¨äºåˆ¤æ–­çº¿ç¨‹æ˜¯å¦å¯ä»¥è¿›è¡Œ <code>join()</code> æ“ä½œã€‚</p>
<p>å¦‚æœæˆ‘ä»¬å¯¹ä¸€ä¸ªä¸å¯ä½¿ç”¨ <code>join()</code> æˆ–è€… <code>detach()</code> çš„çº¿ç¨‹è¿›è¡Œäº† <code>join()</code> å’Œ <code>detach()</code> æ“ä½œï¼Œä¼šå‡ºç°ä¸€ä¸ª <code>SystemError</code>ï¼Œåœ¨ä¸€äº›æ¯”è¾ƒä¸¥è°¨çš„é¡¹ç›®ä¸­ï¼Œä¼šå…ˆä½¿ç”¨ <code>joinable()</code> è¿›è¡Œåˆ¤æ–­ã€‚</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰çº¿ç¨‹éœ€è¦æ‰§è¡Œçš„å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printHelloWorld</span><span class="params">(std::string msg)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; msg &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">    <span class="function">std::thread <span class="title">thread_print</span><span class="params">(printHelloWorld, <span class="string">&quot;Hello Thread @-@ I&#x27;m NilEra...&quot;</span>)</span></span>;</span><br><span class="line">    <span class="type">bool</span> isJoin = thread_print.<span class="built_in">joinable</span>();</span><br><span class="line">    <span class="keyword">if</span> (isJoin) &#123;</span><br><span class="line">        thread_print.<span class="built_in">join</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ§¶-4-çº¿ç¨‹å‡½æ•°ä¸­çš„æ•°æ®æœªå®šä¹‰é”™è¯¯"><a href="#ğŸ§¶-4-çº¿ç¨‹å‡½æ•°ä¸­çš„æ•°æ®æœªå®šä¹‰é”™è¯¯" class="headerlink" title="ğŸ§¶ 4. çº¿ç¨‹å‡½æ•°ä¸­çš„æ•°æ®æœªå®šä¹‰é”™è¯¯"></a>ğŸ§¶ 4. çº¿ç¨‹å‡½æ•°ä¸­çš„æ•°æ®æœªå®šä¹‰é”™è¯¯</h3><h4 id="4-1-ä¼ é€’ä¸´æ—¶å˜é‡é—®é¢˜"><a href="#4-1-ä¼ é€’ä¸´æ—¶å˜é‡é—®é¢˜" class="headerlink" title="4.1 ä¼ é€’ä¸´æ—¶å˜é‡é—®é¢˜"></a>4.1 ä¼ é€’ä¸´æ—¶å˜é‡é—®é¢˜</h4><ul>
<li><p>é”™è¯¯ç¤ºä¾‹ï¼šå¦‚ä¸‹ä½¿ç”¨ <code>std::thread</code> ç±»æ—¶ï¼Œä¼ å…¥çº¿ç¨‹å‡½æ•° <code>foo</code> å’Œ å‚æ•° <code>a</code>ï¼Œè¿™é‡Œçš„å‚æ•° <code>a</code> ä¼šè¢«ä½œä¸ºå€¼ä¼ é€’ï¼Œå³ä¼ é€’çš„ä¸æ˜¯ <code>a</code> çš„å¼•ç”¨ï¼Œè€Œæ˜¯ <code>a</code> æ‰€å­˜å‚¨çš„å€¼ <code>1</code>ã€‚ä½†æ˜¯å¦‚æœæ˜¯å€¼ä¼ é€’çš„è¯ï¼Œè¿™é‡Œè°ƒç”¨çš„å®é™…ä¸Šæ˜¯ <code>foo((int&amp;) 1)</code> ä¼šäº§ç”Ÿç¼–è¯‘é”™è¯¯ï¼Œå› ä¸º <code>1</code> å®é™…ä¸Šæ˜¯ä¸€ä¸ªå³å€¼ï¼Œè€Œ<strong>éå¸¸é‡å¼•ç”¨çš„åˆå§‹å€¼å¿…é¡»ä¸ºå·¦å€¼</strong>ï¼Œæ‰€ä»¥è¿™é‡Œä¼šäº§ç”Ÿç¼–è¯‘é”™è¯¯ã€‚</p>
<p>æˆ‘ä»¬å¹³æ—¶è°ƒç”¨ <code>foo</code> æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>foo(a)</code>ï¼Œå®é™…ä¸Šæˆ‘ä»¬è¿›è¡Œäº†éšå¼è½¬æ¢ï¼Œæ‰§è¡Œçš„å®é™…ä¸Šæ˜¯ <code>foo((int&amp;) a)</code>ã€‚</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* é”™è¯¯ç¤ºä¾‹ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">int</span>&amp; x)</span> </span>&#123;</span><br><span class="line">	x += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> a = <span class="number">1</span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">thread_plus</span><span class="params">(foo, a)</span></span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ä¿®æ”¹ç¤ºä¾‹ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">int</span>&amp; x)</span> </span>&#123;</span><br><span class="line">	x += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> a = <span class="number">1</span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">thread_plus</span><span class="params">(foo, std::ref(a))</span></span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* æ‹“å±• */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">int</span>&amp; x)</span> </span>&#123;</span><br><span class="line">	x += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">const_foo</span><span class="params">(<span class="type">const</span> <span class="type">int</span>&amp; x)</span> </span>&#123;</span><br><span class="line">	std::cout &lt;&lt; <span class="string">&quot;const_foo param x is : &quot;</span> &lt;&lt; x &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> a = <span class="number">1</span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">thread_plus</span><span class="params">(foo, std::ref(a))</span></span>;</span><br><span class="line">	<span class="built_in">Sleep</span>(<span class="number">10</span>);</span><br><span class="line">	<span class="function">std::thread <span class="title">thread_plus_const</span><span class="params">(const_foo, a)</span></span>;</span><br><span class="line">	thread_plus.<span class="built_in">join</span>();</span><br><span class="line">	thread_plus_const.<span class="built_in">join</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-2-ä¼ é€’æŒ‡é’ˆæˆ–å¼•ç”¨æŒ‡å‘å±€éƒ¨å˜é‡çš„é—®é¢˜"><a href="#4-2-ä¼ é€’æŒ‡é’ˆæˆ–å¼•ç”¨æŒ‡å‘å±€éƒ¨å˜é‡çš„é—®é¢˜" class="headerlink" title="4.2 ä¼ é€’æŒ‡é’ˆæˆ–å¼•ç”¨æŒ‡å‘å±€éƒ¨å˜é‡çš„é—®é¢˜"></a>4.2 ä¼ é€’æŒ‡é’ˆæˆ–å¼•ç”¨æŒ‡å‘å±€éƒ¨å˜é‡çš„é—®é¢˜</h4><ul>
<li><p>é”™è¯¯ç¤ºä¾‹ï¼šåœ¨ä¸‹é¢çš„ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå…¨å±€çº¿ç¨‹å˜é‡ï¼Œå¹¶ä¸”åœ¨ <code>test</code> å‡½æ•°è¢«è°ƒç”¨æ—¶å¼€å¯äº†è¿™ä¸ªçº¿ç¨‹ <code>t</code>ï¼Œåœ¨ <code>main</code> å‡½æ•°ä¸­ï¼Œæ‰§è¡Œäº† <code>test</code> å‡½æ•°ï¼Œåœ¨æ‰§è¡Œåˆ° <code>t = std::thread(foo, std::ref(a));</code> æ—¶ï¼Œçº¿ç¨‹å¯åŠ¨ã€‚è¿™æ—¶ä¼šå‡ºç°ä¸¤ç§æƒ…å†µï¼š</p>
<p>â‘  ï¼ˆå¤§æ¦‚ç‡å‡ºç°ï¼‰åœ¨çº¿ç¨‹å¯åŠ¨çš„æ—¶å€™ï¼Œ<code>test</code> å‡½æ•°å·²ç»ç»“æŸäº†è¿è¡Œï¼Œè€Œå±€éƒ¨å˜é‡ <code>a</code> çš„å†…å­˜è¢«é‡Šæ”¾ï¼Œæ­¤æ—¶å‡ºç°ç©ºæŒ‡é’ˆé”™è¯¯ï¼›</p>
<p>â‘¡ ï¼ˆå°æ¦‚ç‡å‡ºç°ï¼‰ç¨‹åºæ­£å¸¸æ‰§è¡Œï¼Œè¿™æ˜¯å› ä¸ºçº¿ç¨‹æ‰§è¡Œçš„æ¯” <code>test</code> å‡½æ•°æ›´å¿«ï¼Œå½“çº¿ç¨‹æ‰§è¡Œç»“æŸæ—¶ï¼Œ<code>a</code> è¿˜æ²¡æœ‰è¢«é‡Šæ”¾ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ <code>t = std::thread(foo, std::ref(a));</code> ä¸‹æ·»åŠ  <code>Sleep(10)</code>ï¼Œä½¿ç¨‹åºæš‚åœ <code>10 ms</code>ï¼Œä¿è¯çº¿ç¨‹ç»“æŸçš„æ—¶å€™ <code>test</code> è¿˜æœªæ‰§è¡Œå®Œæˆæ¥è§‚å¯Ÿè¿™ä¸€ç°è±¡ã€‚</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* é”™è¯¯ç¤ºä¾‹ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::thread t;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">int</span>&amp; x)</span> </span>&#123;</span><br><span class="line">	x += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> a = <span class="number">1</span>;</span><br><span class="line">	t = std::<span class="built_in">thread</span>(foo, std::<span class="built_in">ref</span>(a));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">test</span>();</span><br><span class="line">	t.<span class="built_in">join</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ä¿®æ”¹ç¤ºä¾‹ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::thread t;</span><br><span class="line"><span class="type">int</span> a = <span class="number">1</span>;		<span class="comment">// å»¶é•¿ a çš„å£°æ˜å‘¨æœŸ</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">int</span>&amp; x)</span> </span>&#123;</span><br><span class="line">	x += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// int a = 1;</span></span><br><span class="line">	t = std::<span class="built_in">thread</span>(foo, std::<span class="built_in">ref</span>(a));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">test</span>();</span><br><span class="line">	t.<span class="built_in">join</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* æ‹“å±• */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::thread t;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">int</span>&amp; x)</span> </span>&#123;</span><br><span class="line">	x += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> a = <span class="number">1</span>;</span><br><span class="line">	t = std::<span class="built_in">thread</span>(foo, std::<span class="built_in">ref</span>(a));</span><br><span class="line">    <span class="built_in">Sleep</span>(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">test</span>();</span><br><span class="line">	t.<span class="built_in">join</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-3-ä¼ é€’æŒ‡é’ˆæˆ–å¼•ç”¨æŒ‡å‘å·²ç»é‡Šæ”¾çš„å†…å­˜é—®é¢˜"><a href="#4-3-ä¼ é€’æŒ‡é’ˆæˆ–å¼•ç”¨æŒ‡å‘å·²ç»é‡Šæ”¾çš„å†…å­˜é—®é¢˜" class="headerlink" title="4.3 ä¼ é€’æŒ‡é’ˆæˆ–å¼•ç”¨æŒ‡å‘å·²ç»é‡Šæ”¾çš„å†…å­˜é—®é¢˜"></a>4.3 ä¼ é€’æŒ‡é’ˆæˆ–å¼•ç”¨æŒ‡å‘å·²ç»é‡Šæ”¾çš„å†…å­˜é—®é¢˜</h4><ul>
<li><p>é”™è¯¯ç¤ºä¾‹ï¼šè¿™ä¸ªé—®é¢˜å’Œä¸Šé¢çš„é—®é¢˜æ˜¯å·®ä¸å¤šçš„é—®é¢˜ï¼Œè¿™é‡Œæœ‰å¯èƒ½ä¼šâ‘  ç›´æ¥æŠ¥ç¼–è¯‘é”™è¯¯ï¼›â‘¡ é€šè¿‡ç¼–è¯‘ï¼Œä½†æ˜¯ç»™å‡ºä¸æœŸå¾…çš„ç»“æœï¼›â‘¢ æå°æ¦‚ç‡å‡ºç°æ­£å¸¸æ‰§è¡Œçš„æƒ…å†µã€‚</p>
<p>å½“æˆ‘ä»¬å¯åŠ¨çº¿ç¨‹åï¼Œæ‰‹åŠ¨é‡Šæ”¾ <code>ptr_a</code>ï¼Œæ­¤æ—¶è‹¥çº¿ç¨‹ <code>t</code> çš„æ‰§è¡Œåœ¨é‡Šæ”¾å†…å­˜ä¹‹å‰ï¼ˆå°æ¦‚ç‡ï¼‰ï¼Œä¸ä¼šå‡ºç°ä¸æœŸå¾…çš„è®¿é—®ç»“æœï¼›ä½†æ˜¯å¦‚æœçº¿ç¨‹ <code>t</code> åœ¨é‡Šæ”¾å†…å­˜ä¹‹åæ‰§è¡Œï¼ˆå¤§æ¦‚ç‡ï¼‰ï¼Œåˆ™ä¼šå‡ºç°ä¸æœŸå¾…çš„ç»“æœã€‚</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* é”™è¯¯ç¤ºä¾‹ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::thread t;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">int</span>* x)</span> </span>&#123;</span><br><span class="line">	*x += <span class="number">1</span>;</span><br><span class="line">	std::cout &lt;&lt; *x &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span>* ptr_a = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">1</span>);		<span class="comment">// å®šä¹‰ä¸€ä¸ªæŒ‡é’ˆç±»å‹çš„å˜é‡ ptr_a</span></span><br><span class="line">									<span class="comment">// åˆå§‹åŒ–ä¸ºå…¶å†…å­˜ä¸­å­˜å‚¨çš„å€¼ä¸º 1</span></span><br><span class="line">	<span class="function">std::thread <span class="title">t</span><span class="params">(foo, ptr_a)</span></span>;</span><br><span class="line">	<span class="keyword">delete</span> ptr_a;					<span class="comment">// è¿™é‡Œæ‰‹åŠ¨é‡Šæ”¾ ptr_a</span></span><br><span class="line"></span><br><span class="line">	t.<span class="built_in">join</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ä¿®æ”¹ç¤ºä¾‹ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::thread t;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">int</span>* x)</span> </span>&#123;</span><br><span class="line">	*x += <span class="number">1</span>;</span><br><span class="line">	std::cout &lt;&lt; *x &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span>* ptr_a = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">1</span>);		<span class="comment">// å®šä¹‰ä¸€ä¸ªæŒ‡é’ˆç±»å‹çš„å˜é‡ ptr_a</span></span><br><span class="line">									<span class="comment">// åˆå§‹åŒ–ä¸ºå…¶å†…å­˜ä¸­å­˜å‚¨çš„å€¼ä¸º 1</span></span><br><span class="line">	<span class="function">std::thread <span class="title">t</span><span class="params">(foo, ptr_a)</span></span>;</span><br><span class="line">    <span class="built_in">Sleep</span>(<span class="number">10</span>);						<span class="comment">// å¯åŠ¨çº¿ç¨‹åç­‰å¾… 10 ms, æ­¤æ—¶çº¿ç¨‹å¤§æ¦‚ç‡å·²ç»æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">	<span class="keyword">delete</span> ptr_a;					<span class="comment">// è¿™é‡Œæ‰‹åŠ¨é‡Šæ”¾ ptr_a</span></span><br><span class="line"></span><br><span class="line">	t.<span class="built_in">join</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-4-ç±»æˆå‘˜ä½œä¸ºå…¥å£å‡½æ•°ï¼Œç±»å¯¹è±¡è¢«æå‰é‡Šæ”¾"><a href="#4-4-ç±»æˆå‘˜ä½œä¸ºå…¥å£å‡½æ•°ï¼Œç±»å¯¹è±¡è¢«æå‰é‡Šæ”¾" class="headerlink" title="4.4 ç±»æˆå‘˜ä½œä¸ºå…¥å£å‡½æ•°ï¼Œç±»å¯¹è±¡è¢«æå‰é‡Šæ”¾"></a>4.4 ç±»æˆå‘˜ä½œä¸ºå…¥å£å‡½æ•°ï¼Œç±»å¯¹è±¡è¢«æå‰é‡Šæ”¾</h4><ul>
<li><p>é”™è¯¯ç¤ºä¾‹ï¼šè¿™ä¸ªé”™è¯¯å’Œä¸Šé¢çš„é”™è¯¯åŸºæœ¬ä¸Šæ²¡æœ‰åŒºåˆ«ï¼Œåªä¸è¿‡æ˜¯å°†è¦ <code>int</code> å‹æ¢æˆäº†<em>ç±»</em> ç±»å‹ã€‚</p>
<p>åœ¨ <code>main</code> å‡½æ•°ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ª <code>MyClass</code> ç±»å‹çš„å¯¹è±¡ <code>obj</code>ã€‚æ¥ç€ï¼Œå¯åŠ¨äº†ä¸€ä¸ªçº¿ç¨‹ <code>t</code>ï¼Œè¿™ä¸ªçº¿ç¨‹æ‰§è¡Œ <code>MyClass::func</code>ï¼Œå¹¶ä¼ é€’ <code>obj</code> çš„åœ°å€ <code>&amp;obj</code> ç»™å®ƒï¼Œè¿™é‡Œçš„ <code>&amp;obj</code> ä¸º <code>this</code> æŒ‡é’ˆã€‚å½“ <code>t</code> çº¿ç¨‹å¯åŠ¨æ—¶ï¼Œå®ƒä¼šåœ¨åå°æ‰§è¡Œ <code>MyClass::func</code>ï¼Œä½†æ˜¯ï¼Œ<code>main</code> å‡½æ•°åœ¨å¯åŠ¨çº¿ç¨‹åç«‹å³è¿”å›ï¼Œè€Œæ²¡æœ‰ç­‰å¾…çº¿ç¨‹å®Œæˆã€‚æ­¤æ—¶ï¼Œå±€éƒ¨å˜é‡ <code>obj</code> ä¼šè¢«é”€æ¯ã€‚å¦‚æœ <code>t</code> çº¿ç¨‹è¿˜æ²¡æœ‰æ‰§è¡Œå®Œ <code>MyClass::func</code>ï¼Œåˆ™å®ƒå°†å°è¯•è®¿é—®ä¸€ä¸ªå·²ç»é”€æ¯çš„å¯¹è±¡ï¼Œå¯¼è‡´æœªå®šä¹‰è¡Œä¸ºå’Œè¿è¡Œæ—¶é”™è¯¯ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆçš„æ–¹å¼æ¥é˜²æ­¢å‡ºç°æŒ‡é’ˆæå‰é‡Šæ”¾çš„æƒ…å†µï¼Œä½¿ç”¨ <code>std::shared_ptr&lt;MyClass&gt;</code> åˆ›å»ºå¹¶ç®¡ç† <code>MyClass</code> å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚<code>std::make_shared&lt;MyClass&gt;()</code> åˆ›å»ºä¸€ä¸ª <code>shared_ptr</code>ï¼Œå¹¶è¿”å›ä¸€ä¸ªæŒ‡å‘å †ä¸Šåˆ†é…çš„ <code>MyClass</code> å¯¹è±¡çš„å…±äº«æŒ‡é’ˆã€‚ä¼ é€’ <code>obj</code>ï¼ˆ<code>shared_ptr</code>ï¼‰ç»™ <code>std::thread</code> çš„æ„é€ å‡½æ•°æ—¶ï¼Œä¼šå¢åŠ å¼•ç”¨è®¡æ•°ï¼Œç¡®ä¿ <code>MyClass</code> å¯¹è±¡åœ¨ <code>obj</code> å’Œçº¿ç¨‹ä¸­éƒ½æœ‰æ•ˆã€‚</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* é”™è¯¯ç¤ºä¾‹ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::thread t;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;[Thread &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot;] Started...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;[Thread &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot;] Finished...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	MyClass obj;</span><br><span class="line">	<span class="function">std::thread <span class="title">t</span><span class="params">(&amp;MyClass::func, &amp;obj)</span></span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* æ­£ç¡®ä¿®æ”¹ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::thread t;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;[Thread &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot;] Started...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;[Thread &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot;] Finished...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ</span></span><br><span class="line">	std::shared_ptr&lt;MyClass&gt; obj = std::<span class="built_in">make_shared</span>&lt;MyClass&gt;();</span><br><span class="line">	<span class="function">std::thread <span class="title">t</span><span class="params">(&amp;MyClass::func, obj)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¿è¯çº¿ç¨‹è¿è¡Œç»“æŸå†é€€å‡ºä¸»ç¨‹åº</span></span><br><span class="line">    t.<span class="built_in">join</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ§¶-5-äº’æ–¥é‡è§£å†³å¤šçº¿ç¨‹æ•°æ®å…±äº«é—®é¢˜"><a href="#ğŸ§¶-5-äº’æ–¥é‡è§£å†³å¤šçº¿ç¨‹æ•°æ®å…±äº«é—®é¢˜" class="headerlink" title="ğŸ§¶ 5. äº’æ–¥é‡è§£å†³å¤šçº¿ç¨‹æ•°æ®å…±äº«é—®é¢˜"></a>ğŸ§¶ 5. äº’æ–¥é‡è§£å†³å¤šçº¿ç¨‹æ•°æ®å…±äº«é—®é¢˜</h3><p><strong>æ•°æ®å…±äº«é—®é¢˜ï¼š</strong>åœ¨å¤šä¸ªçº¿ç¨‹ä¸­å…±äº«æ•°æ®æ—¶ï¼Œéœ€è¦æ³¨æ„ <em><strong>çº¿ç¨‹å®‰å…¨</strong></em> é—®é¢˜ã€‚å¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€ä¸ªå˜é‡ï¼Œå¹¶ä¸”å…¶ä¸­è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹è¯¥å˜é‡è¿›è¡Œäº†å†™æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°<strong>æ•°æ®ç«äº‰</strong>é—®é¢˜ã€‚æ•°æ®ç«äº‰å¯èƒ½å¯¼è‡´ç¨‹åºå´©æºƒã€äº§ç”Ÿæœªå®šä¹‰é”™è¯¯æˆ–è€…å¾—åˆ°é”™è¯¯çš„ç»“æœã€‚</p>
<p>ä¸ºäº†é¿å…æ•°æ®ç«äº‰é—®é¢˜ï¼Œéœ€è¦ä½¿ç”¨<strong>åŒæ­¥æœºåˆ¶</strong>æ¥ç¡®ä¿å¤šä¸ªçº¿ç¨‹ä¹‹é—´å¯¹å…±äº«æ•°æ®çš„è®¿é—®é‡æ˜¯å®‰å…¨çš„ã€‚å¸¸è§çš„åŒæ­¥æœºåˆ¶åŒ…æ‹¬<strong>äº’æ–¥é‡</strong>ã€<strong>æ¡ä»¶æ“ä½œ</strong>ã€<strong>åŸå­æ“ä½œ</strong>ç­‰ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ä¸‹é¢è¿™å¼ å›¾ï¼Œæ¥ä½“ä¼šä¸€ä¸‹æ²¡æœ‰é”çš„æƒ…å†µä¸‹å¯¼è‡´çš„å¤šçº¿ç¨‹æ•°æ®å…±äº«çš„é—®é¢˜ã€‚æˆ‘ä»¬æœ‰ä¸¤ä¸ªçº¿ç¨‹ <code>Thread 1</code> å’Œ <code>Thread 2</code>ï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹éƒ½åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå…¶æ“ä½œéƒ½æ˜¯ <code>a += 1</code>ã€‚å…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š<br>â‘  æ­¤æ—¶æˆ‘ä»¬æœ‰ä¸€ä¸ªå˜é‡ <code>a = 1</code>ï¼Œé¦–å…ˆ <code>Thread 1</code> è·å–åˆ°äº† <code>a</code>ï¼Œæ‰§è¡Œæ“ä½œå <code>a=2</code>ï¼›</p>
<p>â‘¡ <code>Thread 2</code> è·å–åˆ°äº† <code>a</code>ï¼Œæ‰§è¡Œæ“ä½œå <code>a=3</code>ï¼›</p>
<p>â‘¢ <code>Thread 1</code> è·å–åˆ°äº† <code>a</code>ï¼Œæ‰§è¡Œæ“ä½œå <code>a=4</code>ï¼›</p>
<p>â‘£ <code>Thread 2</code> è·å–åˆ°äº† <code>a</code>ï¼Œæ‰§è¡Œæ“ä½œå <code>a=5</code>ï¼›</p>
<p>â‘¤ <code>Thread 1</code> å’Œ <code>Thread 2</code> åŒæ—¶è·å–åˆ°äº† <code>a</code>ï¼ŒåŒæ—¶æ‰§è¡Œæ“ä½œå <code>a=6</code>ï¼›</p>
<p>ä¸€å…±æ‰§è¡Œäº† <code>6</code> æ¬¡æ“ä½œï¼Œ<code>a</code> åº”è¯¥ç”± <code>1</code> å˜æˆ <code>7</code>ã€‚ä½†æ˜¯å®é™…ä¸Šä»–æœ€ç»ˆçš„ç»“æœæ˜¯ <code>6</code> ã€‚</p>
<img src="./Cpp_Muti_Threaded/ThreadWithNoMutex.png" style="zoom: 50%;" >

<p><strong>ä¸‹é¢æ¼”ç¤ºè¿™ç§é”™è¯¯ï¼š</strong></p>
<p>åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬è¿è¡Œäº†ä¸¤ä¸ªçº¿ç¨‹ <code>t1</code> å’Œ <code>t2</code>ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½è®© <code>a</code> åŠ  <code>50,000</code>ï¼Œå› æ­¤æˆ‘ä»¬æœŸå¾…çš„ç»“æœæ˜¯ <code>100,000</code>ã€‚ä½†æ˜¯å®é™…ä¸Šè¿è¡Œçš„ç»“æœä¸€èˆ¬æ˜¯å°äº <code>100,000</code> çš„ã€‚æ¯”å¦‚æˆ‘è¿è¡Œäº†å‡ æ¬¡ï¼Œåˆ†åˆ«æ˜¯ï¼š<code>78,301</code>ã€<code>61603</code>ã€<code>54843</code>ã€‚è¯´æ˜ä¸¤ä¸ªçº¿ç¨‹å¤šä¸ªç¬é—´åŒæ—¶è·å–åˆ°äº†å˜é‡ <code>a</code>ã€‚</p>
<p>å½“ç„¶ï¼Œå¾ªç¯æ¬¡æ•°è¾ƒå°çš„æ—¶å€™ä¹Ÿè®¸ä¼šå‡ºç°ç»“æœæ­£ç¡®çš„é—®é¢˜ï¼Œè¿™æ˜¯å› ä¸ºç¼–è¯‘å™¨å¸®æˆ‘ä»¬æ±‡ç¼–æˆäº†åŸå­æ“ä½œã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* é”™è¯¯ç¤ºä¾‹ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50000</span>; i++) &#123;</span><br><span class="line">		a += <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="function">std::thread <span class="title">t1</span><span class="params">(func)</span></span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">t2</span><span class="params">(func)</span></span>;</span><br><span class="line">	t1.<span class="built_in">join</span>();</span><br><span class="line">	t2.<span class="built_in">join</span>();</span><br><span class="line">	std::cout &lt;&lt; a &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <strong>äº’æ–¥é‡<code>mutex</code></strong> å¯¹å˜é‡è¿›è¡Œä¸Šé”æ“ä½œã€‚**äº’æ–¥é‡çš„å¤´æ–‡ä»¶æ˜¯ï¼š<code>#include &lt;mutex&gt;</code>**ã€‚</p>
<p>æˆ‘ä»¬ä¿®æ”¹ç¨‹åºå¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">std::mutex mtx;			<span class="comment">// å®šä¹‰äº’æ–¥é‡</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50000</span>; i++) &#123;</span><br><span class="line">		mtx.<span class="built_in">lock</span>();		<span class="comment">// åŠ é”æ“ä½œ</span></span><br><span class="line">		a += <span class="number">1</span>;</span><br><span class="line">		mtx.<span class="built_in">unlock</span>();	<span class="comment">// è§£é”æ“ä½œ</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="function">std::thread <span class="title">t1</span><span class="params">(func)</span></span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">t2</span><span class="params">(func)</span></span>;</span><br><span class="line">	t1.<span class="built_in">join</span>();</span><br><span class="line">	t2.<span class="built_in">join</span>();</span><br><span class="line">	std::cout &lt;&lt; a &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>å¦‚ä½•åˆ¤æ–­çº¿ç¨‹æ˜¯å¦æ˜¯å®‰å…¨çš„</strong>ï¼šå½“å¤šçº¿ç¨‹ç¨‹åºæ¯ä¸€æ¬¡è¿è¡Œçš„ç»“æœï¼Œå’Œå•çº¿ç¨‹ç¨‹åºè¿è¡Œçš„ç»“æœå§‹ç»ˆéƒ½ä¸€æ ·ï¼Œåˆ™è®¤ä¸ºä½ çš„çº¿ç¨‹æ˜¯å®‰å…¨çš„ã€‚</p>
<h3 id="ğŸ§¶-6-äº’æ–¥é‡æ­»é”"><a href="#ğŸ§¶-6-äº’æ–¥é‡æ­»é”" class="headerlink" title="ğŸ§¶ 6. äº’æ–¥é‡æ­»é”"></a>ğŸ§¶ 6. äº’æ–¥é‡æ­»é”</h3><p>å‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹ <code>Thread 1</code> å’Œ <code>Thread 2</code>ï¼Œä»–ä»¬éœ€è¦å¯¹äº’æ–¥é‡ <code>mtx1</code> å’Œäº’æ–¥é‡<code>mtx2</code> è¿›è¡Œè®¿é—®ï¼Œè€Œä¸”éœ€è¦æŒ‰ç…§ä»¥ä¸‹é¡ºåº<strong>è·å–äº’æ–¥é‡çš„æ‰€æœ‰æƒï¼ˆè·å–æ‰€æœ‰æƒå¯ä»¥ç†è§£ä¸º<em>åŠ é”æ“ä½œ</em> ï¼‰</strong>ï¼š</p>
<ul>
<li><code>Thread 1</code> å…ˆè·å– <code>mtx1</code> çš„æ‰€æœ‰æƒï¼Œå†è·å– <code>mtx2</code> çš„æ‰€æœ‰æƒã€‚</li>
<li><code>Thread 2</code> å…ˆè·å– <code>mtx2</code> çš„æ‰€æœ‰æƒï¼Œå†è·å– <code>mtx1</code> çš„æ‰€æœ‰æƒã€‚</li>
</ul>
<p>æ­¤æ—¶å¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œï¼Œå°±ä¼šäº§ç”Ÿæ­»é”ï¼š</p>
<p><code>Thread 1</code> æ‹¿åˆ°äº† <code>mtx1</code>ï¼ŒåŒæ—¶ <code>Thread 2</code> æ‹¿åˆ°äº† <code>mtx2</code>ã€‚</p>
<p>ä½†æ˜¯æ­¤æ—¶å› ä¸º <code>Thread 2</code> å æœ‰ <code>mtx2</code> æ‰€ä»¥ <code>Thread 1</code> ç­‰å¾… <code>mtx2</code> ç©ºé—²ï¼›è€Œ <code>Thread 1</code> å æœ‰ <code>mtx1</code>ï¼Œæ‰€ä»¥ <code>Thread 2</code> ç­‰å¾… <code>mtx1</code> ç©ºé—²ã€‚</p>
<p>æ‰€ä»¥æ­¤æ—¶ <code>Thread 1</code> å’Œ <code>Thread 2</code> éƒ½æ— æ³•è¿›ä¸€æ­¥æ“ä½œï¼Œæ‰€ä»¥é€ æˆäº†æ­»é”ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* æ­»é”æ¨¡æ‹Ÿ */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::mutex mtx1, mtx2;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func_1</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	mtx1.<span class="built_in">lock</span>();		<span class="comment">// å…ˆè·å– mtx1</span></span><br><span class="line">	<span class="built_in">Sleep</span>(<span class="number">1000</span>);		<span class="comment">// è¿™é‡Œåœç­‰ 1s, ç¡®ä¿ thread_2 æŠ¢å åˆ° mtx2</span></span><br><span class="line">	mtx2.<span class="built_in">lock</span>();		<span class="comment">// å†è·å– mtx2</span></span><br><span class="line">	mtx2.<span class="built_in">unlock</span>();		<span class="comment">// é‡Šæ”¾ mtx2</span></span><br><span class="line">	mtx1.<span class="built_in">unlock</span>();		<span class="comment">// é‡Šæ”¾ mtx1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func_2</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	mtx2.<span class="built_in">lock</span>();		<span class="comment">// å…ˆè·å– mtx2</span></span><br><span class="line">	mtx1.<span class="built_in">lock</span>();		<span class="comment">// å†è·å– mtx1</span></span><br><span class="line">	mtx1.<span class="built_in">unlock</span>();		<span class="comment">// é‡Šæ”¾ mtx1</span></span><br><span class="line">	mtx2.<span class="built_in">unlock</span>();		<span class="comment">// é‡Šæ”¾ mtx2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="function">std::thread <span class="title">thread_1</span><span class="params">(func_1)</span></span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">thread_2</span><span class="params">(func_2)</span></span>;</span><br><span class="line">	thread_1.<span class="built_in">join</span>();</span><br><span class="line">	thread_2.<span class="built_in">join</span>();</span><br><span class="line">	std::cout &lt;&lt; <span class="string">&quot;THREAD OVER...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥ç”¨é¡ºåºé”è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œå³ä¸¤ä¸ªå‡½æ•°éƒ½å…ˆè·å– <code>mtx1</code> çš„æ‰€æœ‰æƒã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::mutex mtx1, mtx2;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func_1</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	mtx1.<span class="built_in">lock</span>();		<span class="comment">// å…ˆè·å– mtx1</span></span><br><span class="line">	mtx2.<span class="built_in">lock</span>();		<span class="comment">// å†è·å– mtx2</span></span><br><span class="line">	mtx2.<span class="built_in">unlock</span>();		<span class="comment">// é‡Šæ”¾ mtx2</span></span><br><span class="line">	mtx1.<span class="built_in">unlock</span>();		<span class="comment">// é‡Šæ”¾ mtx1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func_2</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	mtx1.<span class="built_in">lock</span>();		<span class="comment">// å…ˆè·å– mtx1</span></span><br><span class="line">	mtx2.<span class="built_in">lock</span>();		<span class="comment">// å†è·å– mtx2</span></span><br><span class="line">	mtx2.<span class="built_in">unlock</span>();		<span class="comment">// é‡Šæ”¾ mtx2</span></span><br><span class="line">	mtx1.<span class="built_in">unlock</span>();		<span class="comment">// é‡Šæ”¾ mtx1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="function">std::thread <span class="title">thread_1</span><span class="params">(func_1)</span></span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">thread_2</span><span class="params">(func_2)</span></span>;</span><br><span class="line">	thread_1.<span class="built_in">join</span>();</span><br><span class="line">	thread_2.<span class="built_in">join</span>();</span><br><span class="line">	std::cout &lt;&lt; <span class="string">&quot;THREAD OVER...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ§¶-7-lock-guard-å’Œ-unique-lock"><a href="#ğŸ§¶-7-lock-guard-å’Œ-unique-lock" class="headerlink" title="ğŸ§¶ 7. lock_guard å’Œ unique_lock()"></a>ğŸ§¶ 7. <code>lock_guard</code> å’Œ <code>unique_lock()</code></h3><h4 id="7-1-lock-guard"><a href="#7-1-lock-guard" class="headerlink" title="7.1 lock_guard"></a>7.1 <code>lock_guard</code></h4><p><code>lock_guard</code> æ˜¯ <code>C++</code> æ ‡å‡†åº“ä¸­ä¸€ç§äº’æ–¥é‡çš„å°è£…ç±»ï¼Œç”¨äºä¿æŠ¤å…±äº«æ•°æ®ï¼Œé˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ç»Ÿä¸€èµ„æºè€Œå¯¼è‡´çš„æ•°æ®ç«äº‰é—®é¢˜ã€‚<code>lock_guard</code> å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ã€‚</p>
<ul>
<li>å½“æ„é€ å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œè¯¥äº’æ–¥é‡ä¼šè¢«è‡ªåŠ¨é”å®š</li>
<li>å½“ææ„å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œè¯¥äº’æ–¥é‡ä¼šè¢«è‡ªåŠ¨è§£é”</li>
<li><code>std::lock_guard</code> å¯¹è±¡ä¸èƒ½å¤åˆ¶æˆ–ç§»åŠ¨ï¼Œå› æ­¤ä»–åªèƒ½åœ¨å±€éƒ¨ä½œç”¨åŸŸä¸­ä½¿ç”¨</li>
</ul>
<p>ä¸‹é¢ç®€å•çœ‹å‡ æ®µä»£ç ï¼Œæ¥ä½“ä¼šä¸€ä¸‹ä¸ä½¿ç”¨ <code>lock_guard</code> å’Œä½¿ç”¨ <code>lock_guard</code> çš„åŒºåˆ«ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ä¸ä½¿ç”¨ lock_guard å’Œ unique_lock() */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">std::mutex mtx;			<span class="comment">// å®šä¹‰äº’æ–¥é‡</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50000</span>; i++) &#123;</span><br><span class="line">		mtx.<span class="built_in">lock</span>();		<span class="comment">// åŠ é”æ“ä½œ</span></span><br><span class="line">		a += <span class="number">1</span>;</span><br><span class="line">		mtx.<span class="built_in">unlock</span>();	<span class="comment">// è§£é”æ“ä½œ</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="function">std::thread <span class="title">t1</span><span class="params">(func)</span></span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">t2</span><span class="params">(func)</span></span>;</span><br><span class="line">	t1.<span class="built_in">join</span>();</span><br><span class="line">	t2.<span class="built_in">join</span>();</span><br><span class="line">	std::cout &lt;&lt; a &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬æ·»åŠ  <code>lock_guard</code> åï¼Œä»£ç ä¼šå˜æˆè¿™æ ·ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">std::mutex mtx;			<span class="comment">// å®šä¹‰äº’æ–¥é‡</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50000</span>; i++) &#123;</span><br><span class="line">		<span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lg</span><span class="params">(mtx)</span></span>;	<span class="comment">// è¿™é‡Œè°ƒç”¨äº†æ„é€ å‡½æ•°, mtx è‡ªåŠ¨åŠ é”</span></span><br><span class="line">		a += <span class="number">1</span>;</span><br><span class="line">	&#125; <span class="comment">// è¿™é‡Œè°ƒç”¨äº†ææ„å‡½æ•°, mtx è‡ªåŠ¨è§£é”</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="function">std::thread <span class="title">t1</span><span class="params">(func)</span></span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">t2</span><span class="params">(func)</span></span>;</span><br><span class="line">	t1.<span class="built_in">join</span>();</span><br><span class="line">	t2.<span class="built_in">join</span>();</span><br><span class="line">	std::cout &lt;&lt; a &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥è¯¦ç»†å‰–æ <code>lock_guard</code> çš„æºç ï¼Œæ¥æ·±åˆ»ç†è§£è¯¥ç±»ã€‚</p>
<p>è¡¥å……é˜…è¯»ï¼š<a target="_blank" rel="noopener" href="https://blog.csdn.net/chaipp0607/article/details/100128842">C++ using ç”¨æ³•</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Mutex</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">_NODISCARD</span> lock_guard &#123; <span class="comment">// class with destructor that unlocks a mutex</span></span><br><span class="line"><span class="comment">// è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªæ¨¡æ¿ç±» lock_guard, å…¶ä¸­ _Mutex æ˜¯æ¨¡æ¿å‚æ•°, è¡¨ç¤ºäº’æ–¥é”çš„ç±»å‹</span></span><br><span class="line"><span class="comment">// _NODISCARD æ˜¯ä¸€ä¸ªå±æ€§, è¡¨ç¤ºè¿™ä¸ªç±»ä¸åº”è¯¥è¢«å¿½ç•¥(é€šå¸¸æ˜¯ä¸ºäº†è­¦å‘Šå¼€å‘è€…ä¸è¦å¿½ç•¥è¿™ä¸ªç±»çš„å¯¹è±¡åˆ›å»º)</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> mutex_type = _Mutex;	<span class="comment">// å®šä¹‰ä¸€ä¸ªåˆ«å mutex_type, æŒ‡å‘æ¨¡æ¿å‚æ•° _Mutex</span></span><br><span class="line">    							<span class="comment">// è¿™æ ·å¯ä»¥æ–¹ä¾¿åœ°åœ¨ç±»çš„å…¶ä»–åœ°æ–¹ä½¿ç”¨ mutex_type æ¥è¡¨ç¤ºäº’æ–¥é”çš„ç±»å‹</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°, æ¥æ”¶ä¸€ä¸ªäº’æ–¥é”çš„å¼•ç”¨ _Mtx</span></span><br><span class="line">    <span class="comment">// explicit å…³é”®å­—é˜²æ­¢éšå¼è½¬æ¢</span></span><br><span class="line">    <span class="comment">// åœ¨æ„é€ å‡½æ•°ä½“å†…, è°ƒç”¨ _MyMutex.lock() æ–¹æ³•é”å®šäº’æ–¥é”</span></span><br><span class="line">    <span class="comment">// è¿™æ ·, å½“ lock_guard å¯¹è±¡è¢«åˆ›å»ºæ—¶, äº’æ–¥é”ä¼šè‡ªåŠ¨è¢«é”å®š</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">lock_guard</span><span class="params">(_Mutex&amp; _Mtx)</span> : _MyMutex(_Mtx) &#123;</span> <span class="comment">// construct and lock</span></span><br><span class="line">        _MyMutex.<span class="built_in">lock</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™æ˜¯å¦ä¸€ä¸ªæ„é€ å‡½æ•°, æ¥æ”¶ä¸€ä¸ªäº’æ–¥é”çš„å¼•ç”¨ _Mtx å’Œä¸€ä¸ªæ ‡è®°ç±»å‹ adopt_lock_t</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªæ„é€ å‡½æ•°ä¸ä¼šé”å®šäº’æ–¥é”, å‡è®¾äº’æ–¥é”å·²ç»è¢«é”å®š</span></span><br><span class="line">    <span class="comment">// adopt_lock_t é€šå¸¸æ˜¯ä¸€ä¸ªç©ºçš„ç»“æ„ä½“ç±»å‹, ç”¨äºåŒºåˆ†ä¸åŒçš„æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="built_in">lock_guard</span>(_Mutex&amp; _Mtx, <span class="type">adopt_lock_t</span>) : _MyMutex(_Mtx) &#123;&#125; <span class="comment">// construct but don&#x27;t lock</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ææ„å‡½æ•°æ ‡è®°ä¸º noexcept, è¡¨ç¤ºä¸ä¼šæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="comment">// å½“ lock_guard å¯¹è±¡è¢«é”€æ¯æ—¶, è°ƒç”¨ _MyMutex.unlock() æ–¹æ³•è§£é”äº’æ–¥é”</span></span><br><span class="line">    <span class="comment">// è¿™ç¡®ä¿äº†å³ä½¿åœ¨å¼‚å¸¸æƒ…å†µä¸‹ï¼Œäº’æ–¥é”ä¹Ÿä¼šè¢«è§£é”ã€‚</span></span><br><span class="line">    ~<span class="built_in">lock_guard</span>() <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        _MyMutex.<span class="built_in">unlock</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ˜¾å¼åˆ é™¤æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼æ“ä½œç¬¦</span></span><br><span class="line">    <span class="comment">// é˜²æ­¢ lock_guard å¯¹è±¡è¢«å¤åˆ¶æˆ–èµ‹å€¼</span></span><br><span class="line">    <span class="comment">// è¿™æ˜¯å› ä¸ºäº’æ–¥é”çš„æ‰€æœ‰æƒä¸åº”è¯¥åœ¨å¤šä¸ªå¯¹è±¡ä¹‹é—´å…±äº«, ä»¥é¿å…æ½œåœ¨çš„å¹¶å‘é—®é¢˜ã€‚</span></span><br><span class="line">    <span class="built_in">lock_guard</span>(<span class="type">const</span> lock_guard&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    lock_guard&amp; <span class="keyword">operator</span>=(<span class="type">const</span> lock_guard&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    _Mutex&amp; _MyMutex;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">std::mutex mtx;			<span class="comment">// å®šä¹‰äº’æ–¥é‡</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50000</span>; i++) &#123;</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lg</span><span class="params">(mtx)</span></span>; <span class="comment">// 1. åˆ›å»º lock_guard å¯¹è±¡ lg </span></span><br><span class="line">        									 <span class="comment">// 2. ä¼ é€’ mtx ç»™æ„é€ å‡½æ•°çš„å‚æ•° _Mtx</span></span><br><span class="line">                                             <span class="comment">// 3. lock_guard æ„é€ å‡½æ•°è¢«è°ƒç”¨</span></span><br><span class="line">                                             <span class="comment">// 4. _MyMutex(_Mtx) åˆå§‹åŒ–ç§æœ‰æˆå‘˜ _MyMutex ä¸º mtx çš„å¼•ç”¨</span></span><br><span class="line">                                             <span class="comment">// 5. _MyMutex.lock() é”å®š mtx</span></span><br><span class="line">        a += <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="comment">// 6. å¾ªç¯ç»“æŸæ—¶, lg å¯¹è±¡é”€æ¯, è°ƒç”¨ææ„å‡½æ•° _MyMutex.unlock() è§£é” mtx</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="function">std::thread <span class="title">t1</span><span class="params">(func)</span></span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">t2</span><span class="params">(func)</span></span>;</span><br><span class="line">	t1.<span class="built_in">join</span>();</span><br><span class="line">	t2.<span class="built_in">join</span>();</span><br><span class="line">	std::cout &lt;&lt; a &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="7-2-unique-lock"><a href="#7-2-unique-lock" class="headerlink" title="7.2 unique_lock"></a>7.2 <code>unique_lock</code></h4><p><code>std::unique_lock</code> æ˜¯ <code>C++</code> æ ‡å‡†åº“ä¸­æä¾›çš„ä¸€ä¸ªäº’æ–¥é‡å°è£…ç±»ï¼Œç”¨äºåœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­å¯¹äº’æ–¥é‡è¿›è¡ŒåŠ é”å’Œè§£é”æ“ä½œã€‚ä¸ <code>lock_guard</code> ä»…æä¾›è‡ªåŠ¨çš„åŠ é”ã€è§£é”æ“ä½œä¸åŒï¼Œ<code>unique_lock</code> è¿˜æä¾›äº†å¯¹äº’æ–¥é‡è¿›è¡Œæ›´åŠ çµæ´»çš„ç®¡ç†ï¼ŒåŒ…æ‹¬ï¼šå»¶è¿ŸåŠ é”ã€æ¡ä»¶å˜é‡ã€è¶…æ—¶ç­‰ã€‚</p>
<p><code>std::unique_lock</code> æä¾›äº†ä»¥ä¸‹å‡ ä¸ªæˆå‘˜å‡½æ•°ï¼š</p>
<ul>
<li><code>lock</code>ï¼šå°è¯•å¯¹äº’æ–¥é‡è¿›è¡ŒåŠ é”æ“ä½œï¼Œå¦‚æœå½“å‰äº’æ–¥é‡å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°äº’æ–¥é‡è¢«æˆåŠŸåŠ é”ã€‚</li>
<li><code>try_lock</code>ï¼šå°è¯•å¯¹äº’æ–¥é‡è¿›è¡ŒåŠ é”æ“ä½œï¼Œå¦‚æœå½“å‰äº’æ–¥é‡å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œåˆ™ç«‹åˆ»è¿”å› <code>false</code>ï¼Œå¦åˆ™è¿”å› <code>true</code>ã€‚</li>
<li><code>try_lock_for(const std::chrono::duration&lt;Rep, Period&gt;&amp; rel_time)</code>ï¼šå°è¯•å¯¹äº’æ–¥é‡è¿›è¡ŒåŠ é”æ“ä½œï¼Œï¼Œå¦‚æœå½“å‰äº’æ–¥é‡å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°äº’æ–¥é‡è¢«æˆåŠŸåŠ é”æˆ–è¶…è¿‡äº†æŒ‡å®šæ—¶é—´ã€‚</li>
<li><code>try_lock_until(const std::chrono::time_point&lt;Clock, Duration&gt;&amp; abs_time)</code>ï¼šå°è¯•å¯¹äº’æ–¥é‡è¿›è¡ŒåŠ é”æ“ä½œï¼Œå¦‚æœå½“å‰äº’æ–¥é‡å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°äº’æ–¥é‡è¢«æˆåŠŸåŠ é”æˆ–è¶…è¿‡äº†æŒ‡å®šæ—¶é—´ç‚¹ã€‚</li>
<li><code>unlock()</code>ï¼šå¯¹äº’æ–¥é‡è¿›è¡Œè§£é”æ“ä½œ</li>
</ul>
<p>ä¸‹é¢ç®€å•çœ‹å‡ æ®µä»£ç ï¼Œæ¥ä½“ä¼šä¸€ä¸‹ä¸ä½¿ç”¨ <code>unique_lock</code> å’Œä½¿ç”¨ <code>unique_lock</code> çš„åŒºåˆ«ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ä¸ä½¿ç”¨ unique_lock */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">std::mutex mtx;			<span class="comment">// å®šä¹‰äº’æ–¥é‡</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50000</span>; i++) &#123;</span><br><span class="line">		mtx.<span class="built_in">lock</span>();		<span class="comment">// åŠ é”æ“ä½œ</span></span><br><span class="line">		a += <span class="number">1</span>;</span><br><span class="line">		mtx.<span class="built_in">unlock</span>();	<span class="comment">// è§£é”æ“ä½œ</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="function">std::thread <span class="title">t1</span><span class="params">(func)</span></span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">t2</span><span class="params">(func)</span></span>;</span><br><span class="line">	t1.<span class="built_in">join</span>();</span><br><span class="line">	t2.<span class="built_in">join</span>();</span><br><span class="line">	std::cout &lt;&lt; a &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ä½¿ç”¨ unique_lock */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">std::mutex mtx;			<span class="comment">// å®šä¹‰äº’æ–¥é‡</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50000</span>; i++) &#123;</span><br><span class="line">        <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">uniqueLock</span><span class="params">(mtx)</span></span>;</span><br><span class="line">		a += <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="function">std::thread <span class="title">t1</span><span class="params">(func)</span></span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">t2</span><span class="params">(func)</span></span>;</span><br><span class="line">	t1.<span class="built_in">join</span>();</span><br><span class="line">	t2.<span class="built_in">join</span>();</span><br><span class="line">	std::cout &lt;&lt; a &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä¸‹é¢æˆ‘ä»¬æ¼”ç¤ºä¸€ä¸‹ <code>unique_lock</code> çš„æ›´å¤šæ“ä½œï¼š</p>
<h5 id="7-2-1-lock-unlock-æ‰‹åŠ¨åŠ é”-è§£é”"><a href="#7-2-1-lock-unlock-æ‰‹åŠ¨åŠ é”-è§£é”" class="headerlink" title="7.2.1 lock()/unlock() æ‰‹åŠ¨åŠ é”&#x2F;è§£é”"></a>7.2.1 <code>lock()/unlock()</code> æ‰‹åŠ¨åŠ é”&#x2F;è§£é”</h5><p>æ—¢ç„¶ <code>unique_lock</code> æ”¯æŒè‡ªåŠ¨åŠ é”å’Œè‡ªåŠ¨è§£é”ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¸ºä»€ä¹ˆä¸è®©å®ƒè‡ªåŠ¨çš„åŠ é”å’Œè§£é”å‘¢ï¼Ÿè¿™æ˜¯å› ä¸º <code>unique_lock</code> æä¾›äº†æ›´å¤šçš„åŠ é”æ–¹å¼ï¼Œåœ¨ä½¿ç”¨å…¶ä»–åŠ é”æ–¹å¼ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ä¿è¯ <code>unique_lock</code> ä¸èƒ½è‡ªåŠ¨åŠ é”ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">uniqueLock</span><span class="params">(mtx, std::defer_lock)</span></span>; 	<span class="comment">// ä¼ å…¥ defer_lock è¡¨ç¤ºæ„é€ å‡½æ•°ä»€ä¹ˆéƒ½ä¸åš</span></span><br><span class="line">																<span class="comment">// åŠ é”/è§£é”æ“ä½œéœ€è¦ç”±ç¨‹åºå‘˜è‡ªå·±å®Œæˆ</span></span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆä¸‹é¢å°†ä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ä¸ä½¿ç”¨ unique_lock */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">std::mutex mtx;			<span class="comment">// å®šä¹‰äº’æ–¥é‡</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50000</span>; i++) &#123;</span><br><span class="line">		<span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">uniqueLock</span><span class="params">(mtx, std::defer_lock)</span></span>;	<span class="comment">// ä½¿ç”¨ unique_lock è¿›è¡Œè‡ªåŠ¨åŠ é”</span></span><br><span class="line">		uniqueLock.<span class="built_in">lock</span>();</span><br><span class="line">		a += <span class="number">1</span>;</span><br><span class="line">		uniqueLock.<span class="built_in">unlock</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="function">std::thread <span class="title">t1</span><span class="params">(func)</span></span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">t2</span><span class="params">(func)</span></span>;</span><br><span class="line">	t1.<span class="built_in">join</span>();</span><br><span class="line">	t2.<span class="built_in">join</span>();</span><br><span class="line">	std::cout &lt;&lt; a &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="7-2-2-try-lock-å°è¯•åŠ é”"><a href="#7-2-2-try-lock-å°è¯•åŠ é”" class="headerlink" title="7.2.2 try_lock å°è¯•åŠ é”"></a>7.2.2 <code>try_lock</code> å°è¯•åŠ é”</h5><p>å°è¯•å¯¹äº’æ–¥é‡è¿›è¡ŒåŠ é”æ“ä½œï¼Œå¦‚æœå½“å‰äº’æ–¥é‡å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°äº’æ–¥é‡è¢«æˆåŠŸåŠ é”ã€‚</p>
<h5 id="7-2-3-try-lock-for-const-std-chrono-duration-rel-time"><a href="#7-2-3-try-lock-for-const-std-chrono-duration-rel-time" class="headerlink" title="7.2.3 try_lock_for(const std::chrono::duration&lt;Rep, Period&gt;&amp; rel_time)"></a>7.2.3 <code>try_lock_for(const std::chrono::duration&lt;Rep, Period&gt;&amp; rel_time)</code></h5><p>å°è¯•å¯¹äº’æ–¥é‡è¿›è¡ŒåŠ é”æ“ä½œï¼Œï¼Œå¦‚æœå½“å‰äº’æ–¥é‡å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°äº’æ–¥é‡è¢«æˆåŠŸåŠ é”æˆ–è¶…è¿‡äº†æŒ‡å®šæ—¶é—´ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">std::timed_mutex mtx;			<span class="comment">// å®šä¹‰äº’æ–¥é‡</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">		<span class="function">std::unique_lock&lt;std::timed_mutex&gt; <span class="title">uniqueLock</span><span class="params">(mtx, std::defer_lock)</span></span>;</span><br><span class="line">        <span class="comment">// è¿™é‡Œè¿›è¡Œåˆ¤æ–­, é€šè¿‡æ£€æŸ¥ try_lock_for çš„è¿”å›å€¼, åªæœ‰åœ¨æˆåŠŸé”å®šæ—¶æ‰ä¿®æ”¹ a, ä¿è¯äº†äº’æ–¥é”çš„æœ‰æ•ˆæ€§ã€‚</span></span><br><span class="line">		<span class="keyword">if</span> (uniqueLock.<span class="built_in">try_lock_for</span>(std::chrono::<span class="built_in">microseconds</span>(<span class="number">5</span>))) &#123;</span><br><span class="line">			std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">microseconds</span>(<span class="number">10</span>));</span><br><span class="line">			a += <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="function">std::thread <span class="title">t1</span><span class="params">(func)</span></span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">t2</span><span class="params">(func)</span></span>;</span><br><span class="line">	t1.<span class="built_in">join</span>();</span><br><span class="line">	t2.<span class="built_in">join</span>();</span><br><span class="line">	std::cout &lt;&lt; a &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¸¸è§é”™è¯¯ï¼š<code>&quot;try_lock_for&quot;: ä¸æ˜¯ &quot;std::mutex&quot; çš„æˆå‘˜</code>ï¼Œ<code>std::mutex</code> ä¸æ”¯æŒå»¶è¿ŸåŠ é”ï¼Œå½“æˆ‘ä»¬æƒ³è¦è¿›è¡Œå»¶è¿ŸåŠ é”æ“ä½œæ—¶ï¼Œéœ€è¦ä¿è¯äº’æ–¥é‡æ˜¯æ—¶é—´é”ï¼Œå³ <code>timed_mutex</code>ã€‚</p>
<p>æ­¤å¤–ï¼Œä¸è¦æƒ³å½“ç„¶ï¼Œä»¥ä¸‹æ˜¯ä¸€ç§å¸¸è§çš„é”™è¯¯å†™æ³•ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ä¸ä½¿ç”¨ unique_lock */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">std::timed_mutex mtx;			<span class="comment">// å®šä¹‰äº’æ–¥é‡</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">200</span>; i++) &#123;</span><br><span class="line">		<span class="function">std::unique_lock&lt;std::timed_mutex&gt; <span class="title">uniqueLock</span><span class="params">(mtx, std::defer_lock)</span></span>;</span><br><span class="line">        <span class="comment">// try_lock_for å°è¯•é”å®šäº’æ–¥é”, ä½†è¿”å›å€¼æ²¡æœ‰è¢«æ£€æŸ¥</span></span><br><span class="line">        <span class="comment">// å¦‚æœé”å®šå¤±è´¥, ä»£ç ä»ç„¶ä¼šæ‰§è¡Œ a += 1, è¿™ä¼šå¯¼è‡´æ•°æ®ç«äº‰</span></span><br><span class="line">		uniqueLock.<span class="built_in">try_lock_for</span>(std::chrono::<span class="built_in">microseconds</span>(<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å³ä½¿ try_lock_for å¤±è´¥, ä»£ç ä»ç„¶ä¼šå¢åŠ  a, è¿™ä½¿å¾—äº’æ–¥é”å½¢åŒè™šè®¾</span></span><br><span class="line">		std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">microseconds</span>(<span class="number">10</span>));</span><br><span class="line">		a += <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="7-2-4-try-lock-until-const-std-chrono-time-point-abs-time"><a href="#7-2-4-try-lock-until-const-std-chrono-time-point-abs-time" class="headerlink" title="7.2.4 try_lock_until(const std::chrono::time_point&lt;Clock, Duration&gt;&amp; abs_time)"></a>7.2.4 <code>try_lock_until(const std::chrono::time_point&lt;Clock, Duration&gt;&amp; abs_time)</code></h5><p>å°è¯•å¯¹äº’æ–¥é‡è¿›è¡ŒåŠ é”æ“ä½œï¼Œå¦‚æœå½“å‰äº’æ–¥é‡å·²ç»è¢«å…¶ä»–çº¿ç¨‹æŒæœ‰ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°äº’æ–¥é‡è¢«æˆåŠŸåŠ é”æˆ–è¶…è¿‡äº†æŒ‡å®šæ—¶é—´ç‚¹ã€‚</p>
<h3 id="ğŸ§¶-8-call-once-å®ç°å•ä¾‹æ¨¡å¼"><a href="#ğŸ§¶-8-call-once-å®ç°å•ä¾‹æ¨¡å¼" class="headerlink" title="ğŸ§¶ 8. call_once å®ç°å•ä¾‹æ¨¡å¼"></a>ğŸ§¶ 8. <code>call_once</code> å®ç°å•ä¾‹æ¨¡å¼</h3><h4 id="8-1-å•ä¾‹æ¨¡å¼"><a href="#8-1-å•ä¾‹æ¨¡å¼" class="headerlink" title="8.1 å•ä¾‹æ¨¡å¼"></a>8.1 å•ä¾‹æ¨¡å¼</h4><p><strong>å•ä¾‹æ¨¡å¼ï¼š</strong>å•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Œç”¨äºç¡®ä¿åœ¨ç³»ç»Ÿçš„æ•´ä¸ªå£°æ˜å‘¨æœŸå†…ï¼ŒæŸä¸ªç±»åªèƒ½åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼Œç¡®ä¿è¯¥ç±»çš„å”¯ä¸€æ€§ã€‚<u><em>ç”±äºå•ä¾‹æ¨¡å¼æ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œå› æ­¤åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨å•ä¾‹æ¨¡å¼æ—¶ï¼Œéœ€è¦è€ƒè™‘<strong>çº¿ç¨‹å®‰å…¨</strong>é—®é¢˜ã€‚</em></u></p>
<p><strong>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å•ä¾‹æ¨¡å¼ï¼š</strong>â‘  èŠ‚çº¦èµ„æºï¼Œä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œä¸å­˜åœ¨å¤šä»½å®ä¾‹ï¼ŒèŠ‚çœèµ„æºï¼›â‘¡ æ–¹ä¾¿æ§åˆ¶ï¼Œåœ¨ä¸€äº›æ“ä½œå…¬å…±èµ„æºçš„åœºæ™¯æ—¶ï¼Œé¿å…äº†å¤šä¸ªå¯¹è±¡å¼•èµ·çš„å¤æ‚æ“ä½œã€‚</p>
<p><strong>å•ä¾‹æ¨¡å¼åˆ†ç±»ï¼š</strong>å•ä¾‹æ¨¡å¼å¯ä»¥åˆ†ä¸º <em>æ‡’æ±‰å¼</em> å’Œ <em>é¥¿æ±‰å¼</em> ï¼Œä¸¤è€…ä¹‹é—´çš„åŒºåˆ«åœ¨äºåˆ›å»ºå®ä¾‹çš„æ—¶é—´ä¸åŒã€‚</p>
<ul>
<li><strong>æ‡’æ±‰å¼ï¼š</strong>ç³»ç»Ÿè¿è¡Œä¸­ï¼Œå®ä¾‹å¹¶ä¸å­˜åœ¨ï¼Œåªæœ‰å½“éœ€è¦ä½¿ç”¨è¯¥å®ä¾‹æ—¶ï¼Œæ‰ä¼šå»åˆ›å»ºå¹¶ä½¿ç”¨å®ä¾‹ï¼Œå»¶è¿Ÿå®ä¾‹åŒ–ã€‚è¿™ç§æ–¹å¼è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨ã€‚</li>
<li><strong>é¥¿æ±‰å¼ï¼š</strong>ç³»ç»Ÿä¸€è¿è¡Œï¼Œå°±åˆå§‹åŒ–åˆ›å»ºå®ä¾‹ï¼Œå½“éœ€è¦æ—¶ï¼Œç›´æ¥è°ƒç”¨å³å¯ï¼Œæå‰å®ä¾‹åŒ–ã€‚è¿™ç§æ–¹å¼æœ¬èº«å°±çº¿ç¨‹å®‰å…¨ï¼Œæ²¡æœ‰å¤šçº¿ç¨‹çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</li>
</ul>
<p><strong>å•ä¾‹ç±»çš„ç‰¹ç‚¹ï¼š</strong></p>
<ul>
<li>æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ä¸ºç§æœ‰ç±»å‹ï¼Œç›®çš„æ˜¯ç¦æ­¢å¤–éƒ¨æ„é€ å’Œææ„ã€‚</li>
<li>æ‹·è´æ„é€ å‡½æ•°å’Œèµ‹å€¼æ„é€ å‡½æ•°æ˜¯ç§æœ‰ç±»å‹ï¼Œç›®çš„æ˜¯ç¦æ­¢å¤–éƒ¨æ‹·è´å’Œèµ‹å€¼ï¼Œç¡®ä¿å®ä¾‹çš„å”¯ä¸€æ€§ã€‚</li>
<li>ç±»ä¸­æœ‰ä¸€ä¸ªè·å–å®ä¾‹çš„é™æ€æ–¹æ³•ï¼Œå¯ä»¥å…¨å±€è®¿é—®ã€‚</li>
</ul>
<h4 id="8-2-emplace-back-å‡½æ•°å¿«é€Ÿäº†è§£"><a href="#8-2-emplace-back-å‡½æ•°å¿«é€Ÿäº†è§£" class="headerlink" title="8.2 emplace_back å‡½æ•°å¿«é€Ÿäº†è§£"></a>8.2 <code>emplace_back</code> å‡½æ•°å¿«é€Ÿäº†è§£</h4><p>è¿™é‡Œä½¿ç”¨åˆ°äº† <code>emplace_back</code>ï¼Œ<code>emplace_back</code> æ˜¯ <code>C++ 11</code> å¼•å…¥çš„ä¸€ä¸ª <code>STL</code> å®¹å™¨æ–¹æ³•ï¼Œç”¨äºåœ¨å®¹å™¨çš„æœ«å°¾ç›´æ¥æ„é€ å…ƒç´ ã€‚ä¸ºäº†æ›´å¥½çš„ç†è§£ä»£ç ï¼Œè¿™é‡Œè¡¥å……ä¸€ä¸‹ <code>emplace_back</code> çš„åŸºæœ¬ç”¨æ³•ï¼š</p>
<p><code>emplace_back</code> æ–¹æ³•æä¾›äº†ä¸€ç§é«˜æ•ˆã€ç®€ä¾¿çš„æ–¹å¼åœ¨å®¹å™¨æœ«å°¾æ·»åŠ æ–°å…ƒç´ ã€‚ä¸ <code>push_back</code> æ–¹æ³•ä¸åŒï¼Œ<code>emplace_back</code> ç›´æ¥åœ¨å®¹å™¨å†…éƒ¨æ„é€ å…ƒç´ ï¼Œè€Œä¸æ˜¯å…ˆæ„é€ ä¸´æ—¶å¯¹è±¡ç„¶åå†ç§»åŠ¨æˆ–å¤åˆ¶åˆ°å®¹å™¨ä¸­ã€‚</p>
<h5 id="8-2-1-å…·ä½“ç¤ºä¾‹"><a href="#8-2-1-å…·ä½“ç¤ºä¾‹" class="headerlink" title="8.2.1 å…·ä½“ç¤ºä¾‹"></a>8.2.1 å…·ä½“ç¤ºä¾‹</h5><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªåŒ…å«å¤æ‚å¯¹è±¡çš„ <code>std::vector</code>ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>emplace_back</code> æ¥é¿å…ä¸å¿…è¦çš„ä¸´æ—¶å¯¹è±¡åˆ›å»ºå’Œé”€æ¯ã€‚</p>
<ul>
<li>ä½¿ç”¨ <code>push_back</code></li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MyStruct</span> &#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    std::string y;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">MyStruct</span>(<span class="type">int</span> a, <span class="type">const</span> std::string&amp; b) : <span class="built_in">x</span>(a), <span class="built_in">y</span>(b) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;MyStruct&gt; vec;</span><br><span class="line">    <span class="function">MyStruct <span class="title">obj</span><span class="params">(<span class="number">1</span>, <span class="string">&quot;example&quot;</span>)</span></span>;				<span class="comment">// å…ˆä»å¤–éƒ¨æ„é€  obj</span></span><br><span class="line">    vec.<span class="built_in">push_back</span>(obj); 					<span class="comment">// å¤åˆ¶æ„é€ </span></span><br><span class="line">    vec.<span class="built_in">push_back</span>(<span class="built_in">MyStruct</span>(<span class="number">2</span>, <span class="string">&quot;example2&quot;</span>)); <span class="comment">// ä¸´æ—¶å¯¹è±¡æ„é€ ç„¶åç§»åŠ¨æ„é€ </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨ <code>emplace_back</code></li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MyStruct</span> &#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    std::string y;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">MyStruct</span>(<span class="type">int</span> a, <span class="type">const</span> std::string&amp; b) : <span class="built_in">x</span>(a), <span class="built_in">y</span>(b) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;MyStruct&gt; vec;</span><br><span class="line">    vec.<span class="built_in">emplace_back</span>(<span class="number">1</span>, <span class="string">&quot;example&quot;</span>); 	<span class="comment">// ç›´æ¥åœ¨å®¹å™¨å†…æ„é€ </span></span><br><span class="line">    vec.<span class="built_in">emplace_back</span>(<span class="number">2</span>, <span class="string">&quot;example2&quot;</span>); 	<span class="comment">// ç›´æ¥åœ¨å®¹å™¨å†…æ„é€ </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨ä½¿ç”¨ <code>emplace_back</code> æ—¶ï¼Œæ„é€ å‡½æ•°çš„å‚æ•°ç›´æ¥ä¼ é€’ç»™å®¹å™¨å†…çš„æ–°å¯¹è±¡æ„é€ å‡½æ•°ï¼Œé¿å…äº†ä¸´æ—¶å¯¹è±¡çš„åˆ›å»ºã€‚</p>
<h5 id="8-2-2-åœ¨å¤šçº¿ç¨‹ä¸­ä½¿ç”¨-emplace-back"><a href="#8-2-2-åœ¨å¤šçº¿ç¨‹ä¸­ä½¿ç”¨-emplace-back" class="headerlink" title="8.2.2 åœ¨å¤šçº¿ç¨‹ä¸­ä½¿ç”¨ emplace_back"></a>8.2.2 åœ¨å¤šçº¿ç¨‹ä¸­ä½¿ç”¨ <code>emplace_back</code></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (int i = 0; i &lt; 10; ++i) &#123;</span><br><span class="line">    threads.emplace_back(threadFunction);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œçš„ <code>emplace_back</code> ç”¨äºå°†æ–°çš„ <code>std::thread</code> å¯¹è±¡æ·»åŠ åˆ° <code>std::vector&lt;std::thread&gt;</code> å®¹å™¨ä¸­ã€‚</p>
<p>ç­‰æ•ˆçš„ <code>push_back</code> ç”¨æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (int i = 0; i &lt; 10; ++i) &#123;</span><br><span class="line">    threads.push_back(std::thread(threadFunction));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<code>push_back</code> å’Œ <code>emplace_back</code> éƒ½å¯ä»¥ä½¿ç”¨ï¼Œä½† <code>emplace_back</code> æ›´åŠ é«˜æ•ˆï¼Œå› ä¸ºå®ƒé¿å…äº†ä¸´æ—¶å¯¹è±¡çš„åˆ›å»ºå’Œé”€æ¯ã€‚ä½¿ç”¨ <code>emplace_back</code> æ—¶ï¼Œ<code>std::thread</code> å¯¹è±¡ç›´æ¥åœ¨ <code>threads</code> å®¹å™¨ä¸­æ„é€ ï¼š</p>
<ol>
<li><strong>æ„é€ æ–°å¯¹è±¡</strong>ï¼š<code>emplace_back</code> æ–¹æ³•ç›´æ¥åœ¨å®¹å™¨çš„å†…å­˜ç©ºé—´ä¸­æ„é€ æ–°å¯¹è±¡ï¼Œè€Œä¸æ˜¯å…ˆåœ¨åˆ«å¤„æ„é€ ç„¶åç§»åŠ¨åˆ°å®¹å™¨ä¸­ã€‚</li>
<li><strong>ä¼ é€’å‚æ•°</strong>ï¼š<code>emplace_back</code> å°†ä¼ é€’çš„å‚æ•°ç›´æ¥ç”¨äºæ–°å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼Œæ­¤å¤„ <code>threadFunction</code> è¢«ä½œä¸ºæ„é€ å‡½æ•°å‚æ•°ä¼ é€’ç»™ <code>std::thread</code>ã€‚</li>
</ol>
<h5 id="8-2-3-æ€»ç»“"><a href="#8-2-3-æ€»ç»“" class="headerlink" title="8.2.3 æ€»ç»“"></a>8.2.3 æ€»ç»“</h5><p>**<code>push_back</code>**ï¼šéœ€è¦ä¸€ä¸ªå·²ç»æ„é€ å¥½çš„å¯¹è±¡ï¼ˆå¯èƒ½ä¼šå¯¼è‡´é¢å¤–çš„å¤åˆ¶æˆ–ç§»åŠ¨ï¼‰ã€‚</p>
<p>**<code>emplace_back</code>**ï¼šç›´æ¥åœ¨å®¹å™¨çš„å†…å­˜ç©ºé—´å†…æ„é€ å¯¹è±¡ï¼Œé¿å…äº†é¢å¤–çš„ä¸´æ—¶å¯¹è±¡åˆ›å»ºå’Œç§»åŠ¨æ“ä½œã€‚</p>
<p>åœ¨å¤šçº¿ç¨‹ä»£ç ä¸­ï¼Œä½¿ç”¨ <code>emplace_back</code> å¯ä»¥ä½¿ä»£ç æ›´åŠ é«˜æ•ˆå’Œç®€æ´ï¼Œå°¤å…¶æ˜¯åœ¨æ·»åŠ æ–°å¯¹è±¡åˆ°å®¹å™¨æ—¶ï¼Œå¯ä»¥é¿å…ä¸å¿…è¦çš„å¯¹è±¡æ‹·è´å’Œä¸´æ—¶å¯¹è±¡åˆ›å»ºã€‚</p>
<h4 id="8-3-çº¿ç¨‹ä¸å®‰å…¨çš„æ‡’æ±‰æ¨¡å¼"><a href="#8-3-çº¿ç¨‹ä¸å®‰å…¨çš„æ‡’æ±‰æ¨¡å¼" class="headerlink" title="8.3 çº¿ç¨‹ä¸å®‰å…¨çš„æ‡’æ±‰æ¨¡å¼"></a>8.3 çº¿ç¨‹ä¸å®‰å…¨çš„æ‡’æ±‰æ¨¡å¼</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdexcept&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ—¥å¿—ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> Logger&amp; <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="built_in">Logger</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Logger</span>(<span class="type">const</span> Logger&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    Logger&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Logger&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">log</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> </span>&#123;</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx_)</span></span>;</span><br><span class="line">        logFile_ &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">printLog</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Instance Address IS: &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; std::endl;</span><br><span class="line">        std::cout &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">Logger</span>() &#123;</span><br><span class="line">        logFile_.<span class="built_in">open</span>(<span class="string">&quot;log.txt&quot;</span>, std::ios::out | std::ios::app);</span><br><span class="line">        <span class="keyword">if</span> (!logFile_.<span class="built_in">is_open</span>()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Unable to open log file&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">Logger</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (logFile_.<span class="built_in">is_open</span>()) &#123;</span><br><span class="line">            logFile_.<span class="built_in">close</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">static</span> Logger* instance;</span><br><span class="line">    std::ofstream logFile_;</span><br><span class="line">    std::mutex mtx_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Logger* Logger::instance = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">threadFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Logger&amp; logger = Logger::<span class="built_in">getInstance</span>();</span><br><span class="line">    logger.<span class="built_in">printLog</span>(<span class="string">&quot;Logging from thread&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;std::thread&gt; threads;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">        threads.<span class="built_in">emplace_back</span>(threadFunction);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; thread : threads) &#123;</span><br><span class="line">        thread.<span class="built_in">join</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Instance Address IS: Instance Address IS: 000001FE29979930Instance Address IS: 000001FE2997A2A0</span><br><span class="line">Logging from thread</span><br><span class="line">000001FE29979930</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001FE2997C330</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001FE2997C330</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001FE2997B840</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001FE2997ACD0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001FE2997C330</span><br><span class="line">Logging from thread</span><br><span class="line">Logging from thread</span><br><span class="line"></span><br><span class="line">Instance Address IS: 000001FE2997C330</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001FE2997C330</span><br><span class="line">Logging from thread</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¤šä¸ªä¸åŒçš„å®ä¾‹åœ°å€ï¼Œè¿™æ˜¯å› ä¸ºï¼šåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨ <code>getInstance</code> æ–¹æ³•æ—¶ï¼Œæœ‰å¯èƒ½å¤šä¸ªçº¿ç¨‹åŒæ—¶é€šè¿‡ <code>if (instance == nullptr)</code> æ£€æŸ¥ï¼Œå¹¶è¿›å…¥å®ä¾‹åŒ–ä»£ç å—ã€‚è¿™ä¼šå¯¼è‡´å¤šä¸ªçº¿ç¨‹åŒæ—¶åˆ›å»ºå¤šä¸ªå®ä¾‹ï¼Œè¿èƒŒäº†å•ä¾‹æ¨¡å¼çš„åˆè¡·ã€‚</p>
<h4 id="8-4-çº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰æ¨¡å¼"><a href="#8-4-çº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰æ¨¡å¼" class="headerlink" title="8.4 çº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰æ¨¡å¼"></a>8.4 çº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰æ¨¡å¼</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdexcept&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> Logger&amp; <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx_)</span></span>;</span><br><span class="line">            <span class="keyword">if</span> (instance == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">                instance = <span class="keyword">new</span> <span class="built_in">Logger</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Logger</span>(<span class="type">const</span> Logger&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    Logger&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Logger&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">log</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> </span>&#123;</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(log_mtx_)</span></span>;</span><br><span class="line">        logFile_ &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">printLog</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Instance Address IS: &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; std::endl;</span><br><span class="line">        std::cout &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">Logger</span>() &#123;</span><br><span class="line">        logFile_.<span class="built_in">open</span>(<span class="string">&quot;log.txt&quot;</span>, std::ios::out | std::ios::app);</span><br><span class="line">        <span class="keyword">if</span> (!logFile_.<span class="built_in">is_open</span>()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Unable to open log file&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">Logger</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (logFile_.<span class="built_in">is_open</span>()) &#123;</span><br><span class="line">            logFile_.<span class="built_in">close</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">static</span> Logger* instance;</span><br><span class="line">    <span class="type">static</span> std::mutex mtx_;</span><br><span class="line">    std::mutex log_mtx_;</span><br><span class="line">    std::ofstream logFile_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Logger* Logger::instance = <span class="literal">nullptr</span>;</span><br><span class="line">std::mutex Logger::mtx_;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">threadFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Logger&amp; logger = Logger::<span class="built_in">getInstance</span>();</span><br><span class="line">    logger.<span class="built_in">printLog</span>(<span class="string">&quot;Logging from thread&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;std::thread&gt; threads;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">        threads.<span class="built_in">emplace_back</span>(threadFunction);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; thread : threads) &#123;</span><br><span class="line">        thread.<span class="built_in">join</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Instance Address IS: 000001E13A41AFE0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001E13A41AFE0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001E13A41AFE0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001E13A41AFE0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001E13A41AFE0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001E13A41AFE0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001E13A41AFE0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001E13A41AFE0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001E13A41AFE0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001E13A41AFE0</span><br><span class="line">Logging from thread</span><br></pre></td></tr></table></figure>

<h4 id="8-5-é¥¿æ±‰æ¨¡å¼"><a href="#8-5-é¥¿æ±‰æ¨¡å¼" class="headerlink" title="8.5 é¥¿æ±‰æ¨¡å¼"></a>8.5 é¥¿æ±‰æ¨¡å¼</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdexcept&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> Logger&amp; <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Logger</span>(<span class="type">const</span> Logger&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    Logger&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Logger&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">log</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> </span>&#123;</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx_)</span></span>;</span><br><span class="line">        logFile_ &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">printLog</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Instance Address IS: &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; std::endl;</span><br><span class="line">        std::cout &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">Logger</span>() &#123;</span><br><span class="line">        logFile_.<span class="built_in">open</span>(<span class="string">&quot;log.txt&quot;</span>, std::ios::out | std::ios::app);</span><br><span class="line">        <span class="keyword">if</span> (!logFile_.<span class="built_in">is_open</span>()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Unable to open log file&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">Logger</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (logFile_.<span class="built_in">is_open</span>()) &#123;</span><br><span class="line">            logFile_.<span class="built_in">close</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">static</span> Logger instance;</span><br><span class="line">    std::ofstream logFile_;</span><br><span class="line">    std::mutex mtx_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Logger Logger::instance;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">threadFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Logger&amp; logger = Logger::<span class="built_in">getInstance</span>();</span><br><span class="line">    logger.<span class="built_in">printLog</span>(<span class="string">&quot;Logging from thread&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;std::thread&gt; threads;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">        threads.<span class="built_in">emplace_back</span>(threadFunction);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; thread : threads) &#123;</span><br><span class="line">        thread.<span class="built_in">join</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Instance Address IS: 00007FF652E1F6B0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 00007FF652E1F6B0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 00007FF652E1F6B0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 00007FF652E1F6B0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 00007FF652E1F6B0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 00007FF652E1F6B0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 00007FF652E1F6B0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 00007FF652E1F6B0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 00007FF652E1F6B0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 00007FF652E1F6B0</span><br><span class="line">Logging from thread</span><br></pre></td></tr></table></figure>

<h4 id="8-6-ä½¿ç”¨-call-once-å®ç°å•ä¾‹æ¨¡å¼"><a href="#8-6-ä½¿ç”¨-call-once-å®ç°å•ä¾‹æ¨¡å¼" class="headerlink" title="8.6 ä½¿ç”¨ call_once å®ç°å•ä¾‹æ¨¡å¼"></a>8.6 ä½¿ç”¨ <code>call_once</code> å®ç°å•ä¾‹æ¨¡å¼</h4><p>ä¸ºäº†ä½¿ç”¨ <code>std::call_once</code> ä¿è¯ <code>Logger</code> ç±»çš„çº¿ç¨‹å®‰å…¨ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ <code>std::call_once</code> å’Œ <code>std::once_flag</code> æ¥ç¡®ä¿å•ä¾‹å®ä¾‹åªè¢«åˆ›å»ºä¸€æ¬¡ã€‚<code>std::call_once</code> æ˜¯ä¸€ä¸ª <code>C++ 11</code> å¼•å…¥çš„æœºåˆ¶ï¼Œç”¨äºç¡®ä¿ç»™å®šçš„å‡½æ•°åªè¢«è°ƒç”¨ä¸€æ¬¡ï¼Œå³ä½¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨ <code>std::call_once</code> å®ç°çº¿ç¨‹å®‰å…¨å•ä¾‹æ¨¡å¼çš„ç¤ºä¾‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdexcept&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Logger ç±»</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> Logger&amp; <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::<span class="built_in">call_once</span>(initInstanceFlag, &amp;Logger::initSingleton);	<span class="comment">// ä¼ å…¥ once_flag å’Œ initSingleton å‡½æ•°</span></span><br><span class="line">        <span class="keyword">return</span> *instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Logger</span>(<span class="type">const</span> Logger&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    Logger&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Logger&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">log</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> </span>&#123;</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx_)</span></span>;</span><br><span class="line">        logFile_ &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">printLog</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Instance Address IS: &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; std::endl;</span><br><span class="line">        std::cout &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">Logger</span>() &#123;</span><br><span class="line">        logFile_.<span class="built_in">open</span>(<span class="string">&quot;log.txt&quot;</span>, std::ios::out | std::ios::app);</span><br><span class="line">        <span class="keyword">if</span> (!logFile_.<span class="built_in">is_open</span>()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Unable to open log file&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">Logger</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (logFile_.<span class="built_in">is_open</span>()) &#123;</span><br><span class="line">            logFile_.<span class="built_in">close</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">initSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        instance = <span class="keyword">new</span> <span class="built_in">Logger</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">static</span> Logger* instance;</span><br><span class="line">    <span class="type">static</span> std::once_flag initInstanceFlag;</span><br><span class="line">    std::ofstream logFile_;</span><br><span class="line">    std::mutex mtx_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–é™æ€æˆå‘˜</span></span><br><span class="line">Logger* Logger::instance = <span class="literal">nullptr</span>;</span><br><span class="line">std::once_flag Logger::initInstanceFlag;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">threadFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Logger&amp; logger = Logger::<span class="built_in">getInstance</span>();</span><br><span class="line">    logger.<span class="built_in">printLog</span>(<span class="string">&quot;Logging from thread&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;std::thread&gt; threads;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">        threads.<span class="built_in">emplace_back</span>(threadFunction);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; thread : threads) &#123;</span><br><span class="line">        thread.<span class="built_in">join</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¦ç»†è§£é‡Šï¼š</p>
<ol>
<li><p><strong>é™æ€æˆå‘˜å˜é‡</strong>ï¼š</p>
<ul>
<li><code>static Logger* instance</code>ï¼šæŒ‡å‘å•ä¾‹å®ä¾‹çš„æŒ‡é’ˆã€‚</li>
<li><code>static std::once_flag initInstanceFlag</code>ï¼šç”¨äºä¿è¯ <code>initSingleton</code> åªè¢«è°ƒç”¨ä¸€æ¬¡çš„æ ‡å¿—ã€‚</li>
</ul>
</li>
<li><p><strong><code>getInstance</code> æ–¹æ³•</strong>ï¼š</p>
<ul>
<li><code>std::call_once(initInstanceFlag, &amp;Logger::initSingleton)</code>ï¼š<code>std::call_once</code> ä¿è¯ <code>initSingleton</code> åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹åªè¢«è°ƒç”¨ä¸€æ¬¡ã€‚<code>initInstanceFlag</code> ç¡®ä¿ <code>initSingleton</code> åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå³ä½¿å¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨ <code>getInstance</code>ã€‚</li>
</ul>
</li>
<li><p><strong><code>initSingleton</code> æ–¹æ³•</strong>ï¼š</p>
<ul>
<li><code>initSingleton</code> æ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œç”¨äºåˆå§‹åŒ–å•ä¾‹å®ä¾‹ã€‚<code>std::call_once</code> ä¼šè°ƒç”¨æ­¤æ–¹æ³•æ¥åˆ›å»ºå•ä¾‹å®ä¾‹ã€‚</li>
</ul>
</li>
<li><p><strong>æ„é€ å‡½æ•°å’Œææ„å‡½æ•°</strong>ï¼š</p>
<ul>
<li><code>Logger</code> çš„æ„é€ å‡½æ•°å’Œææ„å‡½æ•°è´Ÿè´£æ‰“å¼€å’Œå…³é—­æ—¥å¿—æ–‡ä»¶ã€‚</li>
</ul>
</li>
<li><p><strong><code>log</code> å’Œ <code>printLog</code> æ–¹æ³•</strong>ï¼š</p>
<ul>
<li><code>log</code> æ–¹æ³•ä½¿ç”¨äº’æ–¥é” <code>mtx_</code> ä¿æŠ¤å¯¹æ—¥å¿—æ–‡ä»¶çš„å†™æ“ä½œï¼Œä»¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚</li>
<li><code>printLog</code> æ–¹æ³•è¾“å‡ºå®ä¾‹çš„åœ°å€å’Œæ¶ˆæ¯ã€‚</li>
</ul>
</li>
</ol>
<p>è¿è¡Œä¸Šè¿°ä»£ç æ—¶ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½ä¼šè°ƒç”¨ <code>Logger::getInstance()</code> è·å–å•ä¾‹å®ä¾‹ã€‚ç”±äºä½¿ç”¨äº† <code>std::call_once</code>ï¼Œ<code>initSingleton</code> æ–¹æ³•åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œä»è€Œç¡®ä¿æ•´ä¸ªç¨‹åºä¸­åªæœ‰ä¸€ä¸ª <code>Logger</code> å®ä¾‹ã€‚é€šè¿‡è¾“å‡ºçš„å®ä¾‹åœ°å€ï¼Œå¯ä»¥éªŒè¯æ‰€æœ‰çº¿ç¨‹è·å–çš„éƒ½æ˜¯ç›¸åŒçš„å®ä¾‹ã€‚</p>
<p>ä½¿ç”¨ <code>std::call_once</code> å’Œ <code>std::once_flag</code> å¯ä»¥ç¡®ä¿å•ä¾‹å®ä¾‹åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹åªè¢«åˆ›å»ºä¸€æ¬¡ï¼Œä»è€Œå®ç°çº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰å•ä¾‹æ¨¡å¼ã€‚è¿™æ ·ä¸ä»…ä¿è¯äº†çº¿ç¨‹å®‰å…¨æ€§ï¼Œè¿˜é¿å…äº†ä¸å¿…è¦çš„é”å¼€é”€ã€‚</p>
<h3 id="ğŸ§¶-9-condition-variable-æ¡ä»¶å˜é‡"><a href="#ğŸ§¶-9-condition-variable-æ¡ä»¶å˜é‡" class="headerlink" title="ğŸ§¶ 9. condition_variable æ¡ä»¶å˜é‡"></a>ğŸ§¶ 9. <code>condition_variable</code> æ¡ä»¶å˜é‡</h3><p><code>conditon_variable</code> å¯ä»¥ç”¨æ¥å®ç°ä¸€ä¸ªç”Ÿäº§è€…æ¶ˆè´¹è€…ç¨‹åºã€‚</p>
<p>ä¾‹å¦‚å¯¹äºä¸€ä¸ªé˜Ÿåˆ—ï¼š</p>
<ul>
<li>åªè¦é˜Ÿåˆ—ä¸æ»¡ï¼Œç”Ÿäº§è€…å°±å¯ä»¥è¿›è¡Œç”Ÿäº§</li>
<li>åªè¦é˜Ÿåˆ—æ»¡äº†ï¼Œç”Ÿäº§è€…å°±åœæ­¢ç”Ÿäº§</li>
<li>åªè¦é˜Ÿåˆ—ä¸ç©ºï¼Œæ¶ˆè´¹è€…å°±å¯ä»¥è¿›è¡Œæ¶ˆè´¹</li>
<li>åªè¦é˜Ÿåˆ—ç©ºäº†ï¼Œæ¶ˆè´¹è€…å°±åœæ­¢æ¶ˆè´¹</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;condition_variable&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atomic&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::queue&lt;<span class="type">int</span>&gt; buffer;                 <span class="comment">// å…±äº«ç¼“å†²åŒº</span></span><br><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">int</span> maxBufferSize = <span class="number">10</span>;  <span class="comment">// ç¼“å†²åŒºçš„æœ€å¤§å¤§å°</span></span><br><span class="line">std::mutex mtx;                         <span class="comment">// äº’æ–¥é”, ç”¨äºä¿æŠ¤å…±äº«ç¼“å†²åŒº</span></span><br><span class="line">std::condition_variable cv;             <span class="comment">// æ¡ä»¶å˜é‡, ç”¨äºé€šçŸ¥ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…</span></span><br><span class="line"><span class="function">std::atomic&lt;<span class="type">bool</span>&gt; <span class="title">done</span><span class="params">(<span class="literal">false</span>)</span></span>;          <span class="comment">// åŸå­å˜é‡, ç”¨äºé€šçŸ¥æ¶ˆè´¹è€…ç”Ÿäº§è€…å·²ç»å®Œæˆç”Ÿäº§</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç”Ÿäº§è€…å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">producer</span><span class="params">(<span class="type">int</span> id, <span class="type">int</span> numItems)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numItems; ++i) &#123;</span><br><span class="line">        <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx)</span></span>;  <span class="comment">// é”å®šäº’æ–¥é”</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç­‰å¾…ç›´åˆ°ç¼“å†²åŒºæœ‰ç©ºé—²ä½ç½®</span></span><br><span class="line">        cv.<span class="built_in">wait</span>(lock, [] &#123; <span class="keyword">return</span> buffer.<span class="built_in">size</span>() &lt; maxBufferSize; &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†ç”Ÿæˆçš„æ•°æ®æ”¾å…¥ç¼“å†²åŒº</span></span><br><span class="line">        buffer.<span class="built_in">push</span>(i);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Producer &quot;</span> &lt;&lt; id &lt;&lt; <span class="string">&quot; produced: &quot;</span> &lt;&lt; i &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">        lock.<span class="built_in">unlock</span>();      <span class="comment">// è§£é”äº’æ–¥é”</span></span><br><span class="line">        cv.<span class="built_in">notify_all</span>();    <span class="comment">// é€šçŸ¥æ¶ˆè´¹è€…ç¼“å†²åŒºä¸­æœ‰æ–°æ•°æ®</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿç”Ÿäº§å»¶è¿Ÿ</span></span><br><span class="line">        std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½® done æ ‡å¿—ï¼Œé€šçŸ¥æ¶ˆè´¹è€…ç”Ÿäº§å·²ç»å®Œæˆ</span></span><br><span class="line">    done = <span class="literal">true</span>;</span><br><span class="line">    cv.<span class="built_in">notify_all</span>();  <span class="comment">// é€šçŸ¥æ¶ˆè´¹è€…åœæ­¢ç­‰å¾…</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¶ˆè´¹è€…å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">consumer</span><span class="params">(<span class="type">int</span> id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx)</span></span>;  <span class="comment">// é”å®šäº’æ–¥é”</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç­‰å¾…ç›´åˆ°ç¼“å†²åŒºæœ‰æ•°æ®æˆ–ç”Ÿäº§å·²ç»å®Œæˆ</span></span><br><span class="line">        cv.<span class="built_in">wait</span>(lock, [] &#123; <span class="keyword">return</span> !buffer.<span class="built_in">empty</span>() || done; &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¦‚æœç”Ÿäº§å·²ç»å®Œæˆä¸”ç¼“å†²åŒºä¸ºç©º, é€€å‡ºå¾ªç¯</span></span><br><span class="line">        <span class="keyword">if</span> (done &amp;&amp; buffer.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»ç¼“å†²åŒºå–å‡ºæ•°æ®</span></span><br><span class="line">        <span class="type">int</span> item = buffer.<span class="built_in">front</span>();</span><br><span class="line">        buffer.<span class="built_in">pop</span>();</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Consumer &quot;</span> &lt;&lt; id &lt;&lt; <span class="string">&quot; consumed: &quot;</span> &lt;&lt; item &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">        lock.<span class="built_in">unlock</span>();      <span class="comment">// è§£é”äº’æ–¥é”</span></span><br><span class="line">        cv.<span class="built_in">notify_all</span>();    <span class="comment">// é€šçŸ¥ç”Ÿäº§è€…æœ‰ç©ºé—²ä½ç½®</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿæ¶ˆè´¹å»¶è¿Ÿ</span></span><br><span class="line">        std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">milliseconds</span>(<span class="number">150</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> numProducers = <span class="number">2</span>;     <span class="comment">// ç”Ÿäº§è€…çº¿ç¨‹æ•°é‡</span></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> numConsumers = <span class="number">2</span>;     <span class="comment">// æ¶ˆè´¹è€…çº¿ç¨‹æ•°é‡</span></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> numItems     = <span class="number">40</span>;    <span class="comment">// æ¯ä¸ªç”Ÿäº§è€…ç”Ÿæˆçš„é¡¹ç›®æ•°é‡</span></span><br><span class="line"></span><br><span class="line">    std::vector&lt;std::thread&gt; producers;  <span class="comment">// ç”Ÿäº§è€…çº¿ç¨‹åˆ—è¡¨</span></span><br><span class="line">    std::vector&lt;std::thread&gt; consumers;  <span class="comment">// æ¶ˆè´¹è€…çº¿ç¨‹åˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºç”Ÿäº§è€…çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numProducers; ++i) &#123;</span><br><span class="line">        producers.<span class="built_in">emplace_back</span>(producer, i, numItems);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºæ¶ˆè´¹è€…çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numConsumers; ++i) &#123;</span><br><span class="line">        consumers.<span class="built_in">emplace_back</span>(consumer, i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾…æ‰€æœ‰ç”Ÿäº§è€…çº¿ç¨‹å®Œæˆ</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; producer : producers) &#123;</span><br><span class="line">        producer.<span class="built_in">join</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç­‰å¾…æ‰€æœ‰æ¶ˆè´¹è€…çº¿ç¨‹å®Œæˆ</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; consumer : consumers) &#123;</span><br><span class="line">        consumer.<span class="built_in">join</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ğŸ§¶-10-çº¿ç¨‹æ± -Thread-Pool"><a href="#ğŸ§¶-10-çº¿ç¨‹æ± -Thread-Pool" class="headerlink" title="ğŸ§¶ 10. çº¿ç¨‹æ±  Thread Pool"></a>ğŸ§¶ 10. çº¿ç¨‹æ±  Thread Pool</h3><h4 id="10-1-çº¿ç¨‹çš„æ¶ˆè€—"><a href="#10-1-çº¿ç¨‹çš„æ¶ˆè€—" class="headerlink" title="10.1 çº¿ç¨‹çš„æ¶ˆè€—"></a>10.1 çº¿ç¨‹çš„æ¶ˆè€—</h4><p>ä¸ºäº†å®Œæˆä»»åŠ¡ï¼Œåˆ›å»ºå¾ˆå¤šçº¿ç¨‹å¯ä»¥å—ï¼Ÿçº¿ç¨‹çœŸçš„æ˜¯è¶Šå¤šè¶Šå¥½å—ï¼Ÿ</p>
<ul>
<li><p>çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯éƒ½æ˜¯éå¸¸â€é‡â€çš„æ“ä½œ</p>
<p>çº¿ç¨‹çš„åˆ›å»ºå’Œé”€æ¯éƒ½éœ€è¦æ‰§è¡Œä¸å°‘æ“ä½œï¼Œä¸‹é¢çš„æ“ä½œåªæ˜¯ä¸€ä¸ªç®€åŒ–çš„æ“ä½œï¼Œå…·ä½“çš„æ“ä½œå¯ä»¥æ·±å…¥äº†è§£æ“ä½œç³»ç»Ÿçš„åŸç†ã€‚</p>
<p>é‚£ä¹ˆå¦‚æœè¦åœ¨ä¸šåŠ¡æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å»å®æ—¶çš„åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ï¼Œé‚£ä¹ˆæ˜¯ä¸€ç§å¾ˆæ¶ˆè€—ç³»ç»Ÿèµ„æºå’Œæ€§èƒ½çš„æ“ä½œã€‚</p>
</li>
</ul>
<img src="./CPP_Muti_Threaded/Create_Thread.png" alt="çº¿ç¨‹åˆ›å»ºçš„æ“ä½œ(ç®€åŒ–ç‰ˆ)" style="zoom:50%;" >

<ul>
<li><p>çº¿ç¨‹æ ˆæœ¬èº«å ç”¨å¤§é‡å†…å­˜</p>
<p><code>32</code> ä½æ“ä½œç³»ç»Ÿçš„åœ°å€ç©ºé—´å¤§å°ä¸º $2^{32}$ ä¸ªåœ°å€ï¼Œå³ <code>4 GB</code>ã€‚å…¶ä¸­ä¸€éƒ¨åˆ†åœ°å€ç©ºé—´ç”¨äºæ“ä½œç³»ç»Ÿçš„å†…æ ¸ç©ºé—´ï¼Œè€Œå¦ä¸€éƒ¨åˆ†åˆ™ç”¨äºç”¨æˆ·ç©ºé—´ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œç”¨æˆ·ç©ºé—´å¯ä»¥æ˜¯ <code>2 GB</code> æˆ–è€… <code>3 GB</code>ï¼Œå‰©ä¸‹çš„å…¨éƒ¨æ˜¯å†…æ ¸ç©ºé—´ã€‚å…·ä½“å–å†³äºæ“ä½œç³»ç»Ÿçš„è®¾ç½®ã€‚ç”±å½“å‰è¿›ç¨‹åˆ›å»ºçš„æ‰€æœ‰çº¿ç¨‹ï¼Œå…±äº«è¿›ç¨‹çš„åœ°å€ç©ºé—´ã€‚</p>
<p>é‚£ä¹ˆä¸€ä¸ªè¿›ç¨‹æœ€å¤šå¯ä»¥å¼€å¤šå°‘çº¿ç¨‹å‘¢ï¼Ÿ</p>
<p>å‡è®¾ç”¨æˆ·ç©ºé—´ä¸º <code>3 GB</code>ï¼Œå³ $3 Ã— 1024 &#x3D; 3072$ï¼Œåœ¨ Linux ç¯å¢ƒä¸‹ä½¿ç”¨ <code>ulimit -a</code> å¯ä»¥æŸ¥è¯¢åˆ°ç³»ç»Ÿçš„ä¸€äº›ä¿¡æ¯ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">core file size          (blocks, -c) 0</span><br><span class="line">data seg size           (kbytes, -d) unlimited</span><br><span class="line">scheduling priority             (-e) 0</span><br><span class="line">file size               (blocks, -f) unlimited</span><br><span class="line">pending signals                 (-i) 3795</span><br><span class="line">max locked memory       (kbytes, -l) 64</span><br><span class="line">max memory size         (kbytes, -m) unlimited</span><br><span class="line">open files                      (-n) 1024</span><br><span class="line">pipe size            (512 bytes, -p) 8</span><br><span class="line">POSIX message queues     (bytes, -q) 819200</span><br><span class="line">real-time priority              (-r) 0</span><br><span class="line">stack size              (kbytes, -s) 8192</span><br><span class="line">cpu time               (seconds, -t) unlimited</span><br><span class="line">max user processes              (-u) 3795</span><br><span class="line">virtual memory          (kbytes, -v) unlimited</span><br><span class="line">file locks                      (-x) unlimited</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ° <code>Stack Size</code> ä¸º <code>8192 kbytes</code>ï¼Œå³ <code>8 MB</code>ï¼Œåˆ™å¯è®¡ç®— $3072 Ã· 8 &#x3D; 384$ï¼Œæ‰€ä»¥åœ¨ Linux ç¯å¢ƒä¸‹ï¼Œä¸€ä¸ªè¿›ç¨‹æœ€å¤šåˆ›å»º $384$ ä¸ªçº¿ç¨‹ã€‚</p>
<p>æˆ‘ä»¬å°†çº¿ç¨‹å‡½æ•°æ‰€ç”¨çš„æ ˆç©ºé—´å°±æ˜¯çº¿ç¨‹æ ˆã€‚</p>
<img src="./Cpp_Muti_Threaded/ThreadStack.png" style="zoom: 50%;" >

<p>é€šè¿‡ä¸Šé¢çš„æè¿°ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå¦‚æœçº¿ç¨‹æ•°é‡å¤ªå¤šï¼Œåˆ›å»ºäº†ä¸€å¤§æ‰¹çº¿ç¨‹ï¼Œè¿˜æ²¡æœ‰å…·ä½“åšäº‹æƒ…ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½éœ€è¦çº¿ç¨‹æ ˆï¼Œæ ˆå‡ ä¹éƒ½è¢«å ç”¨å®Œäº†ï¼Œå°±æ²¡å†…å­˜è¿è¡Œå…¶ä»–ç¨‹åºäº†ã€‚</p>
</li>
<li><p>çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢è¦å ç”¨å¤§é‡æ—¶é—´</p>
<p>çº¿ç¨‹è¿‡å¤šï¼Œçº¿ç¨‹çš„è°ƒåº¦æ˜¯éœ€è¦ä¸Šä¸‹æ–‡åˆ‡æ¢çš„ï¼Œä¹Ÿéœ€è¦èŠ±è´¹å¤§é‡çš„ <code>CPU</code> æ—¶é—´ï¼Œå¦‚æœæ›´å¤šçš„æ—¶é—´èŠ±è´¹åˆ°ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸­ï¼Œé‚£ä¹ˆå®é™…ä¸šåŠ¡ä¸­åˆ©ç”¨ <code>CPU</code> çš„æ—¶é—´å°±é™ä½äº†ï¼Œ<code>CPU</code> çš„åˆ©ç”¨ç‡å°±é™ä½äº†ã€‚</p>
</li>
<li><p>å¤§é‡çº¿ç¨‹åŒæ—¶å”¤é†’ä¼šä½¿ç³»ç»Ÿç»å¸¸å‡ºç°é”¯é½¿çŠ¶è´Ÿè½½æˆ–è€…ç¬é—´è´Ÿè½½é‡å¾ˆå¤§å¯¼è‡´å®•æœº</p>
<p>è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœåŒä¸€æ—¶é—´ï¼Œå¾ˆå¤š I&#x2F;O æ“ä½œéƒ½å‡†å¤‡å¥½äº†ï¼Œæˆ–è€…è¯´å¾ˆå¤šçº¿ç¨‹éƒ½å†ç­‰å¾…ä¸€ä¸ª I&#x2F;O æ“ä½œï¼Œæœ‰å¯èƒ½å¯¼è‡´å¤§é‡çº¿ç¨‹åŒæ—¶è¢«å”¤é†’ï¼Œå¯¼è‡´ç³»ç»Ÿç»å¸¸å‡ºç°é”¯é½¿çŠ¶è´Ÿè½½æˆ–è€…ç¬é—´è´Ÿè½½é‡å¾ˆå¤§å¯¼è‡´å®•æœºã€‚</p>
</li>
</ul>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œ<strong>çº¿ç¨‹ä¸æ˜¯è¶Šå¤šè¶Šå¥½</strong>ã€‚é‚£ä¹ˆåˆ›å»ºå¤šå°‘çº¿ç¨‹æ‰æ˜¯åˆé€‚çš„å‘¢ï¼Ÿ</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œåˆ›å»ºçº¿ç¨‹çš„æ•°é‡ä¸€èˆ¬ç”± <code>CPU</code> çš„æ ¸å¿ƒæ•°æ¥ç¡®å®šçš„ï¼Œå³ï¼šæœ‰å‡ ä¸ªæ ¸åˆ›å»ºå‡ ä¸ªçº¿ç¨‹ã€‚<code>C++</code> çš„å¾ˆå¤šå¼€æºåº“å¦‚ <code>moduo</code>ã€<code>libevent</code>ï¼Œ<code>Java</code> çš„ <code>Netty</code>ã€<code>mina</code> ç­‰ï¼Œéƒ½é‡‡å–äº†è¿™ä¸€ç­–ç•¥ã€‚</p>
<p>å½“ç„¶å¦‚æœä¸€ä¸ªåŠŸèƒ½æ˜¯é‡ <code>I/O</code> çš„ï¼Œå¯ä»¥åšå‡ºé€‚å½“çš„è°ƒæ•´ï¼Œå¢åŠ çº¿ç¨‹æ•°é‡ã€‚</p>
<h4 id="10-2-ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿä¸ºä»€ä¹ˆä½¿ä½¿ç”¨çº¿ç¨‹æ± "><a href="#10-2-ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿä¸ºä»€ä¹ˆä½¿ä½¿ç”¨çº¿ç¨‹æ± " class="headerlink" title="10.2 ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿä¸ºä»€ä¹ˆä½¿ä½¿ç”¨çº¿ç¨‹æ± "></a>10.2 ä»€ä¹ˆæ˜¯çº¿ç¨‹æ± ï¼Ÿä¸ºä»€ä¹ˆä½¿ä½¿ç”¨çº¿ç¨‹æ± </h4><p><u>çº¿ç¨‹è¿‡å¤šä¼šå¸¦æ¥è°ƒåº¦å¼€é”€ï¼Œè¿›è€Œå½±å“ç¼“å­˜å±€éƒ¨æ€§å’Œæ•´ä½“æ€§èƒ½</u>ã€‚æ“ä½œç³»ç»Ÿä¸Šåˆ›å»ºçº¿ç¨‹å’Œé”€æ¯çº¿ç¨‹éƒ½æ˜¯å¾ˆâ€œé‡â€çš„æ“ä½œï¼Œè€—æ—¶è€—æ€§èƒ½éƒ½æ¯”è¾ƒå¤šï¼Œé‚£ä¹ˆåœ¨æœåŠ¡æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä¸šåŠ¡é‡æ¯”è¾ƒå¤§ï¼Œå®æ—¶çš„å»åˆ›å»ºçº¿ç¨‹ã€æ‰§è¡Œä¸šåŠ¡ã€ä¸šåŠ¡å®Œæˆåé”€æ¯çº¿ç¨‹ï¼Œé‚£ä¹ˆä¼šå¯¼è‡´ç³»ç»Ÿçš„å®æ—¶æ€§èƒ½é™ä½ï¼Œä¸šåŠ¡çš„å¤„ç†èƒ½åŠ›ä¹Ÿä¼šé™ä½ã€‚</p>
<p><strong>çº¿ç¨‹æ± </strong>æ˜¯ä¸€ç§é¢„å…ˆåˆ›å»ºä¸€å®šæ•°é‡çº¿ç¨‹çš„æœºåˆ¶ï¼Œæˆ–è€…è¯´å…¶æ˜¯ä¸€ç§çº¿ç¨‹ä½¿ç”¨æ¨¡å¼ã€‚</p>
<p><strong>çº¿ç¨‹æ± </strong>ç»´æŠ¤ç€å¤šä¸ªçº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹å¯ä»¥åœ¨éœ€è¦æ—¶è¢«é‡å¤ä½¿ç”¨ï¼Œè€Œæ— éœ€æ¯æ¬¡éƒ½é‡æ–°åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ã€‚</p>
<p><strong>çº¿ç¨‹æ± </strong>çš„ä¸»è¦ç›®çš„æ˜¯æé«˜æ€§èƒ½å’Œèµ„æºåˆ©ç”¨æ•ˆç‡ï¼Œç‰¹åˆ«æ˜¯åœ¨éœ€è¦é¢‘ç¹åˆ›å»ºå’Œé”€æ¯å¤§é‡çº¿ç¨‹çš„åœºæ™¯ä¸‹ï¼Œçº¿ç¨‹æ± ä¸ä»…èƒ½å¤Ÿä¿è¯å†…æ ¸çš„å……åˆ†åˆ©ç”¨ï¼Œè¿˜èƒ½é˜²æ­¢è¿‡åˆ†è°ƒåº¦ã€‚å¯ç”¨çº¿ç¨‹æ•°æ®å–å†³äºå¯ç”¨çš„å¹¶å‘å¤„ç†å™¨ã€å¤„ç†å™¨å†…æ ¸ã€å†…å­˜ã€ç½‘ç»œ <code>sockets</code> ç­‰æ•°é‡ã€‚</p>
<p><strong>çº¿ç¨‹æ± çš„ä¼˜åŠ¿ï¼š</strong>çº¿ç¨‹æ± çš„ä¼˜åŠ¿å°±æ˜¯ï¼ˆæ¯ä¸ªæ± éƒ½æœ‰è‡ªå·±çš„ä¼˜åŠ¿ï¼‰ï¼Œåœ¨æœåŠ¡è¿›ç¨‹å¯åŠ¨ä¹‹åˆï¼Œå°±äº‹å…ˆåˆ›å»ºå¥½çº¿ç¨‹æ± é‡Œé¢çš„çº¿ç¨‹ï¼Œå½“ä¸šåŠ¡æµé‡åˆ°æ¥æ—¶éœ€è¦åˆ†é…çº¿ç¨‹ï¼Œç›´æ¥ä»çº¿ç¨‹æ± ä¸­è·å–ä¸€ä¸ªç©ºé—²çº¿ç¨‹æ‰§è¡Œ <code>Task</code> ä»»åŠ¡å³å¯ï¼Œ<code>Task</code> æ‰§è¡Œå®Œæˆåï¼Œä¹Ÿä¸ç”¨é‡Šæ”¾çº¿ç¨‹ï¼Œè€Œæ˜¯æŠŠçº¿ç¨‹å½’è¿˜åˆ°çº¿ç¨‹æ± ä¸­ç»§ç»­ç»™åç»­çš„ <code>Task</code> æä¾›æœåŠ¡ã€‚</p>
<p><strong>çº¿ç¨‹æ± çš„ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>çº¿ç¨‹å’Œä»»åŠ¡åˆ†ç¦»,æå‡çº¿ç¨‹é‡ç”¨æ€§ï¼›</li>
<li>æ§åˆ¶çº¿ç¨‹å¹¶å‘æ•°é‡,é™ä½æœåŠ¡å™¨å‹åŠ›ï¼Œç»Ÿä¸€ç®¡ç†æ‰€æœ‰çº¿ç¨‹ï¼›</li>
<li>æé«˜æ€§èƒ½ï¼šæå‡ç³»ç»Ÿå“åº”é€Ÿåº¦ï¼Œå‡å¦‚åˆ›å»ºçº¿ç¨‹ç”¨çš„æ—¶é—´ä¸º <code>T1</code>ï¼Œæ‰§è¡Œä»»åŠ¡ç”¨çš„æ—¶é—´ä¸º<code>T2</code>ï¼Œé”€æ¯çº¿ç¨‹ç”¨çš„æ—¶é—´ä¸º <code>T3</code>ï¼Œé‚£ä¹ˆä½¿ç”¨çº¿ç¨‹æ± å°±å…å»äº† <code>T1</code> å’Œ <code>T3</code> çš„æ—¶é—´ã€‚åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹éƒ½æ˜¯ç›¸å¯¹æ˜‚è´µçš„æ“ä½œï¼Œç‰¹åˆ«æ˜¯åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œé¢‘ç¹åœ°åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ä¼šæå¤§åœ°é™ä½ç¨‹åºçš„æ€§èƒ½ã€‚é€šè¿‡çº¿ç¨‹æ± é¢„å…ˆåˆ›å»ºä¸€å®šæ•°é‡çš„çº¿ç¨‹å¹¶ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥é¿å…é¢‘ç¹åœ°åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ï¼Œä»è€Œæé«˜ç¨‹åºçš„æ€§èƒ½ã€‚</li>
<li>èµ„æºç®¡ç†ï¼šçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿçº§åˆ«çš„èµ„æºï¼Œå¦‚æœçº¿ç¨‹æ•°é‡è¿‡å¤šï¼Œå¯èƒ½ä¼šå¯¼è‡´ç³»ç»Ÿèµ„æºçš„è¿‡åº¦æ¶ˆè€—ï¼Œç”šè‡³å¯èƒ½å¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚é€šè¿‡çº¿ç¨‹æ± ï¼Œå¯ä»¥æ§åˆ¶åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡ï¼Œé¿å…èµ„æºè¿‡åº¦æ¶ˆè€—ã€‚</li>
<li>ä»»åŠ¡è°ƒåº¦ï¼šçº¿ç¨‹æ± å¯ä»¥æ›´æ–¹ä¾¿åœ°è¿›è¡Œä»»åŠ¡çš„è°ƒåº¦ã€‚é€šè¿‡çº¿ç¨‹æ± ï¼Œå¯ä»¥å°†ä»»åŠ¡åˆ†é…ç»™ä¸åŒçš„çº¿ç¨‹æ‰§è¡Œï¼Œå®ç°å¹¶è¡Œå¤„ç†ï¼Œæé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚</li>
<li>ç®€åŒ–ç¼–ç¨‹ï¼šä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥ç®€åŒ–å¤šçº¿ç¨‹ç¼–ç¨‹çš„å¤æ‚æ€§ã€‚ç¨‹åºå‘˜åªéœ€è¦å°†ä»»åŠ¡æäº¤ç»™çº¿ç¨‹æ± ï¼Œè€Œä¸éœ€è¦å…³å¿ƒçº¿ç¨‹çš„åˆ›å»ºã€ç®¡ç†å’Œé”€æ¯ç­‰ç»†èŠ‚ï¼Œé™ä½äº†å¤šçº¿ç¨‹ç¼–ç¨‹çš„éš¾åº¦ã€‚</li>
</ul>
<p>å› æ­¤ï¼ŒC++çº¿ç¨‹æ± çš„å‡ºç°æ˜¯ä¸ºäº†è§£å†³åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„å¼€é”€é—®é¢˜ï¼Œæé«˜ç¨‹åºçš„æ€§èƒ½å’Œå¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œç®€åŒ–å¤šçº¿ç¨‹ç¼–ç¨‹çš„å¤æ‚æ€§ã€‚</p>
<p><strong>åœ¨é¡¹ç›®ä¸­å¦‚ä½•ä½¿ç”¨çº¿ç¨‹æ± ï¼Ÿ</strong></p>
<p>ä»¥ä¸€ä¸ªæ·»åŠ è®¢å•åŠŸèƒ½ä¸ºä¾‹ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥è¯¢ç”¨æˆ·çš„æ”¶è·åœ°å€å’Œå•†å“ä¿¡æ¯ã€‚åœ¨å•çº¿ç¨‹çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æŒ‰ç…§é¡ºåºè¿›è¡ŒæŸ¥è¯¢ï¼›è€Œåœ¨å¤šçº¿ç¨‹çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åœ¨ä¿è¯ä¸¤ä¸ªåŠŸèƒ½æ²¡æœ‰ä¾èµ–å…³ç³»çš„æƒ…å†µä¸‹å¯ä»¥åŒæ—¶æŸ¥è¯¢ï¼ˆå³ä¸éœ€è¦å…ˆæŸ¥è¯¢ç”¨æˆ·çš„æ”¶è·åœ°å€ï¼Œå†æ ¹æ®æ”¶è·åœ°å€æŸ¥è¯¢å•†å“ä¿¡æ¯ï¼‰ã€‚</p>
<p>é¡ºåºæ‰§è¡Œçš„é€Ÿåº¦æ˜¯ <code>503 ms</code>ï¼Œè€Œå¤šçº¿ç¨‹æ‰§è¡Œçš„é€Ÿåº¦æ˜¯ <code>329 ms</code>ï¼Œèƒ½æ˜æ˜¾æé«˜è¿è¡Œé€Ÿåº¦ï¼ˆæ•ˆç‡æå‡å¹…åº¦åœ¨ 50%~60%ï¼‰ã€‚</p>
<h4 id="10-3-çº¿ç¨‹æ± çš„ä¸¤ç§æ¨¡å¼"><a href="#10-3-çº¿ç¨‹æ± çš„ä¸¤ç§æ¨¡å¼" class="headerlink" title="10.3 çº¿ç¨‹æ± çš„ä¸¤ç§æ¨¡å¼"></a>10.3 çº¿ç¨‹æ± çš„ä¸¤ç§æ¨¡å¼</h4><h5 id="10-3-1-fixed-æ¨¡å¼çº¿ç¨‹æ± "><a href="#10-3-1-fixed-æ¨¡å¼çº¿ç¨‹æ± " class="headerlink" title="10.3.1 fixed æ¨¡å¼çº¿ç¨‹æ± "></a>10.3.1 <code>fixed</code> æ¨¡å¼çº¿ç¨‹æ± </h5><p><code>fixed</code> æ¨¡å¼çº¿ç¨‹æ± é‡Œé¢çš„çº¿ç¨‹ä¸ªæ•°æ˜¯å›ºå®šä¸å˜çš„ï¼Œä¸€èˆ¬æ˜¯ <code>ThreadPool</code> åˆ›å»ºæ—¶ï¼Œæ ¹æ®å½“å‰æœºå™¨çš„ <code>CPU</code> æ ¸å¿ƒæ•°é‡è¿›è¡ŒæŒ‡å®šã€‚</p>
<h5 id="10-3-2-cache-æ¨¡å¼çº¿ç¨‹æ± "><a href="#10-3-2-cache-æ¨¡å¼çº¿ç¨‹æ± " class="headerlink" title="10.3.2 cache æ¨¡å¼çº¿ç¨‹æ± "></a>10.3.2 <code>cache</code> æ¨¡å¼çº¿ç¨‹æ± </h5><p>å‡è®¾ä¸€ä¸ªçº¿ç¨‹æ± å†…æœ‰å››ä¸ªçº¿ç¨‹ï¼Œç„¶åæ­¤æ—¶å‡ºç°äº†å››ä¸ªéå¸¸è€—æ—¶çš„ <code>I/O</code> æ“ä½œä»»åŠ¡ï¼Œæ­¤æ—¶æ¯ä¸ªçº¿ç¨‹åˆ†é…äº†ä¸€ä¸ªä»»åŠ¡ï¼Œå¯¼è‡´å››ä¸ªçº¿ç¨‹éƒ½è¢«å ç”¨é˜»å¡åœ¨è¿™é‡Œäº†ã€‚æ­¤æ—¶åˆå‡ºç°äº†ä¸€äº›ä»»åŠ¡ï¼Œä½†æ˜¯ç”±äºçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹é•¿æ—¶é—´é˜»å¡ï¼Œæ‰€ä»¥æ–°çš„ä»»åŠ¡å¯èƒ½è¿Ÿè¿Ÿå¾—ä¸åˆ°å¤„ç†ï¼Œæ­¤æ—¶æ–°çš„ä»»åŠ¡å µåœ¨ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œç›¸å½“äºæ•´ä¸ªç¨‹åºå¡æ­»åœ¨äº†è¿™é‡Œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çº¿ç¨‹æ± çš„å¤§å°æ˜¯å¯ä»¥åŠ¨æ€æ”¹å˜çš„ï¼Œè¿™å°±æ˜¯ <code>cache</code> æ¨¡å¼çš„çº¿ç¨‹æ± ã€‚</p>
<p><code>cache</code>æ¨¡å¼çš„çº¿ç¨‹æ± é‡Œé¢çš„çº¿ç¨‹ä¸ªæ•°æ˜¯å¯åŠ¨æ€å¢é•¿çš„ï¼Œæ ¹æ®ä»»åŠ¡çš„æ•°é‡åŠ¨æ€çš„å¢åŠ çº¿ç¨‹çš„æ•°é‡ï¼Œä½†æ˜¯ä¼šè®¾ç½®ä¸€ä¸ªçº¿ç¨‹æ•°é‡çš„é˜ˆå€¼ï¼ˆçº¿ç¨‹è¿‡å¤šçš„åå¤„ä¸Šé¢å·²ç»è®²è¿‡äº†ï¼‰ï¼Œä»»åŠ¡å¤„ç†å®Œæˆï¼Œå¦‚æœåŠ¨æ€å¢é•¿çš„çº¿ç¨‹ç©ºé—²äº†60sè¿˜æ²¡æœ‰å¤„ç†å…¶å®ƒä»»åŠ¡ï¼Œé‚£ä¹ˆå…³é—­çº¿ç¨‹ï¼Œä¿æŒæ± ä¸­æœ€åˆæ•°é‡çš„çº¿ç¨‹å³å¯ã€‚</p>
<h3 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ailumiyana/p/10016965.html">åŸºäºC++11å®ç°çº¿ç¨‹æ± çš„å·¥ä½œåŸç† - é‘ã„ç©ºã‚› - åšå®¢å›­ (cnblogs.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44667165/article/details/135287449">C++çº¿ç¨‹æ± çš„åŸç†ï¼ˆç”»å›¾ï¼‰åŠç®€å•å®ç°+ä¾‹å­ï¼ˆåŠ æ·±ç†è§£ï¼‰_C++ çº¿ç¨‹æ± åŸç† - CSDNåšå®¢</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000044967349">C++: æ¯ä¸€ä¸ªC++ç¨‹åºå‘˜éƒ½åº”è¯¥çŸ¥é“çš„RAII - ä¸ªäººæ–‡ç«  - SegmentFault æ€å¦</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhongzhaoxie/p/13630795.html">C++çº¿ç¨‹æ±  - BrianX - åšå®¢å›­ (cnblogs.com)</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-06-23T04:27:44.000Z" title="2024/6/23 12:27:44">2024-06-23</time>å‘è¡¨</span><span class="level-item"><time dateTime="2024-06-24T08:40:14.154Z" title="2024/6/24 16:40:14">2024-06-24</time>æ›´æ–°</span><span class="level-item"><a class="link-muted" href="/categories/CppDev/">CppDev</a><span>Â /Â </span><a class="link-muted" href="/categories/CppDev/Gaming/">Gaming</a></span><span class="level-item">5 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦756ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/06/23/CppGamingDEV-PVZ-BASE-EASYX/">CppGamingDEV_PVZ_BASE_EASYX</a></p><div class="content"><h2 id="ğŸ®-ä»é›¶å¼€å§‹è¿›è¡Œ-C-æ¸¸æˆå¼€å‘"><a href="#ğŸ®-ä»é›¶å¼€å§‹è¿›è¡Œ-C-æ¸¸æˆå¼€å‘" class="headerlink" title="ğŸ® ä»é›¶å¼€å§‹è¿›è¡Œ C++ æ¸¸æˆå¼€å‘"></a>ğŸ® ä»é›¶å¼€å§‹è¿›è¡Œ C++ æ¸¸æˆå¼€å‘</h2><p>[TOC]</p>
<h3 id="æ¸¸æˆåœºæ™¯æ¦‚å¿µ"><a href="#æ¸¸æˆåœºæ™¯æ¦‚å¿µ" class="headerlink" title="æ¸¸æˆåœºæ™¯æ¦‚å¿µ"></a>æ¸¸æˆåœºæ™¯æ¦‚å¿µ</h3><ul>
<li><strong>ä»€ä¹ˆæ˜¯åœºæ™¯?</strong><br>å¦‚æœå°†è¦æ¸¸æˆç¨‹åºæ¯”ä½œæ˜¯ä¸€åœºæœ‰ç©å®¶å‚ä¸çš„ç››å¤§æ¼”å‡ºï¼Œé‚£åœºæ™¯å°±æ˜¯æ¼”å‡ºè¿‡ç¨‹ä¸­çš„ä¸€å¹•ã€‚åœ¨ä¸åŒçš„å¹•ä¸­ï¼Œä¼šæœ‰ä¸åŒçš„å‰§æœ¬é€»è¾‘ï¼Œä¹Ÿå¯èƒ½ä¼šæœ‰ä¸åŒçš„è§’è‰²ç™»åœºï¼Œè¿™äº›è§’è‰²å³æ¸¸æˆå¼€å‘ä¸­å¸¸æåˆ°çš„ <code>GameObject</code> çš„æ¦‚å¿µã€‚<br>ä¸è®ºæ˜¯ç©å®¶ã€æ•Œäººè¿˜æ˜¯å­å¼¹ã€é“å…·ç­‰ï¼Œè¿™äº›ä»æ¦‚å¿µä¸Šè®²éƒ½æ˜¯ <code>GameObject</code> çš„èŒƒç•´ã€‚ä»–ä»¬æ¥å—ç€ä¸åŒçš„åœºæ™¯å‰§æœ¬çš„æŒ‡æŒ¥ï¼Œè¿›è¡Œç€ä¸åŒé€»è¾‘çš„æ¼”å‡ºã€‚<br>äº†è§£äº†è¿™äº›ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯¹ç¨‹åºçš„æµç¨‹è¿›è¡Œå®è§‚çš„åˆ’åˆ†ï¼Œæ¸¸æˆçš„ä¸»èœå•æ˜¯ä¸€ä¸ªåœºæ™¯ï¼Œç©å®¶è§’è‰²é€‰æ‹©ç•Œé¢ä¹Ÿæ˜¯ä¸€ä¸ªåœºæ™¯ï¼Œæ¸¸æˆå±€å†…çš„é€»è¾‘ä¹Ÿéœ€è¦æ”¾ç½®åœ¨ä¸€ä¸ªå•ç‹¬çš„åœºæ™¯ä¸­ã€‚<br>æ‰€ä»¥æˆ‘ä»¬å°±å¯ä»¥å®šä¹‰ä¸€ä¸ª <code>Scene</code> åœºæ™¯åŸºç±»ï¼Œ<strong>ä¸»èœå•</strong>ã€<strong>è§’è‰²é€‰æ‹©</strong>ã€<strong>å±€å†…æ¸¸æˆ</strong> ä½œä¸ºæ–°ç±»åˆ†åˆ«ç»§æ‰¿ <code>Scene</code> ç±»ã€‚</li>
</ul>
<h3 id="æ¸¸æˆä¸»å¾ªç¯æ¡†æ¶æ¦‚å¿µ"><a href="#æ¸¸æˆä¸»å¾ªç¯æ¡†æ¶æ¦‚å¿µ" class="headerlink" title="æ¸¸æˆä¸»å¾ªç¯æ¡†æ¶æ¦‚å¿µ"></a>æ¸¸æˆä¸»å¾ªç¯æ¡†æ¶æ¦‚å¿µ</h3><ul>
<li><strong>ä»€ä¹ˆæ˜¯æ¸¸æˆä¸»å¾ªç¯æ¡†æ¶?</strong><br>æ¸¸æˆç¨‹åºçš„ä¸»ä½“æ˜¯ä¸€ä¸ªæ°¸ä¸åœæ­‡çš„æ­»å¾ªç¯ã€‚åœ¨æ¯æ¬¡å¾ªç¯ä¸­ï¼Œæˆ‘ä»¬è¯»å–ç©å®¶çš„æ“ä½œä¿¡æ¯ï¼Œå¹¶æ ¹æ®è¿™äº›æ“ä½œï¼Œå¤„ç†ç©å®¶æ•°æ®æ›´æ–°ï¼Œåœ¨æœ€åçš„ç»˜å›¾é˜¶æ®µå°†æ¸¸æˆç”»é¢æ ¹æ®è¿™äº›æ›´æ–°åçš„æ•°æ®æ¸²æŸ“å‡ºæ¥ã€‚<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">åˆå§‹åŒ–();</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">    è¯»å–æ“ä½œ();</span><br><span class="line">    å¤„ç†æ•°æ®();</span><br><span class="line">    ç»˜åˆ¶ç”»é¢();</span><br><span class="line">&#125;</span><br><span class="line">æ–½æ”¾èµ„æº;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="C-å¤´æ–‡ä»¶"><a href="#C-å¤´æ–‡ä»¶" class="headerlink" title="C++ å¤´æ–‡ä»¶"></a>C++ å¤´æ–‡ä»¶</h3><ul>
<li>ä¸ºä»€ä¹ˆéœ€è¦å¤´æ–‡ä»¶å«å£«?<br>å¦‚æœä¸ä½¿ç”¨å¤´æ–‡ä»¶å«å£«ï¼Œå¯èƒ½ä¼šå¯¼è‡´å‡ºç°é‡å®šä¹‰çš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå¤´æ–‡ä»¶ <code>A.h</code> ï¼Œæœ‰ä¸€ä¸ªå¤´æ–‡ä»¶ <code>B.h</code>ï¼Œå¤´æ–‡ä»¶ <code>B.h</code> ä¸­ä½¿ç”¨äº† <code>A.h</code> çš„å†…å®¹ã€‚å½“æˆ‘ä»¬åœ¨ä¸»å‡½æ•°é‡Œé¢ä½¿ç”¨äº† <code>A.h</code> å’Œ <code>B.h</code> çš„æ—¶å€™ï¼Œä½¿ç”¨ <code>#include</code> æ—¶ä¼šå°†å¤´æ–‡ä»¶ä¸­çš„å†…å®¹å…¨éƒ¨<strong>å¤åˆ¶</strong>åˆ° <code>#include</code> çš„éƒ¨åˆ†ã€‚è¿™æ ·çš„è¯å¦‚æœä¸åŠ å¤´æ–‡ä»¶å«å£«ï¼Œå°±ä¼šå¯¼è‡´é‡å®šä¹‰çš„é—®é¢˜ï¼Œå¦‚ä¸‹ï¼š  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A.h</span></span><br><span class="line"><span class="type">int</span> a;</span><br><span class="line"></span><br><span class="line"><span class="comment">// B.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;A.h&quot;</span></span></span><br><span class="line"><span class="type">int</span> b;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;A.h&quot;</span>      <span class="comment">// int a;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;B.h&quot;</span>      <span class="comment">// int a;</span></span></span><br><span class="line">                    <span class="comment">// int b;</span></span><br><span class="line">                    <span class="comment">// å‡ºç°é‡å®šä¹‰é”™è¯¯</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é”™è¯¯ä¿¡æ¯å¦‚ä¸‹</span></span><br><span class="line">In file included from B.h:<span class="number">1</span>,</span><br><span class="line">             from main.cpp:<span class="number">2</span>:</span><br><span class="line">A.h:<span class="number">1</span>:<span class="number">5</span>: error: redefinition of <span class="string">&#x27;int a&#x27;</span></span><br><span class="line">    <span class="number">1</span> | <span class="type">int</span> a;</span><br><span class="line">      |     ^</span><br><span class="line">In file included from main.cpp:<span class="number">1</span>:</span><br><span class="line">A.h:<span class="number">1</span>:<span class="number">5</span>: note: <span class="string">&#x27;int a&#x27;</span> previously declared here</span><br><span class="line">    <span class="number">1</span> | <span class="type">int</span> a;</span><br><span class="line">      |     ^</span><br></pre></td></tr></table></figure>
åœ¨ <code>MSVC</code> ç¼–è¯‘å™¨ä¸­ï¼Œå¤´æ–‡ä»¶å«å£«å¦‚ä¸‹ï¼š  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br></pre></td></tr></table></figure>
åœ¨å…¶ä»–çš„ä¸€äº›ç¼–è¯‘å™¨ä¸­ï¼Œå¸¸å†™ä¸ºè¿™æ ·ï¼š  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __HEADER_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __HEADER_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="åœºæ™¯ç®¡ç†å™¨"><a href="#åœºæ™¯ç®¡ç†å™¨" class="headerlink" title="åœºæ™¯ç®¡ç†å™¨"></a>åœºæ™¯ç®¡ç†å™¨</h3><p>æ¸¸æˆç¨‹åºæ˜¯ä¸€ä¸ªå·¨å¤§çš„æ­»å¾ªç¯ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªå·¨å¤§çš„çŠ¶æ€æœºã€‚ä¸åŒçš„æ¸¸æˆåœºæ™¯ä»£è¡¨ç€ä¸åŒçš„çŠ¶æ€ï¼Œç®¡ç†ç€è¿™äº›çŠ¶æ€çš„â€œçŠ¶æ€æœºâ€ï¼Œåœ¨æ¸¸æˆå¼€å‘ä¸­æœ‰ä¸€ä¸ªç‰¹æ®Šçš„åå­—â€”â€”åœºæ™¯ç®¡ç†å™¨ã€‚</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-05-22T13:50:18.000Z" title="2024/5/22 21:50:18">2024-05-22</time>å‘è¡¨</span><span class="level-item"><time dateTime="2024-07-29T07:32:26.196Z" title="2024/7/29 15:32:26">2024-07-29</time>æ›´æ–°</span><span class="level-item"><a class="link-muted" href="/categories/CppDev/">CppDev</a><span>Â /Â </span><a class="link-muted" href="/categories/CppDev/QT6/">QT6</a></span><span class="level-item">23 åˆ†é’Ÿè¯»å®Œ (å¤§çº¦3452ä¸ªå­—)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/05/22/Better-QT/">Better QT</a></p><div class="content"><p>[TOC]</p>
<h2 id="ğŸ-Better-QT"><a href="#ğŸ-Better-QT" class="headerlink" title="ğŸ Better QT"></a>ğŸ Better QT</h2><h3 id="ğŸ¦-1-Qt-çš„ä¸€äº›å¸¸ç”¨æŠ€å·§"><a href="#ğŸ¦-1-Qt-çš„ä¸€äº›å¸¸ç”¨æŠ€å·§" class="headerlink" title="ğŸ¦ 1. Qt çš„ä¸€äº›å¸¸ç”¨æŠ€å·§"></a>ğŸ¦ 1. Qt çš„ä¸€äº›å¸¸ç”¨æŠ€å·§</h3><h4 id="1-1-å¿«æ·é”®"><a href="#1-1-å¿«æ·é”®" class="headerlink" title="1.1 å¿«æ·é”®"></a>1.1 å¿«æ·é”®</h4><ul>
<li>å¿«æ·é”® <code>Ctrl + Tab</code> å¯ä»¥åˆ‡æ¢æ–‡ä»¶ï¼›</li>
<li>å¿«æ·é”® <code>Alt + ENTER</code> å¼¹å‡ºä»£ç ç”Ÿæˆæç¤ºï¼Œå¯ä»¥å¿«é€Ÿæç¤ºé”™è¯¯ä¿®æ”¹æ–¹æ¡ˆï¼Œç±»ä¼¼äº IDEA çš„ <code>Alt + ENTER</code>ï¼›</li>
<li>å¿«æ·é”® <code>Alt + é¼ æ ‡</code> åŒæ—¶è¾“å…¥ï¼›</li>
<li>å¿«æ·é”® <code>Ctrl + R</code> è¿è¡Œç¨‹åºï¼›</li>
<li>å¿«æ·é”® <code>Ctrl + M</code> åˆ›å»ºä¹¦ç­¾ï¼ˆBookmarkï¼‰ï¼Œæˆ–è€…ç›´æ¥åœ¨æŸè¡Œä»£ç å‰å³é”®æ·»åŠ ä¹¦ç­¾ï¼›</li>
<li>å¿«æ·é”® <code>Ctrl + ENTER</code> åœ¨å½“å‰è¡Œä¸‹æ–¹æ’å…¥ç©ºè¡Œï¼›</li>
<li>å¿«æ·é”® <code>Ctrl + Shift + ENTER</code> åœ¨å½“å‰è¡Œä¸‹æ–¹æ’å…¥ç©ºè¡Œï¼›</li>
<li>å¿«æ·é”® <code>Ctrl + I</code> ä»£ç å¯¹é½ï¼›</li>
<li>å¿«æ·é”® <code>Ctrl + ;</code> æ ¼å¼åŒ–ä»£ç ï¼›</li>
<li>å¿«æ·é”® <code>Shift + Delete</code> å‰ªåˆ‡å½“å‰è¡Œï¼Œå¯ä»¥å½“åˆ é™¤ç”¨ï¼›</li>
<li>å¿«æ·é”® <code>Ctrl + Shift + R</code> å±€éƒ¨å˜é‡ç»Ÿä¸€ä¿®æ”¹ï¼›</li>
<li>å¿«æ·é”® <code>Ctrl + Shift + V</code> å¤åˆ¶å†å²ï¼›</li>
<li>ç”¨é”®ç›˜æ¨¡æ‹Ÿé¼ æ ‡æ“ä½œï¼š  <table>
    <tr>
        <td colspan="3">åŠŸèƒ½é”®</td> 
        <td colspan="3">æ–¹å‘é”®</td> 
        <td>å¤‡æ³¨</td>
    </tr>
    <tr>
          <td>Ctrl</td>
          <td>Shift</td>
          <td>Alt</td>
          <td>å·¦/å³</td>
          <td>ä¸Š/ä¸‹</td>
          <td>Home/End</td>
          <td>æ–¹å‘é”®å…·æœ‰ç§»åŠ¨å…‰æ ‡çš„ä½œç”¨</td>
    </tr>
    <tr>
          <td>Ã—</td>
          <td>Ã—</td>
          <td>Ã—</td>
          <td>å­—ç¬¦</td>
          <td>å­—ç¬¦</td>
          <td>è¡Œé¦–/è¡Œå°¾</td>
          <td>-</td>
    </tr>
    <tr>
          <td>âˆš</td>
          <td>Ã—</td>
          <td>Ã—</td>
          <td>å•è¯</td>
          <td>æ»šåŠ¨æ¡</td>
          <td>æ–‡ä»¶å¤´/å°¾</td>
          <td>-</td>
    </tr>
    <tr>
          <td>âˆš</td>
          <td>âˆš</td>
          <td>Ã—</td>
          <td>å•è¯</td>
          <td>ç§»åŠ¨</td>
          <td>è¡Œé¦–/è¡Œå°¾</td>
          <td>Shiftå…·æœ‰é€‰ä¸­æ–‡æœ¬çš„ä½œç”¨</td>
    </tr>
    <tr>
          <td>âˆš</td>
          <td>Ã—</td>
          <td>âˆš</td>
          <td>-</td>
          <td>å‘ä¸Š/ä¸‹å¤åˆ¶é€‰ä¸­éƒ¨åˆ†</td>
          <td>-</td>
          <td>-</td>
    </tr>
  </table></li>
<li>å¿«æ·é”® <code>F1</code> æŸ¥çœ‹å¸®åŠ©ã€æ–‡æ¡£</li>
<li>å¿«æ·é”® <code>F2</code> å¿«é€Ÿåˆ°å˜é‡æˆ–è€…å‡½æ•°é—´åˆ‡æ¢</li>
<li>å¿«æ·é”® <code>F4</code> å¿«é€Ÿåœ¨<code>.cpp</code>æ–‡ä»¶å’Œ<code>.h</code>æ–‡ä»¶é—´åˆ‡æ¢</li>
<li>å¿«æ·é”® <code>Ctrl + Shift + U</code> æŸ¥æ‰¾æ‰€æœ‰ä½¿ç”¨è¯¥ç¬¦å·çš„åœ°æ–¹</li>
<li>å¿«æ·é”® <code>Ctrl + K</code> æ‰“å¼€å®šä½å™¨</li>
<li>å¿«æ·é”® <code>Ctrl + L</code> è·³è½¬åˆ°æŸä¸€è¡Œ</li>
<li>å¿«æ·é”® <code>Ctrl + [Shift] + F</code> æŸ¥æ‰¾&#x2F;æ›¿æ¢å½“å‰æ–‡ä»¶[é¡¹ç›®]å½“å‰é€‰ä¸­çš„å†…å®¹</li>
<li>å¿«æ·é”® <code>[Shift] + F3</code> æŸ¥æ‰¾ä¸‹[ä¸Š]ä¸€ä¸ª</li>
<li>å¿«æ·é”® <code>Ctrl + B</code> ç¼–è¯‘å·¥ç¨‹</li>
<li>å¿«æ·é”® <code>Ctrl + R</code> è¿è¡Œå·¥ç¨‹</li>
<li>å¿«æ·é”® <code>F5</code> è°ƒè¯•è¿è¡Œ</li>
<li>å¿«æ·é”® <code>Ctrl + Shift + F5</code> é‡å¯è°ƒè¯•</li>
<li>å¿«æ·é”® <code>F9</code> è®¾ç½®å’Œå–æ¶ˆæ–­ç‚¹</li>
<li>å¿«æ·é”® <code>F10</code> å•æ­¥è·³è¿‡</li>
<li>å¿«æ·é”® <code>F11</code> å•æ­¥è¿›å…¥</li>
</ul>
<h4 id="1-2-Creator-ç‰‡æ®µ"><a href="#1-2-Creator-ç‰‡æ®µ" class="headerlink" title="1.2 Creator ç‰‡æ®µ"></a>1.2 Creator ç‰‡æ®µ</h4><p>ç‰‡æ®µç®€å•ç†è§£ä¸€ä¸‹å°±æ˜¯å·²ç»å†™å¥½çš„ä¸€äº›æ¨¡å¼åŒ–çš„ä»£ç ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨å†…ç½®ç‰‡æ®µæˆ–è€…æ ¹æ®è‡ªå·±çš„éœ€è¦è‡ªå®šä¹‰ç‰‡æ®µã€‚</p>
<ol>
<li>è‡ªå¸¦ç‰‡æ®µç¤ºä¾‹<br><img src="/./BetterQT/QtQuickSnippets.png" alt="Qt Quick Part"></li>
<li>è‡ªå®šä¹‰ç‰‡æ®µ<br>ä¸€ä¸ªç”¨æˆ·çš„è‡ªå®šä¹‰ç‰‡æ®µéœ€è¦ä»¥ä¸‹å‡ ä¸ªå†…å®¹ï¼š<br>$$ç‰‡æ®µ &#x3D; ä¸€çº§æ ‡é¢˜ + äºŒçº§æ ‡é¢˜ + ç‰‡æ®µæ–‡æœ¬$$<br>éœ€è¦é€šè¿‡ï¼šç¼–è¾‘ï¼ˆEditï¼‰â†’é¦–é€‰é¡¹ï¼ˆPreferencesï¼‰â†’æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆText Editorï¼‰â†’ç‰‡æ®µï¼ˆSnippetsï¼‰è¿›è¡Œè®¾ç½®<br><img src="/./BetterQT/Qt_Custom_Snippets.png" alt="Qt Custom Snippets"><br>æ¯”å¦‚æˆ‘è¦æ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰ç‰‡æ®µ <code>note</code>ï¼Œç”¨æ¥è¡¨ç¤ºæ–‡ä»¶æ³¨é‡Šï¼Œå¯ä»¥é€‰æ‹© <code>Group</code> ä¸º <code>C++</code>ï¼Œç„¶åé€‰æ‹© <code>Add</code>ï¼Œæ·»åŠ æŒ‡å®šçš„å†…å®¹ï¼š<br><img src="/./BetterQT/AddCustomSnippets.png" alt="Add Custom Snippets"></li>
</ol>
<h3 id="ğŸ¦-2-Qt-ä»£ç -æ–‡ä»¶è§£é‡Š"><a href="#ğŸ¦-2-Qt-ä»£ç -æ–‡ä»¶è§£é‡Š" class="headerlink" title="ğŸ¦ 2. Qt ä»£ç &#x2F;æ–‡ä»¶è§£é‡Š"></a>ğŸ¦ 2. Qt ä»£ç &#x2F;æ–‡ä»¶è§£é‡Š</h3><p>Qtçš„æºä»£ç å’Œæ–‡ä»¶è§£é‡Š</p>
<h4 id="2-1-Qt-ä»£ç "><a href="#2-1-Qt-ä»£ç " class="headerlink" title="2.1 Qt ä»£ç "></a>2.1 Qt ä»£ç </h4><ul>
<li><p><code>hellocosbrowser.h</code></p>
  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> HELLOCOSBROWSER_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> HELLOCOSBROWSER_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QWidget&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;QMessageBox&gt;</span></span></span><br><span class="line"></span><br><span class="line">QT_BEGIN_NAMESPACE</span><br><span class="line"><span class="keyword">namespace</span> Ui &#123; <span class="keyword">class</span> <span class="title class_">HelloCOSBrowser</span>; &#125;</span><br><span class="line">QT_END_NAMESPACE</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloCOSBrowser</span> : <span class="keyword">public</span> QWidget  <span class="comment">// QWidget æ˜¯æ‰€æœ‰åº”ç”¨ç¨‹åºçª—å£çš„åŸºç±»</span></span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT    <span class="comment">// Qtçš„å®, æ”¯æŒ Qt çš„ç‰¹æ€§, å¦‚ä¿¡å·ä¸æ§½ã€å¯¹è±¡æ ‘ã€å…ƒå¯¹è±¡ç­‰</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// è¿™é‡Œ HelloCOSBrowser æŒ‡å®šçˆ¶çª—å£æŒ‡é’ˆä¸º nullptr, åˆ™å®ƒä¼šä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„çª—å£è¿›è¡Œå±•ç¤º, å¦åˆ™åˆ™ä¼šä½œä¸ºçˆ¶çª—å£çš„ä¸€ä¸ªæ§ä»¶</span></span><br><span class="line">    <span class="comment">// å…³äºè¿™ä¸ªçˆ¶çª—å£æŒ‡é’ˆ, ä¸€ä¸ªå¾ˆå…¸å‹çš„åº”ç”¨å°±æ˜¯ å¾®ä¿¡</span></span><br><span class="line">    <span class="comment">// å½“æˆ‘ä»¬åˆ›å»ºæ–°çª—å£çš„æ—¶å€™, å¦‚æœä¸æŒ‡å®šçˆ¶çª—å£, å°±ä¼šå¼¹å‡ºä¸€ä¸ªç‹¬ç«‹çš„æ–°çª—å£, å³ç”µè„‘ä»»åŠ¡æ çš„å›¾æ ‡ä¼šå¤šå‡ºæ¥ä¸€ä¸ª</span></span><br><span class="line">    <span class="comment">// å¦‚æœæŒ‡å®šäº†çˆ¶çª—å£, åˆ™ä¸ä¼šåˆ›å»ºä¸€ä¸ªç‹¬ç«‹çš„çª—å£, å³ç”µè„‘ä»»åŠ¡æ å¤„çš„å›¾æ ‡ä¸ä¼šå¢åŠ </span></span><br><span class="line">    <span class="built_in">HelloCOSBrowser</span>(QWidget *parent = <span class="literal">nullptr</span>);</span><br><span class="line">    ~<span class="built_in">HelloCOSBrowser</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> slots:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">showDialog</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Ui::HelloCOSBrowser *ui;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">// HELLOCOSBROWSER_H</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-2-Qt-å·¥ç¨‹æ–‡ä»¶è§£é‡Š"><a href="#2-2-Qt-å·¥ç¨‹æ–‡ä»¶è§£é‡Š" class="headerlink" title="2.2 Qt å·¥ç¨‹æ–‡ä»¶è§£é‡Š"></a>2.2 Qt å·¥ç¨‹æ–‡ä»¶è§£é‡Š</h4><p>æ–‡ä»¶åˆ—è¡¨</p>
<table>
<thead>
<tr>
<th align="center">æ–‡ä»¶åç§°</th>
<th align="center">æè¿°</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>pro</code> æ–‡ä»¶</td>
<td align="center">è¯¥æ–‡ä»¶æ˜¯ Qt çš„é¡¹ç›®æ–‡ä»¶ï¼Œqmakeå·¥å…·å¯ä»¥æ ¹æ®æ­¤æ–‡ä»¶ç”Ÿæˆ Makefile</td>
</tr>
<tr>
<td align="center"><code>pro.user</code> æ–‡ä»¶</td>
<td align="center">è¯¥æ–‡ä»¶åŒ…å«å’Œç”¨æˆ·ç›¸å…³çš„é¡¹ç›®ä¿¡æ¯ï¼ˆç”¨æˆ·ä¸éœ€è¦å…³æ³¨æ­¤æ–‡ä»¶ï¼‰</td>
</tr>
<tr>
<td align="center"><code>ui</code> æ–‡ä»¶</td>
<td align="center">Qt çš„è®¾è®¡å¸ˆç•Œé¢æ–‡ä»¶</td>
</tr>
<tr>
<td align="center"><code>.cpp</code> æ–‡ä»¶</td>
<td align="center">C++ æºæ–‡ä»¶</td>
</tr>
<tr>
<td align="center"><code>.h</code> æ–‡ä»¶</td>
<td align="center">C++ å¤´æ–‡ä»¶</td>
</tr>
</tbody></table>
<h3 id="ğŸ¦-3-MOCç¼–è¯‘å™¨"><a href="#ğŸ¦-3-MOCç¼–è¯‘å™¨" class="headerlink" title="ğŸ¦ 3. MOCç¼–è¯‘å™¨"></a>ğŸ¦ 3. MOCç¼–è¯‘å™¨</h3><p>MOC(Meta-Object Compiler)ç¼–è¯‘å™¨<br>C++ ç¼–è¯‘å™¨æœ¬èº«ä¸æ”¯æŒ Qt çš„æŸäº›æœºåˆ¶ï¼ŒQt å¸Œæœ›å¯¹ C++ ä»£ç è¿›è¡Œè‡ªåŠ¨æ‰©å±•ï¼Œè¿™é‡Œå°±éœ€è¦ç”¨åˆ°å®ï¼ˆä¾‹å¦‚ï¼š<code>Q_Object</code>ï¼‰å’Œç»§æ‰¿ã€‚<br>æ­¤å¤–ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ï¼Œå¸Œæœ›ç”¨æˆ·æ— æ„ŸçŸ¥ï¼Œå¯ä»¥å°†è¿™ä¸€æ“ä½œç›´æ¥é›†æˆåˆ°æ¡†æ¶ä¸­ã€‚</p>
<h4 id="3-1-Qt-ç¼–è¯‘è¿‡ç¨‹"><a href="#3-1-Qt-ç¼–è¯‘è¿‡ç¨‹" class="headerlink" title="3.1 Qt ç¼–è¯‘è¿‡ç¨‹"></a>3.1 Qt ç¼–è¯‘è¿‡ç¨‹</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">é¢„ç¼–è¯‘ -&gt; ç¼–è¯‘ -&gt; æ±‡ç¼– -&gt; é“¾æ¥ -&gt; ç›®æ ‡</span><br><span class="line">  â†‘</span><br><span class="line">  +-------------------------+</span><br><span class="line">                            â†‘</span><br><span class="line">æ‹“å±•ä»£ç  -&gt; MOCç¼–è¯‘å™¨ -&gt; æ–°CPPä»£ç </span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä¸Šè¿°æ–¹å¼ï¼Œå®ç° Qt çš„æŸäº›ç‰¹æ€§ã€‚æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œå½“æˆ‘ä»¬å†™å®Œä»£ç è¿›è¡Œç¼–è¯‘åï¼Œä¼šäº§ç”Ÿä¸€ä¸ª <code>debug</code> æ–‡ä»¶å¤¹ï¼Œæ­¤æ—¶æˆ‘ä»¬è¿›å…¥è¯¥æ–‡ä»¶å¤¹ï¼Œä¼šçœ‹åˆ°ä¸€äº›å…ƒå¯¹è±¡ç¼–è¯‘å™¨ç¼–è¯‘çš„æ–‡ä»¶ï¼Œå¦‚ <code>moc_xxxx.cpp</code> æˆ– <code>moc_xxx.h</code> ç­‰æ–‡ä»¶ã€‚</p>
<h4 id="3-2-MOC-çš„ä½¿ç”¨æ–¹æ³•"><a href="#3-2-MOC-çš„ä½¿ç”¨æ–¹æ³•" class="headerlink" title="3.2 MOC çš„ä½¿ç”¨æ–¹æ³•"></a>3.2 MOC çš„ä½¿ç”¨æ–¹æ³•</h4><ol>
<li>MOC ç¼–è¯‘å·¥å…·ç”± Qt æ¡†æ¶è‡ªåŠ¨è°ƒç”¨</li>
<li>æ‰«æ C++ å¤´æ–‡ä»¶ï¼Œå¯»æ‰¾ <code>Q_OBJECT</code> å®</li>
<li>ç”Ÿæˆæ‹“å±• C++ ä»£ç ï¼Œå†è¿›è¡Œé¢„ç¼–è¯‘</li>
<li>ç¨‹åºå‘˜åœ¨ä½¿ç”¨æ—¶ï¼Œéœ€è¦ç»§æ‰¿ QObject ç±»æˆ–è€…æ˜¯ QObject å­ç±»ï¼Œå¹¶ä¸”åŒ…å« <code>Q_OBJECT</code> å®ã€‚</li>
</ol>
<h3 id="ğŸ¦-4-Qtåº”ç”¨ç¨‹åºå¼€å‘"><a href="#ğŸ¦-4-Qtåº”ç”¨ç¨‹åºå¼€å‘" class="headerlink" title="ğŸ¦ 4. Qtåº”ç”¨ç¨‹åºå¼€å‘"></a>ğŸ¦ 4. Qtåº”ç”¨ç¨‹åºå¼€å‘</h3><h4 id="4-1-Qt-Designer-è®¾è®¡å¸ˆç•Œé¢ä½¿ç”¨"><a href="#4-1-Qt-Designer-è®¾è®¡å¸ˆç•Œé¢ä½¿ç”¨" class="headerlink" title="4.1 Qt Designer è®¾è®¡å¸ˆç•Œé¢ä½¿ç”¨"></a>4.1 Qt Designer è®¾è®¡å¸ˆç•Œé¢ä½¿ç”¨</h4><p><img src="/./BetterQT/Qt_Designer.png" alt="Qt Designer"><br>â‘  Qt æ§ä»¶ç¼–è¾‘æ¨¡å¼<br>â‘¡ Qt ä¿¡å·ä¸æ§½ç¼–è¾‘æ¨¡å¼<br>â‘¢ Qt ä¼™ä¼´å…³ç³»ç¼–è¾‘æ¨¡å¼<br>â‘£ Qt Tab é¡ºåºç¼–è¾‘æ¨¡å¼ï¼šå¯ä»¥è®¾ç½®æŒ‰ä¸‹ Tab é”®çš„é«˜äº®é¡ºåº</p>
<h4 id="4-2-Qt-æ ¸å¿ƒâ€”â€”ä¿¡å·ä¸æ§½"><a href="#4-2-Qt-æ ¸å¿ƒâ€”â€”ä¿¡å·ä¸æ§½" class="headerlink" title="4.2 Qt æ ¸å¿ƒâ€”â€”ä¿¡å·ä¸æ§½"></a>4.2 Qt æ ¸å¿ƒâ€”â€”ä¿¡å·ä¸æ§½</h4><p><strong>ä¿¡å·ä¸æ§½çš„åŸºæœ¬æ¦‚å¿µ</strong><br><img src="/./BetterQT/QtSignalsSlots.drawio.png" alt="Qt Signals and Slots"></p>
<ul>
<li>Qt ä¸­çš„ä¿¡å·å’Œæ§½æ˜¯æ”¯æŒå¤šå¯¹å¤šçš„ï¼Œå³ä¸€ä¸ªä¿¡å·å¯ä»¥å¯¹åº”å¤šä¸ªæ§½ï¼Œä¸€ä¸ªæ§½å¯ä»¥ç”±å¤šä¸ªä¿¡å·è§¦å‘ã€‚</li>
<li>Qt ä¸­çš„ä¿¡å·æ— éœ€å®ç°ï¼Œå¯ä»¥ç”±å‡½æ•°ï¼ˆæ™®é€šå‡½æ•°æˆ–è€…æ§½å‡½æ•°ï¼‰é€šè¿‡ <code>emit</code> å…³é”®å­—å‘é€ä¿¡å·ä¼ é€’å‚æ•°ã€‚</li>
</ul>
<h5 id="4-2-1-Qtä¸­å¦‚ä½•å®šä¹‰ä¿¡å·"><a href="#4-2-1-Qtä¸­å¦‚ä½•å®šä¹‰ä¿¡å·" class="headerlink" title="4.2.1 Qtä¸­å¦‚ä½•å®šä¹‰ä¿¡å·"></a>4.2.1 Qtä¸­å¦‚ä½•å®šä¹‰ä¿¡å·</h5><ol>
<li>ç»§æ‰¿ <code>QObject</code> ç±»æˆ–å…¶æ´¾ç”Ÿç±»ï¼ŒåŒæ—¶åŒ…å« <code>Q_OBJECT</code> å®</li>
<li>ä½¿ç”¨å…³é”®å­— <code>signals</code> å£°æ˜å‡½æ•°ä¿¡å·å‡½æ•°ï¼Œä¸éœ€è¦å…·ä½“å®ç°ä¿¡å·å‡½æ•°</li>
<li>ä½¿ç”¨ <code>emit</code> å…³é”®å­—å‘é€ä¿¡å·</li>
</ol>
<h5 id="4-2-2-Qtä¸­å¦‚ä½•å®šä¹‰æ§½å‡½æ•°"><a href="#4-2-2-Qtä¸­å¦‚ä½•å®šä¹‰æ§½å‡½æ•°" class="headerlink" title="4.2.2 Qtä¸­å¦‚ä½•å®šä¹‰æ§½å‡½æ•°"></a>4.2.2 Qtä¸­å¦‚ä½•å®šä¹‰æ§½å‡½æ•°</h5><ol>
<li>å¿…é¡»åŒ…å« <code>Q_OBJECT</code> å®</li>
<li>ä½¿ç”¨å…³é”®å­— <code>[public/protected/private] slots</code> å£°æ˜å‡½æ•°</li>
<li>éœ€è¦å…·ä½“å®ç°å£°æ˜çš„æ§½å‡½æ•°</li>
</ol>
<h5 id="4-2-3-Qtä¸­å¦‚ä½•è¿æ¥ä¿¡å·ä¸æ§½ï¼ˆä¸‰ç§å†™æ³•ï¼‰"><a href="#4-2-3-Qtä¸­å¦‚ä½•è¿æ¥ä¿¡å·ä¸æ§½ï¼ˆä¸‰ç§å†™æ³•ï¼‰" class="headerlink" title="4.2.3 Qtä¸­å¦‚ä½•è¿æ¥ä¿¡å·ä¸æ§½ï¼ˆä¸‰ç§å†™æ³•ï¼‰"></a>4.2.3 Qtä¸­å¦‚ä½•è¿æ¥ä¿¡å·ä¸æ§½ï¼ˆä¸‰ç§å†™æ³•ï¼‰</h5><ol>
<li><code>SIGNAL/SLOT</code> å®å†™æ³•ï¼š<br><code>QObject::connect(this, SIGNAL(...), this, SLOT(...));</code></li>
<li>å‡½æ•°æŒ‡é’ˆå†™æ³•ï¼š<br><code>QObject::connect(this, &amp;SignalFunction, this, &amp;SlotFunction)</code></li>
<li>lambda è¡¨è¾¾å¼å†™æ³•ï¼š<br><code>QObject::connect(this, &amp;SignalFunction, this, [=]() &#123; qDebug() &lt;&lt; &quot;...&quot;; &#125;)</code></li>
</ol>
<p>ä¸‰ç§å†™æ³•çš„æ¯”è¾ƒï¼š</p>
<table>
    <tr>
        <td rowspan="2" colspan="3">è¿æ¥ä¿¡å·ä¸æ§½</td> 
        <td colspan="2">å®</td>
        <td colspan="2">å‡½æ•°æŒ‡é’ˆ</td>
    </tr>
    <tr>
        <td>ç¼–è¯‘</td>
        <td>è¿è¡Œ</td>
        <td>ç¼–è¯‘</td>
        <td>è¿è¡Œ</td>
    </tr>
    <tr>
        <td rowspan="4">å‚æ•°ç±»å‹</td>
        <td colspan="2">å®Œå…¨ç›¸åŒ</td>
        <td>âˆš</td>
        <td>âˆš</td>
        <td>âˆš</td>
        <td>âˆš</td>
    </tr>
    <tr>
        <td rowspan="2">éšå¼è½¬æ¢</td>
        <td>å‘ä¸Š</td>
        <td>âˆš</td>
        <td>Ã—</td>
        <td>âˆš</td>
        <td>âˆš</td>
    </tr>
    <tr>
        <td>å‘ä¸‹</td>
        <td>âˆš</td>
        <td>Ã—</td>
        <td>âˆš</td>
        <td>âˆš</td>
    </tr>
    <tr>
        <td colspan="2">ä¸å¯ä»¥éšå¼è½¬æ¢</td>
        <td>âˆš</td>
        <td>Ã—</td>
        <td>Ã—</td>
        <td>Ã—</td>
    </tr>
        <tr>
        <td rowspan="3">å‚æ•°ä¸ªæ•°</td>
        <td colspan="2">ä¿¡å·=æ§½</td>
        <td>âˆš</td>
        <td>âˆš</td>
        <td>âˆš</td>
        <td>âˆš</td>
    </tr>
    <tr>
        <td colspan="2">ä¿¡å·>æ§½</td>
        <td>âˆš</td>
        <td>âˆš</td>
        <td>âˆš</td>
        <td>âˆš</td>
    </tr>
    <tr>
        <td colspan="2">ä¿¡å·<æ§½</td>
        <td>âˆš</td>
        <td>Ã—</td>
        <td>Ã—</td>
        <td>Ã—</td>
    </tr>
</table>

<ul>
<li>è¿™æ ·çœ‹æ¥å¥½åƒå®å†™æ³•ç›¸å¯¹äºå‡½æ•°æŒ‡é’ˆçš„å†™æ³•æ¥è¯´ï¼Œå¯èƒ½ä¼šå¸¦æ¥ä¸€äº›é—®é¢˜ï¼Œå› ä¸ºæœ‰æ—¶å€™å®å†™æ³•é€šè¿‡ç¼–è¯‘åï¼Œåœ¨è¿è¡Œé˜¶æ®µå¯èƒ½ä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼›è€Œå‡½æ•°æŒ‡é’ˆå†™æ³•å¯ä»¥åœ¨å‡ºç°è¿™ä¸€é—®é¢˜ä¹‹å‰ï¼ˆç¼–è¯‘é˜¶æ®µï¼‰æå‰å‘ç°è¿™ä¸€é—®é¢˜ï¼Œä½¿å¾—ç¨‹åºæ— æ³•é€šè¿‡ç¼–è¯‘ã€‚</li>
<li>ä½†æ˜¯äº‹å®ä¸Šï¼Œå®å†™æ³•è¿˜æ˜¯å­˜åœ¨ä¸€å®šçš„å¥½å¤„ï¼Œå½“ä¿¡å·å‡½æ•°å‡ºç°é‡è½½æ—¶ï¼Œä½¿ç”¨å‡½æ•°æŒ‡é’ˆæ—¶ï¼Œæ— æ³•ç›´æ¥è¿›è¡Œè¿æ¥ï¼ˆä¼šäº§ç”ŸæŠ¥é”™ï¼‰ï¼Œåªèƒ½ä½¿ç”¨ç±»å‹è½¬æ¢æ¥è¿›è¡Œå‡½æ•°æŒ‡é’ˆç±»å‹çš„è½¬æ¢ï¼Œå¦‚<code>static_cast&lt;void QSpinBox::*)(int)&gt;</code>ã€‚</li>
<li>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ¨èä½¿ç”¨å‡½æ•°æŒ‡é’ˆæ–¹å¼è¿æ¥ä¿¡å·ä¸æ§½ã€‚</li>
<li>å½“é¢å¯¹ä¿¡å·ä¸æ§½å‡½æ•°æœ‰é‡è½½çš„æƒ…å†µæ—¶ï¼Œæ¨èä½¿ç”¨å®æ–¹å¼è¿æ¥ã€‚</li>
<li>å¯¹äºçŸ­å°çš„æ§½å‡½æ•°çš„è°ƒç”¨ä¸”åŠŸèƒ½ä¸è¢«å¤ç”¨æ—¶ï¼Œæ¨èä½¿ç”¨ lambda æ–¹å¼è¿æ¥ã€‚</li>
</ul>
<h5 id="4-2-4-å…¶ä»–è¿æ¥ä¿¡å·ä¸æ§½çš„æ–¹å¼"><a href="#4-2-4-å…¶ä»–è¿æ¥ä¿¡å·ä¸æ§½çš„æ–¹å¼" class="headerlink" title="4.2.4 å…¶ä»–è¿æ¥ä¿¡å·ä¸æ§½çš„æ–¹å¼"></a>4.2.4 å…¶ä»–è¿æ¥ä¿¡å·ä¸æ§½çš„æ–¹å¼</h5><ul>
<li>ä½¿ç”¨ Qt Designer è¿æ¥ä¿¡å·ä¸æ§½<br><img src="/./BetterQT/Designer_Connect.png" alt="Qt Designer Connect"></li>
<li>ä½¿ç”¨â€è½¬åˆ°æ§½â€æ–¹å¼</li>
<li>ä¿¡å·ä¸æ§½è‡ªåŠ¨ç»‘å®š<br>ä½¿ç”¨ <code>void on_&lt;å¯¹è±¡å&gt;_&lt;ä¿¡å·å&gt;(ä¿¡å·å‚æ•°);</code> æ—¶å¯ä»¥ä¸ä½¿ç”¨ <code>connect</code> è¿›è¡Œè¿æ¥ï¼Œä½†æ˜¯å½“å¯¹è±¡åã€ä¿¡å·åæˆ–å‚æ•°å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè¿æ¥å°†ä¼šå¤±æ•ˆï¼Œä¸”ç¼–è¯‘ä¸ä¼šæœ‰é”™è¯¯æç¤ºã€‚</li>
</ul>
<h4 id="4-3-Qt-çª—å£"><a href="#4-3-Qt-çª—å£" class="headerlink" title="4.3 Qt çª—å£"></a>4.3 Qt çª—å£</h4><h5 id="4-3-1-çª—å£çš„ç±»å‹"><a href="#4-3-1-çª—å£çš„ç±»å‹" class="headerlink" title="4.3.1 çª—å£çš„ç±»å‹"></a>4.3.1 çª—å£çš„ç±»å‹</h5><p><strong>é¡¶å±‚çª—å£ã€æ¬¡çº§çª—å£ï¼ˆçˆ¶ã€å­çª—å£ï¼‰</strong><br><img src="/./BetterQT/Qt_Windows.png" alt="Qt Windows"><br>åœ¨è¯¥å›¾ä¸­ï¼Œâ‘ å¯ä»¥ç§°ä¸ºé¡¶å±‚çª—å£ï¼ˆçˆ¶çª—å£ï¼‰ï¼Œâ‘¡å¯ä»¥ç§°ä¸ºæ¬¡çº§çª—å£ï¼ˆå­çª—å£ï¼‰ã€‚çª—å£ä¸­çš„æŸäº›æŒ‰é’®ã€è¾“å…¥æ¡†â€¦ç­‰å°±æ˜¯æ§ä»¶ã€‚</p>
<h5 id="4-3-2-è®¾ç½®çª—å£æ ‡å¿—"><a href="#4-3-2-è®¾ç½®çª—å£æ ‡å¿—" class="headerlink" title="4.3.2 è®¾ç½®çª—å£æ ‡å¿—"></a>4.3.2 è®¾ç½®çª—å£æ ‡å¿—</h5><p>åœ¨ Qt ä¸­å¯ä»¥ä½¿ç”¨ <code>setWindowFlags()</code> æ¥è®¾ç½®çª—å£æ ‡å¿—</p>
<ol>
<li><p>è®¾ç½®çª—å£æ— æ ‡é¢˜æ <br><img src="/./BetterQT/Window_With_No_Title.png" alt="Window With No Title"></p>
 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">setWindowFlags</span>(Qt::CustomizeWindowHint);</span><br></pre></td></tr></table></figure></li>
<li><p>è®¾ç½®çª—å£æ— è¾¹æ¡†<br><img src="/./BetterQT/Window_With_No_Frame.png" alt="Window With No Frame"></p>
 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setWindowFlags</span>(Qt::FramelessWindowHint);</span><br></pre></td></tr></table></figure></li>
<li><p>è®¾ç½®çª—å£ç½®é¡¶</p>
 <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setWindowFlags</span>(Qt::WindowStaysOnTopHint);</span><br></pre></td></tr></table></figure>
<p> å¦‚æœæŒ‰ç…§ä¸Šè¿°æ–¹å¼ä¾æ¬¡è®¾ç½®çª—å£æ ‡å¿—ï¼Œæˆ‘ä»¬ä¼šå‘ç°å½“è®¾ç½®ç¬¬ $3$ æ­¥æ—¶å‰é¢ä¸¤æ­¥çš„æ“ä½œéƒ½å¤±æ•ˆäº†ï¼Œè¿™æ˜¯å› ä¸ºè®¾ç½®çª—å£ç½®é¡¶æ—¶ï¼Œä¼šè¦†ç›–å‰é¢çš„è®¾ç½®ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€œæˆ–â€ç¬¦è¿æ¥è¿™äº›æ ‡å¿—ï¼Œè§£å†³è¿™ä¸€é—®é¢˜ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">setWindowFlags</span>(Qt::CustomizeWindowHint | Qt::FramelessWindowHint | Qt::WindowStaysOnTopHint);</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="4-4-çª—å£åæ ‡ç³»ä¸å‡ ä½•å¸ƒå±€"><a href="#4-4-çª—å£åæ ‡ç³»ä¸å‡ ä½•å¸ƒå±€" class="headerlink" title="4.4 çª—å£åæ ‡ç³»ä¸å‡ ä½•å¸ƒå±€"></a>4.4 çª—å£åæ ‡ç³»ä¸å‡ ä½•å¸ƒå±€</h4><h5 id="4-4-1-çª—å£çš„åæ ‡ç³»"><a href="#4-4-1-çª—å£çš„åæ ‡ç³»" class="headerlink" title="4.4.1 çª—å£çš„åæ ‡ç³»"></a>4.4.1 çª—å£çš„åæ ‡ç³»</h5><img src="./BetterQT/CoordinateSystem.png" alt="Window Coordinate System" style="zoom:50%;" />

<h5 id="4-4-2-çª—å£çš„å‡ ä½•å¸ƒå±€"><a href="#4-4-2-çª—å£çš„å‡ ä½•å¸ƒå±€" class="headerlink" title="4.4.2 çª—å£çš„å‡ ä½•å¸ƒå±€"></a>4.4.2 çª—å£çš„å‡ ä½•å¸ƒå±€</h5><img src="./BetterQT/WindowLayout.png" alt="Window Layout" style="zoom:50%;" />

<h4 id="4-5-æ·»åŠ å›¾æ ‡"><a href="#4-5-æ·»åŠ å›¾æ ‡" class="headerlink" title="4.5 æ·»åŠ å›¾æ ‡"></a>4.5 æ·»åŠ å›¾æ ‡</h4><h5 id="4-5-1-ä¸ºçª—å£æ·»åŠ å›¾æ ‡"><a href="#4-5-1-ä¸ºçª—å£æ·»åŠ å›¾æ ‡" class="headerlink" title="4.5.1 ä¸ºçª—å£æ·»åŠ å›¾æ ‡"></a>4.5.1 ä¸ºçª—å£æ·»åŠ å›¾æ ‡</h5><ol>
<li>å‡†å¤‡å›¾æ ‡æ–‡ä»¶</li>
<li>è°ƒç”¨ <code>setWindowIcon</code> æ–¹æ³•</li>
</ol>
<h5 id="4-5-2-ä¸ºåº”ç”¨ç¨‹åºæ·»åŠ å›¾æ ‡ï¼ˆä¸€èˆ¬ä½¿ç”¨è¿™ç§æ–¹å¼ï¼‰"><a href="#4-5-2-ä¸ºåº”ç”¨ç¨‹åºæ·»åŠ å›¾æ ‡ï¼ˆä¸€èˆ¬ä½¿ç”¨è¿™ç§æ–¹å¼ï¼‰" class="headerlink" title="4.5.2 ä¸ºåº”ç”¨ç¨‹åºæ·»åŠ å›¾æ ‡ï¼ˆä¸€èˆ¬ä½¿ç”¨è¿™ç§æ–¹å¼ï¼‰"></a>4.5.2 ä¸ºåº”ç”¨ç¨‹åºæ·»åŠ å›¾æ ‡ï¼ˆä¸€èˆ¬ä½¿ç”¨è¿™ç§æ–¹å¼ï¼‰</h5><ol>
<li>å‡†å¤‡å›¾æ ‡æ–‡ä»¶ <code>logo.ico</code></li>
<li>ä¿®æ”¹ pro å·¥ç¨‹æ–‡ä»¶ <code>RC_ICONS = &lt;Path&gt;</code></li>
<li>é€šè¿‡æ­¤ç§æ–¹å¼ä¿®æ”¹å›¾æ ‡ï¼Œå¯æ‰§è¡Œç¨‹åº <code>.exe</code> çš„å›¾æ ‡ä¼šä¿®æ”¹ï¼Œä¸”ä¸éœ€è¦é¢å¤–å•ç‹¬è®¾ç½®çª—å£å›¾æ ‡ã€‚</li>
</ol>
<h4 id="4-6-éƒ¨ç½²äº§å“çš„ä¸‰ç§æ–¹å¼"><a href="#4-6-éƒ¨ç½²äº§å“çš„ä¸‰ç§æ–¹å¼" class="headerlink" title="4.6 éƒ¨ç½²äº§å“çš„ä¸‰ç§æ–¹å¼"></a>4.6 éƒ¨ç½²äº§å“çš„ä¸‰ç§æ–¹å¼</h4><ol>
<li><p>æ‰‹åŠ¨éƒ¨ç½²ï¼ˆä¸å¸¸ç”¨ï¼Œæ¯”è¾ƒç¹çï¼‰<br>è¿›å…¥ <code>.exe</code> æ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹ï¼ˆ<code>debug</code>ç›®å½•ï¼‰ï¼ŒåŒå‡»è¿è¡Œ <code>.exe</code> æ–‡ä»¶ï¼Œä¼šæç¤ºç¼ºå°‘çš„æ–‡ä»¶ï¼ˆåŒ…æ‹¬<code>dll</code>åŠ¨æ€åº“ã€<code>plugin</code>æ’ä»¶ç­‰ï¼‰ï¼Œç„¶åæ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶ç§»åŠ¨åˆ° <code>.exe</code> æ–‡ä»¶çš„åŒçº§ç›®å½•ä¸‹å³å¯ï¼Œå¦‚ä¸‹ï¼š<br><img src="/./BetterQT/EXE_File_Dictionary.png" alt="EXE File Dictionary"><br>å¦‚æœé…ç½®äº†ç¯å¢ƒå˜é‡åˆ™å¤§æ¦‚ç‡ä¸ä¼šå‡ºç°æŠ¥é”™æç¤ºç¼ºå°‘åº“çš„é—®é¢˜ï¼Œé‚£ä¹ˆè¿™ç§æ–¹å¼å°±ä¼šå¤±æ•ˆã€‚</p>
</li>
<li><p>ä½¿ç”¨ windeployqt éƒ¨ç½²<br>â‘  æŸ¥æ‰¾ <code>windeployqt.exe</code> ç¨‹åº<br>â‘¡ å°† <code>windeployqt.exe</code> åŠ å…¥ç¯å¢ƒå˜é‡<br>â‘¢ å†å‘½ä»¤è¡Œç•Œé¢æ‰§è¡Œå‘½ä»¤ <code>windeployqt.exe &lt;exe_file_dir&gt;</code> å®Œæˆæ“ä½œ<br><img src="/./BetterQT/WIN_DEPLOY_QT_1.png" alt="WIN DEPLOY QT"><br><img src="/./BetterQT/WIN_DEPLOY_QT_2.png" alt="WIN DEPLOY QT"><br><img src="/./BetterQT/WIN_DEPLOY_QT_3.png" alt="WIN DEPLOY QT"></p>
</li>
<li><p>ä½¿ç”¨creator éƒ¨ç½²<br>â‘  é¡¹ç›®å¯¼èˆªçª—å£â†’è¿è¡Œâ†’éƒ¨ç½²â†’æ·»åŠ è‡ªå®šä¹‰éƒ¨ç½²<br><img src="/./BetterQT/CREATOR_DEPLOY_1.png" alt="CREATOR DEPLOY"><br><img src="/./BetterQT/CREATOR_DEPLOY_2.png" alt="CREATOR DEPLOY"><br><img src="/./BetterQT/CREATOR_DEPLOY_3.png" alt="CREATOR DEPLOY"><br>â‘¡ è¾“å…¥ <code>windeployqt.exe</code> ç¨‹åºåŠå¯¹åº”çš„å‘½ä»¤è¡Œå‚æ•°<br><img src="/./BetterQT/CREATOR_DEPLOY_4.png" alt="CREATOR DEPLOY"><br><img src="/./BetterQT/CREATOR_DEPLOY_5.png" alt="CREATOR DEPLOY"><br>â‘¢ æ‰§è¡Œéƒ¨ç½²å‘½ä»¤<br><img src="/./BetterQT/CREATOR_DEPLOY_6.png" alt="CREATOR DEPLOY"><br><img src="/./BetterQT/CREATOR_DEPLOY_OK.png" alt="CREATOR DEPLOY OK"></p>
</li>
</ol>
<h3 id="ğŸ¦-5-Qt-å¸¸ç”¨æ§ä»¶"><a href="#ğŸ¦-5-Qt-å¸¸ç”¨æ§ä»¶" class="headerlink" title="ğŸ¦ 5. Qt å¸¸ç”¨æ§ä»¶"></a>ğŸ¦ 5. Qt å¸¸ç”¨æ§ä»¶</h3><p>å®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/index.html">Qt 6.7</a></p>
<p>ä¸€ä¸ªä¸é”™çš„ Qt ä¸­æ–‡æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="http://qt5.digitser.top/5.15/zh-CN/">Qt ä¸­æ–‡æ–‡æ¡£ 5.15.1 ç‰ˆæœ¬</a></p>
<h4 id="5-1-QLabel-æ ‡ç­¾æ§ä»¶"><a href="#5-1-QLabel-æ ‡ç­¾æ§ä»¶" class="headerlink" title="5.1 QLabel æ ‡ç­¾æ§ä»¶"></a>5.1 <code>QLabel</code> æ ‡ç­¾æ§ä»¶</h4><p><code>QLabel</code> çš„æœ¬è´¨å…¶å®å°±æ˜¯æ˜¾ç¤ºæ•°æ®ã€‚å…¶å¯ä»¥æ˜¾ç¤ºæ–‡æœ¬æ•°æ®ã€å›¾ç‰‡æ•°æ®ã€‚</p>
<img src="./BetterQT/QLabelShowData.png" style="zoom: 20%;" >

<p>äº†è§£äº†è¿™äº›æˆ‘ä»¬å†æ¥çœ‹ <code>QLabel</code> çš„ä¸€äº›å¸¸ç”¨å±æ€§ï¼š</p>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th align="left">è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong><a target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/qlabel.html#text-prop"><code>text</code></a></strong><code>: QString</code></td>
<td align="left">æ–‡æœ¬å†…å®¹ï¼šçº¯æ–‡æœ¬</td>
</tr>
<tr>
<td><strong><a target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/qlabel.html#openExternalLinks-prop"><code>openExternalLinks</code></a></strong><code>:bool</code></td>
<td align="left">æ–‡æœ¬å†…å®¹ï¼šè¶…é“¾æ¥</td>
</tr>
<tr>
<td><strong><a target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/qlabel.html#textFormat-prop"><code>textFormat</code></a></strong> <code>: Qt::TextFormat</code></td>
<td align="left">æ–‡æœ¬å†…å®¹ï¼šä¸åŒç±»å‹çš„æ–‡æœ¬ï¼Œå¦‚å¯Œæ–‡æœ¬ç­‰</td>
</tr>
<tr>
<td><strong><a target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/qlabel.html#alignment-prop"><code>alignment</code></a></strong><code>: Qt::Alignment</code></td>
<td align="left">æ–‡æœ¬æ ¼å¼ï¼šå¯¹é½æ–¹å¼</td>
</tr>
<tr>
<td><strong><a target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/qlabel.html#indent-prop"><code>indent</code></a></strong><code>: int</code></td>
<td align="left">æ–‡æœ¬æ ¼å¼ï¼šç¼©è¿›</td>
</tr>
<tr>
<td><strong><a target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/qlabel.html#margin-prop"><code>margin</code></a></strong><code> : int</code></td>
<td align="left">æ–‡æœ¬æ ¼å¼ï¼šè¾¹è·</td>
</tr>
<tr>
<td><strong><a target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/qlabel.html#wordWrap-prop"><code>wordWrap</code></a></strong><code>: bool</code></td>
<td align="left">æ–‡æœ¬æ ¼å¼ï¼šæ¢è¡Œ</td>
</tr>
<tr>
<td><strong><a target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/qlabel.html#pixmap-prop"><code>pixmap</code></a></strong><code>: QPixmap</code></td>
<td align="left">å›¾ç‰‡å†…å®¹ï¼šæ˜¾ç¤ºå›¾ç‰‡</td>
</tr>
<tr>
<td><strong><a target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/qlabel.html#hasSelectedText-prop"><code>hasSelectedText</code></a></strong><code>: const bool</code></td>
<td align="left">æ–¹æ³•ï¼šæ–‡æœ¬æ˜¯å¦è¢«é€‰ä¸­</td>
</tr>
<tr>
<td><strong><a target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/qlabel.html#scaledContents-prop"><code>scaledContents</code></a></strong><code>: bool</code></td>
<td align="left">æ–¹æ³•ï¼šæ˜¯å¦ç¼©æ”¾å†…å®¹</td>
</tr>
<tr>
<td><strong><a target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/qlabel.html#selectedText-prop"><code>selectedText</code></a></strong><code>: const QString</code></td>
<td align="left">æ–¹æ³•ï¼šè·å–é€‰ä¸­çš„å†…å®¹</td>
</tr>
<tr>
<td><strong><a target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/qlabel.html#textInteractionFlags-prop"><code>textInteractionFlags</code></a></strong><code>: Qt::TextInteractionFlags</code></td>
<td align="left">æ–¹æ³•ï¼šæŒ‡å®šæ ‡ç­¾åº”å¦‚ä½•ä¸ç”¨æˆ·è¾“å…¥äº¤äº’ï¼Œè‹¥å®ƒæ˜¾ç¤ºæ–‡æœ¬</td>
</tr>
</tbody></table>
<h4 id="5-2-QLineEdit-å•è¡Œè¾“å…¥æ¡†æ§ä»¶"><a href="#5-2-QLineEdit-å•è¡Œè¾“å…¥æ¡†æ§ä»¶" class="headerlink" title="5.2 QLineEdit å•è¡Œè¾“å…¥æ¡†æ§ä»¶"></a>5.2 <code>QLineEdit</code> å•è¡Œè¾“å…¥æ¡†æ§ä»¶</h4><p><code>QLineEdit</code> çš„æœ¬è´¨æ˜¯ç”¨äºä¸ç¡®å®šçš„è¾“å…¥ï¼Œå¦‚ç”¨æˆ·çš„æ‰‹æœºå·ã€ç”¨æˆ·çš„å¯†ç ã€‚è¿™æ ·å°±ç»™äº†ç”¨æˆ·ä¸€å®šçš„è‡ªç”±ï¼Œä½†æ˜¯æˆ‘ä»¬åŒæ—¶éœ€è¦åˆ¶å®šä¸€ç³»åˆ—çš„è§„åˆ™ï¼Œä»¥æ ¡éªŒç”¨æˆ·çš„è¾“å…¥ã€‚ä¾‹å¦‚ç”¨æˆ·è¾“å…¥æ‰‹æœºå·ï¼Œæˆ‘ä»¬éœ€è¦åˆ¶å®šä¸€ä¸ªé•¿åº¦ä¸º <code>11</code> ä½çš„è§„åˆ™ï¼Œå¹¶ä¸”è¾“å…¥å­—ç¬¦ä¸­ä¸åŒ…å«å­—æ¯ç­‰ï¼Œä»¥æ–¹ä¾¿å¼€å‘äººå‘˜è¿›è¡Œæ ¡éªŒã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥é…åˆä¸€äº›å…¶ä»–æ“ä½œæ¥ä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼Œå¦‚ï¼šæ¸…ç©ºï¼ˆå¦‚ï¼šå¿«é€Ÿæ¸…ç©ºå†…å®¹ï¼‰ã€æç¤ºï¼ˆå¦‚ï¼šæç¤ºè¾“å…¥æ ¼å¼ï¼‰ã€è®°å¿†ï¼ˆå¦‚ï¼šè®°å¿†ä¹‹å‰çš„è¾“å…¥ï¼‰ç­‰ã€‚</p>
<img src="./BetterQT/QLineEditGetData.png" style="zoom: 20%;" >

<p>äº†è§£äº†è¿™äº›æˆ‘ä»¬å¯ä»¥çœ‹ä¸€ä¸‹ <code>QLineEdit</code> çš„ä¸€äº›å¸¸ç”¨å±æ€§ï¼ˆä¸å®Œå…¨ï¼Œå…·ä½“è¿˜æ˜¯éœ€è¦çœ‹æ–‡æ¡£ï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td><strong><a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qlineedit.html#clearButtonEnabled-prop"><code>clearButtonEnabled</code></a></strong><code>: bool</code></td>
<td>æ¸…ç©ºæ–‡æœ¬æ¡†å†…å®¹<br />è¯¥å±æ€§ä¿å­˜è¡Œç¼–è¾‘ä¸ä¸ºç©ºæ—¶æ˜¯å¦æ˜¾ç¤ºæ¸…é™¤æŒ‰é’®ã€‚</td>
</tr>
<tr>
<td><strong><a target="_blank" rel="noopener" href="https://doc.qt.io/qt-6/qlineedit.html#placeholderText-prop"><code>placeholderText</code></a></strong><code>: QString</code></td>
<td>å ä½ç¬¦æ–‡æœ¬ï¼Œå¯ä»¥ç”¨äºæç¤ºè¾“å…¥å†…å®¹ã€‚</td>
</tr>
<tr>
<td><strong><a target="_blank" rel="noopener" href="https://doc.qt.io/qt-5/qlineedit.html#inputMask-prop"><code>inputMask</code></a></strong><code>: QString</code></td>
<td>æ©ç </td>
</tr>
</tbody></table>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatarMyself.jpg" alt="NilEra"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">NilEra</p><p class="is-size-6 is-block">C/C++ Developer!</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Jinan Shandong</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ–‡ç« </p><a href="/archives"><p class="title">31</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">åˆ†ç±»</p><a href="/categories"><p class="title">27</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">æ ‡ç­¾</p><a href="/tags"><p class="title">32</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/NilEra-K" target="_blank" rel="noopener">å…³æ³¨æˆ‘</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/NilEra-K"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">é“¾æ¥</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://github.com/NilEra-K" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">GitHub</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li><li><a class="level is-mobile" href="https://nano.chemtian.top/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Thymol Blue</span></span><span class="level-right"><span class="level-item tag">nano.chemtian.top</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">åˆ†ç±»</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/CppDev/"><span class="level-start"><span class="level-item">CppDev</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/CppDev/Gaming/"><span class="level-start"><span class="level-item">Gaming</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/CppDev/QT6/"><span class="level-start"><span class="level-item">QT6</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/CppDev/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">å¤šçº¿ç¨‹ç¼–ç¨‹</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Linux/%E8%BD%AF%E4%BB%B6%E6%BA%90/"><span class="level-start"><span class="level-item">è½¯ä»¶æº</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF/"><span class="level-start"><span class="level-item">å¤§æ•°æ®æŠ€æœ¯</span></span><span class="level-end"><span class="level-item tag">8</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF/ECharts/"><span class="level-start"><span class="level-item">ECharts</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF/HBase/"><span class="level-start"><span class="level-item">HBase</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF/Scala/"><span class="level-start"><span class="level-item">Scala</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF/Spark/"><span class="level-start"><span class="level-item">Spark</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/"><span class="level-start"><span class="level-item">æ•°æ®å¯è§†åŒ–</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF/%E9%A1%B9%E7%9B%AE/"><span class="level-start"><span class="level-item">é¡¹ç›®</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"><span class="level-start"><span class="level-item">å¼€å‘å·¥å…·</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Axure-RP-9/"><span class="level-start"><span class="level-item">Axure RP 9</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Docker/"><span class="level-start"><span class="level-item">Docker</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Git/"><span class="level-start"><span class="level-item">Git</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/VSCode/"><span class="level-start"><span class="level-item">VSCode</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E7%AE%97%E6%B3%95/"><span class="level-start"><span class="level-item">æ•°æ®ç»“æ„/ç®—æ³•</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E7%AE%97%E6%B3%95/%E5%93%88%E5%B8%8C-Hash/"><span class="level-start"><span class="level-item">å“ˆå¸Œ(Hash)</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E7%AE%97%E6%B3%95/%E6%A0%88-Stack/"><span class="level-start"><span class="level-item">æ ˆ(Stack)</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E7%AE%97%E6%B3%95/%E6%A0%91-Tree/"><span class="level-start"><span class="level-item">æ ‘(Tree)</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"><span class="level-start"><span class="level-item">æ·±åº¦å­¦ä¹ </span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/Kaggle/"><span class="level-start"><span class="level-item">Kaggle</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/PyTorch/"><span class="level-start"><span class="level-item">PyTorch</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E9%97%B2%E8%81%8A/"><span class="level-start"><span class="level-item">é—²èŠ</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E9%97%B2%E8%81%8A/%E8%AE%A1%E5%88%92/"><span class="level-start"><span class="level-item">è®¡åˆ’</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">è®¢é˜…æ›´æ–°</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="è®¢é˜…"></div></div></form></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="è®¢é˜…"></div></div></form></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">æœ€æ–°æ–‡ç« </h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-08-01T07:29:16.000Z">2024-08-01</time></p><p class="title"><a href="/2024/08/01/LLM-General-Education/">LLM_General_Education</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-30T14:55:47.000Z">2024-07-30</time></p><p class="title"><a href="/2024/07/30/MyBatisPlus/">MyBatisPlus</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-30T14:36:18.000Z">2024-07-30</time></p><p class="title"><a href="/2024/07/30/SpringCloud/">SpringCloud</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-29T07:32:17.000Z">2024-07-29</time></p><p class="title"><a href="/2024/07/29/Cpp-Muti-Threaded/">Cpp_Muti_Threaded</a></p><p class="categories"><a href="/categories/CppDev/">CppDev</a> / <a href="/categories/CppDev/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/">å¤šçº¿ç¨‹ç¼–ç¨‹</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-29T07:29:04.000Z">2024-07-29</time></p><p class="title"><a href="/2024/07/29/Cpp-Network-Programming/">Cpp_Network_Programming</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">å½’æ¡£</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/08/"><span class="level-start"><span class="level-item">å…«æœˆ 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/07/"><span class="level-start"><span class="level-item">ä¸ƒæœˆ 2024</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/06/"><span class="level-start"><span class="level-item">å…­æœˆ 2024</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/05/"><span class="level-start"><span class="level-item">äº”æœˆ 2024</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/04/"><span class="level-start"><span class="level-item">å››æœˆ 2024</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/03/"><span class="level-start"><span class="level-item">ä¸‰æœˆ 2024</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">æ ‡ç­¾</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Axure-RP-9/"><span class="tag">Axure RP 9</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CppDev/"><span class="tag">CppDev</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Docker/"><span class="tag">Docker</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ECharts/"><span class="tag">ECharts</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/EasyX/"><span class="tag">EasyX</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GameDev/"><span class="tag">GameDev</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Git/"><span class="tag">Git</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/HBase/"><span class="tag">HBase</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hadoop/"><span class="tag">Hadoop</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JavaDev/"><span class="tag">JavaDev</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Kaggle/"><span class="tag">Kaggle</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MyBatis-Plus/"><span class="tag">MyBatis-Plus</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PyTorch/"><span class="tag">PyTorch</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/QT6/"><span class="tag">QT6</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/R/"><span class="tag">R</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Scala/"><span class="tag">Scala</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spark/"><span class="tag">Spark</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Tomcat/"><span class="tag">Tomcat</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/VSCode/"><span class="tag">VSCode</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ZooKeeper/"><span class="tag">ZooKeeper</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/"><span class="tag">å¤šçº¿ç¨‹ç¼–ç¨‹</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF/"><span class="tag">å¤§æ•°æ®æŠ€æœ¯</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"><span class="tag">å¼€å‘å·¥å…·</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"><span class="tag">æ•°æ®ç»“æ„</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"><span class="tag">æœºå™¨å­¦ä¹ </span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"><span class="tag">æ·±åº¦å­¦ä¹ </span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%AE%97%E6%B3%95/"><span class="tag">ç®—æ³•</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%A1%E5%88%92/"><span class="tag">è®¡åˆ’</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%BD%AF%E4%BB%B6%E6%BA%90/"><span class="tag">è½¯ä»¶æº</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%97%B2%E8%81%8A/"><span class="tag">é—²èŠ</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%A1%B9%E7%9B%AE/"><span class="tag">é¡¹ç›®</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/StarLogo.svg" alt="Hello, NilEra :-)" height="28"></a><p class="is-size-7"><span>&copy; 2024 NilEra</span>Â Â Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>Â &amp;Â <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">Â© 2024 å‰æ–¹âš¡é«˜èƒ½</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/NilEra-K"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="å›åˆ°é¡¶ç«¯" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "æ­¤ç½‘ç«™ä½¿ç”¨Cookieæ¥æ”¹å–„æ‚¨çš„ä½“éªŒã€‚",
          dismiss: "çŸ¥é“äº†ï¼",
          allow: "å…è®¸ä½¿ç”¨Cookie",
          deny: "æ‹’ç»",
          link: "äº†è§£æ›´å¤š",
          policy: "Cookieæ”¿ç­–",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/javascript" id="MathJax-script" async>MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      },
      chtml: {
        matchFontHeight: false
      }
    };</script><script src="https://cdnjs.loli.net/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js"></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container" id="algolia-input"></div><div id="algolia-poweredby" style="display:flex;margin:0 .5em 0 1em;align-items:center;line-height:0"></div><a class="searchbox-close" href="javascript:;">Ã—</a></div><div class="searchbox-body"></div><div class="searchbox-footer"></div></div></div><script src="https://cdnjs.loli.net/ajax/libs/algoliasearch/4.0.3/algoliasearch-lite.umd.js" crossorigin="anonymous" defer></script><script src="https://cdnjs.loli.net/ajax/libs/instantsearch.js/4.3.1/instantsearch.production.min.js" crossorigin="anonymous" defer></script><script src="/js/algolia.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadAlgolia({"applicationId":"2TB5ZZYPCO","apiKey":"00a43f1d62ca7b24c8b78d5f0223c065","indexName":"dev_nilera_blog"}, {"hint":"æƒ³è¦æŸ¥æ‰¾ä»€ä¹ˆ...","no_result":"æœªæ‰¾åˆ°æœç´¢ç»“æœ","untitled":"(æ— æ ‡é¢˜)","empty_preview":"(æ— å†…å®¹é¢„è§ˆ)"});
        });</script></body></html>