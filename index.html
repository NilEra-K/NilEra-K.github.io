<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><meta name="theme-color" content="#123456"><meta name="generator" content="Hexo 4.2.0"><title>Hello, NilEra :-)</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="Hello, NilEra :-)"><meta name="msapplication-TileImage" content="/img/StarLogo.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Hello, NilEra :-)"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="努力做自己喜欢的事"><meta property="og:type" content="blog"><meta property="og:title" content="Hello, NilEra :-)"><meta property="og:url" content="https://hello-nilera.com/"><meta property="og:site_name" content="Hello, NilEra :-)"><meta property="og:description" content="努力做自己喜欢的事"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://hello-nilera.com/img/og_image.png"><meta property="article:author" content="NilEra"><meta property="article:tag" content="Hello NilEra"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://hello-nilera.com/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://hello-nilera.com"},"headline":"Hello, NilEra :-)","image":["https://hello-nilera.com/img/og_image.png"],"author":{"@type":"Person","name":"NilEra"},"publisher":{"@type":"Organization","name":"Hello, NilEra :-)","logo":{"@type":"ImageObject","url":"https://hello-nilera.com/img/StarLogo.svg"}},"description":"努力做自己喜欢的事"}</script><link rel="icon" href="/img/StarLogo.svg"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/font-awesome/6.0.0/css/all.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/highlight.js/11.7.0/styles/atom-one-light.min.css"><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?249654dcf9a3bf70708fdfc6e2b1ec2b";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><meta name="msvalidate.01" content="F6BD78C6BD0096D2218CF88334111125"><!--!--><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdnjs.loli.net/ajax/libs/pace/1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/StarLogo.svg" alt="Hello, NilEra :-)" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item is-active" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">目录</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a><a class="navbar-item" href="/me">我</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/NilEra-K"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-08-01T07:29:16.000Z" title="2024/8/1 15:29:16">2024-08-01</time>发表</span><span class="level-item"><time dateTime="2024-08-01T12:30:28.902Z" title="2024/8/1 20:30:28">2024-08-01</time>更新</span><span class="level-item">2 分钟读完 (大约284个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/08/01/LLM-General-Education/">LLM_General_Education</a></p><div class="content"><h2 id="🤗-大语言模型通识"><a href="#🤗-大语言模型通识" class="headerlink" title="🤗 大语言模型通识"></a>🤗 大语言模型通识</h2><h3 id="大语言模型"><a href="#大语言模型" class="headerlink" title="大语言模型"></a>大语言模型</h3><p>首先要搞清楚，本地可以部署什么大模型，取决于个人电脑的硬件配置，尤其需要关注GPU的显存。一般来说，只要本地机器GPU的显存能够满足大模型的要求，那基本上都可以本地部署。</p>
<p>那么大模型类别这么多，有7B、13B、70B等等，GPU显存如何准备呢？</p>
<p>在没有考虑任何模型量化技术的前提下，有公式如下：<br>$$<br>GB &#x3D; B × 2<br>$$</p>
<p>其中为 <em><strong>GB</strong></em> 模型显存占用，<em><strong>B</strong></em> 为大模型参数量。</p>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p><a target="_blank" rel="noopener" href="https://www.bilibili.com/read/cv33371756/">AI大模型本地化部署Q&#x2F;A硬件篇</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35054222/article/details/139123564">如何找到最新的大模型、如何判断本地硬件是否满足大模型需求、如何快速部署大模型</a></p>
<p><a target="_blank" rel="noopener" href="https://www.datalearner.com/ai-models/leaderboard/datalearner-llm-leaderboard">大模型综合评测对比 | 当前主流大模型在各评测数据集上的表现总榜单 | 数据学习 (DataLearner)</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-07-30T14:55:47.000Z" title="2024/7/30 22:55:47">2024-07-30</time>发表</span><span class="level-item"><time dateTime="2024-07-31T09:22:55.139Z" title="2024/7/31 17:22:55">2024-07-31</time>更新</span><span class="level-item">30 分钟读完 (大约4524个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/07/30/MyBatisPlus/">MyBatisPlus</a></p><div class="content"><h2 id="🐦MyBatis-Plus"><a href="#🐦MyBatis-Plus" class="headerlink" title="🐦MyBatis-Plus"></a>🐦MyBatis-Plus</h2><p>[TOC]</p>
<h3 id="🚪-1-快速入门"><a href="#🚪-1-快速入门" class="headerlink" title="🚪 1. 快速入门"></a>🚪 1. 快速入门</h3><h4 id="1-1-入门案例"><a href="#1-1-入门案例" class="headerlink" title="1.1 入门案例"></a>1.1 入门案例</h4><p>入门案例：基于课前资料提供的项目，实现下列功能:</p>
<ul>
<li>新增用户功能</li>
<li>根据 <code>id</code> 查询用户</li>
<li>根据 <code>id</code> 批量查询用户</li>
<li>根据 <code>id</code> 更新用户</li>
<li>根据 <code>id</code> 删除用户</li>
</ul>
<h5 id="1-1-1-引入-MyBatis-Plus-的依赖"><a href="#1-1-1-引入-MyBatis-Plus-的依赖" class="headerlink" title="1.1.1 引入 MyBatis-Plus 的依赖"></a>1.1.1 引入 <code>MyBatis-Plus</code> 的依赖</h5><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- MyBatisPlus --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="1-1-2-定义-Mapper"><a href="#1-1-2-定义-Mapper" class="headerlink" title="1.1.2 定义 Mapper"></a>1.1.2 定义 <code>Mapper</code></h5><p>自定义的 <code>Mapper</code> 继承 <code>MybatisPlus</code>提供的 <code>BaseMapper</code> 接口。</p>
<p><code>BaseMapper&lt;T&gt;</code> 给我们提供了很多基础方法，如常用的增、删、改、查等操作。</p>
<p><img src="/./MyBatisPlus/BaseMapperInterface.png" alt="BaseMapperInterface"> </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> <span class="keyword">extends</span> <span class="title class_">BaseMapper</span>&lt;User&gt; &#123; &#125;</span><br></pre></td></tr></table></figure>

<h5 id="1-1-3-直接使用"><a href="#1-1-3-直接使用" class="headerlink" title="1.1.3 直接使用"></a>1.1.3 直接使用</h5><p>做完上面两步操作，此时我们不需要再编写复杂的 <code>SQL</code> 语句即可对数据库进行增、删、改、查操作。</p>
<p>当然对于原有 <code>MyBatis</code> 操作，我们也可以直接使用，因为 <code>MyBatis-Plus</code> 对 <code>MyBatis</code> 是非侵入的，体现了其<strong>润物无声</strong>的特点。</p>
<h4 id="1-2-常见注解"><a href="#1-2-常见注解" class="headerlink" title="1.2 常见注解"></a>1.2 常见注解</h4><p>在初次使用 <code>MyBatis-Plus</code> 时，我们并没有指定要执行操作的表信息和字段信息，那么 <code>Mybatis-Plus</code> 是如何知道我们要查询的是哪张表？表中有哪些字段呢？</p>
<p><code>MyBatisPlus</code> 通过扫描实体类，并基于<strong>反射</strong>获取实体类信息作为数据库表信息。</p>
<p>在入门案例中 <code>1.1.2</code> 定义 <code>Mapper</code> 时，我们需要特别指定泛型类即 <code>&lt;User&gt;</code>。泛型中的 <code>User</code> 就是与数据库对应的 PO。</p>
<p><code>MyBatis-Plus</code> 就是根据 PO 实体的信息来推断出表的信息，从而生成 <code>SQL</code> 的。默认情况下：</p>
<ul>
<li><code>MyBatis-Plus</code> 会把 PO 实体的类名驼峰转下划线作为表名，如类名为 <code>UserInfo</code>，反射的表名为 <code>user_info</code>；</li>
<li><code>MyBatis-Plus</code> 会把 PO 实体的所有变量名驼峰转下划线作为表的字段名，并根据变量类型推断字段类型；</li>
<li><code>MyBatis-Plus</code> 会把名为 <code>id</code> 的字段作为主键。</li>
</ul>
<p>但很多情况下，默认的实现与实际场景不符，因此 <code>MyBatis-Plus</code> 提供了一些注解便于我们声明表信息。</p>
<h5 id="1-2-1-TableName-注解"><a href="#1-2-1-TableName-注解" class="headerlink" title="1.2.1 @TableName 注解"></a>1.2.1 <code>@TableName</code> 注解</h5><ul>
<li>描述：表名注解，标识实体类对应的表</li>
<li>使用位置：实体类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 标注实体类对应的表名 */</span></span><br><span class="line"><span class="meta">@TableName(&quot;t_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>@TableName</code> 注解除了指定表名以外，还可以指定很多其它属性：</p>
<table>
<thead>
<tr>
<th><strong>属性</strong></th>
<th><strong>类型</strong></th>
<th><strong>必须指定</strong></th>
<th><strong>默认值</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td>value</td>
<td>String</td>
<td>否</td>
<td>“”</td>
<td>表名</td>
</tr>
<tr>
<td>schema</td>
<td>String</td>
<td>否</td>
<td>“”</td>
<td>schema</td>
</tr>
<tr>
<td>keepGlobalPrefix</td>
<td>boolean</td>
<td>否</td>
<td>false</td>
<td>是否保持使用全局的 tablePrefix 的值（当全局 tablePrefix 生效时）</td>
</tr>
<tr>
<td>resultMap</td>
<td>String</td>
<td>否</td>
<td>“”</td>
<td>xml 中 resultMap 的 id（用于满足特定类型的实体类对象绑定）</td>
</tr>
<tr>
<td>autoResultMap</td>
<td>boolean</td>
<td>否</td>
<td>false</td>
<td>是否自动构建 resultMap 并使用（如果设置 resultMap 则不会进行 resultMap 的自动构建与注入）</td>
</tr>
<tr>
<td>excludeProperty</td>
<td>String[]</td>
<td>否</td>
<td>{}</td>
<td>需要排除的属性名 @since 3.3.1</td>
</tr>
</tbody></table>
<h5 id="1-2-2-TableId-注解"><a href="#1-2-2-TableId-注解" class="headerlink" title="1.2.2 @TableId 注解"></a>1.2.2 <code>@TableId</code> 注解</h5><ul>
<li>描述：主键注解，标识实体类中的主键字段</li>
<li>使用位置：实体类的主键字段</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableName(&quot;t_user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@TableId(value=&quot;id&quot;, type=IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>TableId</code> 注解支持两个属性：</p>
<table>
<thead>
<tr>
<th align="left"><strong>属性</strong></th>
<th align="left"><strong>类型</strong></th>
<th align="left"><strong>必须指定</strong></th>
<th align="left"><strong>默认值</strong></th>
<th align="left"><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>value</code></td>
<td align="left"><code>String</code></td>
<td align="left">否</td>
<td align="left">“”</td>
<td align="left">表名</td>
</tr>
<tr>
<td align="left"><code>type</code></td>
<td align="left"><code>Enum</code></td>
<td align="left">否</td>
<td align="left"><code>IdType.NONE</code></td>
<td align="left">指定主键类型</td>
</tr>
</tbody></table>
<p><code>IdType</code>支持的类型有：</p>
<table>
<thead>
<tr>
<th align="left"><strong>值</strong></th>
<th align="left"><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>AUTO</code></td>
<td align="left">数据库 <code>ID</code> 自增</td>
</tr>
<tr>
<td align="left"><code>NONE</code></td>
<td align="left">无状态，该类型为未设置主键类型（注解里等于跟随全局，全局里约等于 <code>INPUT</code>）</td>
</tr>
<tr>
<td align="left"><code>INPUT</code></td>
<td align="left"><code>insert</code> 前自行 <code>set</code> 主键值</td>
</tr>
<tr>
<td align="left"><code>ASSIGN_ID</code></td>
<td align="left">分配 <code>ID</code>（主键类型为 <code>Number</code>（<code>Long</code> 和 <code>Integer</code>）或（<code>String</code>）<em>（since 3.3.0）</em>，使用接口<code>IdentifierGenerator</code> 的方法 <code>nextId</code> （默认实现类为 <code>DefaultIdentifierGenerator</code> 雪花算法）</td>
</tr>
<tr>
<td align="left"><code>ASSIGN_UUID</code></td>
<td align="left">分配 <code>UUID</code>，主键类型为 <code>String</code>*(since 3.3.0)*，使用接口 <code>IdentifierGenerator</code> 的方法 <code>nextUUID</code>（默认 <code>default</code> 方法）</td>
</tr>
<tr>
<td align="left"><code>ID_WORKER</code></td>
<td align="left">分布式全局唯一 ID 长整型类型(please use ASSIGN_ID)</td>
</tr>
<tr>
<td align="left"><code>UUID</code></td>
<td align="left"><code>32</code> 位 <code>UUID</code> 字符串（please use ASSIGN_UUID）</td>
</tr>
<tr>
<td align="left"><code>ID_WORKER_STR</code></td>
<td align="left">分布式全局唯一 ID 字符串类型(please use ASSIGN_ID)</td>
</tr>
</tbody></table>
<p>这里比较常见的有三种：</p>
<ul>
<li><code>AUTO</code>：利用数据库的 <code>id</code> 自增长</li>
<li><code>INPUT</code>：手动生成 <code>id</code></li>
<li><code>ASSIGN_ID</code>：雪花算法生成 <code>Long</code> 类型的全局唯一 <code>id</code>，这是默认的ID策略</li>
</ul>
<h5 id="1-2-3-TableField-注解"><a href="#1-2-3-TableField-注解" class="headerlink" title="1.2.3 @TableField 注解"></a>1.2.3 <code>@TableField</code> 注解</h5><ul>
<li><p>描述：普通字段注解</p>
</li>
<li><p>示例：</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@TableName(&quot;user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="meta">@TableId(value=&quot;u_id&quot;, type=IdType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(&quot;username&quot;)</span>		<span class="comment">// 成员变量名与数据库字段名不一致</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(&quot;isMarried&quot;)</span>	<span class="comment">// 成员变量是以 `isXXX` 命名</span></span><br><span class="line">    <span class="keyword">private</span> Boolean isMarried;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField(&quot;`concat`&quot;)</span>		<span class="comment">// 成员变量名与数据库一致, 但是与数据库的关键字冲突</span></span><br><span class="line">    <span class="keyword">private</span> String concat;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(exist = false)</span>	<span class="comment">// 成员变量不是数据库字段</span></span><br><span class="line">    <span class="keyword">private</span> String address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一般情况下我们并不需要给字段添加 <code>@TableField</code> 注解，一些特殊情况除外：</p>
<ul>
<li>成员变量名与数据库字段名不一致；</li>
<li>成员变量是以 <code>isXXX</code> 命名，按照<code>JavaBean</code>的规范，<code>MyBatis-Plus</code>识别字段时会把 <code>is</code> 去除，这就导致与数据库不符；</li>
<li>成员变量名与数据库一致，但是与数据库的关键字冲突。使用 <code>@TableField</code> 注解给字段名添加转义字符：<code>``</code>；</li>
<li>成员变量不是数据库字段，添加 <code>exist = false</code></li>
</ul>
<p>支持的其它属性如下：</p>
<table>
<thead>
<tr>
<th><strong>属性</strong></th>
<th><strong>类型</strong></th>
<th><strong>必填</strong></th>
<th><strong>默认值</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td><code>value</code></td>
<td><code>String</code></td>
<td>否</td>
<td>“”</td>
<td>数据库字段名</td>
</tr>
<tr>
<td><code>exist</code></td>
<td><code>boolean</code></td>
<td>否</td>
<td><code>true</code></td>
<td>是否为数据库表字段</td>
</tr>
<tr>
<td><code>condition</code></td>
<td><code>String</code></td>
<td>否</td>
<td>“”</td>
<td>字段 where 实体查询比较条件，有值设置则按设置的值为准，没有则为默认全局的 <code>%s=#&#123;%s&#125;</code>，<a target="_blank" rel="noopener" href="https://github.com/baomidou/mybatis-plus/blob/3.0/mybatis-plus-annotation/src/main/java/com/baomidou/mybatisplus/annotation/SqlCondition.java">参考(opens new window)</a></td>
</tr>
<tr>
<td><code>update</code></td>
<td><code>String</code></td>
<td>否</td>
<td>“”</td>
<td>字段 update set 部分注入，例如：当在version字段上注解<code>update=&quot;%s+1&quot;</code> 表示更新时会 set version&#x3D;version+1 （该属性优先级高于 el 属性）</td>
</tr>
<tr>
<td><code>insertStrategy</code></td>
<td><code>Enum</code></td>
<td>否</td>
<td><code>FieldStrategy.DEFAULT</code></td>
<td>举例：<code>NOT_NULL insert into table_a(&lt;if test=&quot;columnProperty != null&quot;&gt;column&lt;/if&gt;) values (&lt;if test=&quot;columnProperty != null&quot;&gt;#&#123;columnProperty&#125;&lt;/if&gt;)</code></td>
</tr>
<tr>
<td><code>updateStrategy</code></td>
<td><code>Enum</code></td>
<td>否</td>
<td><code>FieldStrategy.DEFAULT</code></td>
<td>举例：IGNORED update table_a set column&#x3D;#{columnProperty}</td>
</tr>
<tr>
<td><code>whereStrategy</code></td>
<td><code>Enum</code></td>
<td>否</td>
<td><code>FieldStrategy.DEFAULT</code></td>
<td>举例：<code>NOT_EMPTY where &lt;if test=&quot;columnProperty != null and columnProperty!=&#39;&#39;&quot;&gt;column=#&#123;columnProperty&#125;&lt;/if&gt;</code></td>
</tr>
<tr>
<td><code>fill</code></td>
<td><code>Enum</code></td>
<td>否</td>
<td><code>FieldFill.DEFAULT</code></td>
<td>字段自动填充策略</td>
</tr>
<tr>
<td><code>select</code></td>
<td><code>boolean</code></td>
<td>否</td>
<td><code>true</code></td>
<td>是否进行 <code>SELECT</code> 查询</td>
</tr>
<tr>
<td><code>keepGlobalFormat</code></td>
<td><code>boolean</code></td>
<td>否</td>
<td><code>false</code></td>
<td>是否保持使用全局的 format 进行处理</td>
</tr>
<tr>
<td><code>jdbcType</code></td>
<td><code>JdbcType</code></td>
<td>否</td>
<td><code>JdbcType.UNDEFINED</code></td>
<td>JDBC 类型 (该默认值不代表会按照该值生效)</td>
</tr>
<tr>
<td><code>typeHandler</code></td>
<td><code>TypeHander</code></td>
<td>否</td>
<td></td>
<td>类型处理器 (该默认值不代表会按照该值生效)</td>
</tr>
<tr>
<td><code>numericScale</code></td>
<td><code>String</code></td>
<td>否</td>
<td>“”</td>
<td>指定小数点后保留的位数</td>
</tr>
</tbody></table>
<h4 id="1-3-常见配置"><a href="#1-3-常见配置" class="headerlink" title="1.3 常见配置"></a>1.3 常见配置</h4><p><code>MyBatis-Plus</code> 也支持基于 <code>yaml</code> 文件的自定义配置，详见官方文档：</p>
<p><a target="_blank" rel="noopener" href="https://www.baomidou.com/pages/56bac0/#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE">MyBatis-Plus 官方文档</a></p>
<p>大多数的配置都有默认值，因此我们都无需配置。但还有一些是没有默认值的，例如:</p>
<ul>
<li>实体类的别名扫描包</li>
<li>全局id类型</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">	<span class="attr">type-aliases-package:</span> <span class="string">com.itheima.mp.domain.po</span>		<span class="comment"># 别名扫描包</span></span><br><span class="line">	<span class="attr">mapper-locations:</span> <span class="string">&quot;classpath*:/mapper/**/*.xml&quot;</span> 	<span class="comment"># Mapper.xml文件地址，当前这个是默认值。</span></span><br><span class="line">	<span class="attr">configuration:</span></span><br><span class="line">  		<span class="attr">mapper-underscore-to-camel-case:</span> <span class="literal">true</span>			<span class="comment"># 是否开启下划线驼峰映射</span></span><br><span class="line">		<span class="attr">cache-enabled:</span> <span class="literal">false</span>							<span class="comment"># 是否开启二级缓存</span></span><br><span class="line">	<span class="attr">global-config:</span></span><br><span class="line">		<span class="attr">db-config:</span></span><br><span class="line">		<span class="attr">id-type:</span> <span class="string">auto</span> 									<span class="comment"># 全局 id 类型为自增长, 可以更换为其他方法, 如 assign_id</span></span><br><span class="line">		<span class="attr">update-strategy:</span> <span class="string">not_null</span>						<span class="comment"># 更新策略: 只更新非空字段</span></span><br></pre></td></tr></table></figure>

<p>需要注意的是，<code>MyBatis-Plus</code>也支持手写 <code>SQL</code> 的，而 <code>mapper</code> 文件的读取地址可以通过 <code>mapper-locations</code> 配置：默认值是<code>classpath*:/mapper/**/*.xml</code>，也就是说我们只要把 <code>mapper.xml</code> 文件放置这个目录下就一定会被加载。</p>
<h3 id="🥑-2-核心功能"><a href="#🥑-2-核心功能" class="headerlink" title="🥑 2. 核心功能"></a>🥑 2. 核心功能</h3><p>入门案例中都是以 <code>id</code> 为条件的简单CRUD，一些复杂条件的 <code>SQL</code> 语句就要用到一些更高级的功能了。</p>
<h4 id="2-1-条件构造器"><a href="#2-1-条件构造器" class="headerlink" title="2.1 条件构造器"></a>2.1 条件构造器</h4><p>除了新增以外，修改、删除、查询的 <code>SQL</code> 语句都需要指定 <code>WHERE</code> 条件。因此 <code>BaseMapper</code> 中提供的相关方法除了以 <code>id</code> 作为 <code>WHERE</code> 条件以外，还支持更加复杂的 <code>WHERE</code>条件。</p>
<p><img src="https://b11et3un53m.feishu.cn/space/api/box/stream/download/asynccode/?code=YWQ1ZTMzMTg4ZTRiNzFkYzFiNzc2YmU0N2I4OGJiZWFfS1F3dFZqVDU1TzVNSnB1VmJWS0MxNjVCVU1qYklzVGdfVG9rZW46QXlTUGJCVVVTb25wa3p4Y0x6SGNLTlhwblVjXzE3MjIzOTQwODg6MTcyMjM5NzY4OF9WNA" alt="img"></p>
<p>参数中的 <code>Wrapper</code> 就是<strong>条件构造</strong>的抽象类，其下有很多默认实现，继承关系如图：</p>
<p><img src="https://b11et3un53m.feishu.cn/space/api/box/stream/download/asynccode/?code=Y2EwYmQzMWFjZTEzMmNkOTI4MDIyYzM1ZjExOWZlYTRfMW5nN1UxV3NrMHQxWHhWOHlPYWRZNmtJdGFTbmpBeVJfVG9rZW46WjFUU2JGUk1ubzZWaWp4Q1BDbmN6MmdEbjNlXzE3MjIzOTQwODg6MTcyMjM5NzY4OF9WNA" alt="img"></p>
<p><code>Wrapper</code> 的子类 <code>AbstractWrapper</code> 提供了 <code>WHERE</code> 中包含的所有条件构造方法：</p>
<img src="https://b11et3un53m.feishu.cn/space/api/box/stream/download/asynccode/?code=ZWRhOWZiYzNkODcyZjllYTk2Y2VmMmQyM2Q0ZmQzYTdfWkFMRXJSNmZyQ1dQQk1yY2h1Ujd3OHJpTHBNT2ZLUllfVG9rZW46RXlZeWJzZnBBb0FaVnF4V2p5YmNXSzNlbmFmXzE3MjIzOTQwODg6MTcyMjM5NzY4OF9WNA" alt="img" style="zoom: 67%;" />

<p>而 <code>QueryWrapper</code> 在 <code>AbstractWrapper</code> 的基础上拓展了一个 <code>SELETE</code> 方法，<strong>允许指定查询字段：</strong></p>
<p><img src="https://b11et3un53m.feishu.cn/space/api/box/stream/download/asynccode/?code=YjU1MzEzNDYyMjE2MjIwNGUyZDk0NGNlNzJjNDU1NzRfdGxxZHV1c3hXQkxvcExwWW82MUhNTzBtSm14NHRsWFdfVG9rZW46RVVzUmJwaERQbzJNNTN4WjBrSGNCMWhFbmpoXzE3MjIzOTQwODg6MTcyMjM5NzY4OF9WNA" alt="img"></p>
<p>而 <code>UpdateWrapper</code> 在 <code>AbstractWrapper</code> 的基础上拓展了一个 <code>SET</code> 方法，<strong>允许指定 <code>SQL</code> 中的 <code>SET</code> 部分：</strong></p>
<p><img src="https://b11et3un53m.feishu.cn/space/api/box/stream/download/asynccode/?code=ZmI5OGUyOWU5ZWE4M2M1MWIwYjQ5MWZkOWQ0MDBkMWNfVk5xamtvSmNmV0VEUnFhcU9jSUU4a0s0SDhITkNDZ0ZfVG9rZW46TDZVRWJEZ1V5b0R4blZ4UW92SWNpYmEzbmRiXzE3MjIzOTQwODg6MTcyMjM5NzY4OF9WNA" alt="img"></p>
<p>接下来，我们就来看看如何利用 <code>Wrapper</code> 实现复杂查询。</p>
<h5 id="2-1-1-QueryWrapper"><a href="#2-1-1-QueryWrapper" class="headerlink" title="2.1.1 QueryWrapper"></a>2.1.1 QueryWrapper</h5><p>无论是修改、删除、查询，都可以使用QueryWrapper来构建查询条件。</p>
<p>当前表的结构如下：</p>
<table>
<thead>
<tr>
<th>#</th>
<th>名称</th>
<th>数据类型</th>
<th>注释</th>
<th>长度&#x2F;集合</th>
<th>默认</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td><code>id</code></td>
<td><code>BIGINT</code></td>
<td>用户ID</td>
<td>19</td>
<td>AUTO_INCREMENT</td>
</tr>
<tr>
<td>2</td>
<td><code>username</code></td>
<td><code>VARCHAR</code></td>
<td>用户名</td>
<td>50</td>
<td>无默认值</td>
</tr>
<tr>
<td>3</td>
<td><code>password</code></td>
<td><code>VARCHAR</code></td>
<td>密码</td>
<td>128</td>
<td>无默认值</td>
</tr>
<tr>
<td>4</td>
<td><code>phone</code></td>
<td><code>VARCHAR</code></td>
<td>注册手机号</td>
<td>20</td>
<td>NULL</td>
</tr>
<tr>
<td>5</td>
<td><code>info</code></td>
<td><code>JSON</code></td>
<td>详细信息</td>
<td></td>
<td>无默认值</td>
</tr>
<tr>
<td>6</td>
<td><code>status</code></td>
<td><code>INT</code></td>
<td>使用状态(1: 正常 2: 冻结)</td>
<td>10</td>
<td>“1”</td>
</tr>
<tr>
<td>7</td>
<td><code>balance</code></td>
<td><code>INT</code></td>
<td>账户余额</td>
<td>10</td>
<td></td>
</tr>
<tr>
<td>8</td>
<td><code>create_time</code></td>
<td><code>DATETIME</code></td>
<td>创建时间</td>
<td></td>
<td>CURRENT_TIMESTAMP</td>
</tr>
<tr>
<td>9</td>
<td><code>update_time</code></td>
<td><code>DATETIME</code></td>
<td>更新时间</td>
<td></td>
<td>CURRENT_TIMESTAMP</td>
</tr>
</tbody></table>
<p>接下来看一些例子： </p>
<p><strong>查询</strong>：查询出名字中带<code>o</code>的，存款大于等于1000元的人。代码如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> id,username,info,balance</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">WHERE</span> username <span class="keyword">LIKE</span> &quot;%o%&quot; <span class="keyword">AND</span> Balance <span class="operator">&gt;=</span> <span class="number">100</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testQueryWrapper</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1. 构建查询条件 WHERE name LIKE &quot;%o%&quot; AND balance &gt;= 1000</span></span><br><span class="line">    QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;()</span><br><span class="line">            .select(<span class="string">&quot;id&quot;</span>, <span class="string">&quot;username&quot;</span>, <span class="string">&quot;info&quot;</span>, <span class="string">&quot;balance&quot;</span>)</span><br><span class="line">            .like(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;o&quot;</span>)</span><br><span class="line">            .ge(<span class="string">&quot;balance&quot;</span>, <span class="number">1000</span>);</span><br><span class="line">    <span class="comment">// 2. 查询数据</span></span><br><span class="line">    List&lt;User&gt; users = userMapper.selectList(wrapper);</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>更新</strong>：更新用户名为 <code>Jack</code> 的用户的余额为 <code>2000</code>，代码如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> <span class="keyword">user</span></span><br><span class="line">	<span class="keyword">SET</span> balance<span class="operator">=</span><span class="number">2000</span></span><br><span class="line">	<span class="keyword">WHERE</span> (username<span class="operator">=</span>&quot;Jack&quot;)</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testUpdateByQueryWrapper</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1.构建查询条件 WHERE name=&quot;Jack&quot;</span></span><br><span class="line">    QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;User&gt;().eq(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;Jack&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2.更新数据, user 中非 NULL 字段都会作为 SET 语句</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">    user.setBalance(<span class="number">2000</span>);</span><br><span class="line">    userMapper.update(user, wrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-1-2-UpdateWrapper"><a href="#2-1-2-UpdateWrapper" class="headerlink" title="2.1.2 UpdateWrapper"></a>2.1.2 UpdateWrapper</h5><p>基于 <code>BaseMapper</code> 中的 <code>UPDATE</code> 方法更新时只能直接赋值，对于一些复杂的需求就难以实现。 </p>
<p>例如：更新 <code>id</code> 为 <code>1</code>、<code>2</code>、<code>4</code> 的用户的余额，扣 <code>200</code>，对应的SQL应该是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">UPDATE user <span class="type">SET</span> <span class="variable">balance</span> <span class="operator">=</span> balance - <span class="number">200</span> WHERE id <span class="title function_">in</span> <span class="params">(<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>)</span></span><br></pre></td></tr></table></figure>

<p><code>SET</code> 的赋值结果是基于字段现有值的，这个时候就要利用 <code>UpdateWrapper</code> 中的 <code>setSql</code> 功能了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testUpdateWrapper</span><span class="params">()</span> &#123;</span><br><span class="line">    List&lt;Long&gt; ids = List.of(<span class="number">1L</span>, <span class="number">2L</span>, <span class="number">4L</span>);</span><br><span class="line">    <span class="comment">// 1.生成SQL</span></span><br><span class="line">    UpdateWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">UpdateWrapper</span>&lt;User&gt;()</span><br><span class="line">            .setSql(<span class="string">&quot;balance = balance - 200&quot;</span>) 	<span class="comment">// SET balance = balance - 200</span></span><br><span class="line">            .in(<span class="string">&quot;id&quot;</span>, ids); 					<span class="comment">// WHERE id in (1, 2, 4)</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2.更新, 注意第一个参数可以给null, 也就是不填更新字段和数据，</span></span><br><span class="line">    <span class="comment">// 而是基于 UpdateWrapper 中的 setSQL 来更新</span></span><br><span class="line">    userMapper.update(<span class="literal">null</span>, wrapper);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-1-3-LambdaQueryWrapper"><a href="#2-1-3-LambdaQueryWrapper" class="headerlink" title="2.1.3 LambdaQueryWrapper"></a>2.1.3 LambdaQueryWrapper</h5><p>无论是 <code>QueryWrapper</code> 还是 <code>UpdateWrapper</code> 在构造条件的时候都需要写死字段名称，会出现字符串<code>魔法值</code>。这在编程规范中显然是不推荐的。 那怎么样才能不写字段名，又能知道字段名呢？</p>
<p>其中一种办法是基于变量的 <code>getter</code> 方法结合反射技术。因此我们只要将条件对应的字段的 <code>getter</code> 方法传递给 <code>MyBatis-Plus</code>，它就能计算出对应的变量名了。而传递方法可以使用 <code>JDK8</code> 中的 <code>方法引用</code> 和 <code>Lambda</code> 表达式。 因此 <code>MyBatis-Plus</code> 又提供了一套基于<code>Lambda</code> 的 <code>Wrapper</code>，包含两个：</p>
<ul>
<li><code>LambdaQueryWrapper</code></li>
<li><code>LambdaUpdateWrapper</code></li>
</ul>
<p>分别对应 <code>QueryWrapper</code> 和 <code>UpdateWrapper</code></p>
<p>其使用方式如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">void</span> <span class="title function_">testLambdaQueryWrapper</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 1.构建条件 WHERE username LIKE &quot;%o%&quot; AND balance &gt;= 1000</span></span><br><span class="line">    QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">QueryWrapper</span>&lt;&gt;();</span><br><span class="line">    wrapper.lambda()</span><br><span class="line">            .select(User::getId, User::getUsername, User::getInfo, User::getBalance)</span><br><span class="line">            .like(User::getUsername, <span class="string">&quot;o&quot;</span>)</span><br><span class="line">            .ge(User::getBalance, <span class="number">1000</span>);</span><br><span class="line">    <span class="comment">// 2.查询</span></span><br><span class="line">    List&lt;User&gt; users = userMapper.selectList(wrapper);</span><br><span class="line">    users.forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-2-自定义-SQL"><a href="#2-2-自定义-SQL" class="headerlink" title="2.2 自定义 SQL"></a>2.2 自定义 SQL</h4><p>一般企业的开发规范中，是不允许开发人员将 <code>SQL</code> 脱离出 <code>Mapper</code> 层或者 <code>mapper.xml</code> 文件的，但是我们想要使用 <code>MyBatis-Plus</code> 又想要遵守企业的开发规范，应该如何做呢？</p>
<p>我们可以利用 <code>MyBatis-Plus</code> 的 <code>Wrapper</code> 来构建复杂的 <code>WHERE</code> 条件，然后自己定义 <code>SQL</code> 语句中剩下的部分。</p>
<p>① 基于 <code>Wrapper</code> 构造 <code>WHERE</code> 条件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Long&gt; ids = List.of(<span class="number">1L</span>, <span class="number">2L</span>, <span class="number">4L</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">amount</span> <span class="operator">=</span> <span class="number">200</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1. 构造条件</span></span><br><span class="line">LambdaQueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> <span class="title class_">LambdaQueryWrapper</span>&lt;User&gt;().in(User::getId, ids);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 自定义SQL方法调用</span></span><br><span class="line">userMapper.updateBalanceByIds(wrapper, amount);</span><br></pre></td></tr></table></figure>

<p>② 在 <code>mapper</code> 方法参数中用 <code>@Param</code> 注解声明 <code>Wrapper</code> 变量名称，这个名称必须是 <code>ew</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> <span class="title function_">updateBalanceByIds</span><span class="params">(<span class="meta">@Param(&quot;ew&quot;)</span> LambdaQueryWrapper&lt;User&gt; wrapper, <span class="meta">@Param(&quot;amount&quot;)</span> <span class="type">int</span> amount)</span>;</span><br></pre></td></tr></table></figure>

<p>③ 自定义 <code>SQL</code>，并使用 <code>Wrapper</code> 条件，这里 <code>ew.customSqlSegment</code> 是 <code>Wrapper</code> 的一个方法，用于获取用户自定义SQL片段。如果使用出现问题，参考博客：<a target="_blank" rel="noopener" href="https://blog.csdn.net/xxNGchi/article/details/120681606">MyBatis-Plus ${ew.customSqlSegment} 使用的史诗级大坑-CSDN博客</a></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateBalanceByIds&quot;</span>&gt;</span></span><br><span class="line">    UPDATE t_user SET balance = balance - #&#123;amount&#125; $&#123;ew.customSqlSegment&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-3-Service-接口"><a href="#2-3-Service-接口" class="headerlink" title="2.3 Service 接口"></a>2.3 <code>Service</code> 接口</h4><p><code>MyBatis-Plus</code> 不仅提供了 <code>BaseMapper</code>，还提供了通用的 <code>Service</code> 接口及默认实现，封装了一些常用的 <code>service</code> 模板方法。 通用接口为 <code>IService</code>，默认实现为 <code>ServiceImpl</code>，其中封装的方法可以分为以下几类：</p>
<ul>
<li><code>save</code>：新增</li>
<li><code>remove</code>：删除</li>
<li><code>update</code>：更新</li>
<li><code>get</code>：查询单个结果</li>
<li><code>list</code>：查询集合结果</li>
<li><code>count</code>：计数</li>
<li><code>page</code>：分页查询</li>
</ul>
<p><img src="/./MyBatisPlus/IServiceInterface.png" alt="IServiceInterface"></p>
<h5 id="2-3-1-CRUD"><a href="#2-3-1-CRUD" class="headerlink" title="2.3.1 CRUD"></a>2.3.1 CRUD</h5><p>首先了解基本的CRUD接口。</p>
<p><strong>新增</strong>：</p>
<img src="./MyBatisPlus/IServiceSave.png" alt="" style="zoom: 50%;" />

<ul>
<li><code>save</code> 是新增单个元素</li>
<li><code>saveBatch</code> 是批量新增</li>
<li><code>saveOrUpdate</code> 是根据id判断，如果数据存在就更新，不存在则新增</li>
<li><code>saveOrUpdateBatch</code> 是批量的新增或修改</li>
</ul>
<p><strong>删除：</strong></p>
<img src="./MyBatisPlus/IServiceRemove.png" alt="IServiceRemove" style="zoom: 80%;" />

<ul>
<li><code>removeById</code>：根据id删除</li>
<li><code>removeByIds</code>：根据id批量删除</li>
<li><code>removeByMap</code>：根据Map中的键值对为条件删除</li>
<li><code>remove(Wrapper&lt;T&gt;)</code>：根据Wrapper条件删除</li>
<li><code>~~removeBatchByIds~~</code>：暂不支持</li>
</ul>
<p><strong>修改：</strong></p>
<p><img src="/./MyBatisPlus/IServiceUpdate.png" alt="IServiceUpdate"></p>
<ul>
<li><code>updateById</code>：根据id修改</li>
<li><code>update(Wrapper&lt;T&gt;)</code>：根据<code>UpdateWrapper</code>修改，<code>Wrapper</code>中包含<code>set</code>和<code>where</code>部分</li>
<li><code>update(T，Wrapper&lt;T&gt;)</code>：按照<code>T</code>内的数据修改与<code>Wrapper</code>匹配到的数据</li>
<li><code>updateBatchById</code>：根据id批量修改</li>
</ul>
<p><strong>Get：</strong></p>
<p><img src="/./MyBatisPlus/IServiceGet.png" alt="IServiceGet"></p>
<ul>
<li><code>getById</code>：根据 <code>id</code> 查询 <code>1</code> 条数据</li>
<li><code>getOne(Wrapper&lt;T&gt;)</code>：根据<code>Wrapper</code> 查询 <code>1</code> 条数据</li>
<li><code>getBaseMapper</code>：获取<code>Service</code> 内的 <code>BaseMapper</code> 实现，某些时候需要直接调用 <code>Mapper</code> 内的自定义 <code>SQL</code> 时可以用这个方法获取到 <code>Mapper</code></li>
</ul>
<p><strong>List：</strong></p>
<p><img src="/./MyBatisPlus/IServiceList.png" alt="IServiceList"></p>
<ul>
<li><code>listByIds</code>：根据id批量查询</li>
<li><code>list(Wrapper&lt;T&gt;)</code>：根据Wrapper条件查询多条数据</li>
<li><code>list()</code>：查询所有</li>
</ul>
<p><strong>Count</strong>：</p>
<p><img src="/./MyBatisPlus/IServiceCount.png" alt="IServiceCount"></p>
<ul>
<li><code>count()</code>：统计所有数量</li>
<li><code>count(Wrapper&lt;T&gt;)</code>：统计符合<code>Wrapper</code>条件的数据数量</li>
</ul>
<p><strong>getBaseMapper</strong>： 当我们在service中要调用Mapper中自定义SQL时，就必须获取service对应的Mapper，就可以通过这个方法：</p>
<p><img src="https://b11et3un53m.feishu.cn/space/api/box/stream/download/asynccode/?code=MGM1NDYyZmU0NjEyZmE1MTY1ZDBhZDM5NTMzNWQ1YjlfQ1pCTVFyWEt6cWV4bjdDSkE0NDFjazRrYWpSeUxTVTdfVG9rZW46TFdqc2JTMVUzb1JCdXh4MWhDMGMxMzdBbmpoXzE3MjI0MTI1ODk6MTcyMjQxNjE4OV9WNA" alt="img"></p>
<h5 id="2-3-2-基本用法"><a href="#2-3-2-基本用法" class="headerlink" title="2.3.2 基本用法"></a>2.3.2 基本用法</h5><p>由于 <code>Service</code> 中经常需要定义与业务有关的自定义方法，因此我们不能直接使用 <code>IService</code>，而是自定义 <code>Service</code> 接口，然后继承 <code>IService</code> 以拓展方法。同时，让自定义的 <code>Service实现类</code> 继承 <code>ServiceImpl</code>，这样就不用自己实现 <code>IService</code> 中的接口了。</p>
<p>具体方法如下：</p>
<p>① 首先，定义 <code>IUserService</code> 类，继承 <code>IService</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.mp.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.IService;</span><br><span class="line"><span class="keyword">import</span> com.itheima.mp.domain.po.User;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">IUserService</span> <span class="keyword">extends</span> <span class="title class_">IService</span>&lt;User&gt; &#123;</span><br><span class="line">    <span class="comment">// 拓展自定义方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>② 然后，编写 <code>UserServiceImpl</code> 类，继承 <code>ServiceImpl</code>，实现 <code>UserService</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.itheima.mp.service.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;</span><br><span class="line"><span class="keyword">import</span> com.itheima.mp.domain.po.User;</span><br><span class="line"><span class="keyword">import</span> com.itheima.mp.domain.po.service.IUserService;</span><br><span class="line"><span class="keyword">import</span> com.itheima.mp.mapper.UserMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">extends</span> <span class="title class_">ServiceImpl</span>&lt;UserMapper, User&gt; <span class="keyword">implements</span> <span class="title class_">IUserService</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>项目结构如下：</p>
<p><img src="https://b11et3un53m.feishu.cn/space/api/box/stream/download/asynccode/?code=MjZmNzNiNWRlZmQ1MzU1YjYyN2VmYzgzNmNiNTBiOGZfblhsa1NaS1NSbXFpUlByaWNDU1NrcGtmMWIyMXpndVRfVG9rZW46S1BYcGJkM3Y4b2pZVkt4ZHhFUmNmcHpPbnJnXzE3MjI0MDkzNTg6MTcyMjQxMjk1OF9WNA" alt="img"></p>
<p>接下来，我们基于 <code>RESTful</code> 风格快速实现下面几个接口（<a target="_blank" rel="noopener" href="https://blog.csdn.net/SeniorShen/article/details/111591122">什么是<code>RESTful</code>风格</a>）：</p>
<p>简单理解 <code>REST</code> 就是：<code>URL</code> 中只使用名词来定位资源，用 <code>HTTP</code> 协议里的动词（<code>GET</code>、<code>POST</code>、<code>PUT</code>、<code>DELETE</code>）来实现资源的增删改查操作。</p>
<p>什么是 <code>RESTful</code>：</p>
<ul>
<li>使用客户&#x2F;服务器（B&#x2F;S、 C&#x2F;S）模型：客户和服务器之间通过一个统一的接口来互相通讯。</li>
<li>层次化的系统：在一个 <code>REST</code> 系统中，客户端并不会固定地与一个服务器打交道。</li>
<li>无状态：在一个 <code>REST</code> 系统中，服务端并不会保存有关客户的任何状态。也就是说，客户端自身负责用户状态的维持，并在每次发送请求时都需要提供足够的信息。</li>
<li>可缓存：<code>REST</code> 系统需要能够恰当地缓存请求，以尽量减少服务端和客户端之间的信息传输，以提高性能。</li>
<li>统一的接口。一个 <code>REST</code> 系统需要使用一个统一的接口来完成子系统之间以及服务与用户之间的交互。这使得 <code>REST</code> 系统中的各个子系统可以独自完成演化。</li>
</ul>
<p>如果一个系统满足了上面所列出的五条约束，那么该系统就被称为是 <code>RESTful</code> 的。</p>
<table>
<thead>
<tr>
<th align="left"><strong>编号</strong></th>
<th align="left"><strong>接口</strong></th>
<th align="left"><strong>请求方式</strong></th>
<th align="left"><strong>请求路径</strong></th>
<th align="left"><strong>请求参数</strong></th>
<th align="left"><strong>返回值</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">新增用户</td>
<td align="left">POST</td>
<td align="left">&#x2F;users</td>
<td align="left">用户表单实体</td>
<td align="left">无</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">删除用户</td>
<td align="left">DELETE</td>
<td align="left">&#x2F;users&#x2F;{id}</td>
<td align="left">用户 <code>id</code></td>
<td align="left">无</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">根据 <code>id</code> 查询用户</td>
<td align="left">GET</td>
<td align="left">&#x2F;users&#x2F;{id}</td>
<td align="left">用户 <code>id</code></td>
<td align="left">用户VO</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">根据 <code>id</code> 批量查询</td>
<td align="left">GET</td>
<td align="left">&#x2F;users</td>
<td align="left">用户 <code>id</code> 集合</td>
<td align="left">用户VO集合</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">根据 <code>id</code> 扣除余额</td>
<td align="left">PUT</td>
<td align="left">&#x2F;users&#x2F;{id}&#x2F;deduction&#x2F;{money}</td>
<td align="left">1. 用户 <code>id</code><br />2. 扣除金额</td>
<td align="left">无</td>
</tr>
</tbody></table>
<h3 id="🕸-3-拓展功能"><a href="#🕸-3-拓展功能" class="headerlink" title="🕸 3. 拓展功能"></a>🕸 3. 拓展功能</h3><h3 id="🧩-4-插件功能"><a href="#🧩-4-插件功能" class="headerlink" title="🧩 4. 插件功能"></a>🧩 4. 插件功能</h3></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-07-30T14:36:18.000Z" title="2024/7/30 22:36:18">2024-07-30</time>发表</span><span class="level-item"><time dateTime="2024-07-30T14:55:50.823Z" title="2024/7/30 22:55:50">2024-07-30</time>更新</span><span class="level-item">1 分钟读完 (大约222个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/07/30/SpringCloud/">SpringCloud</a></p><div class="content"><h2 id="SpringCloud"><a href="#SpringCloud" class="headerlink" title="SpringCloud"></a>SpringCloud</h2><p>[TOC]</p>
<h3 id="1-微服务"><a href="#1-微服务" class="headerlink" title="1. 微服务"></a>1. 微服务</h3><p><strong>什么是微服务：</strong>微服务是一种软件架构风格，它是以专注于单一职责的很多小型项目为基础，组合出复杂的大型应用。</p>
<p>传统的<strong>单体项目</strong>开发将一个项目的所有模块都集中在这个项目中。而<strong>微服务</strong>可以理解为对一个<strong>单体项目</strong>的拆分，将单体项目的边界打破，并且将一个庞大的项目拆分成一个一个小项目。</p>
<p>当然微服务会涉及到一些问题，主要包括下面这些方面：</p>
<ul>
<li>服务拆分</li>
<li>远程调用</li>
<li>服务治理</li>
<li>请求路由</li>
<li>身份认证</li>
<li>配置管理</li>
<li>服务保护</li>
<li>分布式事务</li>
<li>异步通信</li>
<li>消息可靠性</li>
<li>延迟消息</li>
<li>分布式搜索</li>
<li>倒排索引</li>
<li>数据聚合</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-07-29T07:32:17.000Z" title="2024/7/29 15:32:17">2024-07-29</time>发表</span><span class="level-item"><time dateTime="2024-08-04T14:17:33.494Z" title="2024/8/4 22:17:33">2024-08-04</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/CppDev/">CppDev</a><span> / </span><a class="link-muted" href="/categories/CppDev/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/">多线程编程</a></span><span class="level-item">2 小时读完 (大约14428个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/07/29/Cpp-Muti-Threaded/">Cpp_Muti_Threaded</a></p><div class="content"><h2 id="🔱-C-多线程编程"><a href="#🔱-C-多线程编程" class="headerlink" title="🔱 C++ 多线程编程"></a>🔱 C++ 多线程编程</h2><p>[TOC]</p>
<h3 id="🧶-1-进程和线程的基本概念"><a href="#🧶-1-进程和线程的基本概念" class="headerlink" title="🧶 1. 进程和线程的基本概念"></a>🧶 1. 进程和线程的基本概念</h3><h5 id="1-1-1-进程和线程的概念"><a href="#1-1-1-进程和线程的概念" class="headerlink" title="1.1.1 进程和线程的概念"></a>1.1.1 进程和线程的概念</h5><p><strong>进程是系统中正在运行的一个程序，程序一旦运行就是进程。</strong>进程可以看成程序执行的一个实例。进程是系统资源分配的独立实体，每个进程都拥有独立的地址空间。一个进程无法访问另一个进程的变量和数据结构，如果想让一个进程访问另一个进程的资源，需要使用进程间通信，比如管道、文件、套接字等。</p>
<p><strong><u>线程</u>是进程的进程。</strong>一个进程可以拥有多个线程，每个线程使用其所属进程的栈空间。线程的最大数量取决于CPU的核心数。</p>
<p>线程与进程的一个主要区别是，同一进程内的多个线程会共享部分状态，多个线程可以读写同一块内存（一个进程无法直接访问另一进程的内存）。同时，每个线程还拥有自己的寄存器和栈，其他线程可以读写这些栈内存。</p>
<p>线程是进程的一个实体，是进程的一条执行路径。</p>
<p>线程是进程的一个特定执行路径。当一个线程修改了进程的资源，它的兄弟线程可以立即看到这种变化。</p>
<h5 id="1-1-2-并发和并行的概念"><a href="#1-1-2-并发和并行的概念" class="headerlink" title="1.1.2 并发和并行的概念"></a>1.1.2 并发和并行的概念</h5><p><strong>并发（Concurrent）：</strong>并发指在<strong>同一时间段内</strong>，多个任务都在进行中，但并不一定同时执行。在单核 <code>CPU</code> 上，多个任务占用不同的 <code>CPU</code> 时间片，<strong>物理上还是串行执行的</strong>。但是由于每个任务所占用的 <code>CPU</code> 时间片非常短（如：<code>10ms</code>），看起来就像是多个任务在共同执行一样，这样的场景就叫做<strong>并发</strong>。</p>
<img src="./Cpp_Muti_Threaded/Concurrent.png" alt="并发" style="zoom: 50%;" >

<center>并发概念图</center>

<p><strong>并行（Parallel）：</strong>并行是指在<strong>同一时刻</strong>，多个任务同时执行。并行需要多核 <code>CPU</code> 或者多处理器系统，让不同的任务在不同的核心上同时运行。但是这并不意味着每个核心上只运行一个任务，每个核心上的运行策略其实和单核 <code>CPU</code> 没有太大区别（即也是并发的）。</p>
<img src="./Cpp_Muti_Threaded/Parallel.png" alt="并行概念图" style="zoom:50%;" >

<center>并行概念图</center>

<h3 id="🧶-2-多线程的设计"><a href="#🧶-2-多线程的设计" class="headerlink" title="🧶 2. 多线程的设计"></a>🧶 2. 多线程的设计</h3><p>开发一个任务时，要不要实现成并发程序呢？多线程一定更好吗？</p>
<p>在某些情况下多线程具有一定的优势，但是在某些情况下多线程并不具有优势，这需要根据当前程序的类型进行分析和判断。</p>
<p>程序的类型有以下两种：一种是 I&#x2F;O密集型；一种是 CPU 密集型。</p>
<h4 id="2-1-I-O-密集型程序"><a href="#2-1-I-O-密集型程序" class="headerlink" title="2.1 I&#x2F;O 密集型程序"></a>2.1 I&#x2F;O 密集型程序</h4><p>I&#x2F;O密集型，即程序里面指令的执行，涉及一些 I&#x2F;O 操作，比如设备、文件、网络操作（如等待客户端的连接）等，I&#x2F;O操作是可以将进程阻塞住的，如果我们再给这样的程序分配时间片，其实就相当于 <code>CPU</code> 空闲下来了。</p>
<p>在 I&#x2F;O 密集型的程序在执行的时候，在 I&#x2F;O 操作没有准备好时，程序是会被放在阻塞队列中的，在阻塞队列中是不受操作系统调度的。</p>
<p>正因如此，I&#x2F;O 密集型程序更适合设计成多线程程序。</p>
<p>I&#x2F;O 密集型程序不论是在单核还是多核的情况下，都是适合设计成多线程程序的，因为他不会造成 <code>CPU</code> 资源的浪费。</p>
<h4 id="2-2-CPU-密集型程序"><a href="#2-2-CPU-密集型程序" class="headerlink" title="2.2 CPU 密集型程序"></a>2.2 CPU 密集型程序</h4><p>CPU 密集型程序，即程序里面的指令都是用来做计算用的，例如大量的加减乘除、深度学习都是在进行大量的计算。</p>
<p>CPU密集型程序，在<strong>单核情况下是不适合设计成多线程程序的</strong>，因为线程的调度有额外的花费：线程的上下文切换（当前线程调度完了，该调度下一个线程）。在这种情况下，相当于只有一个计算器，单线程是一个人一直计算，而多线程是多个人一人算一段。但是传递计算器的过程会产生一定的花销。而单线程进行上下文切换时，要获取之前计算到的信息，这也是一笔开销。</p>
<p>但是其在多核情况下是比较适合设计成多线程程序的。</p>
<h3 id="🧶-3-线程同步"><a href="#🧶-3-线程同步" class="headerlink" title="🧶 3. 线程同步"></a>🧶 3. 线程同步</h3><p>线程同步有两种场景：① 线程互斥；② 线程通信</p>
<p><strong>线程互斥：</strong></p>
<ul>
<li>互斥锁 <code>mutex</code></li>
<li>原子类型 <code>atomic</code></li>
</ul>
<p><strong>线程通信：</strong></p>
<ul>
<li>条件变量 <code>condition_variable</code></li>
<li>信号量 <code>semaphore</code></li>
</ul>
<h4 id="3-1-数据竞态（竞态条件）"><a href="#3-1-数据竞态（竞态条件）" class="headerlink" title="3.1 数据竞态（竞态条件）"></a>3.1 数据竞态（竞态条件）</h4><p>一个进程中的所有线程共享整个进程的堆内存，每个线程私有自己的栈内存。</p>
<p>如下图所示，当我们有多个线程想要执行 <code>Code</code> 时，那我们就要考虑这段代码能否在多线程环境下执行。是否能在多线程环境下执行主要要看这段代码是否存在数据竞态（或称竞态条件）。</p>
<p><strong>竞态条件：</strong>代码片段 <code>Code</code> 在多线程环境下执行，随着线程的调度顺序不同，而得到不同的运行结果，这就说明这段代码存在竞态条件。简单来说就是，$Thread1→Thread2→Thread3$ 会得到一个结果，而 $Thread2→Thread1→Thread3$ 可能是另一个结果。这是我们不期待的。</p>
<p>存在竞态条件的代码片段称为<strong>临界区代码段</strong>。</p>
<img src="./Cpp_Muti_Threaded/DataCompetitionStatus.png" style="zoom:50%;" >

<p>为了保证不出现临界区代码段，我们应该要保证代码的<strong>原子操作</strong>。</p>
<p>如果在多线程环境下不存在竞态条件，那么我们称这段代码片段是<em><strong>可重入的（就是一段代码在没执行完的情况下又被运行了）</strong></em>，否则是<em><strong>不可重入</strong></em>的。</p>
<h4 id="3-2-线程互斥"><a href="#3-2-线程互斥" class="headerlink" title="3.2 线程互斥"></a>3.2 线程互斥</h4><p>线程互斥包括：① 互斥锁 <code>mutex</code>；② 原子操作<code>atomic</code>。</p>
<p><code>mutex</code> 如 <code>lock</code> 操作（悲观锁）、<code>unlock</code> 操作或者 <code>try_lock</code> 操作（活锁、乐观锁）。<code>mutex</code> 是重量级的锁。</p>
<p>但是我们有时候不需要很重量级的锁，比如我们有时候可能只是执行一个自增操作 <code>x++</code>，或者是较为简单的一些操作，这时候我们就不太需要一个重量级的锁，<code>C++ 11</code>  已经提供了 $CAS$ （无锁机制）操作，即 <code>Compare &amp; Set/Compare &amp; Swap</code>。无锁机制并不是说没有锁，而是说这个锁是轻量级的，我们可以用 $CAS$ 实现无锁队列、无锁链表、无锁数组等。</p>
<p>以 <code>C++ 11</code> 的 <code>count++</code> 为例，<code>count++</code> 在操作系统中其实进行了三步指令操作，如下图所示：</p>
<img src="./Cpp_Muti_Threaded/NotAtomic.png" style="zoom: 67%;" />

<ul>
<li>假设首先执行 $Thread \ 1$，此时执行 <code>mov eax, count</code> 指令，将 <code>count</code> 的值写到 <code>eax</code> 此时 <code>eax</code> 的值由未知数 <code>x</code> 变为 <code>0</code>；</li>
<li>然后 $Thread \ 1$ 执行 <code>add eax, 1</code> 指令，将 <code>eax</code> 寄存器中的值加 <code>1</code>；</li>
<li>此时时间片完，进行线程切换操作，切换到 $Thread \ 2$；</li>
<li>此时执行 $Thread \ 2$，执行 <code>mov eax, count</code> 指令，将 <code>count</code> 的值写到 <code>eax</code>，此时 <code>count</code> 为从全局获取到的 <code>0</code>，<code>eax</code> 为 未知数<code>x</code>，此时 <code>eax</code> 寄存器由 <code>x</code> 被写为 <code>0</code>；</li>
<li>然后 $Thread \ 2$​ 执行 <code>add eax, 1</code> 指令，将 <code>eax</code> 寄存器中的值加 <code>1</code>；</li>
<li>此时时间片完，进行线程切换操作，切换到 $Thread 1$；</li>
<li>此时执行 $Thread \ 1$，执行 <code>mov count, eax</code> 指令，将 $Thread \ 1$ 上次切换之前的 <code>eax</code> 的值（为 $1$）写到 <code>count</code> 中，<code>count</code> 由 <code>0</code> 变成 <code>1</code>；</li>
<li>此时 $Thread \ 1$ 执行完毕，切换到 $Thread \ 2$；</li>
<li>此时执行 $Thread \ 2$，执行 <code>mov count, eax</code> 指令，将 $Thread \ 2$ 上次切换之前的 <code>eax</code> 的值（为 $1$）写到 <code>count</code> 中，<code>count</code> 由 <code>1</code> 变成 <code>1</code>。</li>
</ul>
<p>我们可以发现，即使是简单的 <code>count++</code> 也不是一个原子操作。</p>
<p>对于这种操作，我们当然可以用重量级的锁（<code>lock</code>）来进行锁定，但是我们更倾向于使用 $CAS$ 来实现这个问题。</p>
<h4 id="3-2-线程通信"><a href="#3-2-线程通信" class="headerlink" title="3.2 线程通信"></a>3.2 线程通信</h4><p>线程通信包括：① 条件变量 <code>condition_variable</code>；② 信号量 <code>semaphore</code>。</p>
<p>在线程中，并不往往都是几个线程互不相干，有时候会存在一定的依赖关系，如 $Thread \ 1$ 的某段代码需要依赖于 $Thread \ 2$ 的某段代码，因为我们并不能保证线程的调度顺序（即有可能被依赖代码可能需要好久才能执行完毕，而已经有线程需要这个代码的结果了），所以我们这个时候就需要进行线程间的通信。</p>
<img src="./Cpp_Muti_Threaded/condition_variable.png" style="zoom:50%;" >

<center>条件变量</center>

<p>条件变量需要配合互斥锁（互斥量）一起使用，其构造函数就需要传入一个互斥锁（互斥量），即 <code>mutex + condition_variable</code>。一个常见的用法就是<strong>生产者——消费者模型</strong>。*<u>线程池其实就是使用了生产者——消费者模型</u>*。</p>
<p><code>mutex</code> 互斥锁就是资源计数只能是 $0$ 或 $1$ 的互斥锁，即执行 <code>mutex.lock()</code> 后锁的<strong>资源计数</strong> $1→0$，执行 <code>mutex.unlock()</code> 后锁的<strong>资源计数</strong> $0→1$。而信号量可以看作 <em><strong>资源计数没有限制</strong></em> 的 <code>mutex</code> 互斥锁。</p>
<img src="./Cpp_Muti_Threaded/semaphore.png" style="zoom: 50%;" >

<center>信号量</center>

<p>信号量都是单独使用的，不需要配合其他条件一同使用。<code>C++ 11</code> 并没有提供信号量的操作，直到 <code>C++ 20</code> 才从语言层面支持了信号量，但是我们完全可以使用 <code>C++ 11</code> 来自己实现一个信号量。信号量也可以用于实现生产者消费者模型，但是无法做到精细的控制。初始信号量为$0$，生产者生产后信号量增加，消费者消费后信号量减少。通过判断信号量来进行简单的线程间通信。</p>
<p>此外还有二元信号量的概念，<code>semaphore sem(1)</code> 资源计数 $0 &#x2F; 1$，可以完成和 <code>mutex</code> 互斥锁同样的线程互斥操作，但是其和 <code>mutex</code> 是存在一定区别的。<code>mutex</code> 只能是哪个线程获取锁，哪个线程释放锁；<code>semaphore</code> 则不同，<code>sem.wait()</code> 和 <code>sem.post()</code> 可以处在不同的线程中调用。例如：有三个线程调用了 <code>sem.wait()</code> 等待执行一块代码 <code>Code</code>，其中一个线程 $Thread \ A$ 开始执行代码，其他两个线程 $Thread \ B$ 和 $Thread \ C$ 依旧在等待。如果此时有其他代码（存在误操作或者其他原因）调用了 <code>sem.post()</code>，此时会使信号量增加，$Thread \ B$ 或 $Thread \  C$ 其中一个会执行代码，若此时 $Thread \ A$ 还没有执行完代码，这就有可能导致数据竞态问题。</p>
<h3 id="🧶-4-C-11-Windows-线程库的基本使用"><a href="#🧶-4-C-11-Windows-线程库的基本使用" class="headerlink" title="🧶 4. C++ 11 Windows 线程库的基本使用"></a>🧶 4. C++ 11 Windows 线程库的基本使用</h3><p><strong>C++ 11 线程库头文件</strong> <code>#include &lt;thread&gt;</code></p>
<ul>
<li><p>创建线程</p>
<p>可以使用 <code>std::thread</code> 来创建线程，这其实是使用线程类 <code>std::thread</code> 声明一个线程实例 <code>printThread</code> 的过程。这里我们直接这样创建线程，生成应用程序之后运行输出结果：<code>Hello World - I&#39;m NilEra @-@</code>，但是运行之后会出现错误。</p>
<p>这里出现错误的原因是：当我们启动了 <code>thread_print</code> 线程，此时程序不会在这里等待线程执行完成，而是会继续向下执行，导致出现程序已经执行到 <code>return 0</code> 时，线程还没有执行完成，因此这里会产生报错。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义线程需要执行的函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printThread</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Hello World - I&#x27;m NilEra @-@&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建线程</span></span><br><span class="line">    <span class="function">std::thread <span class="title">thread_print</span><span class="params">(printThread)</span></span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>主程序等待线程执行完毕</p>
<p>为了解决上述出现的问题，我们需要让主程序等待的线程执行完毕再进行退出，这时我们就需要用到 <code>join()</code> 函数。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义线程需要执行的函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printHelloWorld</span><span class="params">(std::string msg)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; msg &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建线程</span></span><br><span class="line">    <span class="function">std::thread <span class="title">thread_print</span><span class="params">(printHelloWorld, <span class="string">&quot;Hello Thread @-@ I&#x27;m NilEra...&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 等待线程执行完成</span></span><br><span class="line">    thread_print.<span class="built_in">join</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>分离线程</p>
<p>上述的问题还可以使用 <code>detach()</code> 函数来进行解决。当执行下面的程序时，控制台不会又任何输出，直接退出程序。</p>
<p>这是因为线程执行完线程的创建之后，紧接着执行了 <code>detach()</code>，此时线程的具体操作还未来得及执行就进行了线程的分离。进程结束之后，<code>thread_print</code> 线程还在后台运行。但是因为此时进程已经结束，线程执行的过程中不会有输出。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义线程需要执行的函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printHelloWorld</span><span class="params">(std::string msg)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; msg &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建线程</span></span><br><span class="line">    <span class="function">std::thread <span class="title">thread_print</span><span class="params">(printHelloWorld, <span class="string">&quot;Hello Thread @-@ I&#x27;m NilEra...&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 线程分离</span></span><br><span class="line">    thread_print.<span class="built_in">detach</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用如下代码可以更清晰的看到执行 detach() 的效果, 以及 join() 和 detach() 的区别</span></span><br><span class="line"><span class="comment">// join() 是阻塞的</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义线程需要执行的函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printHelloWorld</span><span class="params">(std::string msg)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; msg &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">        std::cout &lt;&lt; i &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建线程</span></span><br><span class="line">    <span class="function">std::thread <span class="title">thread_print</span><span class="params">(printHelloWorld, <span class="string">&quot;Hello Thread @-@ I&#x27;m NilEra...&quot;</span>)</span></span>;</span><br><span class="line">    <span class="built_in">Sleep</span>(<span class="number">100</span>);</span><br><span class="line">    thread_print.<span class="built_in">detach</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>判断线程是否可以合并</p>
<p>有时我们需要对线程判断其是否可以进行 <code>join()</code> 操作，此时我们可以调用 <code>joinable()</code> 函数，<code>joinable()</code> 会返回一个 <code>bool</code> 值，用于判断线程是否可以进行 <code>join()</code> 操作。</p>
<p>如果我们对一个不可使用 <code>join()</code> 或者 <code>detach()</code> 的线程进行了 <code>join()</code> 和 <code>detach()</code> 操作，会出现一个 <code>SystemError</code>，在一些比较严谨的项目中，会先使用 <code>joinable()</code> 进行判断。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义线程需要执行的函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">printHelloWorld</span><span class="params">(std::string msg)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; msg &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建线程</span></span><br><span class="line">    <span class="function">std::thread <span class="title">thread_print</span><span class="params">(printHelloWorld, <span class="string">&quot;Hello Thread @-@ I&#x27;m NilEra...&quot;</span>)</span></span>;</span><br><span class="line">    <span class="type">bool</span> isJoin = thread_print.<span class="built_in">joinable</span>();</span><br><span class="line">    <span class="keyword">if</span> (isJoin) &#123;</span><br><span class="line">        thread_print.<span class="built_in">join</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="🧶-5-线程函数中的数据未定义错误"><a href="#🧶-5-线程函数中的数据未定义错误" class="headerlink" title="🧶 5. 线程函数中的数据未定义错误"></a>🧶 5. 线程函数中的数据未定义错误</h3><h4 id="5-1-传递临时变量问题"><a href="#5-1-传递临时变量问题" class="headerlink" title="5.1 传递临时变量问题"></a>5.1 传递临时变量问题</h4><ul>
<li><p>错误示例：如下使用 <code>std::thread</code> 类时，传入线程函数 <code>foo</code> 和 参数 <code>a</code>，这里的参数 <code>a</code> 会被作为值传递，即传递的不是 <code>a</code> 的引用，而是 <code>a</code> 所存储的值 <code>1</code>。但是如果是值传递的话，这里调用的实际上是 <code>foo((int&amp;) 1)</code> 会产生编译错误，因为 <code>1</code> 实际上是一个右值，而<strong>非常量引用的初始值必须为左值</strong>，所以这里会产生编译错误。</p>
<p>我们平时调用 <code>foo</code> 时，可以使用 <code>foo(a)</code>，实际上我们进行了隐式转换，执行的实际上是 <code>foo((int&amp;) a)</code>。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 错误示例 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">int</span>&amp; x)</span> </span>&#123;</span><br><span class="line">	x += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> a = <span class="number">1</span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">thread_plus</span><span class="params">(foo, a)</span></span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 修改示例 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">int</span>&amp; x)</span> </span>&#123;</span><br><span class="line">	x += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> a = <span class="number">1</span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">thread_plus</span><span class="params">(foo, std::ref(a))</span></span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 拓展 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">int</span>&amp; x)</span> </span>&#123;</span><br><span class="line">	x += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">const_foo</span><span class="params">(<span class="type">const</span> <span class="type">int</span>&amp; x)</span> </span>&#123;</span><br><span class="line">	std::cout &lt;&lt; <span class="string">&quot;const_foo param x is : &quot;</span> &lt;&lt; x &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> a = <span class="number">1</span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">thread_plus</span><span class="params">(foo, std::ref(a))</span></span>;</span><br><span class="line">	<span class="built_in">Sleep</span>(<span class="number">10</span>);</span><br><span class="line">	<span class="function">std::thread <span class="title">thread_plus_const</span><span class="params">(const_foo, a)</span></span>;</span><br><span class="line">	thread_plus.<span class="built_in">join</span>();</span><br><span class="line">	thread_plus_const.<span class="built_in">join</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-2-传递指针或引用指向局部变量的问题"><a href="#5-2-传递指针或引用指向局部变量的问题" class="headerlink" title="5.2 传递指针或引用指向局部变量的问题"></a>5.2 传递指针或引用指向局部变量的问题</h4><ul>
<li><p>错误示例：在下面的程序中，我们定义了一个全局线程变量，并且在 <code>test</code> 函数被调用时开启了这个线程 <code>t</code>，在 <code>main</code> 函数中，执行了 <code>test</code> 函数，在执行到 <code>t = std::thread(foo, std::ref(a));</code> 时，线程启动。这时会出现两种情况：</p>
<p>① （大概率出现）在线程启动的时候，<code>test</code> 函数已经结束了运行，而局部变量 <code>a</code> 的内存被释放，此时出现空指针错误；</p>
<p>② （小概率出现）程序正常执行，这是因为线程执行的比 <code>test</code> 函数更快，当线程执行结束时，<code>a</code> 还没有被释放。我们可以在 <code>t = std::thread(foo, std::ref(a));</code> 下添加 <code>Sleep(10)</code>，使程序暂停 <code>10 ms</code>，保证线程结束的时候 <code>test</code> 还未执行完成来观察这一现象。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 错误示例 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::thread t;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">int</span>&amp; x)</span> </span>&#123;</span><br><span class="line">	x += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> a = <span class="number">1</span>;</span><br><span class="line">	t = std::<span class="built_in">thread</span>(foo, std::<span class="built_in">ref</span>(a));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">test</span>();</span><br><span class="line">	t.<span class="built_in">join</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 修改示例 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::thread t;</span><br><span class="line"><span class="type">int</span> a = <span class="number">1</span>;		<span class="comment">// 延长 a 的声明周期</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">int</span>&amp; x)</span> </span>&#123;</span><br><span class="line">	x += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="comment">// int a = 1;</span></span><br><span class="line">	t = std::<span class="built_in">thread</span>(foo, std::<span class="built_in">ref</span>(a));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">test</span>();</span><br><span class="line">	t.<span class="built_in">join</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 拓展 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::thread t;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">int</span>&amp; x)</span> </span>&#123;</span><br><span class="line">	x += <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">test</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> a = <span class="number">1</span>;</span><br><span class="line">	t = std::<span class="built_in">thread</span>(foo, std::<span class="built_in">ref</span>(a));</span><br><span class="line">    <span class="built_in">Sleep</span>(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="built_in">test</span>();</span><br><span class="line">	t.<span class="built_in">join</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-3-传递指针或引用指向已经释放的内存问题"><a href="#5-3-传递指针或引用指向已经释放的内存问题" class="headerlink" title="5.3 传递指针或引用指向已经释放的内存问题"></a>5.3 传递指针或引用指向已经释放的内存问题</h4><ul>
<li><p>错误示例：这个问题和上面的问题是差不多的问题，这里有可能会① 直接报编译错误；② 通过编译，但是给出不期待的结果；③ 极小概率出现正常执行的情况。</p>
<p>当我们启动线程后，手动释放 <code>ptr_a</code>，此时若线程 <code>t</code> 的执行在释放内存之前（小概率），不会出现不期待的访问结果；但是如果线程 <code>t</code> 在释放内存之后执行（大概率），则会出现不期待的结果。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 错误示例 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::thread t;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">int</span>* x)</span> </span>&#123;</span><br><span class="line">	*x += <span class="number">1</span>;</span><br><span class="line">	std::cout &lt;&lt; *x &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span>* ptr_a = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">1</span>);		<span class="comment">// 定义一个指针类型的变量 ptr_a</span></span><br><span class="line">									<span class="comment">// 初始化为其内存中存储的值为 1</span></span><br><span class="line">	<span class="function">std::thread <span class="title">t</span><span class="params">(foo, ptr_a)</span></span>;</span><br><span class="line">	<span class="keyword">delete</span> ptr_a;					<span class="comment">// 这里手动释放 ptr_a</span></span><br><span class="line"></span><br><span class="line">	t.<span class="built_in">join</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 修改示例 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::thread t;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">foo</span><span class="params">(<span class="type">int</span>* x)</span> </span>&#123;</span><br><span class="line">	*x += <span class="number">1</span>;</span><br><span class="line">	std::cout &lt;&lt; *x &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span>* ptr_a = <span class="keyword">new</span> <span class="built_in">int</span>(<span class="number">1</span>);		<span class="comment">// 定义一个指针类型的变量 ptr_a</span></span><br><span class="line">									<span class="comment">// 初始化为其内存中存储的值为 1</span></span><br><span class="line">	<span class="function">std::thread <span class="title">t</span><span class="params">(foo, ptr_a)</span></span>;</span><br><span class="line">    <span class="built_in">Sleep</span>(<span class="number">10</span>);						<span class="comment">// 启动线程后等待 10 ms, 此时线程大概率已经执行完毕</span></span><br><span class="line">	<span class="keyword">delete</span> ptr_a;					<span class="comment">// 这里手动释放 ptr_a</span></span><br><span class="line"></span><br><span class="line">	t.<span class="built_in">join</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-4-类成员作为入口函数，类对象被提前释放"><a href="#5-4-类成员作为入口函数，类对象被提前释放" class="headerlink" title="5.4 类成员作为入口函数，类对象被提前释放"></a>5.4 类成员作为入口函数，类对象被提前释放</h4><ul>
<li><p>错误示例：这个错误和上面的错误基本上没有区别，只不过是将要 <code>int</code> 型换成了<em>类</em> 类型。</p>
<p>在 <code>main</code> 函数中，创建了一个 <code>MyClass</code> 类型的对象 <code>obj</code>。接着，启动了一个线程 <code>t</code>，这个线程执行 <code>MyClass::func</code>，并传递 <code>obj</code> 的地址 <code>&amp;obj</code> 给它，这里的 <code>&amp;obj</code> 为 <code>this</code> 指针。当 <code>t</code> 线程启动时，它会在后台执行 <code>MyClass::func</code>，但是，<code>main</code> 函数在启动线程后立即返回，而没有等待线程完成。此时，局部变量 <code>obj</code> 会被销毁。如果 <code>t</code> 线程还没有执行完 <code>MyClass::func</code>，则它将尝试访问一个已经销毁的对象，导致未定义行为和运行时错误。</p>
<p>我们可以使用智能指针的方式来防止出现指针提前释放的情况，使用 <code>std::shared_ptr&lt;MyClass&gt;</code> 创建并管理 <code>MyClass</code> 对象的生命周期。<code>std::make_shared&lt;MyClass&gt;()</code> 创建一个 <code>shared_ptr</code>，并返回一个指向堆上分配的 <code>MyClass</code> 对象的共享指针。传递 <code>obj</code>（<code>shared_ptr</code>）给 <code>std::thread</code> 的构造函数时，会增加引用计数，确保 <code>MyClass</code> 对象在 <code>obj</code> 和线程中都有效。</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 错误示例 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::thread t;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;[Thread &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot;] Started...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;[Thread &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot;] Finished...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	MyClass obj;</span><br><span class="line">	<span class="function">std::thread <span class="title">t</span><span class="params">(&amp;MyClass::func, &amp;obj)</span></span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 正确修改 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::thread t;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;[Thread &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot;] Started...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">		std::cout &lt;&lt; <span class="string">&quot;[Thread &quot;</span> &lt;&lt; std::this_thread::<span class="built_in">get_id</span>() &lt;&lt; <span class="string">&quot;] Finished...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 使用智能指针</span></span><br><span class="line">	std::shared_ptr&lt;MyClass&gt; obj = std::<span class="built_in">make_shared</span>&lt;MyClass&gt;();</span><br><span class="line">	<span class="function">std::thread <span class="title">t</span><span class="params">(&amp;MyClass::func, obj)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 保证线程运行结束再退出主程序</span></span><br><span class="line">    t.<span class="built_in">join</span>();</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="🧶-6-互斥量解决多线程数据共享问题"><a href="#🧶-6-互斥量解决多线程数据共享问题" class="headerlink" title="🧶 6. 互斥量解决多线程数据共享问题"></a>🧶 6. 互斥量解决多线程数据共享问题</h3><p><strong>数据共享问题：</strong>在多个线程中共享数据时，需要注意 <em><strong>线程安全</strong></em> 问题。如果多个线程同时访问同一个变量，并且其中至少有一个线程对该变量进行了写操作，那么就会出现<strong>数据竞争</strong>问题。数据竞争可能导致程序崩溃、产生未定义错误或者得到错误的结果。</p>
<p>为了避免数据竞争问题，需要使用<strong>同步机制</strong>来确保多个线程之间对共享数据的访问量是安全的。常见的同步机制包括<strong>互斥量</strong>、<strong>条件操作</strong>、<strong>原子操作</strong>等。</p>
<p>可以看到下面这张图，来体会一下没有锁的情况下导致的多线程数据共享的问题。我们有两个线程 <code>Thread 1</code> 和 <code>Thread 2</code>，这两个线程都在执行的过程中，其操作都是 <code>a += 1</code>。具体过程如下：<br>① 此时我们有一个变量 <code>a = 1</code>，首先 <code>Thread 1</code> 获取到了 <code>a</code>，执行操作后 <code>a=2</code>；</p>
<p>② <code>Thread 2</code> 获取到了 <code>a</code>，执行操作后 <code>a=3</code>；</p>
<p>③ <code>Thread 1</code> 获取到了 <code>a</code>，执行操作后 <code>a=4</code>；</p>
<p>④ <code>Thread 2</code> 获取到了 <code>a</code>，执行操作后 <code>a=5</code>；</p>
<p>⑤ <code>Thread 1</code> 和 <code>Thread 2</code> 同时获取到了 <code>a</code>，同时执行操作后 <code>a=6</code>；</p>
<p>一共执行了 <code>6</code> 次操作，<code>a</code> 应该由 <code>1</code> 变成 <code>7</code>。但是实际上他最终的结果是 <code>6</code> 。</p>
<img src="./Cpp_Muti_Threaded/ThreadWithNoMutex.png" style="zoom: 50%;" >

<p><strong>下面演示这种错误：</strong></p>
<p>在这个案例中，我们运行了两个线程 <code>t1</code> 和 <code>t2</code>，每个线程都让 <code>a</code> 加 <code>50,000</code>，因此我们期待的结果是 <code>100,000</code>。但是实际上运行的结果一般是小于 <code>100,000</code> 的。比如我运行了几次，分别是：<code>78,301</code>、<code>61603</code>、<code>54843</code>。说明两个线程多个瞬间同时获取到了变量 <code>a</code>。</p>
<p>当然，循环次数较小的时候也许会出现结果正确的问题，这是因为编译器帮我们汇编成了原子操作。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 错误示例 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50000</span>; i++) &#123;</span><br><span class="line">		a += <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="function">std::thread <span class="title">t1</span><span class="params">(func)</span></span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">t2</span><span class="params">(func)</span></span>;</span><br><span class="line">	t1.<span class="built_in">join</span>();</span><br><span class="line">	t2.<span class="built_in">join</span>();</span><br><span class="line">	std::cout &lt;&lt; a &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>为了解决这个问题，我们可以使用 <strong>互斥量<code>mutex</code></strong> 对变量进行上锁操作。**互斥量的头文件是：<code>#include &lt;mutex&gt;</code>**。</p>
<p>我们修改程序如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">std::mutex mtx;			<span class="comment">// 定义互斥量</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50000</span>; i++) &#123;</span><br><span class="line">		mtx.<span class="built_in">lock</span>();		<span class="comment">// 加锁操作</span></span><br><span class="line">		a += <span class="number">1</span>;</span><br><span class="line">		mtx.<span class="built_in">unlock</span>();	<span class="comment">// 解锁操作</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="function">std::thread <span class="title">t1</span><span class="params">(func)</span></span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">t2</span><span class="params">(func)</span></span>;</span><br><span class="line">	t1.<span class="built_in">join</span>();</span><br><span class="line">	t2.<span class="built_in">join</span>();</span><br><span class="line">	std::cout &lt;&lt; a &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>如何判断线程是否是安全的</strong>：当多线程程序每一次运行的结果，和单线程程序运行的结果始终都一样，则认为你的线程是安全的。</p>
<h3 id="🧶-7-互斥量死锁"><a href="#🧶-7-互斥量死锁" class="headerlink" title="🧶 7. 互斥量死锁"></a>🧶 7. 互斥量死锁</h3><p>假设有两个线程 <code>Thread 1</code> 和 <code>Thread 2</code>，他们需要对互斥量 <code>mtx1</code> 和互斥量<code>mtx2</code> 进行访问，而且需要按照以下顺序<strong>获取互斥量的所有权（获取所有权可以理解为<em>加锁操作</em> ）</strong>：</p>
<ul>
<li><code>Thread 1</code> 先获取 <code>mtx1</code> 的所有权，再获取 <code>mtx2</code> 的所有权。</li>
<li><code>Thread 2</code> 先获取 <code>mtx2</code> 的所有权，再获取 <code>mtx1</code> 的所有权。</li>
</ul>
<p>此时如果两个线程同时运行，就会产生死锁：</p>
<p><code>Thread 1</code> 拿到了 <code>mtx1</code>，同时 <code>Thread 2</code> 拿到了 <code>mtx2</code>。</p>
<p>但是此时因为 <code>Thread 2</code> 占有 <code>mtx2</code> 所以 <code>Thread 1</code> 等待 <code>mtx2</code> 空闲；而 <code>Thread 1</code> 占有 <code>mtx1</code>，所以 <code>Thread 2</code> 等待 <code>mtx1</code> 空闲。</p>
<p>所以此时 <code>Thread 1</code> 和 <code>Thread 2</code> 都无法进一步操作，所以造成了死锁。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 死锁模拟 */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::mutex mtx1, mtx2;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func_1</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	mtx1.<span class="built_in">lock</span>();		<span class="comment">// 先获取 mtx1</span></span><br><span class="line">	<span class="built_in">Sleep</span>(<span class="number">1000</span>);		<span class="comment">// 这里停等 1s, 确保 thread_2 抢占到 mtx2</span></span><br><span class="line">	mtx2.<span class="built_in">lock</span>();		<span class="comment">// 再获取 mtx2</span></span><br><span class="line">	mtx2.<span class="built_in">unlock</span>();		<span class="comment">// 释放 mtx2</span></span><br><span class="line">	mtx1.<span class="built_in">unlock</span>();		<span class="comment">// 释放 mtx1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func_2</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	mtx2.<span class="built_in">lock</span>();		<span class="comment">// 先获取 mtx2</span></span><br><span class="line">	mtx1.<span class="built_in">lock</span>();		<span class="comment">// 再获取 mtx1</span></span><br><span class="line">	mtx1.<span class="built_in">unlock</span>();		<span class="comment">// 释放 mtx1</span></span><br><span class="line">	mtx2.<span class="built_in">unlock</span>();		<span class="comment">// 释放 mtx2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="function">std::thread <span class="title">thread_1</span><span class="params">(func_1)</span></span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">thread_2</span><span class="params">(func_2)</span></span>;</span><br><span class="line">	thread_1.<span class="built_in">join</span>();</span><br><span class="line">	thread_2.<span class="built_in">join</span>();</span><br><span class="line">	std::cout &lt;&lt; <span class="string">&quot;THREAD OVER...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以用顺序锁解决上述问题，即两个函数都先获取 <code>mtx1</code> 的所有权。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::mutex mtx1, mtx2;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func_1</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	mtx1.<span class="built_in">lock</span>();		<span class="comment">// 先获取 mtx1</span></span><br><span class="line">	mtx2.<span class="built_in">lock</span>();		<span class="comment">// 再获取 mtx2</span></span><br><span class="line">	mtx2.<span class="built_in">unlock</span>();		<span class="comment">// 释放 mtx2</span></span><br><span class="line">	mtx1.<span class="built_in">unlock</span>();		<span class="comment">// 释放 mtx1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func_2</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	mtx1.<span class="built_in">lock</span>();		<span class="comment">// 先获取 mtx1</span></span><br><span class="line">	mtx2.<span class="built_in">lock</span>();		<span class="comment">// 再获取 mtx2</span></span><br><span class="line">	mtx2.<span class="built_in">unlock</span>();		<span class="comment">// 释放 mtx2</span></span><br><span class="line">	mtx1.<span class="built_in">unlock</span>();		<span class="comment">// 释放 mtx1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="function">std::thread <span class="title">thread_1</span><span class="params">(func_1)</span></span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">thread_2</span><span class="params">(func_2)</span></span>;</span><br><span class="line">	thread_1.<span class="built_in">join</span>();</span><br><span class="line">	thread_2.<span class="built_in">join</span>();</span><br><span class="line">	std::cout &lt;&lt; <span class="string">&quot;THREAD OVER...&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="🧶-8-lock-guard-和-unique-lock"><a href="#🧶-8-lock-guard-和-unique-lock" class="headerlink" title="🧶 8. lock_guard 和 unique_lock()"></a>🧶 8. <code>lock_guard</code> 和 <code>unique_lock()</code></h3><h4 id="8-1-lock-guard"><a href="#8-1-lock-guard" class="headerlink" title="8.1 lock_guard"></a>8.1 <code>lock_guard</code></h4><p><code>lock_guard</code> 是 <code>C++</code> 标准库中一种互斥量的封装类，用于保护共享数据，防止多个线程同时访问统一资源而导致的数据竞争问题。<code>lock_guard</code> 具有以下特点。</p>
<ul>
<li>当构造函数被调用时，该互斥量会被自动锁定</li>
<li>当析构函数被调用时，该互斥量会被自动解锁</li>
<li><code>std::lock_guard</code> 对象不能复制或移动，因此他只能在局部作用域中使用</li>
</ul>
<p>下面简单看几段代码，来体会一下不使用 <code>lock_guard</code> 和使用 <code>lock_guard</code> 的区别：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 不使用 lock_guard 和 unique_lock() */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">std::mutex mtx;			<span class="comment">// 定义互斥量</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50000</span>; i++) &#123;</span><br><span class="line">		mtx.<span class="built_in">lock</span>();		<span class="comment">// 加锁操作</span></span><br><span class="line">		a += <span class="number">1</span>;</span><br><span class="line">		mtx.<span class="built_in">unlock</span>();	<span class="comment">// 解锁操作</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="function">std::thread <span class="title">t1</span><span class="params">(func)</span></span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">t2</span><span class="params">(func)</span></span>;</span><br><span class="line">	t1.<span class="built_in">join</span>();</span><br><span class="line">	t2.<span class="built_in">join</span>();</span><br><span class="line">	std::cout &lt;&lt; a &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当我们添加 <code>lock_guard</code> 后，代码会变成这样：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">std::mutex mtx;			<span class="comment">// 定义互斥量</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50000</span>; i++) &#123;</span><br><span class="line">		<span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lg</span><span class="params">(mtx)</span></span>;	<span class="comment">// 这里调用了构造函数, mtx 自动加锁</span></span><br><span class="line">		a += <span class="number">1</span>;</span><br><span class="line">	&#125; <span class="comment">// 这里调用了析构函数, mtx 自动解锁</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="function">std::thread <span class="title">t1</span><span class="params">(func)</span></span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">t2</span><span class="params">(func)</span></span>;</span><br><span class="line">	t1.<span class="built_in">join</span>();</span><br><span class="line">	t2.<span class="built_in">join</span>();</span><br><span class="line">	std::cout &lt;&lt; a &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们可以详细剖析 <code>lock_guard</code> 的源码，来深刻理解该类。</p>
<p>补充阅读：<a target="_blank" rel="noopener" href="https://blog.csdn.net/chaipp0607/article/details/100128842">C++ using 用法</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> <span class="title class_">_Mutex</span>&gt;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">_NODISCARD</span> lock_guard &#123; <span class="comment">// class with destructor that unlocks a mutex</span></span><br><span class="line"><span class="comment">// 这里定义了一个模板类 lock_guard, 其中 _Mutex 是模板参数, 表示互斥锁的类型</span></span><br><span class="line"><span class="comment">// _NODISCARD 是一个属性, 表示这个类不应该被忽略(通常是为了警告开发者不要忽略这个类的对象创建)</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> mutex_type = _Mutex;	<span class="comment">// 定义一个别名 mutex_type, 指向模板参数 _Mutex</span></span><br><span class="line">    							<span class="comment">// 这样可以方便地在类的其他地方使用 mutex_type 来表示互斥锁的类型</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这是一个构造函数, 接收一个互斥锁的引用 _Mtx</span></span><br><span class="line">    <span class="comment">// explicit 关键字防止隐式转换</span></span><br><span class="line">    <span class="comment">// 在构造函数体内, 调用 _MyMutex.lock() 方法锁定互斥锁</span></span><br><span class="line">    <span class="comment">// 这样, 当 lock_guard 对象被创建时, 互斥锁会自动被锁定</span></span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">lock_guard</span><span class="params">(_Mutex&amp; _Mtx)</span> : _MyMutex(_Mtx) &#123;</span> <span class="comment">// construct and lock</span></span><br><span class="line">        _MyMutex.<span class="built_in">lock</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这是另一个构造函数, 接收一个互斥锁的引用 _Mtx 和一个标记类型 adopt_lock_t</span></span><br><span class="line">    <span class="comment">// 这个构造函数不会锁定互斥锁, 假设互斥锁已经被锁定</span></span><br><span class="line">    <span class="comment">// adopt_lock_t 通常是一个空的结构体类型, 用于区分不同的构造函数</span></span><br><span class="line">    <span class="built_in">lock_guard</span>(_Mutex&amp; _Mtx, <span class="type">adopt_lock_t</span>) : _MyMutex(_Mtx) &#123;&#125; <span class="comment">// construct but don&#x27;t lock</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 析构函数标记为 noexcept, 表示不会抛出异常</span></span><br><span class="line">    <span class="comment">// 当 lock_guard 对象被销毁时, 调用 _MyMutex.unlock() 方法解锁互斥锁</span></span><br><span class="line">    <span class="comment">// 这确保了即使在异常情况下，互斥锁也会被解锁。</span></span><br><span class="line">    ~<span class="built_in">lock_guard</span>() <span class="keyword">noexcept</span> &#123;</span><br><span class="line">        _MyMutex.<span class="built_in">unlock</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 显式删除拷贝构造函数和赋值操作符</span></span><br><span class="line">    <span class="comment">// 防止 lock_guard 对象被复制或赋值</span></span><br><span class="line">    <span class="comment">// 这是因为互斥锁的所有权不应该在多个对象之间共享, 以避免潜在的并发问题。</span></span><br><span class="line">    <span class="built_in">lock_guard</span>(<span class="type">const</span> lock_guard&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    lock_guard&amp; <span class="keyword">operator</span>=(<span class="type">const</span> lock_guard&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    _Mutex&amp; _MyMutex;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">std::mutex mtx;			<span class="comment">// 定义互斥量</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50000</span>; i++) &#123;</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lg</span><span class="params">(mtx)</span></span>; <span class="comment">// 1. 创建 lock_guard 对象 lg </span></span><br><span class="line">        									 <span class="comment">// 2. 传递 mtx 给构造函数的参数 _Mtx</span></span><br><span class="line">                                             <span class="comment">// 3. lock_guard 构造函数被调用</span></span><br><span class="line">                                             <span class="comment">// 4. _MyMutex(_Mtx) 初始化私有成员 _MyMutex 为 mtx 的引用</span></span><br><span class="line">                                             <span class="comment">// 5. _MyMutex.lock() 锁定 mtx</span></span><br><span class="line">        a += <span class="number">1</span>;</span><br><span class="line">    &#125; <span class="comment">// 6. 循环结束时, lg 对象销毁, 调用析构函数 _MyMutex.unlock() 解锁 mtx</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="function">std::thread <span class="title">t1</span><span class="params">(func)</span></span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">t2</span><span class="params">(func)</span></span>;</span><br><span class="line">	t1.<span class="built_in">join</span>();</span><br><span class="line">	t2.<span class="built_in">join</span>();</span><br><span class="line">	std::cout &lt;&lt; a &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="8-2-unique-lock"><a href="#8-2-unique-lock" class="headerlink" title="8.2 unique_lock"></a>8.2 <code>unique_lock</code></h4><p><code>std::unique_lock</code> 是 <code>C++</code> 标准库中提供的一个互斥量封装类，用于在多线程程序中对互斥量进行加锁和解锁操作。与 <code>lock_guard</code> 仅提供自动的加锁、解锁操作不同，<code>unique_lock</code> 还提供了对互斥量进行更加灵活的管理，包括：延迟加锁、条件变量、超时等。</p>
<p><code>std::unique_lock</code> 提供了以下几个成员函数：</p>
<ul>
<li><code>lock</code>：尝试对互斥量进行加锁操作，如果当前互斥量已经被其他线程持有，则当前线程会被阻塞，直到互斥量被成功加锁。</li>
<li><code>try_lock</code>：尝试对互斥量进行加锁操作，如果当前互斥量已经被其他线程持有，则立刻返回 <code>false</code>，否则返回 <code>true</code>。</li>
<li><code>try_lock_for(const std::chrono::duration&lt;Rep, Period&gt;&amp; rel_time)</code>：尝试对互斥量进行加锁操作，，如果当前互斥量已经被其他线程持有，则当前线程会被阻塞，直到互斥量被成功加锁或超过了指定时间。</li>
<li><code>try_lock_until(const std::chrono::time_point&lt;Clock, Duration&gt;&amp; abs_time)</code>：尝试对互斥量进行加锁操作，如果当前互斥量已经被其他线程持有，则当前线程会被阻塞，直到互斥量被成功加锁或超过了指定时间点。</li>
<li><code>unlock()</code>：对互斥量进行解锁操作</li>
</ul>
<p>下面简单看几段代码，来体会一下不使用 <code>unique_lock</code> 和使用 <code>unique_lock</code> 的区别：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 不使用 unique_lock */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">std::mutex mtx;			<span class="comment">// 定义互斥量</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50000</span>; i++) &#123;</span><br><span class="line">		mtx.<span class="built_in">lock</span>();		<span class="comment">// 加锁操作</span></span><br><span class="line">		a += <span class="number">1</span>;</span><br><span class="line">		mtx.<span class="built_in">unlock</span>();	<span class="comment">// 解锁操作</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="function">std::thread <span class="title">t1</span><span class="params">(func)</span></span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">t2</span><span class="params">(func)</span></span>;</span><br><span class="line">	t1.<span class="built_in">join</span>();</span><br><span class="line">	t2.<span class="built_in">join</span>();</span><br><span class="line">	std::cout &lt;&lt; a &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 使用 unique_lock */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">std::mutex mtx;			<span class="comment">// 定义互斥量</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50000</span>; i++) &#123;</span><br><span class="line">        <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">uniqueLock</span><span class="params">(mtx)</span></span>;</span><br><span class="line">		a += <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="function">std::thread <span class="title">t1</span><span class="params">(func)</span></span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">t2</span><span class="params">(func)</span></span>;</span><br><span class="line">	t1.<span class="built_in">join</span>();</span><br><span class="line">	t2.<span class="built_in">join</span>();</span><br><span class="line">	std::cout &lt;&lt; a &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面我们演示一下 <code>unique_lock</code> 的更多操作：</p>
<h5 id="8-2-1-lock-unlock-手动加锁-解锁"><a href="#8-2-1-lock-unlock-手动加锁-解锁" class="headerlink" title="8.2.1 lock()/unlock() 手动加锁&#x2F;解锁"></a>8.2.1 <code>lock()/unlock()</code> 手动加锁&#x2F;解锁</h5><p>既然 <code>unique_lock</code> 支持自动加锁和自动解锁，那么我们为什么不让它自动的加锁和解锁呢？这是因为 <code>unique_lock</code> 提供了更多的加锁方式，在使用其他加锁方式之前，我们需要保证 <code>unique_lock</code> 不能自动加锁。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">uniqueLock</span><span class="params">(mtx, std::defer_lock)</span></span>; 	<span class="comment">// 传入 defer_lock 表示构造函数什么都不做</span></span><br><span class="line">																<span class="comment">// 加锁/解锁操作需要由程序员自己完成</span></span><br></pre></td></tr></table></figure>

<p>那么下面将代码修改如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 不使用 unique_lock */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">std::mutex mtx;			<span class="comment">// 定义互斥量</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50000</span>; i++) &#123;</span><br><span class="line">		<span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">uniqueLock</span><span class="params">(mtx, std::defer_lock)</span></span>;	<span class="comment">// 使用 unique_lock 进行自动加锁</span></span><br><span class="line">		uniqueLock.<span class="built_in">lock</span>();</span><br><span class="line">		a += <span class="number">1</span>;</span><br><span class="line">		uniqueLock.<span class="built_in">unlock</span>();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="function">std::thread <span class="title">t1</span><span class="params">(func)</span></span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">t2</span><span class="params">(func)</span></span>;</span><br><span class="line">	t1.<span class="built_in">join</span>();</span><br><span class="line">	t2.<span class="built_in">join</span>();</span><br><span class="line">	std::cout &lt;&lt; a &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="8-2-2-try-lock-尝试加锁"><a href="#8-2-2-try-lock-尝试加锁" class="headerlink" title="8.2.2 try_lock 尝试加锁"></a>8.2.2 <code>try_lock</code> 尝试加锁</h5><p>尝试对互斥量进行加锁操作，如果当前互斥量已经被其他线程持有，则当前线程会被阻塞，直到互斥量被成功加锁。</p>
<h5 id="8-2-3-try-lock-for-const-std-chrono-duration-rel-time"><a href="#8-2-3-try-lock-for-const-std-chrono-duration-rel-time" class="headerlink" title="8.2.3 try_lock_for(const std::chrono::duration&lt;Rep, Period&gt;&amp; rel_time)"></a>8.2.3 <code>try_lock_for(const std::chrono::duration&lt;Rep, Period&gt;&amp; rel_time)</code></h5><p>尝试对互斥量进行加锁操作，，如果当前互斥量已经被其他线程持有，则当前线程会被阻塞，直到互斥量被成功加锁或超过了指定时间。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">std::timed_mutex mtx;			<span class="comment">// 定义互斥量</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">		<span class="function">std::unique_lock&lt;std::timed_mutex&gt; <span class="title">uniqueLock</span><span class="params">(mtx, std::defer_lock)</span></span>;</span><br><span class="line">        <span class="comment">// 这里进行判断, 通过检查 try_lock_for 的返回值, 只有在成功锁定时才修改 a, 保证了互斥锁的有效性。</span></span><br><span class="line">		<span class="keyword">if</span> (uniqueLock.<span class="built_in">try_lock_for</span>(std::chrono::<span class="built_in">microseconds</span>(<span class="number">5</span>))) &#123;</span><br><span class="line">			std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">microseconds</span>(<span class="number">10</span>));</span><br><span class="line">			a += <span class="number">1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="function">std::thread <span class="title">t1</span><span class="params">(func)</span></span>;</span><br><span class="line">	<span class="function">std::thread <span class="title">t2</span><span class="params">(func)</span></span>;</span><br><span class="line">	t1.<span class="built_in">join</span>();</span><br><span class="line">	t2.<span class="built_in">join</span>();</span><br><span class="line">	std::cout &lt;&lt; a &lt;&lt; std::endl;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>常见错误：<code>&quot;try_lock_for&quot;: 不是 &quot;std::mutex&quot; 的成员</code>，<code>std::mutex</code> 不支持延迟加锁，当我们想要进行延迟加锁操作时，需要保证互斥量是时间锁，即 <code>timed_mutex</code>。</p>
<p>此外，不要想当然，以下是一种常见的错误写法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 不使用 unique_lock */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;Windows.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> a = <span class="number">0</span>;</span><br><span class="line">std::timed_mutex mtx;			<span class="comment">// 定义互斥量</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">func</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">200</span>; i++) &#123;</span><br><span class="line">		<span class="function">std::unique_lock&lt;std::timed_mutex&gt; <span class="title">uniqueLock</span><span class="params">(mtx, std::defer_lock)</span></span>;</span><br><span class="line">        <span class="comment">// try_lock_for 尝试锁定互斥锁, 但返回值没有被检查</span></span><br><span class="line">        <span class="comment">// 如果锁定失败, 代码仍然会执行 a += 1, 这会导致数据竞争</span></span><br><span class="line">		uniqueLock.<span class="built_in">try_lock_for</span>(std::chrono::<span class="built_in">microseconds</span>(<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 即使 try_lock_for 失败, 代码仍然会增加 a, 这使得互斥锁形同虚设</span></span><br><span class="line">		std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">microseconds</span>(<span class="number">10</span>));</span><br><span class="line">		a += <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="8-2-4-try-lock-until-const-std-chrono-time-point-abs-time"><a href="#8-2-4-try-lock-until-const-std-chrono-time-point-abs-time" class="headerlink" title="8.2.4 try_lock_until(const std::chrono::time_point&lt;Clock, Duration&gt;&amp; abs_time)"></a>8.2.4 <code>try_lock_until(const std::chrono::time_point&lt;Clock, Duration&gt;&amp; abs_time)</code></h5><p>尝试对互斥量进行加锁操作，如果当前互斥量已经被其他线程持有，则当前线程会被阻塞，直到互斥量被成功加锁或超过了指定时间点。</p>
<h3 id="🧶-9-call-once-实现单例模式"><a href="#🧶-9-call-once-实现单例模式" class="headerlink" title="🧶 9. call_once 实现单例模式"></a>🧶 9. <code>call_once</code> 实现单例模式</h3><h4 id="9-1-单例模式"><a href="#9-1-单例模式" class="headerlink" title="9.1 单例模式"></a>9.1 单例模式</h4><p><strong>单例模式：</strong>单例模式是一种常见的设计模式，用于确保在系统的整个声明周期内，某个类只能创建一个实例，确保该类的唯一性。<u><em>由于单例模式是全局唯一的，因此在多线程环境中使用单例模式时，需要考虑<strong>线程安全</strong>问题。</em></u></p>
<p><strong>为什么要使用单例模式：</strong>① 节约资源，一个类只有一个实例，不存在多份实例，节省资源；② 方便控制，在一些操作公共资源的场景时，避免了多个对象引起的复杂操作。</p>
<p><strong>单例模式分类：</strong>单例模式可以分为 <em>懒汉式</em> 和 <em>饿汉式</em> ，两者之间的区别在于创建实例的时间不同。</p>
<ul>
<li><strong>懒汉式：</strong>系统运行中，实例并不存在，只有当需要使用该实例时，才会去创建并使用实例，延迟实例化。这种方式要考虑线程安全。</li>
<li><strong>饿汉式：</strong>系统一运行，就初始化创建实例，当需要时，直接调用即可，提前实例化。这种方式本身就线程安全，没有多线程的线程安全问题。</li>
</ul>
<p><strong>单例类的特点：</strong></p>
<ul>
<li>构造函数和析构函数为私有类型，目的是禁止外部构造和析构。</li>
<li>拷贝构造函数和赋值构造函数是私有类型，目的是禁止外部拷贝和赋值，确保实例的唯一性。</li>
<li>类中有一个获取实例的静态方法，可以全局访问。</li>
</ul>
<h4 id="9-2-emplace-back-函数快速了解"><a href="#9-2-emplace-back-函数快速了解" class="headerlink" title="9.2 emplace_back 函数快速了解"></a>9.2 <code>emplace_back</code> 函数快速了解</h4><p>这里使用到了 <code>emplace_back</code>，<code>emplace_back</code> 是 <code>C++ 11</code> 引入的一个 <code>STL</code> 容器方法，用于在容器的末尾直接构造元素。为了更好的理解代码，这里补充一下 <code>emplace_back</code> 的基本用法：</p>
<p><code>emplace_back</code> 方法提供了一种高效、简便的方式在容器末尾添加新元素。与 <code>push_back</code> 方法不同，<code>emplace_back</code> 直接在容器内部构造元素，而不是先构造临时对象然后再移动或复制到容器中。</p>
<h5 id="9-2-1-具体示例"><a href="#9-2-1-具体示例" class="headerlink" title="9.2.1 具体示例"></a>9.2.1 具体示例</h5><p>假设我们有一个包含复杂对象的 <code>std::vector</code>，我们可以使用 <code>emplace_back</code> 来避免不必要的临时对象创建和销毁。</p>
<ul>
<li>使用 <code>push_back</code></li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MyStruct</span> &#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    std::string y;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">MyStruct</span>(<span class="type">int</span> a, <span class="type">const</span> std::string&amp; b) : <span class="built_in">x</span>(a), <span class="built_in">y</span>(b) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;MyStruct&gt; vec;</span><br><span class="line">    <span class="function">MyStruct <span class="title">obj</span><span class="params">(<span class="number">1</span>, <span class="string">&quot;example&quot;</span>)</span></span>;				<span class="comment">// 先从外部构造 obj</span></span><br><span class="line">    vec.<span class="built_in">push_back</span>(obj); 					<span class="comment">// 复制构造</span></span><br><span class="line">    vec.<span class="built_in">push_back</span>(<span class="built_in">MyStruct</span>(<span class="number">2</span>, <span class="string">&quot;example2&quot;</span>)); <span class="comment">// 临时对象构造然后移动构造</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用 <code>emplace_back</code></li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">MyStruct</span> &#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    std::string y;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">MyStruct</span>(<span class="type">int</span> a, <span class="type">const</span> std::string&amp; b) : <span class="built_in">x</span>(a), <span class="built_in">y</span>(b) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;MyStruct&gt; vec;</span><br><span class="line">    vec.<span class="built_in">emplace_back</span>(<span class="number">1</span>, <span class="string">&quot;example&quot;</span>); 	<span class="comment">// 直接在容器内构造</span></span><br><span class="line">    vec.<span class="built_in">emplace_back</span>(<span class="number">2</span>, <span class="string">&quot;example2&quot;</span>); 	<span class="comment">// 直接在容器内构造</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在使用 <code>emplace_back</code> 时，构造函数的参数直接传递给容器内的新对象构造函数，避免了临时对象的创建。</p>
<h5 id="9-2-2-在多线程中使用-emplace-back"><a href="#9-2-2-在多线程中使用-emplace-back" class="headerlink" title="9.2.2 在多线程中使用 emplace_back"></a>9.2.2 在多线程中使用 <code>emplace_back</code></h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (int i = 0; i &lt; 10; ++i) &#123;</span><br><span class="line">    threads.emplace_back(threadFunction);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的 <code>emplace_back</code> 用于将新的 <code>std::thread</code> 对象添加到 <code>std::vector&lt;std::thread&gt;</code> 容器中。</p>
<p>等效的 <code>push_back</code> 用法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (int i = 0; i &lt; 10; ++i) &#123;</span><br><span class="line">    threads.push_back(std::thread(threadFunction));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这种情况下，<code>push_back</code> 和 <code>emplace_back</code> 都可以使用，但 <code>emplace_back</code> 更加高效，因为它避免了临时对象的创建和销毁。使用 <code>emplace_back</code> 时，<code>std::thread</code> 对象直接在 <code>threads</code> 容器中构造：</p>
<ol>
<li><strong>构造新对象</strong>：<code>emplace_back</code> 方法直接在容器的内存空间中构造新对象，而不是先在别处构造然后移动到容器中。</li>
<li><strong>传递参数</strong>：<code>emplace_back</code> 将传递的参数直接用于新对象的构造函数，此处 <code>threadFunction</code> 被作为构造函数参数传递给 <code>std::thread</code>。</li>
</ol>
<h5 id="9-2-3-总结"><a href="#9-2-3-总结" class="headerlink" title="9.2.3 总结"></a>9.2.3 总结</h5><p>**<code>push_back</code>**：需要一个已经构造好的对象（可能会导致额外的复制或移动）。</p>
<p>**<code>emplace_back</code>**：直接在容器的内存空间内构造对象，避免了额外的临时对象创建和移动操作。</p>
<p>在多线程代码中，使用 <code>emplace_back</code> 可以使代码更加高效和简洁，尤其是在添加新对象到容器时，可以避免不必要的对象拷贝和临时对象创建。</p>
<h4 id="9-3-线程不安全的懒汉模式"><a href="#9-3-线程不安全的懒汉模式" class="headerlink" title="9.3 线程不安全的懒汉模式"></a>9.3 线程不安全的懒汉模式</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdexcept&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 日志类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> Logger&amp; <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="built_in">Logger</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Logger</span>(<span class="type">const</span> Logger&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    Logger&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Logger&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">log</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> </span>&#123;</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx_)</span></span>;</span><br><span class="line">        logFile_ &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">printLog</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Instance Address IS: &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; std::endl;</span><br><span class="line">        std::cout &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">Logger</span>() &#123;</span><br><span class="line">        logFile_.<span class="built_in">open</span>(<span class="string">&quot;log.txt&quot;</span>, std::ios::out | std::ios::app);</span><br><span class="line">        <span class="keyword">if</span> (!logFile_.<span class="built_in">is_open</span>()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Unable to open log file&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">Logger</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (logFile_.<span class="built_in">is_open</span>()) &#123;</span><br><span class="line">            logFile_.<span class="built_in">close</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">static</span> Logger* instance;</span><br><span class="line">    std::ofstream logFile_;</span><br><span class="line">    std::mutex mtx_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Logger* Logger::instance = <span class="literal">nullptr</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">threadFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Logger&amp; logger = Logger::<span class="built_in">getInstance</span>();</span><br><span class="line">    logger.<span class="built_in">printLog</span>(<span class="string">&quot;Logging from thread&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;std::thread&gt; threads;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">        threads.<span class="built_in">emplace_back</span>(threadFunction);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; thread : threads) &#123;</span><br><span class="line">        thread.<span class="built_in">join</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出结果如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Instance Address IS: Instance Address IS: 000001FE29979930Instance Address IS: 000001FE2997A2A0</span><br><span class="line">Logging from thread</span><br><span class="line">000001FE29979930</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001FE2997C330</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001FE2997C330</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001FE2997B840</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001FE2997ACD0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001FE2997C330</span><br><span class="line">Logging from thread</span><br><span class="line">Logging from thread</span><br><span class="line"></span><br><span class="line">Instance Address IS: 000001FE2997C330</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001FE2997C330</span><br><span class="line">Logging from thread</span><br></pre></td></tr></table></figure>

<p>我们可以看到多个不同的实例地址，这是因为：在多线程环境中，当多个线程同时调用 <code>getInstance</code> 方法时，有可能多个线程同时通过 <code>if (instance == nullptr)</code> 检查，并进入实例化代码块。这会导致多个线程同时创建多个实例，违背了单例模式的初衷。</p>
<h4 id="9-4-线程安全的懒汉模式"><a href="#9-4-线程安全的懒汉模式" class="headerlink" title="9.4 线程安全的懒汉模式"></a>9.4 线程安全的懒汉模式</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdexcept&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> Logger&amp; <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx_)</span></span>;</span><br><span class="line">            <span class="keyword">if</span> (instance == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">                instance = <span class="keyword">new</span> <span class="built_in">Logger</span>();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> *instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Logger</span>(<span class="type">const</span> Logger&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    Logger&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Logger&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">log</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> </span>&#123;</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(log_mtx_)</span></span>;</span><br><span class="line">        logFile_ &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">printLog</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Instance Address IS: &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; std::endl;</span><br><span class="line">        std::cout &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">Logger</span>() &#123;</span><br><span class="line">        logFile_.<span class="built_in">open</span>(<span class="string">&quot;log.txt&quot;</span>, std::ios::out | std::ios::app);</span><br><span class="line">        <span class="keyword">if</span> (!logFile_.<span class="built_in">is_open</span>()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Unable to open log file&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">Logger</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (logFile_.<span class="built_in">is_open</span>()) &#123;</span><br><span class="line">            logFile_.<span class="built_in">close</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">static</span> Logger* instance;</span><br><span class="line">    <span class="type">static</span> std::mutex mtx_;</span><br><span class="line">    std::mutex log_mtx_;</span><br><span class="line">    std::ofstream logFile_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Logger* Logger::instance = <span class="literal">nullptr</span>;</span><br><span class="line">std::mutex Logger::mtx_;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">threadFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Logger&amp; logger = Logger::<span class="built_in">getInstance</span>();</span><br><span class="line">    logger.<span class="built_in">printLog</span>(<span class="string">&quot;Logging from thread&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;std::thread&gt; threads;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">        threads.<span class="built_in">emplace_back</span>(threadFunction);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; thread : threads) &#123;</span><br><span class="line">        thread.<span class="built_in">join</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出结果如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Instance Address IS: 000001E13A41AFE0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001E13A41AFE0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001E13A41AFE0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001E13A41AFE0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001E13A41AFE0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001E13A41AFE0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001E13A41AFE0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001E13A41AFE0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001E13A41AFE0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 000001E13A41AFE0</span><br><span class="line">Logging from thread</span><br></pre></td></tr></table></figure>

<h4 id="9-5-饿汉模式"><a href="#9-5-饿汉模式" class="headerlink" title="9.5 饿汉模式"></a>9.5 饿汉模式</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdexcept&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> Logger&amp; <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Logger</span>(<span class="type">const</span> Logger&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    Logger&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Logger&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">log</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> </span>&#123;</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx_)</span></span>;</span><br><span class="line">        logFile_ &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">printLog</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Instance Address IS: &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; std::endl;</span><br><span class="line">        std::cout &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">Logger</span>() &#123;</span><br><span class="line">        logFile_.<span class="built_in">open</span>(<span class="string">&quot;log.txt&quot;</span>, std::ios::out | std::ios::app);</span><br><span class="line">        <span class="keyword">if</span> (!logFile_.<span class="built_in">is_open</span>()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Unable to open log file&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">Logger</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (logFile_.<span class="built_in">is_open</span>()) &#123;</span><br><span class="line">            logFile_.<span class="built_in">close</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">static</span> Logger instance;</span><br><span class="line">    std::ofstream logFile_;</span><br><span class="line">    std::mutex mtx_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Logger Logger::instance;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">threadFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Logger&amp; logger = Logger::<span class="built_in">getInstance</span>();</span><br><span class="line">    logger.<span class="built_in">printLog</span>(<span class="string">&quot;Logging from thread&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;std::thread&gt; threads;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">        threads.<span class="built_in">emplace_back</span>(threadFunction);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; thread : threads) &#123;</span><br><span class="line">        thread.<span class="built_in">join</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出结果如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Instance Address IS: 00007FF652E1F6B0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 00007FF652E1F6B0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 00007FF652E1F6B0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 00007FF652E1F6B0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 00007FF652E1F6B0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 00007FF652E1F6B0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 00007FF652E1F6B0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 00007FF652E1F6B0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 00007FF652E1F6B0</span><br><span class="line">Logging from thread</span><br><span class="line">Instance Address IS: 00007FF652E1F6B0</span><br><span class="line">Logging from thread</span><br></pre></td></tr></table></figure>

<h4 id="9-6-使用-call-once-实现单例模式"><a href="#9-6-使用-call-once-实现单例模式" class="headerlink" title="9.6 使用 call_once 实现单例模式"></a>9.6 使用 <code>call_once</code> 实现单例模式</h4><p>为了使用 <code>std::call_once</code> 保证 <code>Logger</code> 类的线程安全，我们可以利用 <code>std::call_once</code> 和 <code>std::once_flag</code> 来确保单例实例只被创建一次。<code>std::call_once</code> 是一个 <code>C++ 11</code> 引入的机制，用于确保给定的函数只被调用一次，即使在多线程环境下。</p>
<p>以下是一个使用 <code>std::call_once</code> 实现线程安全单例模式的示例：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdexcept&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Logger 类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> Logger&amp; <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        std::<span class="built_in">call_once</span>(initInstanceFlag, &amp;Logger::initSingleton);	<span class="comment">// 传入 once_flag 和 initSingleton 函数</span></span><br><span class="line">        <span class="keyword">return</span> *instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Logger</span>(<span class="type">const</span> Logger&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    Logger&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Logger&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">log</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> </span>&#123;</span><br><span class="line">        <span class="function">std::lock_guard&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx_)</span></span>;</span><br><span class="line">        logFile_ &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">printLog</span><span class="params">(<span class="type">const</span> std::string&amp; message)</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Instance Address IS: &quot;</span> &lt;&lt; <span class="keyword">this</span> &lt;&lt; std::endl;</span><br><span class="line">        std::cout &lt;&lt; message &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">Logger</span>() &#123;</span><br><span class="line">        logFile_.<span class="built_in">open</span>(<span class="string">&quot;log.txt&quot;</span>, std::ios::out | std::ios::app);</span><br><span class="line">        <span class="keyword">if</span> (!logFile_.<span class="built_in">is_open</span>()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Unable to open log file&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">Logger</span>() &#123;</span><br><span class="line">        <span class="keyword">if</span> (logFile_.<span class="built_in">is_open</span>()) &#123;</span><br><span class="line">            logFile_.<span class="built_in">close</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">initSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        instance = <span class="keyword">new</span> <span class="built_in">Logger</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">static</span> Logger* instance;</span><br><span class="line">    <span class="type">static</span> std::once_flag initInstanceFlag;</span><br><span class="line">    std::ofstream logFile_;</span><br><span class="line">    std::mutex mtx_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 初始化静态成员</span></span><br><span class="line">Logger* Logger::instance = <span class="literal">nullptr</span>;</span><br><span class="line">std::once_flag Logger::initInstanceFlag;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">threadFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Logger&amp; logger = Logger::<span class="built_in">getInstance</span>();</span><br><span class="line">    logger.<span class="built_in">printLog</span>(<span class="string">&quot;Logging from thread&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::vector&lt;std::thread&gt; threads;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">        threads.<span class="built_in">emplace_back</span>(threadFunction);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; thread : threads) &#123;</span><br><span class="line">        thread.<span class="built_in">join</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>详细解释：</p>
<ol>
<li><p><strong>静态成员变量</strong>：</p>
<ul>
<li><code>static Logger* instance</code>：指向单例实例的指针。</li>
<li><code>static std::once_flag initInstanceFlag</code>：用于保证 <code>initSingleton</code> 只被调用一次的标志。</li>
</ul>
</li>
<li><p><strong><code>getInstance</code> 方法</strong>：</p>
<ul>
<li><code>std::call_once(initInstanceFlag, &amp;Logger::initSingleton)</code>：<code>std::call_once</code> 保证 <code>initSingleton</code> 在多线程环境下只被调用一次。<code>initInstanceFlag</code> 确保 <code>initSingleton</code> 只会被执行一次，即使多个线程同时调用 <code>getInstance</code>。</li>
</ul>
</li>
<li><p><strong><code>initSingleton</code> 方法</strong>：</p>
<ul>
<li><code>initSingleton</code> 是一个静态方法，用于初始化单例实例。<code>std::call_once</code> 会调用此方法来创建单例实例。</li>
</ul>
</li>
<li><p><strong>构造函数和析构函数</strong>：</p>
<ul>
<li><code>Logger</code> 的构造函数和析构函数负责打开和关闭日志文件。</li>
</ul>
</li>
<li><p><strong><code>log</code> 和 <code>printLog</code> 方法</strong>：</p>
<ul>
<li><code>log</code> 方法使用互斥锁 <code>mtx_</code> 保护对日志文件的写操作，以确保线程安全。</li>
<li><code>printLog</code> 方法输出实例的地址和消息。</li>
</ul>
</li>
</ol>
<p>运行上述代码时，所有线程都会调用 <code>Logger::getInstance()</code> 获取单例实例。由于使用了 <code>std::call_once</code>，<code>initSingleton</code> 方法只会被执行一次，从而确保整个程序中只有一个 <code>Logger</code> 实例。通过输出的实例地址，可以验证所有线程获取的都是相同的实例。</p>
<p>使用 <code>std::call_once</code> 和 <code>std::once_flag</code> 可以确保单例实例在多线程环境下只被创建一次，从而实现线程安全的懒汉单例模式。这样不仅保证了线程安全性，还避免了不必要的锁开销。</p>
<h3 id="🧶-10-condition-variable-条件变量"><a href="#🧶-10-condition-variable-条件变量" class="headerlink" title="🧶 10. condition_variable 条件变量"></a>🧶 10. <code>condition_variable</code> 条件变量</h3><p><code>conditon_variable</code> 可以用来实现一个生产者消费者程序。</p>
<p>例如对于一个队列：</p>
<ul>
<li>只要队列不满，生产者就可以进行生产</li>
<li>只要队列满了，生产者就停止生产</li>
<li>只要队列不空，消费者就可以进行消费</li>
<li>只要队列空了，消费者就停止消费</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;thread&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;mutex&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;condition_variable&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;chrono&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;atomic&gt;</span></span></span><br><span class="line"></span><br><span class="line">std::queue&lt;<span class="type">int</span>&gt; buffer;                 <span class="comment">// 共享缓冲区</span></span><br><span class="line"><span class="type">const</span> <span class="type">unsigned</span> <span class="type">int</span> maxBufferSize = <span class="number">10</span>;  <span class="comment">// 缓冲区的最大大小</span></span><br><span class="line">std::mutex mtx;                         <span class="comment">// 互斥锁, 用于保护共享缓冲区</span></span><br><span class="line">std::condition_variable cv;             <span class="comment">// 条件变量, 用于通知生产者和消费者</span></span><br><span class="line"><span class="function">std::atomic&lt;<span class="type">bool</span>&gt; <span class="title">done</span><span class="params">(<span class="literal">false</span>)</span></span>;          <span class="comment">// 原子变量, 用于通知消费者生产者已经完成生产</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 生产者函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">producer</span><span class="params">(<span class="type">int</span> id, <span class="type">int</span> numItems)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numItems; ++i) &#123;</span><br><span class="line">        <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx)</span></span>;  <span class="comment">// 锁定互斥锁</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 等待直到缓冲区有空闲位置</span></span><br><span class="line">        cv.<span class="built_in">wait</span>(lock, [] &#123; <span class="keyword">return</span> buffer.<span class="built_in">size</span>() &lt; maxBufferSize; &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将生成的数据放入缓冲区</span></span><br><span class="line">        buffer.<span class="built_in">push</span>(i);</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Producer &quot;</span> &lt;&lt; id &lt;&lt; <span class="string">&quot; produced: &quot;</span> &lt;&lt; i &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">        lock.<span class="built_in">unlock</span>();      <span class="comment">// 解锁互斥锁</span></span><br><span class="line">        cv.<span class="built_in">notify_all</span>();    <span class="comment">// 通知消费者缓冲区中有新数据</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 模拟生产延迟</span></span><br><span class="line">        std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">milliseconds</span>(<span class="number">100</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置 done 标志，通知消费者生产已经完成</span></span><br><span class="line">    done = <span class="literal">true</span>;</span><br><span class="line">    cv.<span class="built_in">notify_all</span>();  <span class="comment">// 通知消费者停止等待</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 消费者函数</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">consumer</span><span class="params">(<span class="type">int</span> id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="function">std::unique_lock&lt;std::mutex&gt; <span class="title">lock</span><span class="params">(mtx)</span></span>;  <span class="comment">// 锁定互斥锁</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 等待直到缓冲区有数据或生产已经完成</span></span><br><span class="line">        cv.<span class="built_in">wait</span>(lock, [] &#123; <span class="keyword">return</span> !buffer.<span class="built_in">empty</span>() || done; &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果生产已经完成且缓冲区为空, 退出循环</span></span><br><span class="line">        <span class="keyword">if</span> (done &amp;&amp; buffer.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 从缓冲区取出数据</span></span><br><span class="line">        <span class="type">int</span> item = buffer.<span class="built_in">front</span>();</span><br><span class="line">        buffer.<span class="built_in">pop</span>();</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Consumer &quot;</span> &lt;&lt; id &lt;&lt; <span class="string">&quot; consumed: &quot;</span> &lt;&lt; item &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">        lock.<span class="built_in">unlock</span>();      <span class="comment">// 解锁互斥锁</span></span><br><span class="line">        cv.<span class="built_in">notify_all</span>();    <span class="comment">// 通知生产者有空闲位置</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 模拟消费延迟</span></span><br><span class="line">        std::this_thread::<span class="built_in">sleep_for</span>(std::chrono::<span class="built_in">milliseconds</span>(<span class="number">150</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> numProducers = <span class="number">2</span>;     	<span class="comment">// 生产者线程数量</span></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> numConsumers = <span class="number">2</span>;     	<span class="comment">// 消费者线程数量</span></span><br><span class="line">    <span class="type">const</span> <span class="type">int</span> numItems     = <span class="number">40</span>;    	<span class="comment">// 每个生产者生成的项目数量</span></span><br><span class="line"></span><br><span class="line">    std::vector&lt;std::thread&gt; producers;  <span class="comment">// 生产者线程列表</span></span><br><span class="line">    std::vector&lt;std::thread&gt; consumers;  <span class="comment">// 消费者线程列表</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建生产者线程</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numProducers; ++i) &#123;</span><br><span class="line">        producers.<span class="built_in">emplace_back</span>(producer, i, numItems);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建消费者线程</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; numConsumers; ++i) &#123;</span><br><span class="line">        consumers.<span class="built_in">emplace_back</span>(consumer, i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 等待所有生产者线程完成</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; producer : producers) &#123;</span><br><span class="line">        producer.<span class="built_in">join</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 等待所有消费者线程完成</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; consumer : consumers) &#123;</span><br><span class="line">        consumer.<span class="built_in">join</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="🧶-11-线程池-Thread-Pool"><a href="#🧶-11-线程池-Thread-Pool" class="headerlink" title="🧶 11. 线程池 Thread Pool"></a>🧶 11. 线程池 Thread Pool</h3><h4 id="11-1-线程的消耗"><a href="#11-1-线程的消耗" class="headerlink" title="11.1 线程的消耗"></a>11.1 线程的消耗</h4><p>为了完成任务，创建很多线程可以吗？线程真的是越多越好吗？</p>
<ul>
<li><p>线程的创建和销毁都是非常”重”的操作</p>
<p>线程的创建和销毁都需要执行不少操作，下面的操作只是一个简化的操作，具体的操作可以深入了解操作系统的原理。</p>
<p>那么如果要在业务执行的过程中去实时的创建和销毁线程，那么是一种很消耗系统资源和性能的操作。</p>
</li>
</ul>
<img src="./CPP_Muti_Threaded/Create_Thread.png" alt="线程创建的操作(简化版)" style="zoom:50%;" >

<ul>
<li><p>线程栈本身占用大量内存</p>
<p><code>32</code> 位操作系统的地址空间大小为 $2^{32}$ 个地址，即 <code>4 GB</code>。其中一部分地址空间用于操作系统的内核空间，而另一部分则用于用户空间。通常情况下，用户空间可以是 <code>2 GB</code> 或者 <code>3 GB</code>，剩下的全部是内核空间。具体取决于操作系统的设置。由当前进程创建的所有线程，共享进程的地址空间。</p>
<p>那么一个进程最多可以开多少线程呢？</p>
<p>假设用户空间为 <code>3 GB</code>，即 $3 × 1024 &#x3D; 3072$，在 Linux 环境下使用 <code>ulimit -a</code> 可以查询到系统的一些信息，如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">core file size          (blocks, -c) 0</span><br><span class="line">data seg size           (kbytes, -d) unlimited</span><br><span class="line">scheduling priority             (-e) 0</span><br><span class="line">file size               (blocks, -f) unlimited</span><br><span class="line">pending signals                 (-i) 3795</span><br><span class="line">max locked memory       (kbytes, -l) 64</span><br><span class="line">max memory size         (kbytes, -m) unlimited</span><br><span class="line">open files                      (-n) 1024</span><br><span class="line">pipe size            (512 bytes, -p) 8</span><br><span class="line">POSIX message queues     (bytes, -q) 819200</span><br><span class="line">real-time priority              (-r) 0</span><br><span class="line">stack size              (kbytes, -s) 8192</span><br><span class="line">cpu time               (seconds, -t) unlimited</span><br><span class="line">max user processes              (-u) 3795</span><br><span class="line">virtual memory          (kbytes, -v) unlimited</span><br><span class="line">file locks                      (-x) unlimited</span><br></pre></td></tr></table></figure>

<p>我们可以看到 <code>Stack Size</code> 为 <code>8192 kbytes</code>，即 <code>8 MB</code>，则可计算 $3072 ÷ 8 &#x3D; 384$，所以在 Linux 环境下，一个进程最多创建 $384$ 个线程。</p>
<p>我们将线程函数所用的栈空间就是线程栈。</p>
<img src="./Cpp_Muti_Threaded/ThreadStack.png" style="zoom: 50%;" >

<p>通过上面的描述，我们可以发现，如果线程数量太多，创建了一大批线程，还没有具体做事情，每一个线程都需要线程栈，栈几乎都被占用完了，就没内存运行其他程序了。</p>
</li>
<li><p>线程的上下文切换要占用大量时间</p>
<p>线程过多，线程的调度是需要上下文切换的，也需要花费大量的 <code>CPU</code> 时间，如果更多的时间花费到上下文切换中，那么实际业务中利用 <code>CPU</code> 的时间就降低了，<code>CPU</code> 的利用率就降低了。</p>
</li>
<li><p>大量线程同时唤醒会使系统经常出现锯齿状负载或者瞬间负载量很大导致宕机</p>
<p>这种情况下，如果同一时间，很多 I&#x2F;O 操作都准备好了，或者说很多线程都再等待一个 I&#x2F;O 操作，有可能导致大量线程同时被唤醒，导致系统经常出现锯齿状负载或者瞬间负载量很大导致宕机。</p>
</li>
</ul>
<p>所以我们可以看出，<strong>线程不是越多越好</strong>。那么创建多少线程才是合适的呢？</p>
<p>一般来说，创建线程的数量一般由 <code>CPU</code> 的核心数来确定的，即：有几个核创建几个线程。<code>C++</code> 的很多开源库如 <code>moduo</code>、<code>libevent</code>，<code>Java</code> 的 <code>Netty</code>、<code>mina</code> 等，都采取了这一策略。</p>
<p>当然如果一个功能是重 <code>I/O</code> 的，可以做出适当的调整，增加线程数量。</p>
<h4 id="11-2-什么是线程池？为什么使使用线程池"><a href="#11-2-什么是线程池？为什么使使用线程池" class="headerlink" title="11.2 什么是线程池？为什么使使用线程池"></a>11.2 什么是线程池？为什么使使用线程池</h4><p><u>线程过多会带来调度开销，进而影响缓存局部性和整体性能</u>。操作系统上创建线程和销毁线程都是很“重”的操作，耗时耗性能都比较多，那么在服务执行的过程中，如果业务量比较大，实时的去创建线程、执行业务、业务完成后销毁线程，那么会导致系统的实时性能降低，业务的处理能力也会降低。</p>
<p><strong>线程池</strong>是一种预先创建一定数量线程的机制，或者说其是一种线程使用模式。</p>
<p><strong>线程池</strong>维护着多个线程，这些线程可以在需要时被重复使用，而无需每次都重新创建和销毁线程。</p>
<p><strong>线程池</strong>的主要目的是提高性能和资源利用效率，特别是在需要频繁创建和销毁大量线程的场景下，线程池不仅能够保证内核的充分利用，还能防止过分调度。可用线程数据取决于可用的并发处理器、处理器内核、内存、网络 <code>sockets</code> 等数量。</p>
<p><strong>线程池的优势：</strong>线程池的优势就是（每个池都有自己的优势），在服务进程启动之初，就事先创建好线程池里面的线程，当业务流量到来时需要分配线程，直接从线程池中获取一个空闲线程执行 <code>Task</code> 任务即可，<code>Task</code> 执行完成后，也不用释放线程，而是把线程归还到线程池中继续给后续的 <code>Task</code> 提供服务。</p>
<p><strong>线程池的优点：</strong></p>
<ul>
<li>线程和任务分离,提升线程重用性；</li>
<li>控制线程并发数量,降低服务器压力，统一管理所有线程；</li>
<li>提高性能：提升系统响应速度，假如创建线程用的时间为 <code>T1</code>，执行任务用的时间为<code>T2</code>，销毁线程用的时间为 <code>T3</code>，那么使用线程池就免去了 <code>T1</code> 和 <code>T3</code> 的时间。创建和销毁线程都是相对昂贵的操作，特别是在高并发场景下，频繁地创建和销毁线程会极大地降低程序的性能。通过线程池预先创建一定数量的线程并保存在内存中，可以避免频繁地创建和销毁线程，从而提高程序的性能。</li>
<li>资源管理：线程是操作系统级别的资源，如果线程数量过多，可能会导致系统资源的过度消耗，甚至可能导致系统崩溃。通过线程池，可以控制同时运行的线程数量，避免资源过度消耗。</li>
<li>任务调度：线程池可以更方便地进行任务的调度。通过线程池，可以将任务分配给不同的线程执行，实现并行处理，提高程序的执行效率。</li>
<li>简化编程：使用线程池可以简化多线程编程的复杂性。程序员只需要将任务提交给线程池，而不需要关心线程的创建、管理和销毁等细节，降低了多线程编程的难度。</li>
</ul>
<p>因此，C++线程池的出现是为了解决在高并发场景下创建和销毁线程的开销问题，提高程序的性能和并发处理能力，简化多线程编程的复杂性。</p>
<p><strong>在项目中如何使用线程池？</strong></p>
<p>以一个添加订单功能为例，我们需要查询用户的收获地址和商品信息。在单线程的代码中，我们需要按照顺序进行查询；而在多线程的代码中，我们在保证两个功能没有依赖关系的情况下可以同时查询（即不需要先查询用户的收获地址，再根据收获地址查询商品信息）。</p>
<p>顺序执行的速度是 <code>503 ms</code>，而多线程执行的速度是 <code>329 ms</code>，能明显提高运行速度（效率提升幅度在 50%~60%）。</p>
<h4 id="11-3-线程池的两种模式"><a href="#11-3-线程池的两种模式" class="headerlink" title="11.3 线程池的两种模式"></a>11.3 线程池的两种模式</h4><h5 id="11-3-1-fixed-模式线程池"><a href="#11-3-1-fixed-模式线程池" class="headerlink" title="11.3.1 fixed 模式线程池"></a>11.3.1 <code>fixed</code> 模式线程池</h5><p><code>fixed</code> 模式线程池里面的线程个数是固定不变的，一般是 <code>ThreadPool</code> 创建时，根据当前机器的 <code>CPU</code> 核心数量进行指定。</p>
<h5 id="11-3-2-cache-模式线程池"><a href="#11-3-2-cache-模式线程池" class="headerlink" title="11.3.2 cache 模式线程池"></a>11.3.2 <code>cache</code> 模式线程池</h5><p>假设一个线程池内有四个线程，然后此时出现了四个非常耗时的 <code>I/O</code> 操作任务，此时每个线程分配了一个任务，导致四个线程都被占用阻塞在这里了。此时又出现了一些任务，但是由于线程池中的线程长时间阻塞，所以新的任务可能迟迟得不到处理，此时新的任务堵在任务队列中，相当于整个程序卡死在了这里。在这种情况下，我们希望我们线程池的大小是可以动态改变的，这就是 <code>cache</code> 模式的线程池。</p>
<p><code>cache</code>模式的线程池里面的线程个数是可动态增长的，根据任务的数量动态的增加线程的数量，但是会设置一个线程数量的阈值（线程过多的坏处上面已经讲过了），任务处理完成，如果动态增长的线程空闲了60s还没有处理其它任务，那么关闭线程，保持池中最初数量的线程即可。</p>
<h4 id="11-4-线程池的架构、流程和使用方式"><a href="#11-4-线程池的架构、流程和使用方式" class="headerlink" title="11.4 线程池的架构、流程和使用方式"></a>11.4 线程池的架构、流程和使用方式</h4><img src="./Cpp_Muti_Threaded/ThreadPoolStructure.png">

<p>由图所示，我们的线程池主要需要完成以下几个操作：</p>
<ul>
<li>创建线程池、设置线程池模式、启动线程池</li>
<li>提交异步任务：<code>Result result = pool.submitTask(concreteTask);</code></li>
<li>保证可以接受各种各样的任务</li>
<li>获取异步任务的处理结果（这里需要用到 <code>Any</code> 上帝类）</li>
<li>实现任务队列，这里任务队列要保证线程安全，且任务队列的任务数不宜过多（过多会导致大量的内存占用）</li>
</ul>
<h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/ailumiyana/p/10016965.html">基于C++11实现线程池的工作原理 - 靑い空゛ - 博客园 (cnblogs.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_44667165/article/details/135287449">C++线程池的原理（画图）及简单实现+例子（加深理解）_C++ 线程池原理 - CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000044967349">C++: 每一个C++程序员都应该知道的RAII - 个人文章 - SegmentFault 思否</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/zhongzhaoxie/p/13630795.html">C++线程池 - BrianX - 博客园 (cnblogs.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/gnivor/p/15919850.html">C++笔记-Atomic原子操作&#x2F;CAS(Compare and Swap) - 流了个火 - 博客园 (cnblogs.com)</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-07-29T07:29:04.000Z" title="2024/7/29 15:29:04">2024-07-29</time>发表</span><span class="level-item"><time dateTime="2024-07-29T07:29:04.152Z" title="2024/7/29 15:29:04">2024-07-29</time>更新</span><span class="level-item">几秒读完 (大约0个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/07/29/Cpp-Network-Programming/">Cpp_Network_Programming</a></p><div class="content"></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-07-24T02:38:18.000Z" title="2024/7/24 10:38:18">2024-07-24</time>发表</span><span class="level-item"><time dateTime="2024-07-28T16:19:31.513Z" title="2024/7/29 00:19:31">2024-07-29</time>更新</span><span class="level-item">31 分钟读完 (大约4638个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/07/24/NginxQuickIN/">NginxQuickIN</a></p><div class="content"><h2 id="ENGINE-X-Nginx-快速上手指南"><a href="#ENGINE-X-Nginx-快速上手指南" class="headerlink" title="ENGINE X - Nginx 快速上手指南"></a>ENGINE X - <code>Nginx</code> 快速上手指南</h2><p>[TOC]</p>
<h3 id="🌐-1-Nginx-基本概念"><a href="#🌐-1-Nginx-基本概念" class="headerlink" title="🌐 1. Nginx 基本概念"></a>🌐 1. <code>Nginx</code> 基本概念</h3><p><code>Nginx</code> 是目前最流行的 Web 服务器软件，也是互联网公司和网站的首选。一开始是由一个名为 <code>Igor Sysoev</code> 的俄罗斯程序员开发的，目的是用于解决 <code>C10K</code> 问题，<code>C10K</code> 问题是指服务器同时支持成千上万个并发客户端的问题。这个问题在当时是非常严重的，因为当时的服务器软件都是单线程的，所以在高并发的情况下，服务器的性能会变得非常的差。</p>
<p><code>Nginx</code> 的出现很好的解决了这个问题，在 <code>Nginx</code> 官方的测试结果中，<code>Nginx</code> 可以支持 <code>50000</code> 个并发连接，在后来的发展中，<code>Nginx</code> 也逐渐成为了最流行的 Web 服务器软件。</p>
<p><code>Nginx</code> 具有 <strong><code>epoll</code> I&#x2F;O多路复用</strong>、<strong>高并发</strong>、<strong>高性能</strong>、<strong>低内存消耗</strong>、<strong>热部署</strong>等优势。</p>
<h3 id="🌐-2-Nginx-安装配置"><a href="#🌐-2-Nginx-安装配置" class="headerlink" title="🌐 2. Nginx 安装配置"></a>🌐 2. <code>Nginx</code> 安装配置</h3><h4 id="2-1-通过包管理工具安装-Nginx"><a href="#2-1-通过包管理工具安装-Nginx" class="headerlink" title="2.1 通过包管理工具安装 Nginx"></a>2.1 通过包管理工具安装 <code>Nginx</code></h4><p>① 在 Linux  环境下：</p>
<p>执行 <code>sudo apt update</code> 更新 <code>apt</code> 包，并执行 <code>sudo apt install nginx </code> 安装 <code>Nginx</code>。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">nilera@nilera-virtual-machine:~$ sudo apt update</span><br><span class="line">[sudo] password <span class="keyword">for</span> nilera: </span><br><span class="line">Get:2 http://security.ubuntu.com/ubuntu jammy-security InRelease [129 kB]                                                                                                                  </span><br><span class="line">Hit:3 https://packages.microsoft.com/repos/edge stable InRelease                                                                                        </span><br><span class="line">Hit:1 https://packages.microsoft.com/repos/code stable InRelease                                                                                        </span><br><span class="line">Hit:4 https://ppa.launchpadcontent.net/christian-boxdoerfer/fsearch-stable/ubuntu jammy InRelease</span><br><span class="line">Hit:5 https://ppa.launchpadcontent.net/git-core/ppa/ubuntu jammy InRelease                     </span><br><span class="line">Hit:6 http://mirrors.tuna.tsinghua.edu.cn/ubuntu jammy InRelease                               </span><br><span class="line">Hit:7 http://mirrors.tuna.tsinghua.edu.cn/ubuntu jammy-updates InRelease</span><br><span class="line">Hit:8 http://mirrors.tuna.tsinghua.edu.cn/ubuntu jammy-backports InRelease</span><br><span class="line">Fetched 129 kB <span class="keyword">in</span> 4s (29.4 kB/s)</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree... Done</span><br><span class="line">Reading state information... Done</span><br><span class="line">271 packages can be upgraded. Run <span class="string">&#x27;apt list --upgradable&#x27;</span> to see them.</span><br><span class="line"></span><br><span class="line">nilera@nilera-virtual-machine:~$ sudo apt install nginx </span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree... Done</span><br><span class="line">Reading state information... Done</span><br><span class="line">The following additional packages will be installed:</span><br><span class="line">  libnginx-mod-http-geoip2 libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libnginx-mod-stream-geoip2 nginx-common nginx-core</span><br><span class="line">Suggested packages:</span><br><span class="line">  fcgiwrap nginx-doc</span><br><span class="line">The following NEW packages will be installed:</span><br><span class="line">  libnginx-mod-http-geoip2 libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter libnginx-mod-mail libnginx-mod-stream libnginx-mod-stream-geoip2 nginx nginx-common nginx-core</span><br><span class="line">0 upgraded, 9 newly installed, 0 to remove and 271 not upgraded.</span><br><span class="line">Need to get 697 kB of archives.</span><br><span class="line">After this operation, 2,395 kB of additional disk space will be used.</span><br><span class="line">Do you want to <span class="built_in">continue</span>? [Y/n] Y</span><br><span class="line">Get:1 http://mirrors.tuna.tsinghua.edu.cn/ubuntu jammy-updates/main amd64 nginx-common all 1.18.0-6ubuntu14.4 [40.0 kB]</span><br><span class="line">Get:2 http://mirrors.tuna.tsinghua.edu.cn/ubuntu jammy-updates/main amd64 libnginx-mod-http-geoip2 amd64 1.18.0-6ubuntu14.4 [11.9 kB]</span><br><span class="line">Get:3 http://mirrors.tuna.tsinghua.edu.cn/ubuntu jammy-updates/main amd64 libnginx-mod-http-image-filter amd64 1.18.0-6ubuntu14.4 [15.4 kB]</span><br><span class="line">Get:4 http://mirrors.tuna.tsinghua.edu.cn/ubuntu jammy-updates/main amd64 libnginx-mod-http-xslt-filter amd64 1.18.0-6ubuntu14.4 [13.7 kB]</span><br><span class="line">Get:5 http://mirrors.tuna.tsinghua.edu.cn/ubuntu jammy-updates/main amd64 libnginx-mod-mail amd64 1.18.0-6ubuntu14.4 [45.7 kB]</span><br><span class="line">Get:6 http://mirrors.tuna.tsinghua.edu.cn/ubuntu jammy-updates/main amd64 libnginx-mod-stream amd64 1.18.0-6ubuntu14.4 [72.9 kB]</span><br><span class="line">Get:7 http://mirrors.tuna.tsinghua.edu.cn/ubuntu jammy-updates/main amd64 libnginx-mod-stream-geoip2 amd64 1.18.0-6ubuntu14.4 [10.1 kB]</span><br><span class="line">Get:8 http://mirrors.tuna.tsinghua.edu.cn/ubuntu jammy-updates/main amd64 nginx-core amd64 1.18.0-6ubuntu14.4 [484 kB]</span><br><span class="line">Get:9 http://mirrors.tuna.tsinghua.edu.cn/ubuntu jammy-updates/main amd64 nginx amd64 1.18.0-6ubuntu14.4 [3,872 B]</span><br><span class="line">Fetched 697 kB <span class="keyword">in</span> 5s (128 kB/s)  </span><br><span class="line"></span><br><span class="line">debconf: unable to initialize frontend: Dialog</span><br><span class="line">debconf: (Dialog frontend requires a screen at least 13 lines tall and 31 columns wide.)</span><br><span class="line">debconf: falling back to frontend: Readline</span><br><span class="line">Preconfiguring packages ...</span><br><span class="line">Selecting previously unselected package nginx-common.</span><br><span class="line">(Reading database ... 229379 files and directories currently installed.)</span><br><span class="line">Preparing to unpack .../0-nginx-common_1.18.0-6ubuntu14.4_all.deb ...</span><br><span class="line">Unpacking nginx-common (1.18.0-6ubuntu14.4) ...</span><br><span class="line">Selecting previously unselected package libnginx-mod-http-geoip2.</span><br><span class="line">Preparing to unpack .../1-libnginx-mod-http-geoip2_1.18.0-6ubuntu14.4_amd64.deb ...</span><br><span class="line">Unpacking libnginx-mod-http-geoip2 (1.18.0-6ubuntu14.4) ...</span><br><span class="line">Selecting previously unselected package libnginx-mod-http-image-filter.</span><br><span class="line">Preparing to unpack .../2-libnginx-mod-http-image-filter_1.18.0-6ubuntu14.4_amd64.deb ...</span><br><span class="line">Unpacking libnginx-mod-http-image-filter (1.18.0-6ubuntu14.4) ...</span><br><span class="line">Selecting previously unselected package libnginx-mod-http-xslt-filter.</span><br><span class="line">Preparing to unpack .../3-libnginx-mod-http-xslt-filter_1.18.0-6ubuntu14.4_amd64.deb ...</span><br><span class="line">Unpacking libnginx-mod-http-xslt-filter (1.18.0-6ubuntu14.4) ...</span><br><span class="line">Selecting previously unselected package libnginx-mod-mail.</span><br><span class="line">Preparing to unpack .../4-libnginx-mod-mail_1.18.0-6ubuntu14.4_amd64.deb ...</span><br><span class="line">Unpacking libnginx-mod-mail (1.18.0-6ubuntu14.4) ...</span><br><span class="line">Selecting previously unselected package libnginx-mod-stream.</span><br><span class="line">Preparing to unpack .../5-libnginx-mod-stream_1.18.0-6ubuntu14.4_amd64.deb ...</span><br><span class="line">Unpacking libnginx-mod-stream (1.18.0-6ubuntu14.4) ...</span><br><span class="line">Selecting previously unselected package libnginx-mod-stream-geoip2.</span><br><span class="line">Preparing to unpack .../6-libnginx-mod-stream-geoip2_1.18.0-6ubuntu14.4_amd64.deb ...</span><br><span class="line">Unpacking libnginx-mod-stream-geoip2 (1.18.0-6ubuntu14.4) ...</span><br><span class="line">Selecting previously unselected package nginx-core.</span><br><span class="line">Preparing to unpack .../7-nginx-core_1.18.0-6ubuntu14.4_amd64.deb ...</span><br><span class="line">Unpacking nginx-core (1.18.0-6ubuntu14.4) ...</span><br><span class="line">Selecting previously unselected package nginx.</span><br><span class="line">Preparing to unpack .../8-nginx_1.18.0-6ubuntu14.4_amd64.deb ...</span><br><span class="line">Unpacking nginx (1.18.0-6ubuntu14.4) ...</span><br><span class="line">Setting up nginx-common (1.18.0-6ubuntu14.4) ...</span><br><span class="line">debconf: unable to initialize frontend: Dialog</span><br><span class="line">debconf: (Dialog frontend requires a screen at least 13 lines tall and 31 columns wide.)</span><br><span class="line">debconf: falling back to frontend: Readline</span><br><span class="line">Created symlink /etc/systemd/system/multi-user.target.wants/nginx.service → /lib/systemd/system/nginx.service.</span><br><span class="line">Setting up libnginx-mod-http-xslt-filter (1.18.0-6ubuntu14.4) ...</span><br><span class="line">Setting up libnginx-mod-http-geoip2 (1.18.0-6ubuntu14.4) ...</span><br><span class="line">Setting up libnginx-mod-mail (1.18.0-6ubuntu14.4) ...</span><br><span class="line">Setting up libnginx-mod-http-image-filter (1.18.0-6ubuntu14.4) ...</span><br><span class="line">Setting up libnginx-mod-stream (1.18.0-6ubuntu14.4) ...</span><br><span class="line">Setting up libnginx-mod-stream-geoip2 (1.18.0-6ubuntu14.4) ...</span><br><span class="line">Setting up nginx-core (1.18.0-6ubuntu14.4) ...</span><br><span class="line"> * Upgrading binary nginx                                                                                                                                                            [ OK ] </span><br><span class="line">Setting up nginx (1.18.0-6ubuntu14.4) ...</span><br><span class="line">Processing triggers <span class="keyword">for</span> man-db (2.10.2-1) ...</span><br><span class="line">Processing triggers <span class="keyword">for</span> ufw (0.36.1-4ubuntu0.1) ...</span><br></pre></td></tr></table></figure>

<p>② 在 Mac OS 环境下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install nginx</span><br></pre></td></tr></table></figure>

<p>③ 在 Windows 环境下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scoop install nginx</span><br></pre></td></tr></table></figure>

<p>或者使用：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">choco install nginx</span><br></pre></td></tr></table></figure>

<h4 id="2-2-通过源码编译的方式安装-Nginx"><a href="#2-2-通过源码编译的方式安装-Nginx" class="headerlink" title="2.2 通过源码编译的方式安装 Nginx"></a>2.2 通过源码编译的方式安装 <code>Nginx</code></h4><p><code>Nginx</code> 是使用 <code>C</code> 语言开发的，因此可以像其他 C 语言的项目一样，下载 <code>Nginx</code> 的源码到自己的服务器上，然后执行预编译、编译和安装的过程。</p>
<p>① 预编译</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br><span class="line">--sbin-path=/usr/local/nginx/nginx \</span><br><span class="line">--conf-path=/usr/local/nginx/nginx.conf \</span><br><span class="line">--pid-path=/usr/local/nginx/nginx/pid \</span><br><span class="line">--with-http_ssl_module \</span><br><span class="line">--with-pcre=../pcre2-10.39 \</span><br><span class="line">--with-zlib=../zlib-1.2.11</span><br></pre></td></tr></table></figure>

<p>② 编译</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make</span><br></pre></td></tr></table></figure>

<p>③ 安装</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make install</span><br></pre></td></tr></table></figure>

<h4 id="2-3-使用-Docker-来安装-Nginx"><a href="#2-3-使用-Docker-来安装-Nginx" class="headerlink" title="2.3 使用 Docker 来安装 Nginx"></a>2.3 使用 <code>Docker</code> 来安装 <code>Nginx</code></h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nginx</span><br></pre></td></tr></table></figure>

<h3 id="🌐-3-Nginx-常用命令"><a href="#🌐-3-Nginx-常用命令" class="headerlink" title="🌐 3. Nginx 常用命令"></a>🌐 3. <code>Nginx</code> 常用命令</h3><h4 id="3-1-服务的启动和停止"><a href="#3-1-服务的启动和停止" class="headerlink" title="3.1 服务的启动和停止"></a>3.1 服务的启动和停止</h4><h5 id="3-1-1-服务的启动"><a href="#3-1-1-服务的启动" class="headerlink" title="3.1.1 服务的启动"></a>3.1.1 服务的启动</h5><p>安装完成后，可以直接在命令行输入 <code>nginx</code> 启动服务，若是没有出现信息则说明启动成功；若是启动失败，则会输出启动失败的原因，此时需要根据错误原因进行排查。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx</span><br></pre></td></tr></table></figure>

<p>可能会遇到的问题：</p>
<table>
<thead>
<tr>
<th>问题描述</th>
<th>问题原因</th>
<th>解决方案</th>
</tr>
</thead>
<tbody><tr>
<td>运行 <code>nginx</code> 命令出现错误：<br /><code>nginx: [alert] could not open error log file: open() &quot;/var/log/nginx/error.log&quot; failed (13: Permission denied)</code></td>
<td>权限问题导致无法正常启动 <code>Nginx</code>。</td>
<td>使用 <code>sudo nginx</code> 命令提高用户执行的权限。</td>
</tr>
<tr>
<td>运行 <code>sudo nginx</code> 命令出现错误：<br /><code>nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Unknown error) ... nginx: [emerg] still could not bind()</code></td>
<td>大概率是 <code>80</code> 端口已经被绑定了，或者是之前已经启动了 <code>Nginx</code> 导致端口冲突。可以查看 <code>80</code> 端口的占用情况进行进一步操作。</td>
<td>使用 <code>kill</code> 命令杀死占用端口的程序，然后重新运行 <code>sudo nginx</code> 命令。</td>
</tr>
</tbody></table>
<p>访问 <code>&lt;your ipaddr&gt;:8080</code> 出现以下欢迎界面则表示 <code>Nginx</code> 启动成功。</p>
<img src="./NginxQuickIN/Welcome2Nginx.png" style="zoom: 33%;" >

<h5 id="3-1-2-查看-Nginx-的进程"><a href="#3-1-2-查看-Nginx-的进程" class="headerlink" title="3.1.2 查看 Nginx 的进程"></a>3.1.2 查看 <code>Nginx</code> 的进程</h5><p>使用 <code>ps -ef|grep nginx</code> 可以查看 <code>Nginx</code> 进程。这个其实并不是 <code>Nginx</code> 的命令，而是 <code>Linux</code> 自带的命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nilera@nilera-virtual-machine:~$ ps -ef|grep nginx</span><br><span class="line">root       14461       1  0 10:43 ?        00:00:00 nginx: master process nginx</span><br><span class="line">www-data   14462   14461  0 10:43 ?        00:00:00 nginx: worker process</span><br><span class="line">www-data   14463   14461  0 10:43 ?        00:00:00 nginx: worker process</span><br><span class="line">www-data   14464   14461  0 10:43 ?        00:00:00 nginx: worker process</span><br><span class="line">www-data   14465   14461  0 10:43 ?        00:00:00 nginx: worker process</span><br><span class="line">nilera     14542   11143  0 10:43 pts/0    00:00:00 grep --color=auto nginx</span><br></pre></td></tr></table></figure>

<p>这里可以看到 <code>Nginx</code> 的进程包括 <strong><code>Master</code> 进程</strong> 和 <strong><code>Worker</code> 进程</strong>。</p>
<ul>
<li><strong><code>Master</code> 进程</strong>就是<code>Nginx</code> 的主进程，他主要负责读取和验证配置文件，并管理 <strong><code>Worker</code>进程</strong>，将工作分配给 <strong><code>Worker</code>进程</strong>。</li>
<li><strong><code>Worker</code> 进程</strong>就是<code>Nginx</code> 的工作进程，其主要负责实际的请求，完成具体的工作。</li>
<li><strong><code>Master</code>进程</strong>只有一个，而**<code>Worker</code>进程**可以有很多个，<code>Worker</code> 进程的数量可以通过配置文件来调整。</li>
</ul>
<p>或者我们可以使用 <code>lsof -i:80</code> 来查看 <code>80</code> 端口的占用情况，需要注意：<code>lsof</code> 命令并不适用于所有的 Linux 发行版，有些发行版可能需要安装该命令。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">nilera@nilera-virtual-machine:~$ sudo lsof -i:80</span><br><span class="line">[sudo] password <span class="keyword">for</span> nilera: </span><br><span class="line">COMMAND   PID     USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">nginx   14461     root    6u  IPv4 141914      0t0  TCP *:http (LISTEN)</span><br><span class="line">nginx   14461     root    7u  IPv6 141915      0t0  TCP *:http (LISTEN)</span><br><span class="line">nginx   14462 www-data    6u  IPv4 141914      0t0  TCP *:http (LISTEN)</span><br><span class="line">nginx   14462 www-data    7u  IPv6 141915      0t0  TCP *:http (LISTEN)</span><br><span class="line">nginx   14463 www-data    6u  IPv4 141914      0t0  TCP *:http (LISTEN)</span><br><span class="line">nginx   14463 www-data    7u  IPv6 141915      0t0  TCP *:http (LISTEN)</span><br><span class="line">nginx   14464 www-data    6u  IPv4 141914      0t0  TCP *:http (LISTEN)</span><br><span class="line">nginx   14464 www-data    7u  IPv6 141915      0t0  TCP *:http (LISTEN)</span><br><span class="line">nginx   14465 www-data    6u  IPv4 141914      0t0  TCP *:http (LISTEN)</span><br><span class="line">nginx   14465 www-data    7u  IPv6 141915      0t0  TCP *:http (LISTEN)</span><br></pre></td></tr></table></figure>

<h5 id="3-1-3-服务的停止"><a href="#3-1-3-服务的停止" class="headerlink" title="3.1.3 服务的停止"></a>3.1.3 服务的停止</h5><p>我们可以使用 <code>nginx -s &lt;signal&gt;</code> 来控制 <code>Nginx</code> 的停止或重启。<code>&lt;signal&gt;</code> 可以是 <strong><code>quit</code>优雅退出</strong>、**<code>stop</code>立即停止<strong>、</strong><code>reload</code>重载配置文件<strong>、</strong><code>reopen</code>重新打开日志文件**中的一个。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nilera@nilera-virtual-machine:~$ sudo nginx -s quit</span><br><span class="line">nilera@nilera-virtual-machine:~$ ps -ef|grep nginx</span><br><span class="line">nilera     15527   11143  0 11:16 pts/0    00:00:00 grep --color=auto nginx</span><br></pre></td></tr></table></figure>

<h4 id="3-2-查看-Nginx-的版本、路径等信息"><a href="#3-2-查看-Nginx-的版本、路径等信息" class="headerlink" title="3.2 查看 Nginx 的版本、路径等信息"></a>3.2 查看 <code>Nginx</code> 的版本、路径等信息</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nilera@nilera-virtual-machine:~$ nginx -V</span><br><span class="line">nginx version: nginx/1.18.0 (Ubuntu)</span><br><span class="line">built with OpenSSL 3.0.2 15 Mar 2022</span><br><span class="line">TLS SNI support enabled</span><br><span class="line">configure arguments: --with-cc-opt=<span class="string">&#x27;-g -O2 -ffile-prefix-map=/build/nginx-zctdR4/nginx-1.18.0=. -flto=auto -ffat-lto-objects -flto=auto -ffat-lto-objects -fstack-protector-strong -Wformat -Werror=format-security -fPIC -Wdate-time -D_FORTIFY_SOURCE=2&#x27;</span> --with-ld-opt=<span class="string">&#x27;-Wl,-Bsymbolic-functions -flto=auto -ffat-lto-objects -flto=auto -Wl,-z,relro -Wl,-z,now -fPIC&#x27;</span> --prefix=/usr/share/nginx --conf-path=/etc/nginx/nginx.conf --http-log-path=/var/log/nginx/access.log --error-log-path=/var/log/nginx/error.log --lock-path=/var/lock/nginx.lock --pid-path=/run/nginx.pid --modules-path=/usr/lib/nginx/modules --http-client-body-temp-path=/var/lib/nginx/body --http-fastcgi-temp-path=/var/lib/nginx/fastcgi --http-proxy-temp-path=/var/lib/nginx/proxy --http-scgi-temp-path=/var/lib/nginx/scgi --http-uwsgi-temp-path=/var/lib/nginx/uwsgi --with-compat --with-debug --with-pcre-jit --with-http_ssl_module --with-http_stub_status_module --with-http_realip_module --with-http_auth_request_module --with-http_v2_module --with-http_dav_module --with-http_slice_module --with-threads --add-dynamic-module=/build/nginx-zctdR4/nginx-1.18.0/debian/modules/http-geoip2 --with-http_addition_module --with-http_gunzip_module --with-http_gzip_static_module --with-http_sub_module</span><br></pre></td></tr></table></figure>

<p>其中 <code>--conf-path</code> 包含了 <code>Nginx</code> 的配置文件的位置。在这里我们可以看到路径为：<code>--conf-path=/etc/nginx/nginx.conf</code>。</p>
<p>或者可以使用 <code>nginx -t</code> 来快速定位到 配置文件的位置。<code>nginx -t</code> 同时也可以用于检测配置文件是否存在问题，如果配置文件出现错误，执行 <code>nginx -t</code> 会提示错误位置和错误信息。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nilera@nilera-virtual-machine:~$ sudo nginx -t</span><br><span class="line">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok</span><br><span class="line">nginx: configuration file /etc/nginx/nginx.conf <span class="built_in">test</span> is successful</span><br></pre></td></tr></table></figure>

<p>在<code>Ubuntu 22.04</code> 中，安装的 <code>Nginx</code> 版本为 <code>nginx/1.18.0(Ubuntu)</code>。在该版本中的配置文件和一些最新的版本有一些区别，体现在如下几个方面：</p>
<ul>
<li>主配置文件：<code>/etc/nginx/nginx.conf</code></li>
<li>站点配置文件目录：<code>/etc/nginx/sites-available</code> 和 <code>/etc/nginx/sites-enabled</code></li>
</ul>
<p>在该版本通常将站点配置文件放在 <code>sites-available</code> 目录中，并通过创建符号链接到 <code>sites-enabled</code> 目录来启用它们。例如，可以通过以下命令创建一个简单的站点配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/nginx/sites-available/my_site</span><br></pre></td></tr></table></figure>

<p>在 <code>nginx/1.25.1</code> 版本中，站点的配置文件和主配置文件是在写在一起的。</p>
<h4 id="3-3-Nginx-的配置文件"><a href="#3-3-Nginx-的配置文件" class="headerlink" title="3.3 Nginx 的配置文件"></a>3.3 <code>Nginx</code> 的配置文件</h4><p><code>Nginx</code> 的配置文件可以帮助我们进行 <code>Nginx</code> 的一些设置，如 <code>worker</code> 进程数等。</p>
<p>我们通过以下步骤修改 <code>Nginx</code> 的配置文件。</p>
<p>① 编辑 <code>Nginx</code> 配置文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>

<p>② 修改相应的配置项</p>
<p><code>Nginx</code> 的配置项包括全局块、<code>events</code> 块、<code>http</code> 块。</p>
<ul>
<li><p>全局块</p>
<p>主要是一些全局配置，比如 <code>Worker</code> 进程数、指定运行服务的用户等。</p>
</li>
<li><p><code>events</code> 块</p>
<p>主要是服务器和客户端之间网络连接的一些配置等，比如指定每个 <code>Worker</code> 进程可以同时接收多少个网络连接、网络I&#x2F;O模型等。</p>
</li>
<li><p><code>http</code> 块</p>
<p><code>http</code> 块是 <code>Nginx</code> 修改最频繁的部分，如虚拟主机、反向代理、负载均衡等，都是在 <code>http</code> 块中进行配置的。</p>
<ul>
<li><p><code>server</code> 块</p>
<p><code>http</code> 块下具有多个 <code>server</code> 块，也叫虚拟主机。</p>
<p>我们可以在文件下面 <code>include servers/*</code>，这样就可以将 <code>servers</code> 目录下所有的配置文件都包含进来，这样就可以将每个虚拟主机都放在一个单独的文件中。从而让主配置文件看起来更加的清晰。</p>
<p>在 <code>1.18.0(Ubuntu)</code> 版本中，可以看到主配置文件中包含 <code>include /etc/nginx/sites-enabled/*;</code>，而在 <code>/etc/nginx/site-enabled</code> 中，可以看到 <code>default</code> 软连接到 <code>/etc/nginx/sites-available/default</code> 中。</p>
<p><code>include</code> 命令还可以包含其他的配置文件，如 <code>mime.types</code>。</p>
</li>
</ul>
</li>
</ul>
<p>下面是 <code>Ubuntu</code> 版本的配置文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">user www-data;</span><br><span class="line">worker_processes auto;				-- 这里可以用于修改 Work 进程的进程数</span><br><span class="line">pid /run/nginx.pid;</span><br><span class="line">include /etc/nginx/modules-enabled/*.conf;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">        worker_connections 768;</span><br><span class="line">        <span class="comment"># multi_accept on;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">##</span></span><br><span class="line">        <span class="comment"># Basic Settings</span></span><br><span class="line">        <span class="comment">##</span></span><br><span class="line"></span><br><span class="line">        sendfile on;</span><br><span class="line">        tcp_nopush on;</span><br><span class="line">        types_hash_max_size 2048;</span><br><span class="line">        <span class="comment"># server_tokens off;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># server_names_hash_bucket_size 64;</span></span><br><span class="line">        <span class="comment"># server_name_in_redirect off;</span></span><br><span class="line"></span><br><span class="line">        include /etc/nginx/mime.types;</span><br><span class="line">        default_type application/octet-stream;</span><br><span class="line"></span><br><span class="line">        <span class="comment">##</span></span><br><span class="line">        <span class="comment"># SSL Settings</span></span><br><span class="line">        <span class="comment">##</span></span><br><span class="line"></span><br><span class="line">        ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; <span class="comment"># Dropping SSLv3, ref: POODLE</span></span><br><span class="line">        ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line">        <span class="comment">##</span></span><br><span class="line">        <span class="comment"># Logging Settings</span></span><br><span class="line">        <span class="comment">##</span></span><br><span class="line"></span><br><span class="line">        access_log /var/log/nginx/access.log;</span><br><span class="line">        error_log /var/log/nginx/error.log;</span><br><span class="line"></span><br><span class="line">        <span class="comment">##</span></span><br><span class="line">        <span class="comment"># Gzip Settings</span></span><br><span class="line">        <span class="comment">##</span></span><br><span class="line"></span><br><span class="line">        gzip on;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># gzip_vary on;</span></span><br><span class="line">        <span class="comment"># gzip_proxied any;</span></span><br><span class="line">        <span class="comment"># gzip_comp_level 6;</span></span><br><span class="line">        <span class="comment"># gzip_buffers 16 8k;</span></span><br><span class="line">        <span class="comment"># gzip_http_version 1.1;</span></span><br><span class="line">        <span class="comment"># gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">##</span></span><br><span class="line">        <span class="comment"># Virtual Host Configs</span></span><br><span class="line">        <span class="comment">##</span></span><br><span class="line"></span><br><span class="line">        include /etc/nginx/conf.d/*.conf;</span><br><span class="line">        include /etc/nginx/sites-enabled/*;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#mail &#123;</span></span><br><span class="line"><span class="comment">#       # See sample authentication script at:</span></span><br><span class="line"><span class="comment">#       # http://wiki.nginx.org/ImapAuthenticateWithApachePhpScript</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#       # auth_http localhost/auth.php;</span></span><br><span class="line"><span class="comment">#       # pop3_capabilities &quot;TOP&quot; &quot;USER&quot;;</span></span><br><span class="line"><span class="comment">#       # imap_capabilities &quot;IMAP4rev1&quot; &quot;UIDPLUS&quot;;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#       server &#123;</span></span><br><span class="line"><span class="comment">#               listen     localhost:110;</span></span><br><span class="line"><span class="comment">#               protocol   pop3;</span></span><br><span class="line"><span class="comment">#               proxy      on;</span></span><br><span class="line"><span class="comment">#       &#125;</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#       server &#123;</span></span><br><span class="line"><span class="comment">#               listen     localhost:143;</span></span><br><span class="line"><span class="comment">#               protocol   imap;</span></span><br><span class="line"><span class="comment">#               proxy      on;</span></span><br><span class="line"><span class="comment">#       &#125;</span></span><br><span class="line"><span class="comment">#&#125;</span></span><br></pre></td></tr></table></figure>

<p>③ 使用 <code>nginx -t</code> 命令检查配置文件是否存在问题。</p>
<p>④ 使用 <code>nginx -s reload</code> 修改配置文件后需要重新加载配置文件。</p>
<h3 id="🌐-4-Nginx-常用操作"><a href="#🌐-4-Nginx-常用操作" class="headerlink" title="🌐 4. Nginx 常用操作"></a>🌐 4. <code>Nginx</code> 常用操作</h3><h4 id="4-1-静态站点部署"><a href="#4-1-静态站点部署" class="headerlink" title="4.1 静态站点部署"></a>4.1 静态站点部署</h4><p>我们可以使用 <code>Hexo</code> 来生成一个简单的静态博客网站，并将其部署到 <code>Nginx</code> 中。</p>
<p><code>Hexo</code> 是一个静态博客站点生成工具，是一个基于 <code>Node.js</code> 的博客框架。它可以将 <code>Markdown</code> 格式的文档转化成静态页面，非常适合用于做个人技术博客。</p>
<p>下面先了解以下如何安装和启动 <code>Hexo</code>。</p>
<p>① 前置要求：安装 <code>Node.js</code> 和 <code>Git</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nilera@nilera-virtual-machine:~$ sudo apt update</span><br><span class="line">nilera@nilera-virtual-machine:~$ sudo apt install -y nodejs npm</span><br><span class="line"></span><br><span class="line">nilera@nilera-virtual-machine:~$ sudo apt install git</span><br></pre></td></tr></table></figure>

<p>② 检测 <code>Node.js</code>、<code>npm</code> 和 <code>Git</code> 的版本</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nilera@nilera-virtual-machine:~$ nodejs -v</span><br><span class="line">v12.22.9</span><br><span class="line"></span><br><span class="line">nilera@nilera-virtual-machine:~$ npm -v</span><br><span class="line">8.5.1</span><br><span class="line"></span><br><span class="line">nilera@nilera-virtual-machine:~$ git -v</span><br><span class="line">git version 2.43.0</span><br></pre></td></tr></table></figure>

<p>③ 安装 <code>Hexo</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nilera@nilera-virtual-machine:~$ npm install hexo-cli -g</span><br></pre></td></tr></table></figure>

<p>④ 安装 <code>Hexo</code> 有可能会出现安装速度过慢的情况，这时我们进行 <code>npm</code> 换源操作。</p>
<ul>
<li>查看源</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nilera@nilera-virtual-machine:~$ npm config get registry</span><br><span class="line">https://registry.npmjs.org/</span><br></pre></td></tr></table></figure>

<ul>
<li><p>更换淘宝源</p>
<p>这里需要注意，<code>https://registry.npm.taobao.org/</code> 已经于 <em>2022年05月31日</em> 废弃，现在需要更换为新的淘宝镜像源 <code>https://registry.npmmirror.com/</code>。换源的配置会持久化保存到 <code>~/.npmrc</code> 文件中，可以通过手动修改该文件来修改配置。</p>
<p>此外我们可以安装 <code>nrm</code> 包来简化这一操作，<code>nrm</code> 其实就是 <code>NPM Registry Manager</code>，是一个用于管理 <code>NPM</code> 源的简单命令行工具。具体操作可以参考文章：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/564574951"><code>NPM</code> 如何换源 ?</a></p>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nilera@nilera-virtual-machine:~$ npm config <span class="built_in">set</span> registry https://registry.npm.taobao.org/</span><br><span class="line">nilera@nilera-virtual-machine:~$ npm config <span class="built_in">set</span> registry https://registry.npmmirror.com/</span><br></pre></td></tr></table></figure>

<ul>
<li>恢复官方源</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nilera@nilera-virtual-machine:~$ npm config <span class="built_in">set</span> registry https://registry.npmjs.org</span><br></pre></td></tr></table></figure>

<ul>
<li>删除注册表</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nilera@nilera-virtual-machine:~$ npm config delete registry</span><br></pre></td></tr></table></figure>

<p>⑤ 初始化</p>
<p>执行完 <code>hexo init blog-demo</code> 后，会在执行该目录下生成 <code>blog-demo</code> 目录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nilera@nilera-virtual-machine:~$ hexo init blog-demo</span><br><span class="line">INFO  Cloning hexo-starter https://github.com/hexojs/hexo-starter.git</span><br><span class="line">INFO  Install dependencies</span><br><span class="line">INFO  Start blogging with Hexo!</span><br></pre></td></tr></table></figure>

<p>⑥ 安装依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nilera@nilera-virtual-machine:~$ <span class="built_in">cd</span> blog-demo</span><br><span class="line">nilera@nilera-virtual-machine:~$ npm install</span><br></pre></td></tr></table></figure>

<p>⑦ 使用 <code>hexo g</code> 生成网站静态页面</p>
<p>该命令的主要作用是将 <code>Markdown</code> 格式的文章，转化成静态页面，并放到 <code>public</code> 目录中。第一次执行该命令，会生成 <code>public</code> 目录。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">nilera@nilera-virtual-machine:~/blog-demo$ hexo g</span><br><span class="line">INFO  Validating config</span><br><span class="line">INFO  Start processing</span><br><span class="line">INFO  Files loaded <span class="keyword">in</span> 1.18 s</span><br><span class="line">INFO  Generated: archives/2024/index.html</span><br><span class="line">INFO  Generated: archives/index.html</span><br><span class="line">INFO  Generated: archives/2024/07/index.html</span><br><span class="line">INFO  Generated: index.html</span><br><span class="line">INFO  Generated: fancybox/jquery.fancybox.min.css</span><br><span class="line">INFO  Generated: js/script.js</span><br><span class="line">INFO  Generated: css/style.css</span><br><span class="line">INFO  Generated: css/images/banner.jpg</span><br><span class="line">INFO  Generated: 2024/07/28/hello-world/index.html</span><br><span class="line">INFO  Generated: fancybox/jquery.fancybox.min.js</span><br><span class="line">INFO  Generated: js/jquery-3.6.4.min.js</span><br><span class="line">INFO  11 files generated <span class="keyword">in</span> 7.46 s</span><br></pre></td></tr></table></figure>

<p>⑦ 使用 <code>hexo s</code> 或 <code>hexo server</code> 本地运行（启动本地服务器）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">nilera@nilera-virtual-machine:~/blog-demo$ hexo server</span><br><span class="line">nilera@nilera-virtual-machine:~/blog-demo$ hexo s</span><br><span class="line">INFO  Validating config</span><br><span class="line">INFO  Start processing</span><br><span class="line">INFO  Hexo is running at http://localhost:4000/ . Press Ctrl+C to stop.</span><br></pre></td></tr></table></figure>

<p>⑧ 实际生产环境中，我们会将页面部署到 <code>Nginx</code> 上，我们只需要将 <code>blog-demo</code> 中的 <code>public</code> 目录复制到 <code>Nginx</code> 用于存放静态页面的目录下即可。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nilera@nilera-virtual-machine:~/blog-demo$ sudo <span class="built_in">cp</span> -rf public/* /var/www/html/</span><br></pre></td></tr></table></figure>

<p>⑨ 访问 <code>Nginx</code> 页面，即可进行博客网站的访问。</p>
<h4 id="4-2-反向代理"><a href="#4-2-反向代理" class="headerlink" title="4.2 反向代理"></a>4.2 反向代理</h4><p>反向代理是相对于正向代理来说的，简单来说，正向代理就是代理客户端，反向代理就是代理服务端。</p>
<img src="./NginxQuickIN/Proxy.png" style="zoom: 33%;" >

<p>例如，当我们想要访问一个国外的网站（如：Google）时，可能由于网络的原因无法访问到相关内容。这个时候我们就可以使用 <code>VPN</code> 这种代理服务器，让代理服务器作为客户端，代理我们去访问这些网站，再将访问的结果返回给我们。这就是一个典型的<strong>正向代理</strong>的例子，这里的代理服务器代理的是客户端，而且这个过程客户端是知道的，但是对于服务端来说是透明的。</p>
<p>而<strong>反向代理是代理服务端</strong>的，比如当我们准备访问一个网站（如：Google）的时候，他后面可能有着成千上万台服务器，但是对外暴露的只有一个域名，我们也只能通过这个域名来进行访问，然后我们的请求会被转发到后面的服务器上。这种方式隐藏了真实的服务器<code>IP</code>地址、端口等信息。这就是<strong>反向代理</strong>的典型例子，这里的代理服务器代理的是服务端，而且这个过程服务端是知道的，但是对于客户端来说是透明的。</p>
<h4 id="4-3-负载均衡"><a href="#4-3-负载均衡" class="headerlink" title="4.3 负载均衡"></a>4.3 负载均衡</h4><h4 id="4-4-HTTPS-配置"><a href="#4-4-HTTPS-配置" class="headerlink" title="4.4 HTTPS 配置"></a>4.4 <code>HTTPS</code> 配置</h4><p><code>HTTPS</code> 协议是 <code>HTTP</code> 协议的安全版本，它通过对传输的数据进行加密来保证数据的安全性。<code>HTTP</code> 协议的默认端口号是 <code>80</code> ，而 <code>HTTPS</code> 协议的默认端口号是 <code>443</code>。</p>
<p><code>HTTPS</code> 协议需要使用到 <code>SSL</code> 证书，再主流的云平台上都可以免费申请到 <code>SSL</code> 证书。证书申请完成之后，会得到密钥文件和证书文件。如果没有云平台也没有关系，我们可以通过 <code>OpenSSL</code> 命令来生成一个自签名的 <code>SSL</code> 证书，步骤如下：</p>
<p>① 生成私钥文件（<em>Private Key</em>）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out private.key 2048</span><br></pre></td></tr></table></figure>

<p>② 根据私钥生成证书签名请求文件（<em>Certificate Signing Request, CSR</em>）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -key private.key -out cert.csr</span><br></pre></td></tr></table></figure>

<p>③ 使用私钥对证书申请进行签名从而生成证书文件（<em>pem</em>）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -<span class="keyword">in</span> cert.csr -out cacert.pem -signkey private.key</span><br></pre></td></tr></table></figure>

<h4 id="4-5-虚拟主机"><a href="#4-5-虚拟主机" class="headerlink" title="4.5 虚拟主机"></a>4.5 虚拟主机</h4></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-07-22T08:18:39.000Z" title="2024/7/22 16:18:39">2024-07-22</time>发表</span><span class="level-item"><time dateTime="2024-07-24T02:39:16.666Z" title="2024/7/24 10:39:16">2024-07-24</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/">开发工具</a><span> / </span><a class="link-muted" href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Docker/">Docker</a></span><span class="level-item">28 分钟读完 (大约4263个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/07/22/DockerQuickIN/">DockerQuickIN</a></p><div class="content"><h2 id="Docker-快速入门"><a href="#Docker-快速入门" class="headerlink" title="Docker 快速入门"></a>Docker 快速入门</h2><p>[TOC]</p>
<p><strong>宝藏视频：</strong><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV14s4y1i7Vf">https://www.bilibili.com/video/BV14s4y1i7Vf</a></p>
<p>如果你遇到过：</p>
<ul>
<li>应用程序的部署和环境配置过于复杂</li>
<li>在开发环境好用，但是到了测试和生产环境都不好用的情况</li>
<li>作为新人加入项目组，需要花费大量的时间来配置开发环境</li>
<li>花费一整天甚至更长时间，一步一步按照配置部署文档来配置环境，但是最终却卡在中间某个步骤上，再也无法前进</li>
</ul>
<p>那么，<code>Docker</code> 可以帮我们完美解决上面这些问题。</p>
<h3 id="🐳-1-Docker-的基本概念"><a href="#🐳-1-Docker-的基本概念" class="headerlink" title="🐳 1. Docker 的基本概念"></a>🐳 1. <code>Docker</code> 的基本概念</h3><h4 id="1-1-Docker-的简介"><a href="#1-1-Docker-的简介" class="headerlink" title="1.1 Docker 的简介"></a>1.1 <code>Docker</code> 的简介</h4><p><code>Docker</code> 是一个用于<strong>构建（Build）</strong>、<strong>运行（Run）</strong>、<strong>传送（Share）</strong>应用程序的平台。</p>
<img src="./DockerQuickIN/Docker.png" style="zoom:50%;" >

<p>有了 <code>Docker</code>，我们就可以将应用程序和运行他所需要的各种依赖包、第三方软件库、配置文件等打包在一起。以便在任何环境中都能正确的运行。<code>Docker</code> 可以让开发者打包他们的应用以及依赖包到一个轻量级、可移植的容器中，然后发布到任何流行的 Linux 机器上，也可以实现虚拟化。容器是完全使用沙箱机制，相互之间不会有任何接口，更重要的是容器性能开销极低。</p>
<p><code>Docker</code> 从 <code>17.03</code> 版本之后分为 社区版 <code>CE(Community Edition)</code> 和 企业版 <code>EE(Enterprise Edition)</code>。</p>
<h4 id="1-2-为什么-要使用-Docker"><a href="#1-2-为什么-要使用-Docker" class="headerlink" title="1.2 为什么 要使用 Docker"></a>1.2 为什么 要使用 <code>Docker</code></h4><p>为什么要使用 <code>Docker</code> 呢？</p>
<p>举个简单的例子：我们写了一个网站，用到了现在不叫流行的前后端分离架构，前端使用 <code>Vue</code> 框架来构建网站的界面，后端使用 <code>Java</code> 的 <code>SpringBoot</code> 框架来提供各种服务和接口，并且使用 <code>MySQL</code> 数据库来存储数据。</p>
<img src="./DockerQuickIN/WebWithoutDocker.png" style="zoom:50%;" >

<p>如果没有 <code>Docker</code>，我们的步骤大概是这样的：</p>
<ul>
<li>Step-01：安装 <code>NodeJS</code> 环境。</li>
<li>Step-02：安装各种 <code>npm</code> 依赖。</li>
<li>Step-03：安装 <code>Java</code> 运行时环境。</li>
<li>Step-04：安装各种第三方依赖包。</li>
<li>Step-05：安装 <code>MySQL</code> 数据库。</li>
<li>Step-06：配置各种环境变量、启动脚本。</li>
<li>Step-07：配置 <code>Redis</code>。</li>
<li>Step-08：配置 <code>Nginx</code> 负载均衡。 </li>
<li>Step-09：其他配置项…</li>
</ul>
<p>这仅仅是开发环境所需要进行的操作，当我们需要将我们的网站部署到测试环境或生产环境上，那么这些所有的步骤都需要重新再来一遍。</p>
<p>但是如果我们有了 <code>Docker</code>，我们就可以将他们打包成一个个集装箱，只要我们在开发环境中运行成功了，那么在测试环境中一定也是可以运行成功的。</p>
<img src="./DockerQuickIN/WebWithDocker.png">

<h4 id="1-3-Docker-和-虚拟机的区别"><a href="#1-3-Docker-和-虚拟机的区别" class="headerlink" title="1.3 Docker 和 虚拟机的区别"></a>1.3 <code>Docker</code> 和 虚拟机的区别</h4><p>我们可能了解或使用过一些虚拟机软件，如：<code>VMware</code>、<code>Virtalbox</code>、<code>Parallels Desktop</code>，或者 <code>Window</code> 的 <code>WSL</code>、<code>Microsoft Hyper-V</code> 等功能。</p>
<p>他们都是完整的操作系统，和实际上使用操作系统一样，可以在实际的操作系统中运行应用程序，这是通过一种叫做<strong>虚拟化（Hypervisor）</strong>的技术实现的。虚拟化技术是一种将物理资源虚拟为多个逻辑资源的技术，他可以将一台物理服务器虚拟成多个逻辑服务器，每个逻辑服务器都有自己的操作系统、CPU、内存、硬盘和网络接口等。不同的逻辑服务器之间是完全隔离的，可以独立运行。</p>
<p>虚拟机在一定程度上实现了资源的整合，可以将要一台服务器的计算能力、存储能力、网络资源分配给多个逻辑服务器。实现多台服务器的功能。但是其缺点也同样明显，每台虚拟机需要占用大量的资源，比如CPU、内存、硬盘、网络等，而且启动速度非常慢。但是其实我们的每台服务器上只需要运行一个主要对外提供服务的应用程序就可以了。并不需要一个完整的操作系统所提供的所有功能。</p>
<img src="./DockerQuickIN/Hypervisor.png" style="zoom:67%;" >

<p>也许我们需要的只是一个Web服务器，但是使用虚拟机却需要启动一个完整的操作系统，包括操作系统的内核、各种系统服务、各种工具甚至图形界面等，这些我们并不需要的服务占用了大量的资源，导致了资源的浪费和启动速度慢的问题。</p>
<img src="./DockerQuickIN/VM.png" style="zoom:50%;" >

<p>了解了虚拟机后，我们再来看一下 <code>Docker</code> 是如何解决的。需要注意，<code>Docker</code> 中***容器(Container)<em><strong>的概念。需要注意的是，<code>Docker</code> 和 <strong>容器</strong>是两个不同的概念，但是因为 <code>Docker</code> 的流行性，以至于很多人将 <code>Docker</code> 和 <strong>容器</strong> 混为一谈，实际上 <code>Docker</code>只是容器的一种实现，是一个容器化的解决方案和平台。而</strong>容器是一种虚拟化技术，和虚拟机类似</em>*，也是一个独立的环境，可以在这个环境中运行应用程序。和虚拟机不同的是，他并不需要在容器中运行一个完整的操作系统，而是使用宿主机的操作系统，所以启动速度非常快，通常只需要几秒钟。同时，因为需要的资源更少，所以可以在一台物理服务器上运行更多的容器，以便于更加充分的利用服务器的资源，减少资源的闲置和浪费。</p>
<img src="./DockerQuickIN/DockerContainer.png" style="zoom:50%;" >

<p>正因如此，一台物理服务器上也许可以运行几个虚拟机，但是却可以运行上百个容器。</p>
<h4 id="1-4-Docker-的基本原理和主要概念"><a href="#1-4-Docker-的基本原理和主要概念" class="headerlink" title="1.4 Docker 的基本原理和主要概念"></a>1.4 <code>Docker</code> 的基本原理和主要概念</h4><img src="./DockerQuickIN/DockerConcept.png">

<p><strong>镜像 Image</strong>：镜像是一个<strong>只读</strong>的模板，它可以用来创建容器。</p>
<p><strong>容器 Container</strong>：容器是 <code>Docker</code> 的<strong>运行实例</strong>，他提供了一个独立的、可移植的环境，可以在这个环境中运行应用程序。</p>
<p><strong>仓库 Registry</strong>：<code>Docker</code> 的仓库是一个用于存储 <code>Docker</code>镜像的地方。最流行、最常用的仓库就是 <code>Docker Hub</code>。</p>
<p>类似于 <code>Java</code> 和 <code>C++</code>，<em><strong>镜像</strong></em>类似于<em><strong>类</strong></em>，而<em><strong>容器</strong></em>则就是<em><strong>类的实例</strong></em>，可以有一到多个容器。</p>
<p><code>Docker</code> 使用的是 <code>Client-Server</code> 架构模式，<code>Docker Client</code> 和 <code>Docker Daemon</code> 之间通过 <code>socket</code> 或 <code>RESTful API</code> 进行通信。<code>Docker Daemon</code> 就是 <code>Docker</code> 服务端的守护进程，他负责管理 <code>Docker</code> 的各种资源。<code>Docker Client</code> 负责向 <code>Docker Daemon</code> 发送请求，<code>Docker Daemon</code> 接收到请求后进行处理，然后将要结果返回给 <code>Docker Client</code>。<code>Docker Daemon</code> 是一个后台进程，用于接收并处理来自 <code>Docker</code> 客户端的请求，然后将结果返回给客户端。因此我们在终端中输入的各种 <code>Docker</code> 命令，其实都是通过 <code>Docker Client</code> 发送给 <code>Docker Daemon</code> 的，<code>Docker Daemon</code> 进行处理，最后将处理结果返回给 <code>Docker Client</code>，然后就可以再终端中看到执行结果。</p>
<h3 id="🐳-2-Docker-的安装配置"><a href="#🐳-2-Docker-的安装配置" class="headerlink" title="🐳 2. Docker 的安装配置"></a>🐳 2. <code>Docker</code> 的安装配置</h3><p><code>Docker</code> 官网（目前国内无法正常访问）：<a target="_blank" rel="noopener" href="https://www.docker.com/">https://www.docker.com/</a></p>
<p>可以找一些镜像网站来进行下载安装。</p>
<p>下载完成后，需要运行 <code>Docker</code>，才可以使用 <code>Docker</code> 的一系列命令。</p>
<p><code>Windows</code> 系统下需要开启 <code>Hyper-V</code> 功能。开启方式如下：</p>
<ul>
<li>在设置中搜索 <strong>启用或关闭 Windows 功能</strong>。</li>
<li>勾选 <code>Hyper-V</code> 选项，按照提示重启系统即可。</li>
</ul>
<p>启动之后，即可在终端使用 <code>Docker</code> 的各种命令了。我们可以使用一条简单的命令来进行测试：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\NilEra&gt;docker version</span><br><span class="line">Client:</span><br><span class="line"> Cloud integration: v1.0.28</span><br><span class="line"> Version:           20.10.17</span><br><span class="line"> API version:       1.41</span><br><span class="line"> Go version:        go1.17.11</span><br><span class="line"> Git commit:        100c701</span><br><span class="line"> Built:             Mon Jun  6 23:09:02 2022</span><br><span class="line"> OS/Arch:           windows/amd64</span><br><span class="line"> Context:           default</span><br><span class="line"> Experimental:      <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">Server: Docker Desktop 4.11.1 (84025)</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          20.10.17</span><br><span class="line">  API version:      1.41 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.17.11</span><br><span class="line">  Git commit:       a89b842</span><br><span class="line">  Built:            Mon Jun  6 23:01:23 2022</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     <span class="literal">false</span></span><br><span class="line"> containerd:</span><br><span class="line">  Version:          1.6.6</span><br><span class="line">  GitCommit:        10c12954828e7c7c9b6e0ea9b0c02b01407d3ae1</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.1.2</span><br><span class="line">  GitCommit:        v1.1.2-0-ga916309</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.19.0</span><br><span class="line">  GitCommit:        de40ad0</span><br></pre></td></tr></table></figure>

<p>我们可以看到 <code>Client</code> 和 <code>Server</code> 的信息，如果只能看到 <code>Client</code>，则表示 <code>Docker</code> 没有启动，需要启动 <code>Docker</code> 之后才可以看到 <code>Server</code>。</p>
<h3 id="🐳-3-Docker-的常用命令"><a href="#🐳-3-Docker-的常用命令" class="headerlink" title="🐳 3. Docker 的常用命令"></a>🐳 3. <code>Docker</code> 的常用命令</h3><h4 id="3-1-Docker-Desktop-的使用"><a href="#3-1-Docker-Desktop-的使用" class="headerlink" title="3.1 Docker Desktop 的使用"></a>3.1 <code>Docker Desktop</code> 的使用</h4><h5 id="3-1-1-Docker-Containers-Images-容器和镜像"><a href="#3-1-1-Docker-Containers-Images-容器和镜像" class="headerlink" title="3.1.1 Docker Containers &amp; Images 容器和镜像"></a>3.1.1 <code>Docker Containers</code> &amp; <code>Images</code> 容器和镜像</h5><p><code>Docker Desktop</code> 是 <code>Docker</code> 的图形化界面，<code>Docker Desktop</code> 封装了容器日常使用和管理的各种常用功能，打开控制台面板后，可以看到 <strong><code>Containers</code> 容器</strong>和**<code>Images</code>镜像**，这两个菜单项分别用于查看本机的容器列表和镜像列表。</p>
<p>对于菜单项中的内容，我们可以进行一系列操作。</p>
<img src="./DockerQuickIN/DockerDesktopImagesMenu.png">

<p>比如，我们可以点击 <code>RUN</code> 按钮运行一个镜像，等同于执行了 <code>docker run</code> 命令。点击三个小圆点，有几个选项 <code>Inspect</code>、<code>Pull</code>、<code>Push to Hub</code>、<code>Remove</code>，分别用于查看镜像的详细信息、拉取镜像、推送镜像、移除镜像。</p>
<h5 id="3-1-2-Docker-Volumes-逻辑卷"><a href="#3-1-2-Docker-Volumes-逻辑卷" class="headerlink" title="3.1.2 Docker Volumes 逻辑卷"></a>3.1.2 <code>Docker Volumes</code> 逻辑卷</h5><p>此外，还有 <strong><code>Volumes</code> 逻辑卷</strong> 菜单项，在这个菜单项列表中可以看到容器的逻辑卷，逻辑卷是 <code>Docker</code> 中用来存储的。</p>
<p><code>Docker</code> 容器有一个特点，就是容器中的数据是不会持久化的，当我们创建一个容器的时候，它通常以一个干净的文件系统开始，容器启动之后，我们可以在文件中创建文件、修改文件，但是当容器停止之后，容器中的所有数据都会丢失掉。</p>
<p>如果我们想要对于 <code>Docker</code> 中的数据进行容器的持久化应该怎么做？</p>
<p>逻辑卷就是用来解决这个问题的，它可以将容器中的目录或者指定路径映射到宿主机的某一目录或者位置上，这样就可以将数据保存到宿主机的磁盘上，实现了数据的持久化。</p>
<h5 id="3-1-3-Docker-Dev-Environments-开发环境"><a href="#3-1-3-Docker-Dev-Environments-开发环境" class="headerlink" title="3.1.3 Docker Dev Environments 开发环境"></a>3.1.3 <code>Docker Dev Environments</code> 开发环境</h5><p>用于管理开发环境，简单来说就是可以创建一个开发环境，然后通过一些代码配置这个开发环境，这样就可以将这个开发环境共享给项目中的其他开发人员，让每个人都在一个相同的环境下进行开发，避免因为环境的不一致导致的各种问题。</p>
<h3 id="🐳-4-如何从零开始构建一个-Docker-镜像"><a href="#🐳-4-如何从零开始构建一个-Docker-镜像" class="headerlink" title="🐳 4. 如何从零开始构建一个 Docker 镜像"></a>🐳 4. 如何从零开始构建一个 <code>Docker</code> 镜像</h3><h4 id="4-1-容器化和-Dockerfile"><a href="#4-1-容器化和-Dockerfile" class="headerlink" title="4.1 容器化和 Dockerfile"></a>4.1 容器化和 <code>Dockerfile</code></h4><p>**容器化(Containerization)**：就是将应用程序打包成容器，然后在容器中运行应用程序的过程。</p>
<p>容器化的过程可以分为以下几个步骤：</p>
<ol>
<li>创建一个 <code>Dockerfile</code>：来告诉 <code>Docker</code> 构建应用程序镜像所需要的步骤和配置。</li>
<li>使用 <code>Dockerfile</code> 构建镜像。</li>
<li>使用镜像创建和运行容器。</li>
</ol>
<p><code>Dockerfile</code> 是一个文本文件，里面包含了一条条指令，用于告诉 <code>Docker</code> 如何构建镜像，这个镜像中包括了我们应用程序执行的所有命令，如各种依赖、配置环境和运行应用程序所需要的所有内容，一般来说包括：精简版的操作系统（如<code>Alpine</code>）、应用程序的运行时环境（如<code>NodeJS</code>、<code>Python</code>、<code>Java</code>）、应用程序（如打包好的 <code>jar</code> 包）、应用程序的第三方依赖库或包、应用程序的配置文件、环境变量等。</p>
<p>一般来说，我们会在项目的根目录下创建一个叫 <code>Dockerfile</code> 的文件，在这个文件中写入构建镜像所需要的各种指令之后，<code>Docker</code> 就会根据这个 <code>Dockerfile</code> 文件来构建一个镜像，有了这个镜像后，我们就可以根据这个镜像来创建容器，然后在容器中运行应用程序。</p>
<h4 id="4-2-编写-Dockerfile"><a href="#4-2-编写-Dockerfile" class="headerlink" title="4.2 编写 Dockerfile"></a>4.2 编写 <code>Dockerfile</code></h4><ol>
<li>新建一个名为 <code>HelloDocker</code> 的文件夹，使用 <code>VSCode</code> 打开该文件夹</li>
<li>在文件夹中创建一个 <code>index.js</code> 文件，简单的输入一些代码内容，比如输出一段内容到控制台</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Hello Docker!&quot;</span>);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>我们可以使用 <code>NodeJS</code> 来测试这个 <code>JavaScript</code> 文件，<code>NodeJS</code> 是一个运行时环境，它可以让我们在浏览器之外的环境运行 <code>JavaScript</code> 代码。<code>JavaScript</code> 和 <code>NodeJS</code> 的关系就像 <code>Java</code> 和 <code>JRE</code> 的关系一样，如果想在浏览器之外的环境中运行 <code>JavaScript</code> 代码就需要 <code>NodeJS</code>。可以使用下面的命令运行 <code>index.js</code>。</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> D:\HelloDocker&gt; node index.js</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>所以，当我们想要在另一个环境中运行这个应用程序时，都需要执行那些步骤呢？</p>
<ul>
<li>安装操作系统</li>
<li>安装 <code>JavaScript</code> 的运行环境</li>
<li>复制应用程序、依赖包、配置文件</li>
<li>执行启动命令运行程序</li>
</ul>
<p>而有了 <code>Docker</code> 后，我们可以将上述的步骤写入到 <code>Dockerfile</code> 中，剩下的工作交给 <code>Docker</code> 自动完成。</p>
</li>
<li><p>创建 <code>Dockerfile</code> 文件</p>
<p>在 <code>Dockerfile</code> 中，我们需要先指定一个基础镜像，镜像是按层次结构来构建的，每一层都是基于上一层的，所以我们需要先指定一个基础镜像，然后在此基础上添加我们的应用程序。</p>
<p>注意 <code>Dockerfile</code> 中不需要注释，这里只是为了便于理解所以添加了注释</p>
</li>
</ol>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 指定基础镜像</span></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">14</span>-alpine</span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制 本地路径的 JS 文件到镜像的根目录下</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> index.js /</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 CMD 命令运行该程序 CMD [&quot;arg1&quot;, &quot;arg2&quot;, &quot;arg...&quot;], 其中 arg1 表示可执行程序的名字, arg2 及以后的参数表示可执行程序的参数</span></span><br><span class="line"><span class="comment"># 可以写成这种形式: CMD node /index.js</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;node&quot;</span>, <span class="string">&quot;/index.js&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<h4 id="4-3-创建镜像"><a href="#4-3-创建镜像" class="headerlink" title="4.3 创建镜像"></a>4.3 创建镜像</h4><ol start="6">
<li><p>构建 <code>Docker</code> 镜像</p>
<p>执行 <code>docker build</code> 命令，<code>hello-docker</code> 是镜像名称；<code>.</code> 表示当前目录，即 <code>Dockerfile</code> 所在目录。</p>
</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> D:\HelloDocker&gt; docker build <span class="literal">-t</span> hello<span class="literal">-docker</span> .</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>执行完成后，我们可以使用命令<code>docker images</code> 或 <code>docker image ls</code> 查看所有镜像。</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> D:\HelloDocker&gt; docker images</span><br><span class="line">REPOSITORY        TAG                              IMAGE ID       CREATED          SIZE</span><br><span class="line">hello<span class="literal">-docker</span>      latest                           <span class="number">31429</span>fa0e1e7   <span class="number">22</span> seconds ago   <span class="number">119</span>MB</span><br></pre></td></tr></table></figure>

<h4 id="4-4-启动容器"><a href="#4-4-启动容器" class="headerlink" title="4.4 启动容器"></a>4.4 启动容器</h4><ol start="8">
<li>使用 <code>docker run</code> 命令运行容器。</li>
</ol>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> D:\HelloDocker&gt; docker run hello<span class="literal">-docker</span></span><br><span class="line">Hello Docker!</span><br></pre></td></tr></table></figure>

<h4 id="4-5-在其他设备上测试容器"><a href="#4-5-在其他设备上测试容器" class="headerlink" title="4.5 在其他设备上测试容器"></a>4.5 在其他设备上测试容器</h4><ol start="9">
<li><p>为了测试我们的容器，我们可以将我们的镜像上传到 <code>Docker Hub</code> 或者 <code>Harbor</code> 镜像仓库中，上传完成之后，可以使用 <a target="_blank" rel="noopener" href="https://labs.play-with-docker.com/">Play with Docker</a> 进行测试。</p>
<p>上传镜像可以使用 <code>docker push</code> 命令。需要注意的是，推送镜像可能会出现问题：<code>docker：denied: requested access to the resource is denied</code>，遇到这个问题时，可以参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/fengpengfei_yes/article/details/113838579">解决docker：denied: requested access to the resource is denied_docker login - CSDN</a>。</p>
<p>① 确保自己登录了 <code>Docker</code></p>
<p>② 将镜像打 <code>TAG</code>，使用 <code>docker tag hello-docker:latest nilerak/hello-docker:1.0.0</code></p>
<p>③ 推送镜像，使用 <code>docker push nilerak/hello-docker:1.0.0</code></p>
</li>
<li><p>使用 <code>docker pull</code> 命令下载镜像文件。</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull nilerak/hello-docker:1.0.0</span><br></pre></td></tr></table></figure>

<img src="./DockerQuickIN/DockerPull01.png" style="width:700px">

<img src="./DockerQuickIN/DockerPull02.png" style="width:700px">

<img src="./DockerQuickIN/DockerPull03.png"  style="width:700px">

<h3 id="🐳-5-如何运行一个-Docker-容器"><a href="#🐳-5-如何运行一个-Docker-容器" class="headerlink" title="🐳 5. 如何运行一个 Docker 容器"></a>🐳 5. 如何运行一个 <code>Docker</code> 容器</h3><h3 id="🐳-6-Docker-Compose-和-Kubernetes"><a href="#🐳-6-Docker-Compose-和-Kubernetes" class="headerlink" title="🐳 6. Docker Compose 和 Kubernetes"></a>🐳 6. <code>Docker Compose</code> 和 <code>Kubernetes</code></h3><h4 id="6-1-Docker-Compose"><a href="#6-1-Docker-Compose" class="headerlink" title="6.1 Docker Compose"></a>6.1 Docker Compose</h4><p>Docker Compose 是 Docker 官方的开源项目，是一个用于定义和运行多容器 <code>Docker</code> 应用程序的工具，使用 <code>Yaml</code> 文件配置应用程序的服务，只需运行一条命令即可创建并启动所有的服务。</p>
<p>例如我们的项目可能需要前端（Vue）、后端（SpringBoot）、数据库（MySQL）、缓存（Redis）、负载均衡（Nginx）等多个服务器，这些服务相互独立，但是又存在一定的关联，需要相互配合来工作，前端需要连接后端、后端需要连接数据库。这些服务之间的关联关系，就是 <code>Docker Compose</code> 要解决的问题。它通过一个单独的 <code>docker-compose.yaml</code> 文件来将这一组互相关联的容器组合在一起，形成一个项目，然后使用一条命令 <code>docker compose up</code> 即可启动、停止、重建这些服务，这样就可以非常方便的管理这些服务了。</p>
<h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/lqpf199681/article/details/110518692">Docker超详细基础教程 - CSDN博客</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-06-23T04:27:44.000Z" title="2024/6/23 12:27:44">2024-06-23</time>发表</span><span class="level-item"><time dateTime="2024-06-24T08:40:14.154Z" title="2024/6/24 16:40:14">2024-06-24</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/CppDev/">CppDev</a><span> / </span><a class="link-muted" href="/categories/CppDev/Gaming/">Gaming</a></span><span class="level-item">5 分钟读完 (大约756个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/06/23/CppGamingDEV-PVZ-BASE-EASYX/">CppGamingDEV_PVZ_BASE_EASYX</a></p><div class="content"><h2 id="🎮-从零开始进行-C-游戏开发"><a href="#🎮-从零开始进行-C-游戏开发" class="headerlink" title="🎮 从零开始进行 C++ 游戏开发"></a>🎮 从零开始进行 C++ 游戏开发</h2><p>[TOC]</p>
<h3 id="游戏场景概念"><a href="#游戏场景概念" class="headerlink" title="游戏场景概念"></a>游戏场景概念</h3><ul>
<li><strong>什么是场景?</strong><br>如果将要游戏程序比作是一场有玩家参与的盛大演出，那场景就是演出过程中的一幕。在不同的幕中，会有不同的剧本逻辑，也可能会有不同的角色登场，这些角色即游戏开发中常提到的 <code>GameObject</code> 的概念。<br>不论是玩家、敌人还是子弹、道具等，这些从概念上讲都是 <code>GameObject</code> 的范畴。他们接受着不同的场景剧本的指挥，进行着不同逻辑的演出。<br>了解了这些，我们就可以对程序的流程进行宏观的划分，游戏的主菜单是一个场景，玩家角色选择界面也是一个场景，游戏局内的逻辑也需要放置在一个单独的场景中。<br>所以我们就可以定义一个 <code>Scene</code> 场景基类，<strong>主菜单</strong>、<strong>角色选择</strong>、<strong>局内游戏</strong> 作为新类分别继承 <code>Scene</code> 类。</li>
</ul>
<h3 id="游戏主循环框架概念"><a href="#游戏主循环框架概念" class="headerlink" title="游戏主循环框架概念"></a>游戏主循环框架概念</h3><ul>
<li><strong>什么是游戏主循环框架?</strong><br>游戏程序的主体是一个永不停歇的死循环。在每次循环中，我们读取玩家的操作信息，并根据这些操作，处理玩家数据更新，在最后的绘图阶段将游戏画面根据这些更新后的数据渲染出来。<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">初始化();</span><br><span class="line"><span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">    读取操作();</span><br><span class="line">    处理数据();</span><br><span class="line">    绘制画面();</span><br><span class="line">&#125;</span><br><span class="line">施放资源;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="C-头文件"><a href="#C-头文件" class="headerlink" title="C++ 头文件"></a>C++ 头文件</h3><ul>
<li>为什么需要头文件卫士?<br>如果不使用头文件卫士，可能会导致出现重定义的问题。例如，我们有一个头文件 <code>A.h</code> ，有一个头文件 <code>B.h</code>，头文件 <code>B.h</code> 中使用了 <code>A.h</code> 的内容。当我们在主函数里面使用了 <code>A.h</code> 和 <code>B.h</code> 的时候，使用 <code>#include</code> 时会将头文件中的内容全部<strong>复制</strong>到 <code>#include</code> 的部分。这样的话如果不加头文件卫士，就会导致重定义的问题，如下：  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A.h</span></span><br><span class="line"><span class="type">int</span> a;</span><br><span class="line"></span><br><span class="line"><span class="comment">// B.h</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;A.h&quot;</span></span></span><br><span class="line"><span class="type">int</span> b;</span><br><span class="line"></span><br><span class="line"><span class="comment">// main.cpp</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;A.h&quot;</span>      <span class="comment">// int a;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;B.h&quot;</span>      <span class="comment">// int a;</span></span></span><br><span class="line">                    <span class="comment">// int b;</span></span><br><span class="line">                    <span class="comment">// 出现重定义错误</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 错误信息如下</span></span><br><span class="line">In file included from B.h:<span class="number">1</span>,</span><br><span class="line">             from main.cpp:<span class="number">2</span>:</span><br><span class="line">A.h:<span class="number">1</span>:<span class="number">5</span>: error: redefinition of <span class="string">&#x27;int a&#x27;</span></span><br><span class="line">    <span class="number">1</span> | <span class="type">int</span> a;</span><br><span class="line">      |     ^</span><br><span class="line">In file included from main.cpp:<span class="number">1</span>:</span><br><span class="line">A.h:<span class="number">1</span>:<span class="number">5</span>: note: <span class="string">&#x27;int a&#x27;</span> previously declared here</span><br><span class="line">    <span class="number">1</span> | <span class="type">int</span> a;</span><br><span class="line">      |     ^</span><br></pre></td></tr></table></figure>
在 <code>MSVC</code> 编译器中，头文件卫士如下：  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br></pre></td></tr></table></figure>
在其他的一些编译器中，常写为这样：  <figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> __HEADER_H__</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> __HEADER_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="场景管理器"><a href="#场景管理器" class="headerlink" title="场景管理器"></a>场景管理器</h3><p>游戏程序是一个巨大的死循环，也是一个巨大的状态机。不同的游戏场景代表着不同的状态，管理着这些状态的“状态机”，在游戏开发中有一个特殊的名字——场景管理器。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-06-22T08:15:12.000Z" title="2024/6/22 16:15:12">2024-06-22</time>发表</span><span class="level-item"><time dateTime="2024-07-09T12:42:38.315Z" title="2024/7/9 20:42:38">2024-07-09</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF/">大数据技术</a><span> / </span><a class="link-muted" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/">数据可视化</a></span><span class="level-item">1 小时读完 (大约11518个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/06/22/DataVisualization-USE-R-ECHARTS/">DataVisualization_USE_R_ECHARTS</a></p><div class="content"><h2 id="📺-数据可视化基础（使用R和ECharts）"><a href="#📺-数据可视化基础（使用R和ECharts）" class="headerlink" title="📺 数据可视化基础（使用R和ECharts）"></a>📺 数据可视化基础（使用<code>R</code>和<code>ECharts</code>）</h2><p>本文会从 <strong><code>R</code></strong> 和 <strong><code>ECharts</code></strong> 两个方面来展开数据可视化技术的一些使用方法。</p>
<p>[TOC]</p>
<h3 id="📊-1-数据可视化概述"><a href="#📊-1-数据可视化概述" class="headerlink" title="📊 1. 数据可视化概述"></a>📊 1. 数据可视化概述</h3><ul>
<li><p>数据可视化概念</p>
<ul>
<li>狭义概念：指的是数据用统计图表方式呈现</li>
<li>广义概念：是数据可视化、信息可视化以及科学可视化等等多个领域的统称</li>
</ul>
</li>
<li><p>数据可视化分类</p>
<ul>
<li>数据可视化</li>
<li>信息可视化</li>
<li>科学可视化</li>
</ul>
</li>
<li><p>⭐*** 数据可视化作用***</p>
<ul>
<li><strong>数据表达</strong>：通过计算机图形图形技术来更加友好地展示数据信息，以方便人们理解和分析数据。</li>
<li><strong>数据操作</strong>：以计算提供的界面、接口和协议等条件为基础完成人与数据的交互需求。</li>
<li><strong>数据分析</strong>：通过计算机获得多维、多源、异构和海量数据所隐含信息的核心手段，它是数据存储、数据转换、数据计算和数据可视化的综合应用。</li>
</ul>
</li>
<li><p>⭐ <em><strong>数据可视化的工具</strong></em></p>
<ul>
<li><code>R</code>、<code>ECharts</code>、<code>D3</code> <strong>…</strong></li>
<li><code>Python</code>、<code>pyecharts</code>、<code>Excel</code> <strong>…</strong></li>
<li>第三方商业工具：<code>FineBI</code>、<code>FineReport</code> <strong>…</strong></li>
</ul>
</li>
<li><p>学习数据可视化需要了解（具备）什么？</p>
<ul>
<li><p>对色彩的感知：了解原色、间色、复色等，并且了解色彩的视觉感受（心理感受），当然也就是了解即可，色彩这种东西天赋更重要一些，知道三原色是啥就行。</p>
<ul>
<li><strong>原色</strong>：红、黄、蓝。</li>
<li>间色：可存在多个间色，当原色之间 <code>1:1</code> 匹配时则为：橙、绿、紫。</li>
<li>复色：可存在多个复色（一定包含三原色），两个间色或一种原色和其对应的间色（黄 + 紫、蓝 + 橙）相混合得到复色。</li>
<li>色彩感受：轻重感、冷暖感、前后感、收缩感 …</li>
</ul>
</li>
<li><p>数据可视化的基本流程</p>
<ul>
<li>数据采集</li>
<li>数据处理</li>
<li>可视化映射</li>
<li>用户感知</li>
</ul>
</li>
<li><p>数据可视化的一些设计技巧</p>
<ul>
<li><p>设计原则：注重用户的视觉体验</p>
</li>
<li><p>设计技巧：</p>
<p>① （颜色）建立视觉层次，用醒目的颜色突出数据，淡化其他元素</p>
<p>② （内容）高亮显示重点内容</p>
<p>③ （跨度）提升不同区域的色阶跨度</p>
<p>④ （场景）借助场景来表现数据指标</p>
<p>⑤ （转换）将抽象的不易理解的数字转换为容易被人感知的图表</p>
<p>⑥ （简洁）尽量让图表简洁</p>
</li>
</ul>
</li>
<li><p>数据可视化的图表类型</p>
<p>在统计图表中每一种类型的图表中都可包含不同的数据可视化图形，如：柱状图、饼图、气泡图、热力图、趋势图、直方图、雷达图、色块图、漏斗图、和弦图、仪表盘、面积图、折线图、密度图 以及 K线图等。</p>
</li>
</ul>
</li>
</ul>
<h3 id="🎫-2-R-R语言快速入门"><a href="#🎫-2-R-R语言快速入门" class="headerlink" title="🎫 2. R - R语言快速入门"></a>🎫 2. <code>R</code> - <code>R</code>语言快速入门</h3><p>参考文献：<a target="_blank" rel="noopener" href="https://bookdown.org/wangminjie/R4DS/">数据科学中的 R 语言 (bookdown.org)</a></p>
<h4 id="2-1-R-语言概述"><a href="#2-1-R-语言概述" class="headerlink" title="2.1 R 语言概述"></a>2.1 R 语言概述</h4><p>R语言是为数学研究工作者设计的一种数学编程语言，主要用于统计分析、绘图、数据挖掘数据可视化。</p>
<p>目前主流的数据分析语言有 <code>R</code>、<code>Python</code>、<code>Matlab</code> 等。</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left"><code>R</code></th>
<th><code>Python</code></th>
<th><code>Matlab</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>语言学习难易程度</strong></td>
<td align="left">入门难度低</td>
<td>入门难度一般</td>
<td>入门难度一般</td>
</tr>
<tr>
<td align="left"><strong>使用场景</strong></td>
<td align="left">数据分析、数据挖掘、机器学习、数据可视化等。</td>
<td>数据分析、机器学习、矩阵运算、科学数据可视化、数字图像处理、Web应用、网络爬虫、系统运维等。</td>
<td>矩阵计算、数值分析、科学数据可视化、机器学习、符号计算、数字图像处理、数字信号处理、仿真模拟等。</td>
</tr>
<tr>
<td align="left"><strong>第三方支持</strong></td>
<td align="left">拥有大量的 <code>Packages</code>，能够调用 <code>C</code>、<code>C++</code>、<code>Fortran</code>、<code>Java</code>等其他程序语言。</td>
<td>拥有大量的第三方库，能够简便地调用<code>C</code>、<code>C++</code>、<code>Fortran</code>、<code>Java</code>等其他程序语言。</td>
<td>拥有大量专业的工具箱，在新版本中加入了对<code>C</code>、<code>C++</code>，<code>Java</code>的支持。</td>
</tr>
<tr>
<td align="left"><strong>流行领域</strong></td>
<td align="left">工业界 ≈ 学术界</td>
<td>工业界 ＞ 学术界</td>
<td>工业界 ≤ 学术界</td>
</tr>
<tr>
<td align="left"><strong>软件成本</strong></td>
<td align="left">开源免费</td>
<td>开源免费</td>
<td>商业收费</td>
</tr>
</tbody></table>
<h4 id="2-2-R-语言中包的概念和使用"><a href="#2-2-R-语言中包的概念和使用" class="headerlink" title="2.2 R 语言中包的概念和使用"></a>2.2 R 语言中包的概念和使用</h4><ul>
<li><p>软件包和软件库</p>
<ul>
<li><p>软件包：<code>R</code> 中的包是 <code>R</code> 函数、数据、预编译代码以一种定义完善的格式组成的集合。</p>
</li>
<li><p>软件库：软件库指的是一个包含了若干个包的目录。你可以拥有一个系统级别的软件库，也可以为每个用户单独设立一个软件库。</p>
</li>
<li><p><code>R</code> 自带了一系列默认包（包括 <code>base</code>、<code>datasets</code>、<code>utils</code>、<code>grDevices</code>、<code>graphics</code>、<code>stats</code>以及<code>methods</code>），它们提供了种类繁多的默认函数和数据集。</p>
<ul>
<li><code>base</code>：包含基础的 <code>R</code> 函数</li>
<li><code>database</code>：自带的数据包，里面的数据结构包括矩阵、向量、数据框等</li>
<li><code>utils</code>：工具函数包</li>
<li><code>grDevices</code>：基础绘图工具包，提供调整图形颜色和字体的功能，可用于配色</li>
<li><code>graphics</code>：基础绘图工具包</li>
<li><code>stats</code>：统计函数的扩展包</li>
<li><code>methods</code>：<code>R</code> 对象和其他编程工具定义方法和类比的扩展包</li>
</ul>
</li>
</ul>
</li>
<li><p>包的相关操作</p>
<ul>
<li>查看包的安装路径：<code>.libPaths()</code></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> .libPaths<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;D:/R/R-4.3.3/library&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>查看已安装的包：<code>library()</code></li>
<li>查看编译环境下已载入的包的列表：<code>search()</code></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> search<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;.GlobalEnv&quot;</span>        <span class="string">&quot;tools:rstudio&quot;</span>     <span class="string">&quot;package:stats&quot;</span>     <span class="string">&quot;package:graphics&quot;</span>  <span class="string">&quot;package:grDevices&quot;</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">6</span><span class="punctuation">]</span> <span class="string">&quot;package:utils&quot;</span>     <span class="string">&quot;package:datasets&quot;</span>  <span class="string">&quot;package:methods&quot;</span>   <span class="string">&quot;Autoloads&quot;</span>         <span class="string">&quot;package:base&quot;</span>   </span><br></pre></td></tr></table></figure>

<ul>
<li><p>下载包：</p>
<ul>
<li><p>通过 <strong>CRAN (The Comprehensive R Archive Network)</strong> 下载。<strong>CRAN</strong> 是 R 语言的综合档案网络。用户可以从 CRAN 上下载并安装各种第三方包来扩展 R 语言的功能。</p>
<p>① 指定包名进行安装：<code>install.packages(&quot;PackageName&quot;)</code></p>
<p>② 使用图形界面安装：<code>install.packages()</code> </p>
</li>
<li><p>手动安装：<a target="_blank" rel="noopener" href="https://cran.r-project.org/web/packages/XML/index.html">https://cran.r-project.org/web/packages/XML/index.html</a></p>
</li>
<li><p>使用 <code>RStudio</code> 安装</p>
</li>
</ul>
</li>
<li><p>包的卸载：<code>remove.packages(&quot;PackageName&quot;)</code></p>
</li>
<li><p>包的载入：<code>library(&quot;PackageName&quot;)</code></p>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> library<span class="punctuation">(</span><span class="string">&quot;XML&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> search<span class="punctuation">(</span><span class="punctuation">)</span>		<span class="comment"># 可以看到 &quot;package:XML&quot; 已经被加载进来了</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;.GlobalEnv&quot;</span>        <span class="string">&quot;package:XML&quot;</span>       <span class="string">&quot;tools:rstudio&quot;</span>     <span class="string">&quot;package:stats&quot;</span>     <span class="string">&quot;package:graphics&quot;</span> </span><br><span class="line"> <span class="punctuation">[</span><span class="number">6</span><span class="punctuation">]</span> <span class="string">&quot;package:grDevices&quot;</span> <span class="string">&quot;package:utils&quot;</span>     <span class="string">&quot;package:datasets&quot;</span>  <span class="string">&quot;package:methods&quot;</span>   <span class="string">&quot;Autoloads&quot;</span>        </span><br><span class="line"><span class="punctuation">[</span><span class="number">11</span><span class="punctuation">]</span> <span class="string">&quot;package:base&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>包的取消载入：<code>detach(&quot;package:PackageName&quot;, unload = True)</code></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> detach<span class="punctuation">(</span><span class="string">&quot;package:XML&quot;</span><span class="punctuation">,</span> unload <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> search<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;.GlobalEnv&quot;</span>        <span class="string">&quot;tools:rstudio&quot;</span>     <span class="string">&quot;package:stats&quot;</span>     <span class="string">&quot;package:graphics&quot;</span>  <span class="string">&quot;package:grDevices&quot;</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">6</span><span class="punctuation">]</span> <span class="string">&quot;package:utils&quot;</span>     <span class="string">&quot;package:datasets&quot;</span>  <span class="string">&quot;package:methods&quot;</span>   <span class="string">&quot;Autoloads&quot;</span>         <span class="string">&quot;package:base&quot;</span>     </span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-3-R-语言的工作空间的概念和使用"><a href="#2-3-R-语言的工作空间的概念和使用" class="headerlink" title="2.3  R 语言的工作空间的概念和使用"></a>2.3  R 语言的工作空间的概念和使用</h4><ul>
<li>概念：<strong>工作空间(Work Space)</strong> 就是当前 R 的工作环境，它储存着所有用户定义的对象（向量、矩阵、函数、数据框、列表）。在一个 R 会话结束时，用户可以将当前工作空间保存到一个镜像中，并在下次启动 R 时自动载入它。</li>
<li>设置工作目录：<code>setwd()</code> 或使用 <code>RStudio</code> 可视化窗口进行设置（<em><strong>Session</strong></em> → <em><strong>Set Working Directory</strong></em>）</li>
<li>获取工作目录：<code>getwd()</code></li>
</ul>
<h4 id="2-4-R-语言的六大原子数据类型"><a href="#2-4-R-语言的六大原子数据类型" class="headerlink" title="2.4 R 语言的六大原子数据类型"></a>2.4 R 语言的六大原子数据类型</h4><ul>
<li><strong>数字型(Numeric)</strong></li>
<li><strong>逻辑型(Logical)</strong></li>
<li><strong>整型(Integer)</strong></li>
<li><strong>字符型(Character)</strong></li>
<li><strong>复合型(Complex)</strong></li>
<li><strong>原子型(Raw)</strong></li>
</ul>
<p>对于不同原子数据类型可以按照如下方式定义：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 数值型(Numeric)</span></span><br><span class="line"><span class="operator">&gt;</span> varNumeric <span class="operator">=</span> <span class="number">12.5</span></span><br><span class="line"><span class="operator">&gt;</span> varNumeric</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">12.5</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 逻辑型(Logical)</span></span><br><span class="line"><span class="operator">&gt;</span> varLogical <span class="operator">=</span> <span class="literal">TRUE</span></span><br><span class="line"><span class="operator">&gt;</span> varLogical</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">TRUE</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 整型(Integer)</span></span><br><span class="line"><span class="operator">&gt;</span> varInteger <span class="operator">=</span> <span class="number">25L</span></span><br><span class="line"><span class="operator">&gt;</span> varInteger</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">25</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 字符型(Character)</span></span><br><span class="line"><span class="operator">&gt;</span> varCharacter <span class="operator">=</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> varCharacter</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 复合型(Complex)</span></span><br><span class="line"><span class="operator">&gt;</span> varComplex <span class="operator">=</span> <span class="number">2</span> <span class="operator">+</span> <span class="number">3i</span></span><br><span class="line"><span class="operator">&gt;</span> varComplex</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">2</span><span class="operator">+</span><span class="number">3i</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 原子型(Raw)</span></span><br><span class="line"><span class="operator">&gt;</span> varRaw <span class="operator">=</span> charToRaw<span class="punctuation">(</span><span class="string">&#x27;Hello&#x27;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> varRaw</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">48</span> <span class="number">65</span> <span class="number">6</span><span class="built_in">c</span> <span class="number">6</span><span class="built_in">c</span> <span class="number">6</span>f</span><br></pre></td></tr></table></figure>

<h4 id="2-5-R-语言变量使用"><a href="#2-5-R-语言变量使用" class="headerlink" title="2.5 R 语言变量使用"></a>2.5 R 语言变量使用</h4><ul>
<li>定义变量并赋值：使用 <code>&lt;-</code>、<code>=</code>、<code>-&gt;</code></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> var1 <span class="operator">=</span> <span class="number">12.5</span>		<span class="comment"># 定义 var1, 并赋值为 12.5</span></span><br><span class="line"><span class="operator">&gt;</span> print<span class="punctuation">(</span>var1<span class="punctuation">)</span>		<span class="comment"># 输出 var1</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">12.5</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> var2 <span class="operator">&lt;-</span> 13		<span class="comment"># 定义 var2, 并赋值为 13(由右向左)</span></span><br><span class="line"><span class="operator">&gt;</span> print<span class="punctuation">(</span>var2<span class="punctuation">)</span>		<span class="comment"># 输出 var2</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">13</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">14</span> <span class="operator">-&gt;</span> var3		<span class="comment"># 定义 var3, 并赋值为 14(由左向右)</span></span><br><span class="line"><span class="operator">&gt;</span> print<span class="punctuation">(</span>var3<span class="punctuation">)</span>		<span class="comment"># 输出 var3</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">14</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> var2 <span class="operator">-&gt;</span> var3</span><br><span class="line"><span class="operator">&gt;</span> print<span class="punctuation">(</span>var3<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">13</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>变量的打印：<code>print()</code> 或 <code>cat()</code></p>
<p><code>print()</code> 和 <code>cat()</code> 都可以向控制台输出文字，区别在于 <code>print()</code> 有返回值，其会返回输出的内容，无法使用转义字符，当使用转义字符时，会直接输出转义字符；而 <code>cat()</code> 没有返回值，可以使用转义字符。</p>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> varX <span class="operator">=</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> varY <span class="operator">=</span> <span class="string">&quot;Hello World\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> printX <span class="operator">&lt;-</span> print<span class="punctuation">(</span>varX<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> catX   <span class="operator">&lt;-</span> cat<span class="punctuation">(</span>varX<span class="punctuation">,</span> <span class="string">&quot;\n&quot;</span><span class="punctuation">)</span>	<span class="comment"># 如果不添加转义字符会无法换行</span></span><br><span class="line">Hello World </span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> printY <span class="operator">&lt;-</span> print<span class="punctuation">(</span>varY<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;Hello World\n&quot;</span>			<span class="comment"># 使用 print() 直接将转义字符进行了输出</span></span><br><span class="line"><span class="operator">&gt;</span> catY   <span class="operator">&lt;-</span> cat<span class="punctuation">(</span>varY<span class="punctuation">)</span></span><br><span class="line">Hello World					<span class="comment"># 使用 cat() 没有将转义字符直接输出, 而是转化成了响应的格式, 如&quot;换行&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> print<span class="punctuation">(</span>printX<span class="punctuation">)</span>				<span class="comment"># print() 有返回值</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;Hello World&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> print<span class="punctuation">(</span>catX<span class="punctuation">)</span>				<span class="comment"># cat() 没有返回值</span></span><br><span class="line"><span class="literal">NULL</span></span><br></pre></td></tr></table></figure>

<ul>
<li>变量的查看：<code>ls()</code></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> ls<span class="punctuation">(</span><span class="punctuation">)</span>						<span class="comment"># 输出所有变量</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;catX&quot;</span>     <span class="string">&quot;catY&quot;</span>     <span class="string">&quot;cyl.f&quot;</span>    <span class="string">&quot;printX&quot;</span>   <span class="string">&quot;printY&quot;</span>   <span class="string">&quot;score&quot;</span>    <span class="string">&quot;tempdens&quot;</span> <span class="string">&quot;var1&quot;</span>     <span class="string">&quot;var2&quot;</span>     <span class="string">&quot;var3&quot;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">11</span><span class="punctuation">]</span> <span class="string">&quot;varX&quot;</span>     <span class="string">&quot;varY&quot;</span>    </span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> ls<span class="punctuation">(</span>pattern <span class="operator">=</span> <span class="string">&quot;var&quot;</span><span class="punctuation">)</span> 		<span class="comment"># 模式匹配部分变量, 包含 &quot;var&quot; 的</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;var1&quot;</span> <span class="string">&quot;var2&quot;</span> <span class="string">&quot;var3&quot;</span> <span class="string">&quot;varX&quot;</span> <span class="string">&quot;varY&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> ls<span class="punctuation">(</span>pattern <span class="operator">=</span> <span class="string">&quot;*&quot;</span><span class="punctuation">)</span>			<span class="comment"># 模式匹配部分变量, 使用通配符</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;catX&quot;</span>     <span class="string">&quot;catY&quot;</span>     <span class="string">&quot;cyl.f&quot;</span>    <span class="string">&quot;printX&quot;</span>   <span class="string">&quot;printY&quot;</span>   <span class="string">&quot;score&quot;</span>    <span class="string">&quot;tempdens&quot;</span> <span class="string">&quot;var1&quot;</span>     <span class="string">&quot;var2&quot;</span>     <span class="string">&quot;var3&quot;</span>    </span><br><span class="line"><span class="punctuation">[</span><span class="number">11</span><span class="punctuation">]</span> <span class="string">&quot;varX&quot;</span>     <span class="string">&quot;varY&quot;</span>    </span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> ls<span class="punctuation">(</span>pattern <span class="operator">=</span> <span class="string">&quot;2&quot;</span><span class="punctuation">)</span>			<span class="comment"># 模式匹配部分变量, 包含 &quot;2&quot; 的</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;var2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> ls<span class="punctuation">(</span>all.names <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span>		<span class="comment"># </span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;.Random.seed&quot;</span> <span class="string">&quot;catX&quot;</span>         <span class="string">&quot;catY&quot;</span>         <span class="string">&quot;cyl.f&quot;</span>        <span class="string">&quot;printX&quot;</span>       <span class="string">&quot;printY&quot;</span>       <span class="string">&quot;score&quot;</span>       </span><br><span class="line"> <span class="punctuation">[</span><span class="number">8</span><span class="punctuation">]</span> <span class="string">&quot;tempdens&quot;</span>     <span class="string">&quot;var1&quot;</span>         <span class="string">&quot;var2&quot;</span>         <span class="string">&quot;var3&quot;</span>         <span class="string">&quot;varX&quot;</span>         <span class="string">&quot;varY&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>变量的删除：<code>rm()</code></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> rm<span class="punctuation">(</span><span class="string">&quot;var1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;var2&quot;</span><span class="punctuation">)</span>				<span class="comment"># 删除 &quot;var1&quot; 和 &quot;var2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> ls<span class="punctuation">(</span>pattern <span class="operator">=</span> <span class="string">&quot;var&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span>	<span class="comment"># 删除 匹配到 &quot;var&quot; 的变量, list 是一个可以指定的参数</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> rmlist <span class="operator">=</span> ls<span class="punctuation">(</span>pattern <span class="operator">=</span> <span class="string">&quot;X&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> rmlist</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;catX&quot;</span>   <span class="string">&quot;printX&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> rm<span class="punctuation">(</span><span class="built_in">list</span> <span class="operator">=</span> rmlist<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>[⭐] 变量的数据类型判别和转换</p>
<ul>
<li>判别：<code>is.XXX()</code>，返回 <code>True/False</code></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 数值型(Numeric)</span></span><br><span class="line"><span class="operator">&gt;</span> varNumeric <span class="operator">=</span> <span class="number">12.5</span></span><br><span class="line"><span class="operator">&gt;</span> varNumeric</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">12.5</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">is.numeric</span><span class="punctuation">(</span>varNumeric<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">TRUE</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">is.logical</span><span class="punctuation">(</span>varNumeric<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">FALSE</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">is.integer</span><span class="punctuation">(</span>varNumeric<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">FALSE</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">is.character</span><span class="punctuation">(</span>varNumeric<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">FALSE</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">is.complex</span><span class="punctuation">(</span>varNumeric<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">FALSE</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">is.raw</span><span class="punctuation">(</span>varNumeric<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">FALSE</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 逻辑型(Logical)</span></span><br><span class="line"><span class="operator">&gt;</span> varLogical <span class="operator">=</span> <span class="literal">TRUE</span></span><br><span class="line"><span class="operator">&gt;</span> varLogical</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">TRUE</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">is.numeric</span><span class="punctuation">(</span>varLogical<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">FALSE</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">is.logical</span><span class="punctuation">(</span>varLogical<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">TRUE</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">is.integer</span><span class="punctuation">(</span>varLogical<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">FALSE</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">is.character</span><span class="punctuation">(</span>varLogical<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">FALSE</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">is.complex</span><span class="punctuation">(</span>varLogical<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">FALSE</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">is.raw</span><span class="punctuation">(</span>varLogical<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">FALSE</span></span><br></pre></td></tr></table></figure>

<ul>
<li>转换：<code>as.XXX()</code></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 变量类型转换</span></span><br><span class="line"><span class="operator">&gt;</span> varNumToChar <span class="operator">&lt;-</span> <span class="built_in">as.character</span><span class="punctuation">(</span>varNumeric<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> varNumToChar</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;12.5&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">is.numeric</span><span class="punctuation">(</span>varNumToChar<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">FALSE</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">is.logical</span><span class="punctuation">(</span>varNumToChar<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">FALSE</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">is.integer</span><span class="punctuation">(</span>varNumToChar<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">FALSE</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">is.character</span><span class="punctuation">(</span>varNumToChar<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">TRUE</span>	<span class="operator">&lt;-</span><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span><span class="operator">-</span> 可以看到已经转换成了字符型</span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">is.complex</span><span class="punctuation">(</span>varNumToChar<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">FALSE</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">is.raw</span><span class="punctuation">(</span>varNumToChar<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">FALSE</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>[⭐] 变量的数据类型查看</p>
<ul>
<li><code>mode()</code>：查看数据元素类型</li>
<li><code>typeof()</code>：查看数据元素类型，基本等同于 <code>mode()</code> ，比 <code>mode()</code> 更为详细</li>
<li><code>class()</code>：查看数据结构，<code>vector</code>、<code>matrix</code>、<code>array</code>、<code>dataframe</code>、<code>list</code></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 查看变量类型</span></span><br><span class="line"><span class="operator">&gt;</span> mode<span class="punctuation">(</span>varNumeric<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;numeric&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> typeof<span class="punctuation">(</span>varNumeric<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;double&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">class</span><span class="punctuation">(</span>varNumeric<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;numeric&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> mode<span class="punctuation">(</span>varLogical<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;logical&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> typeof<span class="punctuation">(</span>varLogical<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;logical&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">class</span><span class="punctuation">(</span>varLogical<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;logical&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> mode<span class="punctuation">(</span>varInteger<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;numeric&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> typeof<span class="punctuation">(</span>varInteger<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">class</span><span class="punctuation">(</span>varInteger<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> mode<span class="punctuation">(</span>varCharacter<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;character&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> typeof<span class="punctuation">(</span>varCharacter<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;character&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">class</span><span class="punctuation">(</span>varCharacter<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;character&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> mode<span class="punctuation">(</span>varComplex<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;complex&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> typeof<span class="punctuation">(</span>varComplex<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;complex&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">class</span><span class="punctuation">(</span>varComplex<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;complex&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> mode<span class="punctuation">(</span>varRaw<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;raw&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> typeof<span class="punctuation">(</span>varRaw<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;raw&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">class</span><span class="punctuation">(</span>varRaw<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;raw&quot;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>[⭐] 字符串的应用</p>
<ul>
<li>R语言中的文本，或者原子数据类型中 <code>Character</code>。在 R 语言中的单引号<code>&#39; &#39;</code> 或 双引号<code>&quot; &quot;</code> 中写入的任何值都被视为字符串。在字符串构造中应用的规则：<ul>
<li>在字符串的开头和结尾的引号应该是两个双引号或两个单引号。它们不能被混合。</li>
<li>双引号可以插入到以单引号开头和结尾的字符串中</li>
<li>单引号可以插入以双引号开头和结尾的字符串。</li>
<li>双引号不能插入以双引号开头和结尾的字符串。</li>
<li>单引号不能插入以单引号开头和结尾的字符串。</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="2-7-R-语言的运算符的概念和使用"><a href="#2-7-R-语言的运算符的概念和使用" class="headerlink" title="2.7 R 语言的运算符的概念和使用"></a>2.7 R 语言的运算符的概念和使用</h4><ul>
<li><p>运算符的概念</p>
</li>
<li><p>算数运算符</p>
<ul>
<li><code>+</code>加、<code>-</code>减、<code>*</code>乘、<code>/</code>除</li>
<li><code>%%</code> 整除取余</li>
<li><code>%/%</code> 整除</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 相除</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">6</span> <span class="operator">/</span> <span class="number">4</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">1.5</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># %% 整除取余</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">6</span> <span class="operator">%%</span> <span class="number">4</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># %/% 整除</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="number">6</span> <span class="operator">%/%</span> <span class="number">4</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>关系运算符</p>
<ul>
<li><code>&lt;</code> 小于、<code>&gt;</code> 大于、<code>=</code> 等于</li>
<li><code>&lt;=</code>小于等于、<code>&gt;=</code> 大于等于</li>
<li><code>!=</code> 不等于</li>
</ul>
</li>
<li><p>逻辑运算符</p>
<ul>
<li><code>&amp;</code></li>
<li><code>|</code></li>
<li><code>&amp;&amp;</code></li>
<li><code>||</code></li>
</ul>
<p><strong><code>&amp;&amp;</code>和<code>||</code>为值逻辑，<code>&amp;</code>和<code>|</code>为位逻辑</strong><br>说人话就是，<code>&amp;&amp;</code> 和 <code>||</code>是讲两个操作目的值做逻辑运算，无论操作对象是向量还是标量，返回值都是一个逻辑值，（NOW）<code>&amp;&amp;</code> 和 <code>||</code> 运算符只接受长度为 1 的逻辑值作为参数；而 <code>&amp;</code> 和 <code>|</code> 是讲两个对象按位比较，其返回值的长度与对象是标量还是向量有关。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 逻辑运算符</span></span><br><span class="line"><span class="operator">&gt;</span> v <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="literal">TRUE</span><span class="punctuation">,</span>  <span class="number">2</span><span class="operator">+</span><span class="number">3i</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> t <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="literal">FALSE</span><span class="punctuation">,</span> <span class="number">2</span><span class="operator">+</span><span class="number">3i</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> print<span class="punctuation">(</span>v<span class="operator">&amp;</span>t<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span>  <span class="literal">TRUE</span>  <span class="literal">TRUE</span> <span class="literal">FALSE</span>  <span class="literal">TRUE</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> v <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="literal">TRUE</span><span class="punctuation">,</span> <span class="number">2</span><span class="operator">+</span><span class="number">2i</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> t <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="literal">TRUE</span><span class="punctuation">,</span> <span class="number">2</span><span class="operator">+</span><span class="number">3i</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> print<span class="punctuation">(</span>v <span class="operator">&amp;&amp;</span> t<span class="punctuation">)</span></span><br><span class="line">Error <span class="keyword">in</span> v <span class="operator">&amp;&amp;</span> t <span class="operator">:</span> <span class="string">&#x27;length = 4&#x27;</span> <span class="keyword">in</span> coercion to <span class="string">&#x27;logical(1)&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="literal">TRUE</span> <span class="operator">&amp;&amp;</span> <span class="literal">TRUE</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">TRUE</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="literal">TRUE</span> <span class="operator">&amp;&amp;</span> <span class="literal">FALSE</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">FALSE</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="literal">FALSE</span> <span class="operator">&amp;&amp;</span> <span class="literal">TRUE</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">FALSE</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="literal">FALSE</span> <span class="operator">&amp;&amp;</span> <span class="literal">FALSE</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">FALSE</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>赋值运算符</p>
<ul>
<li><code>&lt;-</code></li>
<li><code>=</code></li>
<li><code>-&gt;</code></li>
<li><code>&lt;&lt;-</code></li>
<li><code>-&gt;&gt;</code></li>
</ul>
<p><code>&lt;−</code> 或 <code>=</code> 或 <code>&lt;&lt;−</code> 运算符： 称为左赋值。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 赋值运算符</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 左赋值</span></span><br><span class="line"><span class="operator">&gt;</span> v1 <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="literal">TRUE</span><span class="punctuation">,</span><span class="number">2</span><span class="operator">+</span><span class="number">3i</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> v2 <span class="operator">&lt;&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="literal">TRUE</span><span class="punctuation">,</span><span class="number">2</span><span class="operator">+</span><span class="number">3i</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> v3 <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="literal">TRUE</span><span class="punctuation">,</span><span class="number">2</span><span class="operator">+</span><span class="number">3i</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> print<span class="punctuation">(</span>v1<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">3</span><span class="operator">+</span><span class="number">0i</span> <span class="number">1</span><span class="operator">+</span><span class="number">0i</span> <span class="number">1</span><span class="operator">+</span><span class="number">0i</span> <span class="number">2</span><span class="operator">+</span><span class="number">3i</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> print<span class="punctuation">(</span>v2<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">3</span><span class="operator">+</span><span class="number">0i</span> <span class="number">1</span><span class="operator">+</span><span class="number">0i</span> <span class="number">1</span><span class="operator">+</span><span class="number">0i</span> <span class="number">2</span><span class="operator">+</span><span class="number">3i</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> print<span class="punctuation">(</span>v3<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">3</span><span class="operator">+</span><span class="number">0i</span> <span class="number">1</span><span class="operator">+</span><span class="number">0i</span> <span class="number">1</span><span class="operator">+</span><span class="number">0i</span> <span class="number">2</span><span class="operator">+</span><span class="number">3i</span></span><br></pre></td></tr></table></figure>

<p><code>-&gt;</code> 或 <code>-&gt;&gt;</code> 运算符：称为右赋值。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 右赋值</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="literal">TRUE</span><span class="punctuation">,</span><span class="number">2</span><span class="operator">+</span><span class="number">3i</span><span class="punctuation">)</span> <span class="operator">-&gt;</span> v1</span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="literal">TRUE</span><span class="punctuation">,</span><span class="number">2</span><span class="operator">+</span><span class="number">3i</span><span class="punctuation">)</span> <span class="operator">-&gt;&gt;</span> v2 </span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> print<span class="punctuation">(</span>v1<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">3</span><span class="operator">+</span><span class="number">0i</span> <span class="number">1</span><span class="operator">+</span><span class="number">0i</span> <span class="number">1</span><span class="operator">+</span><span class="number">0i</span> <span class="number">2</span><span class="operator">+</span><span class="number">3i</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> print<span class="punctuation">(</span>v2<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">3</span><span class="operator">+</span><span class="number">0i</span> <span class="number">1</span><span class="operator">+</span><span class="number">0i</span> <span class="number">1</span><span class="operator">+</span><span class="number">0i</span> <span class="number">2</span><span class="operator">+</span><span class="number">3i</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>其他运算符</p>
<ul>
<li><code>:</code> 为向量创建数字序列。</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> v <span class="operator">&lt;-</span> 2<span class="operator">:</span><span class="number">8</span></span><br><span class="line"><span class="operator">&gt;</span> print<span class="punctuation">(</span>v<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>%in%</code> 用于确定元素是否属于向量。</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> v1 <span class="operator">&lt;-</span> 8</span><br><span class="line"><span class="operator">&gt;</span> v2 <span class="operator">&lt;-</span> 12</span><br><span class="line"><span class="operator">&gt;</span> t <span class="operator">&lt;-</span> 1<span class="operator">:</span><span class="number">10</span></span><br><span class="line"><span class="operator">&gt;</span> print<span class="punctuation">(</span>v1 <span class="operator">%in%</span> t<span class="punctuation">)</span>	<span class="comment">#  8 是否再 1~10 中</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">TRUE</span></span><br><span class="line"><span class="operator">&gt;</span> print<span class="punctuation">(</span>v2 <span class="operator">%in%</span> t<span class="punctuation">)</span>	<span class="comment"># 12 是否再 1~10 中</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">FALSE</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>%*%</code> 用于求两个向量的内积，也称为点乘</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> M <span class="operator">=</span> matrix<span class="punctuation">(</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span><span class="number">6</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">10</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">)</span><span class="punctuation">,</span> nrow <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> ncol <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> byrow <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># M</span></span><br><span class="line"><span class="number">2</span><span class="punctuation">,</span>  <span class="number">6</span><span class="punctuation">,</span> <span class="number">5</span></span><br><span class="line"><span class="number">1</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># t(M)</span></span><br><span class="line"><span class="number">2</span><span class="punctuation">,</span>  <span class="number">1</span></span><br><span class="line"><span class="number">6</span><span class="punctuation">,</span> <span class="number">10</span></span><br><span class="line"><span class="number">5</span><span class="punctuation">,</span>  <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># M %*% t(M)</span></span><br><span class="line"><span class="number">2</span><span class="operator">*</span><span class="number">2</span> <span class="operator">+</span>  <span class="number">6</span><span class="operator">*</span><span class="number">6</span> <span class="operator">+</span> <span class="number">5</span><span class="operator">*</span><span class="number">5</span><span class="punctuation">,</span> <span class="number">1</span><span class="operator">*</span><span class="number">2</span> <span class="operator">+</span> <span class="number">10</span><span class="operator">*</span> <span class="number">6</span> <span class="operator">+</span> <span class="number">4</span><span class="operator">*</span><span class="number">5</span></span><br><span class="line"><span class="number">2</span><span class="operator">*</span><span class="number">1</span> <span class="operator">+</span> <span class="number">10</span><span class="operator">*</span><span class="number">6</span> <span class="operator">+</span> <span class="number">4</span><span class="operator">*</span><span class="number">5</span><span class="punctuation">,</span> <span class="number">1</span><span class="operator">*</span><span class="number">1</span> <span class="operator">+</span> <span class="number">10</span><span class="operator">*</span><span class="number">10</span> <span class="operator">+</span> <span class="number">4</span><span class="operator">*</span><span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> t <span class="operator">=</span> M <span class="operator">%*%</span> t<span class="punctuation">(</span>M<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> print<span class="punctuation">(</span>t<span class="punctuation">)</span></span><br><span class="line">     <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="punctuation">]</span>   <span class="number">65</span>   <span class="number">82</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span>   <span class="number">82</span>  <span class="number">117</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment">#===================================================================#</span></span><br><span class="line"><span class="operator">&gt;</span> M <span class="operator">=</span> matrix<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span> <span class="number">6</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">,</span> nrow <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span>ncol <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> byrow <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> N <span class="operator">=</span> matrix<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">,</span> <span class="number">6</span><span class="punctuation">)</span><span class="punctuation">,</span> nrow <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> ncol <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> byrow <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> t <span class="operator">=</span> M <span class="operator">%*%</span> N</span><br><span class="line"><span class="operator">&gt;</span> print<span class="punctuation">(</span>t<span class="punctuation">)</span></span><br><span class="line">     <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="punctuation">]</span>   <span class="number">45</span>   <span class="number">58</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span>   <span class="number">51</span>   <span class="number">66</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="2-8-R-语言的六大数据对象"><a href="#2-8-R-语言的六大数据对象" class="headerlink" title="2.8 R 语言的六大数据对象"></a>2.8 R 语言的六大数据对象</h4><p>R 语言有六种基本的数据结构（数据对象）：向量<code>vector</code>、列表<code>list</code>、矩阵<code>matrix</code>、数组<code>array</code>、数据框<code>data.frame</code> 和 因子<code>factor</code> 类型。</p>
<h5 id="2-8-1-向量-vector"><a href="#2-8-1-向量-vector" class="headerlink" title="2.8.1 向量 vector"></a>2.8.1 向量 <code>vector</code></h5><ul>
<li><p>概念：向量是最基本的 R 语言数据对象，向量的元素支持六种原子数据类型，即逻辑，整数，双精度，复合，字符和原型。</p>
</li>
<li><p>特征：一个向量的所有元素都必须属于<strong>相同的类型</strong>。如果不是，R将强制执行类型转换。</p>
</li>
<li><p>创建向量：<code>c()</code>、<code>seq()</code>、<code>rep()</code></p>
<ul>
<li><code>c()</code> 这里的<code>c</code>就是 <em>combine</em> 或 <em>concatenate</em> 的意思，它要求元素之间用<strong>英文的逗号</strong>分隔，且元素的数据类型是统一的，比如都是数值。<code>c()</code> 函数把一组数据聚合到了一起，就构成了一个<strong>向量</strong>。</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 创建向量</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 使用 c()</span></span><br><span class="line"><span class="operator">&gt;</span> low      <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> high     <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">4</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">,</span> <span class="number">6</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> sequence <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span>low<span class="punctuation">,</span> high<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> sequence</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span> <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 给变量命名</span></span><br><span class="line"><span class="operator">&gt;</span> x <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;a&#x27;</span> <span class="operator">=</span> <span class="number">5</span><span class="punctuation">,</span> <span class="string">&#x27;b&#x27;</span> <span class="operator">=</span> <span class="number">6</span><span class="punctuation">,</span> <span class="string">&#x27;c&#x27;</span> <span class="operator">=</span> <span class="number">7</span><span class="punctuation">,</span> <span class="string">&#x27;d&#x27;</span> <span class="operator">=</span> <span class="number">8</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> x</span><br><span class="line">a b <span class="built_in">c</span> d </span><br><span class="line"><span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> </span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> x <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span> <span class="number">6</span><span class="punctuation">,</span> <span class="number">7</span><span class="punctuation">,</span> <span class="number">8</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">names</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&#x27;a&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;b&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;c&#x27;</span><span class="punctuation">,</span> <span class="string">&#x27;d&#x27;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> x</span><br><span class="line">a b <span class="built_in">c</span> d </span><br><span class="line"><span class="number">5</span> <span class="number">6</span> <span class="number">7</span> <span class="number">8</span> </span><br></pre></td></tr></table></figure>

<p>如果向量元素很多，用手工一个个去输入，那就成了体力活，不现实。<strong>在特定情况下</strong>，有几种偷懒方法:</p>
<ul>
<li><code>seq()</code> 函数可以生成等差数列，<code>from</code> 参数指定数列的起始值，<code>to</code> 参数指定数列的终止值，<code>by</code> 参数指定数值的间距。</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 使用 seq()</span></span><br><span class="line"><span class="operator">&gt;</span> s1 <span class="operator">&lt;-</span> seq<span class="punctuation">(</span>from <span class="operator">=</span> <span class="number">0</span><span class="punctuation">,</span> to <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> by <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> s1</span><br><span class="line"> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span>  <span class="number">0.0</span>  <span class="number">0.5</span>  <span class="number">1.0</span>  <span class="number">1.5</span>  <span class="number">2.0</span>  <span class="number">2.5</span>  <span class="number">3.0</span>  <span class="number">3.5</span>  <span class="number">4.0</span>  <span class="number">4.5</span>  <span class="number">5.0</span>  <span class="number">5.5</span>  <span class="number">6.0</span>  <span class="number">6.5</span>  <span class="number">7.0</span>  <span class="number">7.5</span>  <span class="number">8.0</span>  <span class="number">8.5</span>  <span class="number">9.0</span>  <span class="number">9.5</span> <span class="number">10.0</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>rep()</code> 是 <em>repeat</em>（重复）的意思，可以用于产生重复出现的数字序列：<code>x</code> 用于重复的向量，<code>times</code> 参数可以指定要生成的个数，<code>each</code> 参数可以指定每个元素重复的次数。</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> s2 <span class="operator">&lt;-</span> <span class="built_in">rep</span><span class="punctuation">(</span>x <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> times <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> s2</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span> <span class="number">0</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> s3 <span class="operator">&lt;-</span> <span class="built_in">rep</span><span class="punctuation">(</span>x <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> each <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> s3</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> s4 <span class="operator">&lt;-</span> <span class="built_in">rep</span><span class="punctuation">(</span>x <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> time <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> each <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> s4</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>向量元素访问</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 定义一个向量</span></span><br><span class="line"><span class="operator">&gt;</span> t <span class="operator">&lt;-</span> seq<span class="punctuation">(</span>from <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> to <span class="operator">=</span> <span class="number">20</span><span class="punctuation">,</span> by <span class="operator">=</span> <span class="number">0.4</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> t</span><br><span class="line"> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">10.0</span> <span class="number">10.4</span> <span class="number">10.8</span> <span class="number">11.2</span> <span class="number">11.6</span> <span class="number">12.0</span> <span class="number">12.4</span> <span class="number">12.8</span> <span class="number">13.2</span> <span class="number">13.6</span> <span class="number">14.0</span> <span class="number">14.4</span> <span class="number">14.8</span> <span class="number">15.2</span> <span class="number">15.6</span> <span class="number">16.0</span> <span class="number">16.4</span> <span class="number">16.8</span> <span class="number">17.2</span> <span class="number">17.6</span> <span class="number">18.0</span> <span class="number">18.4</span> <span class="number">18.8</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">24</span><span class="punctuation">]</span> <span class="number">19.2</span> <span class="number">19.6</span> <span class="number">20.0</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>t[index]</code>：使用这种方式进行访问，<code>index</code> 默认从 1 开始。</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 方式 1</span></span><br><span class="line"><span class="operator">&gt;</span> t<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">10</span></span><br><span class="line"><span class="operator">&gt;</span> t<span class="punctuation">[</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">10.4</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>t[Logic Index]</code>： <code>TRUE</code> 表示读取，<code>FALSE</code> 为不读取。</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 方式 2</span></span><br><span class="line"><span class="operator">&gt;</span> t<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="literal">TRUE</span><span class="punctuation">,</span> <span class="literal">TRUE</span><span class="punctuation">,</span> <span class="literal">FALSE</span><span class="punctuation">,</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">10.0</span> <span class="number">10.4</span> <span class="number">11.2</span> <span class="number">11.6</span> <span class="number">12.0</span> <span class="number">12.8</span> <span class="number">13.2</span> <span class="number">13.6</span> <span class="number">14.4</span> <span class="number">14.8</span> <span class="number">15.2</span> <span class="number">16.0</span> <span class="number">16.4</span> <span class="number">16.8</span> <span class="number">17.6</span> <span class="number">18.0</span> <span class="number">18.4</span> <span class="number">19.2</span> <span class="number">19.6</span> <span class="number">20.0</span></span><br><span class="line"><span class="operator">&gt;</span> t<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">10.0</span> <span class="number">10.4</span> <span class="number">10.8</span> <span class="number">10.0</span></span><br><span class="line"><span class="operator">&gt;</span> t<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">6</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">0</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">12</span> <span class="number">10</span> <span class="number">10</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>t[name]</code>：通过 <code>name</code> 进行访问。</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 方式 3</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">names</span><span class="punctuation">(</span>t<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;v1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;v2&quot;</span><span class="punctuation">,</span> <span class="string">&quot;v3&quot;</span><span class="punctuation">,</span> <span class="string">&quot;v4&quot;</span><span class="punctuation">,</span> <span class="string">&quot;v5&quot;</span><span class="punctuation">,</span> <span class="string">&quot;v6&quot;</span><span class="punctuation">,</span> <span class="string">&quot;v7&quot;</span><span class="punctuation">,</span> <span class="string">&quot;v8&quot;</span><span class="punctuation">,</span> <span class="string">&quot;v9&quot;</span><span class="punctuation">,</span> <span class="string">&quot;v10&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> t</span><br><span class="line">  v1   v2   v3   v4   v5   v6   v7   v8   v9  v10 <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> </span><br><span class="line"><span class="number">10.0</span> <span class="number">10.4</span> <span class="number">10.8</span> <span class="number">11.2</span> <span class="number">11.6</span> <span class="number">12.0</span> <span class="number">12.4</span> <span class="number">12.8</span> <span class="number">13.2</span> <span class="number">13.6</span> <span class="number">14.0</span> <span class="number">14.4</span> <span class="number">14.8</span> <span class="number">15.2</span> <span class="number">15.6</span> <span class="number">16.0</span> <span class="number">16.4</span> <span class="number">16.8</span> <span class="number">17.2</span> <span class="number">17.6</span> <span class="number">18.0</span> <span class="number">18.4</span> <span class="number">18.8</span> </span><br><span class="line"><span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> </span><br><span class="line"><span class="number">19.2</span> <span class="number">19.6</span> <span class="number">20.0</span> </span><br><span class="line"><span class="operator">&gt;</span> t<span class="punctuation">[</span><span class="string">&quot;v1&quot;</span><span class="punctuation">]</span></span><br><span class="line">v1 </span><br><span class="line"><span class="number">10</span> </span><br></pre></td></tr></table></figure>

<ul>
<li><code>t[-index]</code>：索引为负数，则会删除该位置的元素。</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 方式 4</span></span><br><span class="line"><span class="operator">&gt;</span> t</span><br><span class="line">  v1   v2   v3   v4   v5   v6   v7   v8   v9  v10 <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> </span><br><span class="line"><span class="number">10.0</span> <span class="number">10.4</span> <span class="number">10.8</span> <span class="number">11.2</span> <span class="number">11.6</span> <span class="number">12.0</span> <span class="number">12.4</span> <span class="number">12.8</span> <span class="number">13.2</span> <span class="number">13.6</span> <span class="number">14.0</span> <span class="number">14.4</span> <span class="number">14.8</span> <span class="number">15.2</span> <span class="number">15.6</span> <span class="number">16.0</span> <span class="number">16.4</span> <span class="number">16.8</span> <span class="number">17.2</span> <span class="number">17.6</span> <span class="number">18.0</span> <span class="number">18.4</span> <span class="number">18.8</span> </span><br><span class="line"><span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> </span><br><span class="line"><span class="number">19.2</span> <span class="number">19.6</span> <span class="number">20.0</span> </span><br><span class="line"><span class="operator">&gt;</span> t<span class="punctuation">[</span><span class="operator">-</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line">  v2   v3   v4   v5   v6   v7   v8   v9  v10 <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> </span><br><span class="line"><span class="number">10.4</span> <span class="number">10.8</span> <span class="number">11.2</span> <span class="number">11.6</span> <span class="number">12.0</span> <span class="number">12.4</span> <span class="number">12.8</span> <span class="number">13.2</span> <span class="number">13.6</span> <span class="number">14.0</span> <span class="number">14.4</span> <span class="number">14.8</span> <span class="number">15.2</span> <span class="number">15.6</span> <span class="number">16.0</span> <span class="number">16.4</span> <span class="number">16.8</span> <span class="number">17.2</span> <span class="number">17.6</span> <span class="number">18.0</span> <span class="number">18.4</span> <span class="number">18.8</span> <span class="number">19.2</span> </span><br><span class="line"><span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> </span><br><span class="line"><span class="number">19.6</span> <span class="number">20.0</span> </span><br><span class="line"><span class="operator">&gt;</span> t<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="operator">-</span><span class="number">2</span><span class="operator">:</span> <span class="operator">-</span><span class="number">4</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">  v1   v5   v6   v7   v8   v9  v10 <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span> </span><br><span class="line"><span class="number">10.0</span> <span class="number">11.6</span> <span class="number">12.0</span> <span class="number">12.4</span> <span class="number">12.8</span> <span class="number">13.2</span> <span class="number">13.6</span> <span class="number">14.0</span> <span class="number">14.4</span> <span class="number">14.8</span> <span class="number">15.2</span> <span class="number">15.6</span> <span class="number">16.0</span> <span class="number">16.4</span> <span class="number">16.8</span> <span class="number">17.2</span> <span class="number">17.6</span> <span class="number">18.0</span> <span class="number">18.4</span> <span class="number">18.8</span> <span class="number">19.2</span> <span class="number">19.6</span> <span class="number">20.0</span> </span><br></pre></td></tr></table></figure>
</li>
<li><p>向量元素运算</p>
<ul>
<li>长度相同的向量</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 长度不同的向量</span></span><br><span class="line"><span class="operator">&gt;</span> v3 <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span> <span class="number">20</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> v4 <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span> <span class="number">20</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">20</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">20</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> add.result <span class="operator">=</span> v1 <span class="operator">+</span> v3</span><br><span class="line"><span class="operator">&gt;</span> add.result <span class="operator">=</span> v1 <span class="operator">+</span> v4</span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 向量的运算</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 长度相同的向量</span></span><br><span class="line"><span class="operator">&gt;</span> v1 <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">,</span>  <span class="number">5</span><span class="punctuation">,</span>  <span class="number">6</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> v2 <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">6</span><span class="punctuation">,</span> <span class="number">7</span><span class="punctuation">,</span> <span class="number">8</span><span class="punctuation">,</span> <span class="number">9</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">11</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> add.result <span class="operator">=</span> v1 <span class="operator">+</span> v2</span><br><span class="line"><span class="operator">&gt;</span> sub.result <span class="operator">=</span> v1 <span class="operator">-</span> v2</span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> add.result</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span>  <span class="number">7</span>  <span class="number">9</span> <span class="number">11</span> <span class="number">13</span> <span class="number">15</span> <span class="number">17</span></span><br><span class="line"><span class="operator">&gt;</span> sub.result</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="operator">-</span><span class="number">5</span> <span class="operator">-</span><span class="number">5</span> <span class="operator">-</span><span class="number">5</span> <span class="operator">-</span><span class="number">5</span> <span class="operator">-</span><span class="number">5</span> <span class="operator">-</span><span class="number">5</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>长度不同的向量</p>
<p>如果长度不同，较短的向量会循环补充到与较长的向量长度相同，在进行运算。但是前提是：长的向量的长度必须为短的向量的整数倍。</p>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 长度不同的向量</span></span><br><span class="line"><span class="operator">&gt;</span> v3 <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span> <span class="number">20</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> v4 <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span> <span class="number">20</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">20</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">20</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> add.result <span class="operator">=</span> v1 <span class="operator">+</span> v3</span><br><span class="line"><span class="operator">&gt;</span> add.result</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">11</span> <span class="number">22</span> <span class="number">13</span> <span class="number">24</span> <span class="number">15</span> <span class="number">26</span></span><br><span class="line"><span class="operator">&gt;</span> add.result <span class="operator">=</span> v1 <span class="operator">+</span> v4</span><br><span class="line"><span class="operator">&gt;</span> add.result</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">11</span> <span class="number">22</span> <span class="number">13</span> <span class="number">24</span> <span class="number">15</span> <span class="number">26</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="2-8-2-列表-list"><a href="#2-8-2-列表-list" class="headerlink" title="2.8.2 列表 list"></a>2.8.2 列表 <code>list</code></h5><ul>
<li>概念：列表是 R 语言的对象集合，可以用来保存<strong>不同类型</strong>的数据，可以是数字、字符串、向量、另一个列表等，当然还可以包含矩阵和函数。R语言创建列表使用 <code>list()</code> 函数。</li>
<li>列表的创建</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 列表的创建</span></span><br><span class="line"><span class="operator">&gt;</span> list_data <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span><span class="string">&quot;Hello&quot;</span><span class="punctuation">,</span> <span class="string">&quot;World&quot;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="literal">TRUE</span><span class="punctuation">,</span> <span class="number">51.23</span><span class="punctuation">,</span> <span class="number">119L</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> list_data</span><br><span class="line"><span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;Hello&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;World&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[[</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span>  <span class="number">1</span> <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[[</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">TRUE</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[[</span><span class="number">5</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">51.23</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[[</span><span class="number">6</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">119</span></span><br></pre></td></tr></table></figure>

<ul>
<li>列表元素的重命名(<code>names</code> 函数)</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 列表的重命名</span></span><br><span class="line"><span class="operator">&gt;</span> list_data <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Hello&quot;</span><span class="punctuation">,</span> <span class="string">&quot;World&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> matrix<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">,</span> <span class="number">6</span><span class="punctuation">)</span><span class="punctuation">,</span> nrow<span class="operator">=</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">list</span><span class="punctuation">(</span><span class="string">&quot;Happy&quot;</span><span class="punctuation">,</span> <span class="number">1314L</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> list_data</span><br><span class="line"><span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;Hello&quot;</span> <span class="string">&quot;World&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line">     <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">1</span>    <span class="number">3</span>    <span class="number">5</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">2</span>    <span class="number">4</span>    <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[[</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[[</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;Happy&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[[</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">]</span><span class="punctuation">[[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">1314</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">names</span><span class="punctuation">(</span>list_data<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;HelloString&quot;</span><span class="punctuation">,</span> <span class="string">&quot;MatrixElem&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ListElem&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> list_data</span><br><span class="line"><span class="operator">$</span>HelloString</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;Hello&quot;</span> <span class="string">&quot;World&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">$</span>MatrixElem</span><br><span class="line">     <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">1</span>    <span class="number">3</span>    <span class="number">5</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">2</span>    <span class="number">4</span>    <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="operator">$</span>ListElem</span><br><span class="line"><span class="operator">$</span>ListElem<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;Happy&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">$</span>ListElem<span class="punctuation">[[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">1314</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>列表元素的访问——增删改查</p>
<ul>
<li>查</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># (查)</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 根据索引访问</span></span><br><span class="line"><span class="operator">&gt;</span> list_data<span class="punctuation">[</span><span class="number">0</span><span class="punctuation">]</span></span><br><span class="line">named <span class="built_in">list</span><span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> list_data<span class="punctuation">[</span><span class="number">3</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">$</span>ListElem</span><br><span class="line"><span class="operator">$</span>ListElem<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;Happy&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">$</span>ListElem<span class="punctuation">[[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">1314</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 根据元素名称访问</span></span><br><span class="line"><span class="operator">&gt;</span> list_data<span class="operator">$</span>HelloString</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;Hello&quot;</span> <span class="string">&quot;World&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> list_data<span class="operator">$</span>ListElem</span><br><span class="line"><span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;Happy&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">1314</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> list_data<span class="punctuation">[</span><span class="number">4</span><span class="punctuation">]</span><span class="operator">&lt;-</span><span class="string">&quot;Hello&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> list_data</span><br><span class="line"><span class="operator">$</span>HelloString</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;Hello&quot;</span> <span class="string">&quot;World&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">$</span>MatrixElem</span><br><span class="line">     <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">1</span>    <span class="number">3</span>    <span class="number">5</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">2</span>    <span class="number">4</span>    <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="operator">$</span>ListElem</span><br><span class="line"><span class="operator">$</span>ListElem<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;Happy&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">$</span>ListElem<span class="punctuation">[[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">1314</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[[</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;Hello&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>增</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># (增)</span></span><br><span class="line"><span class="operator">&gt;</span> list_data<span class="punctuation">[</span><span class="number">4</span><span class="punctuation">]</span><span class="operator">&lt;-</span><span class="string">&quot;Hello&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> list_data</span><br><span class="line"><span class="operator">$</span>HelloString</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;Hello&quot;</span> <span class="string">&quot;World&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">$</span>MatrixElem</span><br><span class="line">     <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">1</span>    <span class="number">3</span>    <span class="number">5</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">2</span>    <span class="number">4</span>    <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="operator">$</span>ListElem</span><br><span class="line"><span class="operator">$</span>ListElem<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;Happy&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">$</span>ListElem<span class="punctuation">[[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">1314</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[[</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;Hello&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>改</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># (改)</span></span><br><span class="line"><span class="operator">&gt;</span> list_data<span class="punctuation">[</span><span class="number">4</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="number">12</span></span><br><span class="line"><span class="operator">&gt;</span> list_data</span><br><span class="line"><span class="operator">$</span>HelloString</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;Hello&quot;</span> <span class="string">&quot;World&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">$</span>MatrixElem</span><br><span class="line">     <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">1</span>    <span class="number">3</span>    <span class="number">5</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">2</span>    <span class="number">4</span>    <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="operator">$</span>ListElem</span><br><span class="line"><span class="operator">$</span>ListElem<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;Happy&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">$</span>ListElem<span class="punctuation">[[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">1314</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[[</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">12</span></span><br></pre></td></tr></table></figure>

<ul>
<li>删</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># (删)</span></span><br><span class="line"><span class="operator">&gt;</span> list_data<span class="punctuation">[</span><span class="number">4</span><span class="punctuation">]</span> <span class="operator">&lt;-</span> <span class="literal">NULL</span></span><br><span class="line"><span class="operator">&gt;</span> list_data</span><br><span class="line"><span class="operator">$</span>HelloString</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;Hello&quot;</span> <span class="string">&quot;World&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">$</span>MatrixElem</span><br><span class="line">     <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">1</span>    <span class="number">3</span>    <span class="number">5</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">2</span>    <span class="number">4</span>    <span class="number">6</span></span><br><span class="line"></span><br><span class="line"><span class="operator">$</span>ListElem</span><br><span class="line"><span class="operator">$</span>ListElem<span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;Happy&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">$</span>ListElem<span class="punctuation">[[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">1314</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>列表的合并：使用 <code>c</code> 可以将多个列表合并为一个列表</p>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 合并列表</span></span><br><span class="line"><span class="operator">&gt;</span> list1 <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> list2 <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span><span class="string">&quot;A&quot;</span><span class="punctuation">,</span> <span class="string">&quot;B&quot;</span><span class="punctuation">,</span> <span class="string">&quot;C&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">class</span><span class="punctuation">(</span>list1<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;list&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">class</span><span class="punctuation">(</span>list2<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;list&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> merged.list <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span>list1<span class="punctuation">,</span> list2<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> merged.list</span><br><span class="line"><span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[[</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[[</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;A&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[[</span><span class="number">5</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;B&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[[</span><span class="number">6</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;C&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">class</span><span class="punctuation">(</span>merged.list<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;list&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>列表和向量之间的转换</li>
</ul>
  <figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 列表转换为向量</span></span><br><span class="line"><span class="operator">&gt;</span> list1 <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span><span class="number">1</span> <span class="operator">:</span>  <span class="number">5</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> list2 <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span><span class="number">10</span><span class="operator">:</span> <span class="number">14</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> list3 <span class="operator">&lt;-</span> <span class="built_in">list</span><span class="punctuation">(</span><span class="string">&quot;hello&quot;</span><span class="punctuation">,</span> matrix<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">,</span> nrow<span class="operator">=</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> list1</span><br><span class="line"><span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span> <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> list2</span><br><span class="line"><span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> list3</span><br><span class="line"><span class="punctuation">[[</span><span class="number">1</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;hello&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[[</span><span class="number">2</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line">     <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">1</span>    <span class="number">3</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">2</span>    <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">[[</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> v1 <span class="operator">&lt;-</span> unlist<span class="punctuation">(</span>list1<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> v2 <span class="operator">&lt;-</span> unlist<span class="punctuation">(</span>list2<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> v3 <span class="operator">&lt;-</span> unlist<span class="punctuation">(</span>list3<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">class</span><span class="punctuation">(</span>v1<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">class</span><span class="punctuation">(</span>v2<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">class</span><span class="punctuation">(</span>v3<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;character&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> v3</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;hello&quot;</span> <span class="string">&quot;1&quot;</span>     <span class="string">&quot;2&quot;</span>     <span class="string">&quot;3&quot;</span>     <span class="string">&quot;4&quot;</span>     <span class="string">&quot;3&quot;</span>    </span><br></pre></td></tr></table></figure>

<h5 id="2-8-3-矩阵-matrix"><a href="#2-8-3-矩阵-matrix" class="headerlink" title="2.8.3 矩阵 matrix"></a>2.8.3 矩阵 <code>matrix</code></h5><ul>
<li>概念：<code>R</code> 语言为线性代数的研究提供了矩阵类型，这种数据结构很类似于其它语言中的二维数组。</li>
<li>矩阵的创建</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 矩阵的创建</span></span><br><span class="line"><span class="operator">&gt;</span> m1 <span class="operator">=</span> matrix<span class="punctuation">(</span>data<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="operator">:</span> <span class="number">14</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> m1</span><br><span class="line">      <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">3</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">4</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">3</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">5</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">4</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">6</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">5</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">7</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">6</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">8</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">7</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">9</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">8</span><span class="punctuation">,</span><span class="punctuation">]</span>   <span class="number">10</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">9</span><span class="punctuation">,</span><span class="punctuation">]</span>   <span class="number">11</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">10</span><span class="punctuation">,</span><span class="punctuation">]</span>   <span class="number">12</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">11</span><span class="punctuation">,</span><span class="punctuation">]</span>   <span class="number">13</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">12</span><span class="punctuation">,</span><span class="punctuation">]</span>   <span class="number">14</span></span><br><span class="line"><span class="operator">&gt;</span> m2 <span class="operator">=</span> matrix<span class="punctuation">(</span>data<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="operator">:</span> <span class="number">14</span><span class="punctuation">)</span><span class="punctuation">,</span> nrow<span class="operator">=</span><span class="number">4</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> m2</span><br><span class="line">     <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">3</span>    <span class="number">7</span>   <span class="number">11</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">4</span>    <span class="number">8</span>   <span class="number">12</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">3</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">5</span>    <span class="number">9</span>   <span class="number">13</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">4</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">6</span>   <span class="number">10</span>   <span class="number">14</span></span><br><span class="line"><span class="operator">&gt;</span> m2 <span class="operator">=</span> matrix<span class="punctuation">(</span>data<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="operator">:</span> <span class="number">14</span><span class="punctuation">)</span><span class="punctuation">,</span> ncol<span class="operator">=</span><span class="number">4</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> m2</span><br><span class="line">     <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">3</span>    <span class="number">6</span>    <span class="number">9</span>   <span class="number">12</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">4</span>    <span class="number">7</span>   <span class="number">10</span>   <span class="number">13</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">3</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">5</span>    <span class="number">8</span>   <span class="number">11</span>   <span class="number">14</span></span><br><span class="line"><span class="operator">&gt;</span> m3 <span class="operator">&lt;-</span> matrix<span class="punctuation">(</span>data<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span> <span class="number">14</span><span class="punctuation">)</span><span class="punctuation">,</span> nrow<span class="operator">=</span><span class="number">4</span><span class="punctuation">,</span> byrow<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">)</span>		<span class="comment"># 默认为 TRUE</span></span><br><span class="line"><span class="operator">&gt;</span> m3</span><br><span class="line">     <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">3</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span>   <span class="number">14</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">3</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">3</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">4</span><span class="punctuation">,</span><span class="punctuation">]</span>   <span class="number">14</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> rownames <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;row1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;row2&quot;</span><span class="punctuation">,</span> <span class="string">&quot;row3&quot;</span><span class="punctuation">,</span> <span class="string">&quot;row4&quot;</span><span class="punctuation">)</span> </span><br><span class="line"><span class="operator">&gt;</span> colnames <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;col1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;col2&quot;</span><span class="punctuation">,</span> <span class="string">&quot;col3&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> m4 <span class="operator">&lt;-</span> matrix<span class="punctuation">(</span>data<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="operator">:</span> <span class="number">14</span><span class="punctuation">)</span><span class="punctuation">,</span> nrow<span class="operator">=</span><span class="number">4</span><span class="punctuation">,</span> byrow<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span> <span class="built_in">dimnames</span><span class="operator">=</span><span class="built_in">list</span><span class="punctuation">(</span>rownames<span class="punctuation">,</span> colnames<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> m4</span><br><span class="line">     col1 col2 col3</span><br><span class="line">row1    <span class="number">3</span>    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">row2    <span class="number">6</span>    <span class="number">7</span>    <span class="number">8</span></span><br><span class="line">row3    <span class="number">9</span>   <span class="number">10</span>   <span class="number">11</span></span><br><span class="line">row4   <span class="number">12</span>   <span class="number">13</span>   <span class="number">14</span></span><br></pre></td></tr></table></figure>

<ul>
<li>矩阵转置</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 矩阵转置 t()</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># R 语言矩阵提供了 t() 函数, 可以实现矩阵的行列转换</span></span><br><span class="line"><span class="operator">&gt;</span> t<span class="punctuation">(</span>m4<span class="punctuation">)</span></span><br><span class="line">     row1 row2 row3 row4</span><br><span class="line">col1    <span class="number">3</span>    <span class="number">6</span>    <span class="number">9</span>   <span class="number">12</span></span><br><span class="line">col2    <span class="number">4</span>    <span class="number">7</span>   <span class="number">10</span>   <span class="number">13</span></span><br><span class="line">col3    <span class="number">5</span>    <span class="number">8</span>   <span class="number">11</span>   <span class="number">14</span></span><br></pre></td></tr></table></figure>

<ul>
<li>矩阵元素访问</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> m4<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;row1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;row4&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;col1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;col3&quot;</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line">     col1 col3</span><br><span class="line">row1    <span class="number">3</span>    <span class="number">5</span></span><br><span class="line">row4   <span class="number">12</span>   <span class="number">14</span></span><br></pre></td></tr></table></figure>

<ul>
<li>矩阵相关操作</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 矩阵元素操作</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 矩阵计算</span></span><br><span class="line"><span class="operator">&gt;</span> m1 <span class="operator">&lt;-</span> matrix<span class="punctuation">(</span>data<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="operator">:</span> <span class="number">14</span><span class="punctuation">)</span><span class="punctuation">,</span> nrow<span class="operator">=</span><span class="number">4</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> m1</span><br><span class="line">     <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">3</span>    <span class="number">7</span>   <span class="number">11</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">4</span>    <span class="number">8</span>   <span class="number">12</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">3</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">5</span>    <span class="number">9</span>   <span class="number">13</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">4</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">6</span>   <span class="number">10</span>   <span class="number">14</span></span><br><span class="line"><span class="operator">&gt;</span> m2 <span class="operator">&lt;-</span> matrix<span class="punctuation">(</span>data<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span> <span class="number">12</span><span class="punctuation">)</span><span class="punctuation">,</span> nrow<span class="operator">=</span><span class="number">4</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> m2</span><br><span class="line">     <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">1</span>    <span class="number">5</span>    <span class="number">9</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">2</span>    <span class="number">6</span>   <span class="number">10</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">3</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">3</span>    <span class="number">7</span>   <span class="number">11</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">4</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">4</span>    <span class="number">8</span>   <span class="number">12</span></span><br><span class="line"><span class="operator">&gt;</span> m1 <span class="operator">+</span> m2</span><br><span class="line">     <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">4</span>   <span class="number">12</span>   <span class="number">20</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">6</span>   <span class="number">14</span>   <span class="number">22</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">3</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">8</span>   <span class="number">16</span>   <span class="number">24</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">4</span><span class="punctuation">,</span><span class="punctuation">]</span>   <span class="number">10</span>   <span class="number">18</span>   <span class="number">26</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 矩阵转换 </span></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 矩阵 -&gt; 向量</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">is.matrix</span><span class="punctuation">(</span>m1<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">TRUE</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">class</span><span class="punctuation">(</span>m1<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;matrix&quot;</span> <span class="string">&quot;array&quot;</span> </span><br><span class="line"><span class="operator">&gt;</span> v1 <span class="operator">&lt;-</span> as.vector<span class="punctuation">(</span>m1<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> v1</span><br><span class="line"> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span>  <span class="number">3</span>  <span class="number">4</span>  <span class="number">5</span>  <span class="number">6</span>  <span class="number">7</span>  <span class="number">8</span>  <span class="number">9</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">class</span><span class="punctuation">(</span>v1<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;integer&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 矩阵组合</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># cbind() 把其自变量横向拼成一个大矩阵, 横向组合, 行数一致</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># rbind() 把其自变量纵向拼成一个大矩阵, 纵向组合, 列数一致</span></span><br><span class="line"><span class="operator">&gt;</span> v1 <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> v2 <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">6</span><span class="punctuation">,</span> <span class="number">7</span><span class="punctuation">,</span> <span class="number">8</span><span class="punctuation">,</span> <span class="number">9</span><span class="punctuation">,</span><span class="number">10</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> y1 <span class="operator">=</span> cbind<span class="punctuation">(</span>v1<span class="punctuation">,</span> v2<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> y2 <span class="operator">=</span> rbind<span class="punctuation">(</span>v1<span class="punctuation">,</span> v2<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> y1</span><br><span class="line">     v1 v2</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="punctuation">]</span>  <span class="number">1</span>  <span class="number">6</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span>  <span class="number">2</span>  <span class="number">7</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">3</span><span class="punctuation">,</span><span class="punctuation">]</span>  <span class="number">3</span>  <span class="number">8</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">4</span><span class="punctuation">,</span><span class="punctuation">]</span>  <span class="number">4</span>  <span class="number">9</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">5</span><span class="punctuation">,</span><span class="punctuation">]</span>  <span class="number">5</span> <span class="number">10</span></span><br><span class="line"><span class="operator">&gt;</span> y2</span><br><span class="line">   <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">5</span><span class="punctuation">]</span></span><br><span class="line">v1    <span class="number">1</span>    <span class="number">2</span>    <span class="number">3</span>    <span class="number">4</span>    <span class="number">5</span></span><br><span class="line">v2    <span class="number">6</span>    <span class="number">7</span>    <span class="number">8</span>    <span class="number">9</span>   <span class="number">10</span></span><br><span class="line"><span class="operator">&gt;</span> </span><br></pre></td></tr></table></figure>

<h5 id="2-8-4-数组-array"><a href="#2-8-4-数组-array" class="headerlink" title="2.8.4 数组 array"></a>2.8.4 数组 <code>array</code></h5><ul>
<li>概念：数组也是 <code>R</code> 语言的对象，<code>R</code> 语言可以创建一维或多维数组。</li>
<li>数组的创建</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 创建数组</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 一维数组</span></span><br><span class="line"><span class="operator">&gt;</span> v1 <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span> <span class="number">9</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> a1 <span class="operator">&lt;-</span> array<span class="punctuation">(</span>v1<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> a1</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">5</span> <span class="number">9</span> <span class="number">1</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">is.array</span><span class="punctuation">(</span>a1<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">TRUE</span></span><br><span class="line"><span class="operator">&gt;</span> a <span class="operator">&lt;-</span> array<span class="punctuation">(</span><span class="number">10</span><span class="operator">:</span> <span class="number">15</span><span class="punctuation">,</span> <span class="built_in">dim</span><span class="operator">=</span><span class="number">9</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> a</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span> <span class="number">13</span> <span class="number">14</span> <span class="number">15</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span></span><br><span class="line"><span class="operator">&gt;</span> a <span class="operator">&lt;-</span> array<span class="punctuation">(</span><span class="number">10</span><span class="operator">:</span> <span class="number">15</span><span class="punctuation">,</span> <span class="built_in">dim</span><span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> a</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">10</span> <span class="number">11</span></span><br><span class="line"><span class="operator">&gt;</span> </span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 二维数组</span></span><br><span class="line"><span class="operator">&gt;</span> a <span class="operator">&lt;-</span> array<span class="punctuation">(</span><span class="number">10</span><span class="operator">:</span> <span class="number">15</span><span class="punctuation">,</span> <span class="built_in">dim</span><span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">)</span>   <span class="comment"># 10, 11, 12, 13, 14, 15</span></span><br><span class="line"><span class="operator">&gt;</span> a</span><br><span class="line">     <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="punctuation">]</span>   <span class="number">10</span>   <span class="number">12</span>   <span class="number">14</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span>   <span class="number">11</span>   <span class="number">13</span>   <span class="number">15</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">is.array</span><span class="punctuation">(</span>a<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">TRUE</span></span><br><span class="line"><span class="operator">&gt;</span> </span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 三维数组</span></span><br><span class="line"><span class="operator">&gt;</span> a <span class="operator">&lt;-</span> array<span class="punctuation">(</span><span class="number">10</span><span class="operator">:</span> <span class="number">15</span><span class="punctuation">,</span> <span class="built_in">dim</span><span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> a</span><br><span class="line"><span class="punctuation">,</span> <span class="punctuation">,</span> <span class="number">1</span></span><br><span class="line">     <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="punctuation">]</span>   <span class="number">10</span>   <span class="number">12</span>   <span class="number">14</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span>   <span class="number">11</span>   <span class="number">13</span>   <span class="number">15</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">,</span> <span class="punctuation">,</span> <span class="number">2</span></span><br><span class="line">     <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="punctuation">]</span>   <span class="number">10</span>   <span class="number">12</span>   <span class="number">14</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span>   <span class="number">11</span>   <span class="number">13</span>   <span class="number">15</span></span><br><span class="line"></span><br><span class="line"><span class="operator">&gt;</span> column.names <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;COL1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;COL2&quot;</span><span class="punctuation">,</span> <span class="string">&quot;COL3&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> row.names <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;ROW1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ROW2&quot;</span><span class="punctuation">,</span> <span class="string">&quot;ROW3&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> matrix.names <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Matrix1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Matrix2&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> </span><br><span class="line"><span class="operator">&gt;</span> vector1 <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">5</span><span class="punctuation">,</span> <span class="number">9</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> vector2 <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span> <span class="number">11</span><span class="punctuation">,</span> <span class="number">12</span><span class="punctuation">,</span> <span class="number">13</span><span class="punctuation">,</span> <span class="number">14</span><span class="punctuation">,</span> <span class="number">15</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> a <span class="operator">&lt;-</span> array<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>vector1<span class="punctuation">,</span> vector2<span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">dim</span><span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">dimnames</span> <span class="operator">=</span> <span class="built_in">list</span><span class="punctuation">(</span>row.names<span class="punctuation">,</span> column.names<span class="punctuation">,</span> matrix.names<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> a</span><br><span class="line"><span class="punctuation">,</span> <span class="punctuation">,</span> Matrix1</span><br><span class="line">     COL1 COL2 COL3</span><br><span class="line">ROW1    <span class="number">5</span>   <span class="number">10</span>   <span class="number">13</span></span><br><span class="line">ROW2    <span class="number">9</span>   <span class="number">11</span>   <span class="number">14</span></span><br><span class="line">ROW3    <span class="number">3</span>   <span class="number">12</span>   <span class="number">15</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">,</span> <span class="punctuation">,</span> Matrix2</span><br><span class="line">     COL1 COL2 COL3</span><br><span class="line">ROW1    <span class="number">5</span>   <span class="number">10</span>   <span class="number">13</span></span><br><span class="line">ROW2    <span class="number">9</span>   <span class="number">11</span>   <span class="number">14</span></span><br><span class="line">ROW3    <span class="number">3</span>   <span class="number">12</span>   <span class="number">15</span></span><br></pre></td></tr></table></figure>

<ul>
<li>数组元素访问</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 数组访问</span></span><br><span class="line"><span class="operator">&gt;</span> a<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span>    <span class="comment"># 一维数组的访问</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">5</span></span><br><span class="line"><span class="operator">&gt;</span> a<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span> <span class="number">6</span><span class="punctuation">]</span> <span class="comment"># 一维数组的访问——向量访问</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span>  <span class="number">5</span>  <span class="number">9</span>  <span class="number">3</span> <span class="number">10</span> <span class="number">11</span> <span class="number">12</span></span><br><span class="line"><span class="operator">&gt;</span> </span><br><span class="line"><span class="operator">&gt;</span> dim2_a <span class="operator">&lt;-</span> array<span class="punctuation">(</span><span class="built_in">c</span><span class="punctuation">(</span>vector1<span class="punctuation">,</span> vector2<span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">dim</span><span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">3</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> dim2_a</span><br><span class="line">     <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">5</span>   <span class="number">10</span>   <span class="number">13</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">9</span>   <span class="number">11</span>   <span class="number">14</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">3</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">3</span>   <span class="number">12</span>   <span class="number">15</span></span><br><span class="line"><span class="operator">&gt;</span> dim2_a<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span> <span class="number">1</span><span class="punctuation">]</span>       <span class="comment"># 二维数组的访问, 访问的必须是二维数组</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">5</span></span><br><span class="line"><span class="operator">&gt;</span> dim2_a<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">1</span><span class="operator">:</span> <span class="number">2</span><span class="punctuation">]</span> <span class="comment"># 二维数组的访问——矩阵访问</span></span><br><span class="line">     <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span> <span class="punctuation">[</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">5</span>   <span class="number">10</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">2</span><span class="punctuation">,</span><span class="punctuation">]</span>    <span class="number">9</span>   <span class="number">11</span></span><br><span class="line"><span class="operator">&gt;</span> </span><br><span class="line"><span class="operator">&gt;</span> a<span class="punctuation">[</span><span class="number">3</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">]</span>    <span class="comment"># 三维数组</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">15</span></span><br></pre></td></tr></table></figure>

<h5 id="2-8-5-数据框-data-frame"><a href="#2-8-5-数据框-data-frame" class="headerlink" title="2.8.5 数据框 data.frame"></a>2.8.5 数据框 <code>data.frame</code></h5><ul>
<li><p>概念：数据框 <code>DataFrame</code> 可以理解成我们常说的<strong>表格</strong>，数据框是 <code>R</code> 语言的数据结构，是特殊的二维列表。数据框每一列都有一个唯一的列名，长度都是相等的，同一列的数据类型需要一致，不同列的数据类型可以不一样。数据框的特点：</p>
<ul>
<li>列名称应为非空。</li>
<li>行名称应该是唯一的。</li>
<li>存储在数据框中的数据可以是数字，字符型等。</li>
<li>每个列应包含相同数量的数据项。</li>
</ul>
</li>
<li><p>数据框的创建</p>
</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 数据框</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 创建数据框对象</span></span><br><span class="line"><span class="operator">&gt;</span> df1 <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span></span><br><span class="line"><span class="operator">+</span>   <span class="comment"># tag = value</span></span><br><span class="line"><span class="operator">+</span>   姓名 <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;张三&quot;</span><span class="punctuation">,</span> <span class="string">&quot;李四&quot;</span><span class="punctuation">,</span> <span class="string">&quot;王五&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line"><span class="operator">+</span>   工号 <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;001&quot;</span><span class="punctuation">,</span> <span class="string">&quot;002&quot;</span><span class="punctuation">,</span> <span class="string">&quot;003&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line"><span class="operator">+</span>   月薪 <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1000</span><span class="punctuation">,</span> <span class="number">2000</span><span class="punctuation">,</span> <span class="number">3000</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">+</span> <span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> df1</span><br><span class="line">  姓名 工号 月薪</span><br><span class="line"><span class="number">1</span> 张三  <span class="number">001</span> <span class="number">1000</span></span><br><span class="line"><span class="number">2</span> 李四  <span class="number">002</span> <span class="number">2000</span></span><br><span class="line"><span class="number">3</span> 王五  <span class="number">003</span> <span class="number">3000</span></span><br></pre></td></tr></table></figure>

<ul>
<li>查看数据框结构</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 查看数据框结构(Structure)</span></span><br><span class="line"><span class="operator">&gt;</span> str<span class="punctuation">(</span>df1<span class="punctuation">)</span></span><br><span class="line"><span class="string">&#x27;data.frame&#x27;</span><span class="operator">:</span>	<span class="number">3</span> obs. of  <span class="number">3</span> variables<span class="operator">:</span></span><br><span class="line"> <span class="operator">$</span> 姓名<span class="operator">:</span> chr  <span class="string">&quot;张三&quot;</span> <span class="string">&quot;李四&quot;</span> <span class="string">&quot;王五&quot;</span></span><br><span class="line"> <span class="operator">$</span> 工号<span class="operator">:</span> chr  <span class="string">&quot;001&quot;</span> <span class="string">&quot;002&quot;</span> <span class="string">&quot;003&quot;</span></span><br><span class="line"> <span class="operator">$</span> 月薪<span class="operator">:</span> num  <span class="number">1000</span> <span class="number">2000</span> <span class="number">3000</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 查看数据框描述性统计量</span></span><br><span class="line"><span class="operator">&gt;</span> summary<span class="punctuation">(</span>df1<span class="punctuation">)</span></span><br><span class="line">     姓名               工号                月薪     </span><br><span class="line"> Length<span class="operator">:</span><span class="number">3</span>           Length<span class="operator">:</span><span class="number">3</span>           Min.   <span class="operator">:</span><span class="number">1000</span>  </span><br><span class="line"> Class <span class="operator">:</span>character   Class <span class="operator">:</span>character   <span class="number">1</span>st Qu.<span class="operator">:</span><span class="number">1500</span>  </span><br><span class="line"> Mode  <span class="operator">:</span>character   Mode  <span class="operator">:</span>character   Median <span class="operator">:</span><span class="number">2000</span>  </span><br><span class="line">                                       Mean   <span class="operator">:</span><span class="number">2000</span>  </span><br><span class="line">                                       <span class="number">3</span>rd Qu.<span class="operator">:</span><span class="number">2500</span>  </span><br><span class="line">                                       Max.   <span class="operator">:</span><span class="number">3000</span>  </span><br></pre></td></tr></table></figure>

<ul>
<li>数据框访问、新增列</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 提取数据框中的列</span></span><br><span class="line"><span class="operator">&gt;</span> df1<span class="operator">$</span>姓名</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;张三&quot;</span> <span class="string">&quot;李四&quot;</span> <span class="string">&quot;王五&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> df2 <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>df1<span class="operator">$</span>姓名<span class="punctuation">,</span> df1<span class="operator">$</span>月薪<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> df2</span><br><span class="line">  df1.姓名 df1.月薪</span><br><span class="line"><span class="number">1</span>     张三     <span class="number">1000</span></span><br><span class="line"><span class="number">2</span>     李四     <span class="number">2000</span></span><br><span class="line"><span class="number">3</span>     王五     <span class="number">3000</span></span><br><span class="line"><span class="operator">&gt;</span> </span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 提取数据框中的行</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 提取前两行</span></span><br><span class="line"><span class="operator">&gt;</span> result <span class="operator">&lt;-</span> df1<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">,</span> <span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> result</span><br><span class="line">  姓名 工号 月薪</span><br><span class="line"><span class="number">1</span> 张三  <span class="number">001</span> <span class="number">1000</span></span><br><span class="line"><span class="number">2</span> 李四  <span class="number">002</span> <span class="number">2000</span></span><br><span class="line"><span class="operator">&gt;</span> </span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 提取前两行, 前两列</span></span><br><span class="line"><span class="operator">&gt;</span> result <span class="operator">&lt;-</span> df1<span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">,</span> <span class="number">1</span><span class="operator">:</span><span class="number">3</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> result</span><br><span class="line">  姓名 工号 月薪</span><br><span class="line"><span class="number">1</span> 张三  <span class="number">001</span> <span class="number">1000</span></span><br><span class="line"><span class="number">2</span> 李四  <span class="number">002</span> <span class="number">2000</span></span><br><span class="line"><span class="operator">&gt;</span> </span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 提取第1、3行, 第1、2列的数据</span></span><br><span class="line"><span class="operator">&gt;</span> result <span class="operator">&lt;-</span> df1<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">]</span></span><br><span class="line"><span class="operator">&gt;</span> result</span><br><span class="line">  姓名 工号</span><br><span class="line"><span class="number">1</span> 张三  <span class="number">001</span></span><br><span class="line"><span class="number">3</span> 王五  <span class="number">003</span></span><br><span class="line"><span class="operator">&gt;</span> </span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 新增列</span></span><br><span class="line"><span class="operator">&gt;</span> df1<span class="operator">$</span>部门 <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;运营&quot;</span><span class="punctuation">,</span> <span class="string">&quot;技术&quot;</span><span class="punctuation">,</span> <span class="string">&quot;运营&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> df1</span><br><span class="line">  姓名 工号 月薪 部门</span><br><span class="line"><span class="number">1</span> 张三  <span class="number">001</span> <span class="number">1000</span> 运营</span><br><span class="line"><span class="number">2</span> 李四  <span class="number">002</span> <span class="number">2000</span> 技术</span><br><span class="line"><span class="number">3</span> 王五  <span class="number">003</span> <span class="number">3000</span> 运营</span><br></pre></td></tr></table></figure>

<ul>
<li>数据框合并</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据框合并</span></span><br><span class="line"><span class="comment"># cbind()/rbind()</span></span><br></pre></td></tr></table></figure>

<ul>
<li>数据框筛选</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 数据框筛选</span></span><br><span class="line"><span class="operator">&gt;</span> student <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span></span><br><span class="line"><span class="operator">+</span>   sno <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line"><span class="operator">+</span>   sname <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;zhangsan&quot;</span><span class="punctuation">,</span> <span class="string">&quot;lisi&quot;</span><span class="punctuation">,</span> <span class="string">&quot;wangwu&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line"><span class="operator">+</span>   sage <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span> <span class="number">12</span><span class="punctuation">,</span> <span class="number">14</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">+</span> <span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> student</span><br><span class="line">  sno    sname sage</span><br><span class="line"><span class="number">1</span>   <span class="number">1</span> zhangsan   <span class="number">10</span></span><br><span class="line"><span class="number">2</span>   <span class="number">2</span>     lisi   <span class="number">12</span></span><br><span class="line"><span class="number">3</span>   <span class="number">3</span>   wangwu   <span class="number">14</span></span><br><span class="line"><span class="operator">&gt;</span> </span><br><span class="line"><span class="operator">&gt;</span> student<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span>      <span class="comment"># 第一个字段</span></span><br><span class="line">  sno</span><br><span class="line"><span class="number">1</span>   <span class="number">1</span></span><br><span class="line"><span class="number">2</span>   <span class="number">2</span></span><br><span class="line"><span class="number">3</span>   <span class="number">3</span></span><br><span class="line"><span class="operator">&gt;</span> student<span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">]</span>   <span class="comment"># 第一行, 第二列</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;zhangsan&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> student<span class="operator">$</span>sage<span class="operator">&gt;</span><span class="number">12</span> <span class="comment"># FALSE FALSE TRUE</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">FALSE</span> <span class="literal">FALSE</span>  <span class="literal">TRUE</span></span><br><span class="line"><span class="operator">&gt;</span> </span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># [...] 里面一个参数取字段, 两个参数取行列</span></span><br><span class="line"><span class="operator">&gt;</span> student<span class="punctuation">[</span>student<span class="operator">$</span>sage<span class="operator">&gt;</span><span class="number">11</span><span class="punctuation">]</span>          <span class="comment"># 执行判断, 得到结果 c(FALSE, TRUE, TRUE)</span></span><br><span class="line">     sname sage</span><br><span class="line"><span class="number">1</span> zhangsan   <span class="number">10</span></span><br><span class="line"><span class="number">2</span>     lisi   <span class="number">12</span></span><br><span class="line"><span class="number">3</span>   wangwu   <span class="number">14</span></span><br><span class="line"><span class="operator">&gt;</span> student<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="literal">FALSE</span><span class="punctuation">,</span> <span class="literal">TRUE</span><span class="punctuation">,</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">]</span>     <span class="comment"># 使用 c(FALSE, TRUE, TRUE) 进行运算</span></span><br><span class="line">     sname sage</span><br><span class="line"><span class="number">1</span> zhangsan   <span class="number">10</span></span><br><span class="line"><span class="number">2</span>     lisi   <span class="number">12</span></span><br><span class="line"><span class="number">3</span>   wangwu   <span class="number">14</span></span><br><span class="line"><span class="operator">&gt;</span> student<span class="punctuation">[</span>student<span class="operator">$</span>sage<span class="operator">&gt;</span><span class="number">11</span><span class="punctuation">,</span> <span class="punctuation">]</span>        <span class="comment"># 选择年龄大于 11 的, 并取所有字段</span></span><br><span class="line">  sno  sname sage</span><br><span class="line"><span class="number">2</span>   <span class="number">2</span>   lisi   <span class="number">12</span></span><br><span class="line"><span class="number">3</span>   <span class="number">3</span> wangwu   <span class="number">14</span></span><br><span class="line"><span class="operator">&gt;</span> student<span class="punctuation">[</span><span class="built_in">c</span><span class="punctuation">(</span><span class="literal">FALSE</span><span class="punctuation">,</span> <span class="literal">TRUE</span><span class="punctuation">,</span> <span class="literal">TRUE</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="punctuation">]</span>   <span class="comment"># 选择年龄大于 11 的行, 并取所有字段</span></span><br><span class="line">  sno  sname sage</span><br><span class="line"><span class="number">2</span>   <span class="number">2</span>   lisi   <span class="number">12</span></span><br><span class="line"><span class="number">3</span>   <span class="number">3</span> wangwu   <span class="number">14</span></span><br><span class="line"><span class="operator">&gt;</span> student<span class="punctuation">[</span>student<span class="operator">$</span>sage<span class="operator">&gt;</span><span class="number">11</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">]</span>       <span class="comment"># 选择年龄大于 11 的, 并取第 2 个字段</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;lisi&quot;</span>   <span class="string">&quot;wangwu&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> student<span class="punctuation">[</span>student<span class="operator">$</span>sage<span class="operator">&gt;</span><span class="number">11</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">]</span> <span class="comment"># 选择年龄大于 11 的, 并取第 1、2 个字段 </span></span><br><span class="line">  sno  sname</span><br><span class="line"><span class="number">2</span>   <span class="number">2</span>   lisi</span><br><span class="line"><span class="number">3</span>   <span class="number">3</span> wangwu</span><br><span class="line"><span class="operator">&gt;</span> </span><br><span class="line"><span class="operator">&gt;</span> subset<span class="punctuation">(</span>student<span class="punctuation">,</span> select <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;sname&quot;</span><span class="punctuation">,</span> <span class="string">&quot;sage&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span>                        <span class="comment"># 可以理解为: SELECT sname, sage FROM student;</span></span><br><span class="line">     sname sage</span><br><span class="line"><span class="number">1</span> zhangsan   <span class="number">10</span></span><br><span class="line"><span class="number">2</span>     lisi   <span class="number">12</span></span><br><span class="line"><span class="number">3</span>   wangwu   <span class="number">14</span></span><br><span class="line"><span class="operator">&gt;</span> subset<span class="punctuation">(</span>student<span class="punctuation">,</span> select <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;sname&quot;</span><span class="punctuation">,</span> <span class="string">&quot;sage&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> sage<span class="operator">&gt;</span><span class="number">11</span> <span class="operator">&amp;</span> sno <span class="operator">==</span> <span class="number">2</span><span class="punctuation">)</span>    <span class="comment"># 可以理解问: SELECT sname, sage FROM student WHERE sage&gt;11 AND sno=2;</span></span><br><span class="line">  sname sage</span><br><span class="line"><span class="number">2</span>  lisi   <span class="number">12</span></span><br></pre></td></tr></table></figure>

<h5 id="2-8-6-因子-factor"><a href="#2-8-6-因子-factor" class="headerlink" title="2.8.6 因子 factor"></a>2.8.6 因子 <code>factor</code></h5><ul>
<li>概念：因子用于存储不同类别的数据类型，例如：人的性别有 <em>男</em> 和 <em>女</em> 两个类别，年龄来分可以有 <em>未成年人</em> 和 <em>成年人</em> 。</li>
<li>因子创建</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 因子创建</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 例 1:男 2:女</span></span><br><span class="line"><span class="operator">&gt;</span> x <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> factor<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">1</span> <span class="number">2</span> <span class="number">1</span> <span class="number">2</span> <span class="number">2</span> <span class="number">1</span> <span class="number">3</span></span><br><span class="line">Levels<span class="operator">:</span> <span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br><span class="line"><span class="operator">&gt;</span> factor<span class="punctuation">(</span>x<span class="punctuation">,</span> levels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">1</span>    <span class="number">2</span>    <span class="number">1</span>    <span class="number">2</span>    <span class="number">2</span>    <span class="number">1</span>    <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span></span><br><span class="line">Levels<span class="operator">:</span> <span class="number">1</span> <span class="number">2</span></span><br><span class="line"><span class="operator">&gt;</span> factor<span class="punctuation">(</span>x<span class="punctuation">,</span> levels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;男&quot;</span><span class="punctuation">,</span> <span class="string">&quot;女&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> 男   女   男   女   女   男   <span class="operator">&lt;</span><span class="literal">NA</span><span class="operator">&gt;</span></span><br><span class="line">Levels<span class="operator">:</span> 男 女</span><br></pre></td></tr></table></figure>

<h4 id="2-9-R-语言判断、控制、循环"><a href="#2-9-R-语言判断、控制、循环" class="headerlink" title="2.9 R 语言判断、控制、循环"></a>2.9 R 语言判断、控制、循环</h4><h5 id="2-9-1-判断语句"><a href="#2-9-1-判断语句" class="headerlink" title="2.9.1 判断语句"></a>2.9.1 判断语句</h5><ul>
<li><code>if</code> 语句</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 控制语句</span></span><br><span class="line"><span class="operator">&gt;</span> x <span class="operator">&lt;-</span> <span class="literal">TRUE</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="keyword">if</span> <span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="operator">+</span>   print<span class="punctuation">(</span><span class="string">&quot;x 为真&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">+</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;x 为真&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> </span><br><span class="line"><span class="operator">&gt;</span> <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">is.logical</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="operator">+</span>   print<span class="punctuation">(</span><span class="string">&quot;x 是逻辑型数据&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">+</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;x 是逻辑型数据&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>if...else...</code> 语句 和 <code>if...else if...</code> 语句</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> x <span class="operator">&lt;-</span> 10L</span><br><span class="line"><span class="operator">&gt;</span> <span class="keyword">if</span> <span class="punctuation">(</span><span class="built_in">is.logical</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="operator">+</span>   print<span class="punctuation">(</span><span class="string">&quot;x 是逻辑型数据&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">+</span> <span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="keyword">if</span><span class="punctuation">(</span><span class="built_in">is.numeric</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="operator">+</span>   print<span class="punctuation">(</span><span class="string">&quot;x 是数值型数据&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">+</span> <span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="operator">+</span>   print<span class="punctuation">(</span><span class="string">&quot;x 不是逻辑型数据, 也不是数值型数据&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">+</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;x 是数值型数据&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> </span><br><span class="line"><span class="operator">&gt;</span> y <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;a&quot;</span><span class="punctuation">,</span> <span class="string">&quot;b&quot;</span><span class="punctuation">,</span> <span class="string">&quot;c&quot;</span><span class="punctuation">,</span> <span class="string">&quot;e&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="keyword">if</span><span class="punctuation">(</span><span class="string">&quot;e&quot;</span> <span class="operator">%in%</span> y<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="operator">+</span>   print<span class="punctuation">(</span><span class="string">&quot;y 中包含 `e`&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">+</span> <span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="keyword">if</span> <span class="punctuation">(</span><span class="string">&quot;a&quot;</span> <span class="operator">%in%</span> y<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="operator">+</span>   print<span class="punctuation">(</span><span class="string">&quot;y 中包含 `a`&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">+</span> <span class="punctuation">&#125;</span> <span class="keyword">else</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="operator">+</span>   print<span class="punctuation">(</span><span class="string">&quot;不存在&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">+</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;y 中包含 `e`&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>switch</code> 语句</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># switch语句</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># x &lt;- switch (object,</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment">#   case = action</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># )</span></span><br><span class="line"><span class="operator">&gt;</span> </span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># expression(object) 是一个常量表达式, 可以是整数或字符串</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># 如果是整数, 则返回对应 case 的位置值, 如果整数不在范围内则返回 NULL</span></span><br><span class="line"><span class="operator">&gt;</span> x <span class="operator">&lt;-</span> <span class="built_in">switch</span> <span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"><span class="operator">+</span>   <span class="string">&quot;a&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="operator">+</span>   <span class="string">&quot;b&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="operator">+</span>   <span class="string">&quot;c&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="operator">+</span>   <span class="string">&quot;d&quot;</span></span><br><span class="line"><span class="operator">+</span> <span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> x</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;a&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> </span><br><span class="line"><span class="operator">&gt;</span> x <span class="operator">&lt;-</span> <span class="built_in">switch</span> <span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"><span class="operator">+</span>   <span class="string">&quot;a&quot;</span> <span class="operator">=</span> <span class="string">&quot;a1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="operator">+</span>   <span class="string">&quot;b&quot;</span> <span class="operator">=</span> <span class="string">&quot;b1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="operator">+</span>   <span class="string">&quot;c&quot;</span> <span class="operator">=</span> <span class="string">&quot;c1&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="operator">+</span>   <span class="string">&quot;d&quot;</span> <span class="operator">=</span> <span class="string">&quot;d1&quot;</span></span><br><span class="line"><span class="operator">+</span> <span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> x</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;a1&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> </span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># expression 如果是字符串, 则对应的是 case 中变量名对应的值, 没有匹配则没有返回值</span></span><br><span class="line"><span class="operator">&gt;</span> x <span class="operator">&lt;-</span> <span class="built_in">switch</span> <span class="punctuation">(</span><span class="string">&quot;c&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="operator">+</span>   <span class="string">&quot;a&quot;</span> <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"><span class="operator">+</span>   <span class="string">&quot;b&quot;</span> <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line"><span class="operator">+</span>   <span class="string">&quot;c&quot;</span> <span class="operator">=</span> <span class="string">&quot;cn&quot;</span></span><br><span class="line"><span class="operator">+</span> <span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> </span><br><span class="line"><span class="operator">&gt;</span> x</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;cn&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="2-9-2-循环语句"><a href="#2-9-2-循环语句" class="headerlink" title="2.9.2 循环语句"></a>2.9.2 循环语句</h5><ul>
<li><code>repeat + if(...) &#123; break &#125;</code></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 循环语句</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># repeat + if(...) &#123; break &#125;</span></span><br><span class="line"><span class="operator">&gt;</span> v <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Google&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Micrsoft&quot;</span><span class="punctuation">,</span> <span class="string">&quot;OpenAI&quot;</span><span class="punctuation">,</span> <span class="string">&quot;LinkIn&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> cnt <span class="operator">&lt;-</span> 3</span><br><span class="line"><span class="operator">&gt;</span> <span class="keyword">repeat</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="operator">+</span>   print<span class="punctuation">(</span>v<span class="punctuation">[</span>cnt<span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">+</span>   cnt <span class="operator">&lt;-</span> cnt <span class="operator">+</span> <span class="number">1</span></span><br><span class="line"><span class="operator">+</span>   <span class="keyword">if</span><span class="punctuation">(</span>cnt <span class="operator">&gt;</span> <span class="number">6</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span> <span class="keyword">break</span>; <span class="punctuation">&#125;</span></span><br><span class="line"><span class="operator">+</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;OpenAI&quot;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;LinkIn&quot;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">NA</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">NA</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>while()</code></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> </span><br><span class="line"><span class="operator">&gt;</span> <span class="comment"># while 循环</span></span><br><span class="line"><span class="operator">&gt;</span> v <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;Google&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Micrsoft&quot;</span><span class="punctuation">,</span> <span class="string">&quot;OpenAI&quot;</span><span class="punctuation">,</span> <span class="string">&quot;LinkIn&quot;</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> cnt <span class="operator">&lt;-</span> 3</span><br><span class="line"><span class="operator">&gt;</span> <span class="keyword">while</span><span class="punctuation">(</span>cnt <span class="operator">&lt;=</span> <span class="number">5</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="operator">+</span>   print<span class="punctuation">(</span>v<span class="punctuation">[</span>cnt<span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">+</span>   cnt <span class="operator">&lt;-</span> cnt <span class="operator">+</span> <span class="number">1</span></span><br><span class="line"><span class="operator">+</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;OpenAI&quot;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;LinkIn&quot;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="literal">NA</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>for()</code></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># for 循环</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">letters</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;a&quot;</span> <span class="string">&quot;b&quot;</span> <span class="string">&quot;c&quot;</span> <span class="string">&quot;d&quot;</span> <span class="string">&quot;e&quot;</span> <span class="string">&quot;f&quot;</span> <span class="string">&quot;g&quot;</span> <span class="string">&quot;h&quot;</span> <span class="string">&quot;i&quot;</span> <span class="string">&quot;j&quot;</span> <span class="string">&quot;k&quot;</span> <span class="string">&quot;l&quot;</span> <span class="string">&quot;m&quot;</span> <span class="string">&quot;n&quot;</span> <span class="string">&quot;o&quot;</span> <span class="string">&quot;p&quot;</span> <span class="string">&quot;q&quot;</span> <span class="string">&quot;r&quot;</span> <span class="string">&quot;s&quot;</span> <span class="string">&quot;t&quot;</span> <span class="string">&quot;u&quot;</span> <span class="string">&quot;v&quot;</span> <span class="string">&quot;w&quot;</span> <span class="string">&quot;x&quot;</span> <span class="string">&quot;y&quot;</span> <span class="string">&quot;z&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">LETTERS</span></span><br><span class="line"> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;A&quot;</span> <span class="string">&quot;B&quot;</span> <span class="string">&quot;C&quot;</span> <span class="string">&quot;D&quot;</span> <span class="string">&quot;E&quot;</span> <span class="string">&quot;F&quot;</span> <span class="string">&quot;G&quot;</span> <span class="string">&quot;H&quot;</span> <span class="string">&quot;I&quot;</span> <span class="string">&quot;J&quot;</span> <span class="string">&quot;K&quot;</span> <span class="string">&quot;L&quot;</span> <span class="string">&quot;M&quot;</span> <span class="string">&quot;N&quot;</span> <span class="string">&quot;O&quot;</span> <span class="string">&quot;P&quot;</span> <span class="string">&quot;Q&quot;</span> <span class="string">&quot;R&quot;</span> <span class="string">&quot;S&quot;</span> <span class="string">&quot;T&quot;</span> <span class="string">&quot;U&quot;</span> <span class="string">&quot;V&quot;</span> <span class="string">&quot;W&quot;</span> <span class="string">&quot;X&quot;</span> <span class="string">&quot;Y&quot;</span> <span class="string">&quot;Z&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="built_in">LETTERS</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span> <span class="number">6</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;A&quot;</span> <span class="string">&quot;B&quot;</span> <span class="string">&quot;C&quot;</span> <span class="string">&quot;D&quot;</span> <span class="string">&quot;E&quot;</span> <span class="string">&quot;F&quot;</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="built_in">LETTERS</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span> <span class="number">6</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="operator">+</span>   print<span class="punctuation">(</span>i<span class="punctuation">)</span></span><br><span class="line"><span class="operator">+</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;A&quot;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;B&quot;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;C&quot;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;D&quot;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;E&quot;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;F&quot;</span></span><br></pre></td></tr></table></figure>

<h5 id="2-9-3-控制语句"><a href="#2-9-3-控制语句" class="headerlink" title="2.9.3 控制语句"></a>2.9.3 控制语句</h5><ul>
<li><code>break</code></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># break语句</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="built_in">LETTERS</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span> <span class="number">6</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="operator">+</span>   <span class="keyword">if</span> <span class="punctuation">(</span>i <span class="operator">==</span> <span class="string">&quot;D&quot;</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="operator">+</span>     <span class="keyword">break</span>;</span><br><span class="line"><span class="operator">+</span>   <span class="punctuation">&#125;</span></span><br><span class="line"><span class="operator">+</span>   print<span class="punctuation">(</span>i<span class="punctuation">)</span></span><br><span class="line"><span class="operator">+</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;A&quot;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;B&quot;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;C&quot;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>next</code></li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># next语句</span></span><br><span class="line"><span class="operator">&gt;</span> <span class="keyword">for</span> <span class="punctuation">(</span>i <span class="keyword">in</span> <span class="built_in">LETTERS</span><span class="punctuation">[</span><span class="number">1</span><span class="operator">:</span> <span class="number">6</span><span class="punctuation">]</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="operator">+</span>   <span class="keyword">if</span> <span class="punctuation">(</span>i <span class="operator">==</span> <span class="string">&quot;D&quot;</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="operator">+</span>     <span class="keyword">next</span>;</span><br><span class="line"><span class="operator">+</span>   <span class="punctuation">&#125;</span></span><br><span class="line"><span class="operator">+</span>   print<span class="punctuation">(</span>i<span class="punctuation">)</span></span><br><span class="line"><span class="operator">+</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;A&quot;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;B&quot;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;C&quot;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;E&quot;</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="string">&quot;F&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-10-R-语言函数"><a href="#2-10-R-语言函数" class="headerlink" title="2.10 R 语言函数"></a>2.10 R 语言函数</h4><p>概念：函数是一组一起执行一个任务的语句。</p>
<h5 id="2-10-1-内置函数："><a href="#2-10-1-内置函数：" class="headerlink" title="2.10.1 内置函数："></a>2.10.1 内置函数：</h5><ul>
<li><code>print()</code></li>
<li><code>cat()</code></li>
<li><code>list()</code></li>
<li><code>array()</code></li>
</ul>
<h5 id="2-10-2-自定义函数"><a href="#2-10-2-自定义函数" class="headerlink" title="2.10.2 自定义函数"></a>2.10.2 自定义函数</h5><p><code>R</code> 语言函数通常由以下几个部分组成：</p>
<ul>
<li>函数名</li>
<li>参数</li>
<li>函数体</li>
<li>返回值</li>
</ul>
<p>具体格式如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function_name <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span>arg_1<span class="punctuation">,</span> arg_2<span class="punctuation">,</span> ...<span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment"># 函数体</span></span><br><span class="line">    <span class="comment"># 执行的代码块</span></span><br><span class="line">    <span class="built_in">return</span><span class="punctuation">(</span>output<span class="punctuation">)</span>	<span class="comment"># 返回值</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>下面由一些例子来演示：</p>
<p>只演示几种情况，其他情况（如有参函数、有默认参数值的函数都和其他语言类似）。</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># R 语言函数</span></span><br><span class="line"><span class="operator">&gt;</span> new.function <span class="operator">&lt;-</span> <span class="keyword">function</span><span class="punctuation">(</span><span class="punctuation">)</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="operator">+</span>   <span class="comment"># 函数体</span></span><br><span class="line"><span class="operator">+</span>   <span class="keyword">for</span><span class="punctuation">(</span>i <span class="keyword">in</span> <span class="number">1</span><span class="operator">:</span> <span class="number">6</span><span class="punctuation">)</span><span class="punctuation">&#123;</span></span><br><span class="line"><span class="operator">+</span>     print<span class="punctuation">(</span>i<span class="operator">^</span><span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">+</span>   <span class="punctuation">&#125;</span></span><br><span class="line"><span class="operator">+</span> <span class="punctuation">&#125;</span></span><br><span class="line"><span class="operator">&gt;</span> </span><br><span class="line"><span class="operator">&gt;</span> new.function<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">4</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">9</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">16</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">25</span></span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> <span class="number">36</span></span><br></pre></td></tr></table></figure>

<h4 id="2-11-R语言读写数据文件、数据库"><a href="#2-11-R语言读写数据文件、数据库" class="headerlink" title="2.11 R语言读写数据文件、数据库"></a>2.11 R语言读写数据文件、数据库</h4><h5 id="2-11-1-读写数据文件"><a href="#2-11-1-读写数据文件" class="headerlink" title="2.11.1 读写数据文件"></a>2.11.1 读写数据文件</h5><table>
<thead>
<tr>
<th>读写类型</th>
<th>读写方法</th>
<th align="center">备注</th>
</tr>
</thead>
<tbody><tr>
<td>从键盘输入数据</td>
<td><code>edit()</code></td>
<td align="center">使用方法见下方代码</td>
</tr>
<tr>
<td>读写 <code>.txt</code> 格式文件</td>
<td>读 <code>read.table</code> <br />写 <code>write.table</code></td>
<td align="center">-</td>
</tr>
<tr>
<td>读写 <code>.csv</code> 格式文件</td>
<td>读 <code>read.csv()</code><br />写 <code>write.csv()</code></td>
<td align="center">-</td>
</tr>
<tr>
<td>读写 <code>.xlsx</code> 格式文件</td>
<td>读 <code>read.xlsx()</code><br />写 <code>write.xlsx()</code></td>
<td align="center">使用之前需要下载并加载 R语言的 <code>xlsx</code> 包</td>
</tr>
</tbody></table>
<ol>
<li>从键盘中输入数据</li>
</ol>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">&gt;</span> <span class="comment"># 从键盘读入数据, edit() 和 fix() 可以可视化的输入数据</span></span><br><span class="line"><span class="operator">&gt;</span> mydata <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span>age<span class="operator">=</span>numeric<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span> gender<span class="operator">=</span>character<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">,</span> weight<span class="operator">=</span>numeric<span class="punctuation">(</span><span class="number">0</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> mydata</span><br><span class="line"><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">]</span> age    gender weight</span><br><span class="line"><span class="operator">&lt;</span><span class="number">0</span> 行<span class="operator">&gt;</span> <span class="punctuation">(</span>或<span class="number">0</span><span class="operator">-</span>长度的row.names<span class="punctuation">)</span></span><br><span class="line"><span class="operator">&gt;</span> edit<span class="punctuation">(</span>mydata<span class="punctuation">)</span></span><br><span class="line">  age gender weight</span><br><span class="line"><span class="number">1</span>  <span class="number">12</span>      <span class="number">2</span>    <span class="number">120</span></span><br><span class="line"><span class="number">2</span>  <span class="number">13</span>      <span class="number">2</span>     <span class="literal">NA</span></span><br><span class="line"><span class="operator">&gt;</span> </span><br><span class="line"><span class="operator">&gt;</span> fix<span class="punctuation">(</span>mydata<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>读写 <code>.txt</code> 格式文件</li>
</ol>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">stutxt <span class="operator">&lt;-</span> read.table<span class="punctuation">(</span><span class="string">&quot;/path/to/file.txt&quot;</span><span class="punctuation">,</span> header<span class="operator">=</span><span class="literal">TRUE</span><span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;,&quot;</span><span class="punctuation">)</span></span><br><span class="line">stutxt</span><br><span class="line"><span class="built_in">class</span><span class="punctuation">(</span>stutxt<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">write.table<span class="punctuation">(</span>stutxt<span class="punctuation">,</span> <span class="string">&quot;/path/to/write.txt&quot;</span><span class="punctuation">,</span> sep<span class="operator">=</span><span class="string">&quot;,&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>读写 <code>.csv</code> 格式文件</li>
</ol>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">csvfile <span class="operator">&lt;-</span> read.csv<span class="punctuation">(</span><span class="string">&quot;/path/to/file.csv&quot;</span><span class="punctuation">)</span></span><br><span class="line">csvfile</span><br><span class="line"></span><br><span class="line">write.csv<span class="punctuation">(</span>csvfile<span class="punctuation">,</span> <span class="string">&quot;/path/to/write.csv&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>读写 <code>.xlsx</code> 格式文件</li>
</ol>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">install.packages<span class="punctuation">(</span><span class="string">&quot;xlsx&quot;</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">search<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span><span class="string">&quot;x1sx&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">student <span class="operator">&lt;-</span> read.xlsx<span class="punctuation">(</span><span class="string">&quot;/path/to/file.xlsx&quot;</span><span class="punctuation">,</span> sheetIndex<span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> encoding <span class="operator">=</span> <span class="string">&quot;UTF-8&quot;</span><span class="punctuation">)</span></span><br><span class="line">student</span><br><span class="line"></span><br><span class="line">city<span class="operator">&lt;-</span>read.xlsx<span class="punctuation">(</span><span class="string">&quot;/path/to/file.xlsx&quot;</span><span class="punctuation">,</span> sheetName <span class="operator">=</span> <span class="string">&quot;city&quot;</span><span class="punctuation">,</span>encoding <span class="operator">=</span> <span class="string">&quot;UTF-8&quot;</span><span class="punctuation">)</span></span><br><span class="line">city</span><br><span class="line"></span><br><span class="line">write.xlsx<span class="punctuation">(</span>city<span class="punctuation">,</span> <span class="string">&quot;/path/to/write.xlsx&quot;</span><span class="punctuation">,</span> sheetName <span class="operator">=</span> <span class="string">&quot;city&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h5 id="2-11-2-读写数据库"><a href="#2-11-2-读写数据库" class="headerlink" title="2.11.2 读写数据库"></a>2.11.2 读写数据库</h5><p>非重点，有需要可自行了解</p>
<h4 id="2-12-R-语言基础绘图"><a href="#2-12-R-语言基础绘图" class="headerlink" title="2.12 R 语言基础绘图"></a>2.12 R 语言基础绘图</h4><h5 id="2-12-1-R-语言绘制barplot-条形图、堆叠条形图"><a href="#2-12-1-R-语言绘制barplot-条形图、堆叠条形图" class="headerlink" title="2.12.1 R 语言绘制barplot() 条形图、堆叠条形图"></a>2.12.1 R 语言绘制<code>barplot()</code> 条形图、堆叠条形图</h5><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">####### 1. 绘制条形图 barplot()</span></span><br><span class="line"><span class="comment"># 1.1 height: 高度, 通过这个参数可以指定要画多少个柱子, 以及每个柱子的高度, 其值有两种——向量、矩阵</span></span><br><span class="line"><span class="comment"># 1.1.1 向量 vector, 此时会根据向量的长度确定图中有多少个柱子, 向量中的每个值就是高度</span></span><br><span class="line">barplot<span class="punctuation">(</span>height <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span> <span class="number">5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.1.2 矩阵 matrix, 此时用于画堆积柱状图</span></span><br><span class="line">data <span class="operator">&lt;-</span> cbind<span class="punctuation">(</span>a <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span> <span class="number">4</span><span class="punctuation">,</span> b <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span> <span class="number">4</span><span class="punctuation">)</span></span><br><span class="line">data</span><br><span class="line"><span class="built_in">class</span><span class="punctuation">(</span>data<span class="punctuation">)</span></span><br><span class="line">barplot<span class="punctuation">(</span>height <span class="operator">=</span> data<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.2 width: 宽度, 控制每个柱子的宽度, 默认值为 1, 值得注意的是, 这个参数的值是可以循环使用的</span></span><br><span class="line">barplot<span class="punctuation">(</span>height <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span> <span class="number">5</span><span class="punctuation">)</span></span><br><span class="line">barplot<span class="punctuation">(</span>height <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span> <span class="number">5</span><span class="punctuation">,</span> width<span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">barplot<span class="punctuation">(</span>height <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span> <span class="number">5</span><span class="punctuation">,</span> width<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">barplot<span class="punctuation">(</span>height <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span> <span class="number">5</span><span class="punctuation">,</span> width<span class="operator">=</span><span class="number">1</span><span class="operator">:</span> <span class="number">5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">data <span class="operator">&lt;-</span> cbind<span class="punctuation">(</span>a <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span> <span class="number">4</span><span class="punctuation">,</span> b <span class="operator">=</span> <span class="number">1</span><span class="operator">:</span><span class="number">4</span><span class="punctuation">)</span></span><br><span class="line">barplot<span class="punctuation">(</span>height <span class="operator">=</span> data<span class="punctuation">)</span></span><br><span class="line">barplot<span class="punctuation">(</span>height <span class="operator">=</span> data<span class="punctuation">,</span> width<span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">barplot<span class="punctuation">(</span>height <span class="operator">=</span> data<span class="punctuation">,</span> width<span class="operator">=</span><span class="number">1</span><span class="operator">:</span><span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.3 space: 间隔, 指定每个柱子左边的空白区域的宽度, 这个值为一个百分比, 默认值为 0.2</span></span><br><span class="line">barplot<span class="punctuation">(</span>height<span class="operator">=</span><span class="number">1</span><span class="operator">:</span> <span class="number">5</span><span class="punctuation">,</span> space<span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">barplot<span class="punctuation">(</span>height<span class="operator">=</span><span class="number">1</span><span class="operator">:</span> <span class="number">5</span><span class="punctuation">,</span> space<span class="operator">=</span><span class="number">5</span><span class="operator">:</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">barplot<span class="punctuation">(</span>height<span class="operator">=</span>data<span class="punctuation">,</span> space<span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">barplot<span class="punctuation">(</span>height<span class="operator">=</span>data<span class="punctuation">,</span> space<span class="operator">=</span><span class="number">1</span><span class="operator">:</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.4 names.arg: 每个柱子下面的标记, 当 height 为 vector 时, 默认的标记为向量的 names 属性</span></span><br><span class="line">barplot<span class="punctuation">(</span>height<span class="operator">=</span><span class="number">1</span><span class="operator">:</span><span class="number">3</span><span class="punctuation">,</span> names.arg<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;a&quot;</span><span class="punctuation">,</span><span class="string">&quot;b&quot;</span><span class="punctuation">,</span><span class="string">&quot;c&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">v <span class="operator">&lt;-</span> 1<span class="operator">:</span><span class="number">3</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>v<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;c&quot;</span> <span class="punctuation">,</span><span class="string">&quot;b&quot;</span> <span class="punctuation">,</span><span class="string">&quot;a&quot;</span><span class="punctuation">)</span></span><br><span class="line">v</span><br><span class="line">barplot<span class="punctuation">(</span>height<span class="operator">=</span>v<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.5 horiz: 逻辑值, 默认为 FALSE, 当值为 TRUE 时, 将 X 轴和 Y 轴转置</span></span><br><span class="line">barplot<span class="punctuation">(</span>height<span class="operator">=</span><span class="number">1</span><span class="operator">:</span><span class="number">3</span><span class="punctuation">,</span> horiz <span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">barplot<span class="punctuation">(</span>height<span class="operator">=</span><span class="number">1</span><span class="operator">:</span><span class="number">3</span><span class="punctuation">,</span> horiz <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line">data</span><br><span class="line"></span><br><span class="line">barplot<span class="punctuation">(</span>height<span class="operator">=</span>data<span class="punctuation">,</span> horiz<span class="operator">=</span> <span class="literal">FALSE</span><span class="punctuation">)</span></span><br><span class="line">barplot<span class="punctuation">(</span>height<span class="operator">=</span>data<span class="punctuation">,</span> horiz <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.6 col: 柱子的填充色, 默认为灰色</span></span><br><span class="line"><span class="comment"># 1.7 border: 柱子边框的颜色, 默认为 black, 当 border为 NA时, 表示没有边框</span></span><br><span class="line"><span class="comment"># 1.8 main: 设置图形标题</span></span><br><span class="line"><span class="built_in">c</span> <span class="operator">&lt;-</span> colors<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">c</span></span><br><span class="line"><span class="built_in">c</span><span class="punctuation">[</span><span class="number">2</span><span class="operator">:</span> <span class="number">5</span><span class="punctuation">]</span></span><br><span class="line"></span><br><span class="line">barplot<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span> <span class="number">4</span><span class="punctuation">,</span> col<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">[</span><span class="number">2</span><span class="operator">:</span><span class="number">5</span><span class="punctuation">]</span><span class="punctuation">,</span> border <span class="operator">=</span> <span class="literal">NA</span><span class="punctuation">,</span> main<span class="operator">=</span><span class="string">&quot;图形标题&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">barplot<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span> <span class="number">4</span><span class="punctuation">,</span> col<span class="operator">=</span>rainbow<span class="punctuation">(</span><span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">barplot<span class="punctuation">(</span><span class="number">1</span><span class="operator">:</span> <span class="number">4</span><span class="punctuation">,</span> col<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;red&quot;</span><span class="punctuation">,</span> <span class="string">&quot;green&quot;</span><span class="punctuation">,</span> <span class="string">&quot;antiquewhite&quot;</span><span class="punctuation">,</span> <span class="string">&quot;white&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">barplot<span class="punctuation">(</span>data<span class="punctuation">,</span> col<span class="operator">=</span>rainbow<span class="punctuation">(</span><span class="number">4</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.9 &amp; 1.10 density 设置柱子用线条填充, density 控制线条的密度，angle 控制线条的角度</span></span><br><span class="line">par<span class="punctuation">(</span>mfrow<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">par</span><br><span class="line"></span><br><span class="line">barplot<span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">,</span> density <span class="operator">=</span> <span class="number">1</span><span class="punctuation">,</span> angle <span class="operator">=</span> <span class="number">30</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;density = 1&quot;</span><span class="punctuation">)</span></span><br><span class="line">barplot<span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">,</span> density <span class="operator">=</span> <span class="number">2</span><span class="punctuation">,</span> angle <span class="operator">=</span> <span class="number">90</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;density = 2&quot;</span><span class="punctuation">)</span></span><br><span class="line">barplot<span class="punctuation">(</span><span class="built_in">rep</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">)</span><span class="punctuation">,</span> density <span class="operator">=</span> <span class="number">3</span><span class="punctuation">,</span> angle <span class="operator">=</span> <span class="number">180</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;density = 3&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.11 axes: 逻辑值, 控制是否显示轴线(如 y 轴线)</span></span><br><span class="line">barplot<span class="punctuation">(</span>data<span class="punctuation">,</span> axes <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line">barplot<span class="punctuation">(</span>data<span class="punctuation">,</span> axes <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.12 axisnames: 控制是否显示柱子的标签</span></span><br><span class="line">barplot<span class="punctuation">(</span>data<span class="punctuation">,</span> axisnames <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line">barplot<span class="punctuation">(</span>data<span class="punctuation">,</span> axisnames <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.13 beside: 当输入参数为矩阵时, 默认是堆积柱状图, beside 默认值为 FALSE;</span></span><br><span class="line"><span class="comment"># beside = FALSE 时, 条形图的高度是矩阵的数值, 矩形条是水平堆叠的</span></span><br><span class="line"><span class="comment"># beside = TRUE 时, 条形图的高度是矩阵的数值, 矩形条是并列的</span></span><br><span class="line">data</span><br><span class="line">barplot<span class="punctuation">(</span>data<span class="punctuation">,</span> beside <span class="operator">=</span> <span class="built_in">F</span><span class="punctuation">)</span></span><br><span class="line">barplot<span class="punctuation">(</span>data<span class="punctuation">,</span> beside <span class="operator">=</span> <span class="built_in">T</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.14 legend.text: 图例的文字说明</span></span><br><span class="line"><span class="comment"># 只有当 height 参数的值是 matrix 时, 才起作用</span></span><br><span class="line"><span class="comment"># 默认显示的是 matrix 的 rownames 属性</span></span><br><span class="line"><span class="comment"># 其值有两种指定形式:</span></span><br><span class="line"><span class="comment"># 第一种: 逻辑值, 是否需要显示图例, 默认为FALSE</span></span><br><span class="line">par<span class="punctuation">(</span>mfrow<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">data</span><br><span class="line">rownames<span class="punctuation">(</span>data<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;A1&quot;</span><span class="punctuation">,</span> <span class="string">&quot;A2&quot;</span><span class="punctuation">,</span> <span class="string">&quot;A3&quot;</span><span class="punctuation">,</span> <span class="string">&quot;A4&quot;</span><span class="punctuation">)</span></span><br><span class="line">data</span><br><span class="line">barplot<span class="punctuation">(</span>data<span class="punctuation">,</span> legend.text <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第二种, 指定图例中的文字内容</span></span><br><span class="line"><span class="comment"># 相当于修改了 matrix 的 rownames 属性</span></span><br><span class="line">barplot<span class="punctuation">(</span>data<span class="punctuation">,</span> legend.text <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;D&quot;</span><span class="punctuation">,</span> <span class="string">&quot;E&quot;</span><span class="punctuation">,</span> <span class="string">&quot;F&quot;</span><span class="punctuation">,</span> <span class="string">&quot;G&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h5 id="2-12-2-R-语言绘制-饼图、3D饼图绘制"><a href="#2-12-2-R-语言绘制-饼图、3D饼图绘制" class="headerlink" title="2.12.2 R 语言绘制 饼图、3D饼图绘制"></a>2.12.2 R 语言绘制 饼图、3D饼图绘制</h5><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">####### 2. 绘制饼图</span></span><br><span class="line"><span class="comment"># 2.1 x: 数值向量, 表示每个扇形的面积</span></span><br><span class="line">x <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">21</span><span class="punctuation">,</span> <span class="number">62</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">53</span><span class="punctuation">)</span></span><br><span class="line">pie<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.2 labels: 字符型向量, 表示各扇形面积标签</span></span><br><span class="line">x<span class="operator">&lt;-</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">21</span><span class="punctuation">,</span> <span class="number">62</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">53</span><span class="punctuation">)</span></span><br><span class="line"><span class="built_in">names</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;London&quot;</span><span class="punctuation">,</span> <span class="string">&quot;New York&quot;</span><span class="punctuation">,</span> <span class="string">&quot;singapore&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Mumbai&quot;</span><span class="punctuation">)</span></span><br><span class="line">x</span><br><span class="line">pie<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">x<span class="operator">&lt;-</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">21</span><span class="punctuation">,</span> <span class="number">62</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">53</span><span class="punctuation">)</span></span><br><span class="line">pie<span class="punctuation">(</span>x<span class="punctuation">)</span></span><br><span class="line">pie<span class="punctuation">(</span>x<span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;London&quot;</span><span class="punctuation">,</span> <span class="string">&quot;New York&quot;</span><span class="punctuation">,</span> <span class="string">&quot;singapore&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Mumbai&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.3 radius: 饼图的半径</span></span><br><span class="line">x<span class="operator">&lt;-</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">21</span><span class="punctuation">,</span> <span class="number">62</span><span class="punctuation">,</span> <span class="number">10</span><span class="punctuation">,</span> <span class="number">53</span><span class="punctuation">)</span></span><br><span class="line">pie<span class="punctuation">(</span>x<span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;London&quot;</span><span class="punctuation">,</span> <span class="string">&quot;New York&quot;</span><span class="punctuation">,</span> <span class="string">&quot;singapore&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Mumbai&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> radius <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.4 main: 饼图的标题</span></span><br><span class="line">pie<span class="punctuation">(</span>x<span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;London&quot;</span><span class="punctuation">,</span> <span class="string">&quot;New York&quot;</span><span class="punctuation">,</span> <span class="string">&quot;singapore&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Mumbai&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> radius <span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> main<span class="operator">=</span><span class="string">&quot;饼图&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.5 clockwise: 一个逻辑值, 用来指定饼图各个切片是否按顺时针做出分割</span></span><br><span class="line">pie<span class="punctuation">(</span>x<span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;London&quot;</span><span class="punctuation">,</span> <span class="string">&quot;New York&quot;</span><span class="punctuation">,</span> <span class="string">&quot;singapore&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Mumbai&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> radius <span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> main<span class="operator">=</span><span class="string">&quot;饼图&quot;</span><span class="punctuation">,</span> clockwise <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.6 &amp; 2.7</span></span><br><span class="line"><span class="comment"># angle: 设置底纹的斜率</span></span><br><span class="line"><span class="comment"># density: 底纹的密度, 默认值为NULL</span></span><br><span class="line">pie<span class="punctuation">(</span>x<span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;London&quot;</span><span class="punctuation">,</span> <span class="string">&quot;New York&quot;</span><span class="punctuation">,</span> <span class="string">&quot;singapore&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Mumbai&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> radius <span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> main<span class="operator">=</span><span class="string">&quot;饼图&quot;</span><span class="punctuation">,</span> clockwise <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> density <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> angle <span class="operator">=</span> <span class="number">20</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.8 col: 每个扇面的颜色, 相当于调色板</span></span><br><span class="line">pie<span class="punctuation">(</span>x<span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;London&quot;</span><span class="punctuation">,</span> <span class="string">&quot;New York&quot;</span><span class="punctuation">,</span> <span class="string">&quot;singapore&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Mumbai&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">    radius <span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> main<span class="operator">=</span><span class="string">&quot;饼图&quot;</span><span class="punctuation">,</span> clockwise <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> </span><br><span class="line">    density <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> angle <span class="operator">=</span> <span class="number">20</span><span class="punctuation">,</span> col <span class="operator">=</span> rainbow<span class="punctuation">(</span><span class="built_in">length</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">pie<span class="punctuation">(</span>x<span class="punctuation">,</span> labels <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;London&quot;</span><span class="punctuation">,</span> <span class="string">&quot;New York&quot;</span><span class="punctuation">,</span> <span class="string">&quot;singapore&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Mumbai&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> </span><br><span class="line">    radius <span class="operator">=</span><span class="number">1</span><span class="punctuation">,</span> main<span class="operator">=</span><span class="string">&quot;饼图&quot;</span><span class="punctuation">,</span> clockwise <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> </span><br><span class="line">    col <span class="operator">=</span> rainbow<span class="punctuation">(</span><span class="built_in">length</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.9 设置百分数</span></span><br><span class="line">piepercent <span class="operator">&lt;-</span> <span class="built_in">round</span><span class="punctuation">(</span>x<span class="operator">/</span><span class="built_in">sum</span><span class="punctuation">(</span>x<span class="punctuation">)</span> <span class="operator">*</span> <span class="number">100</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">)</span></span><br><span class="line">pie<span class="punctuation">(</span>x<span class="punctuation">,</span> piepercent<span class="punctuation">,</span> radius<span class="operator">=</span><span class="number">0.5</span><span class="punctuation">,</span> main<span class="operator">=</span><span class="string">&quot;饼图&quot;</span><span class="punctuation">,</span> clockwise<span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> col<span class="operator">=</span>rainbow<span class="punctuation">(</span><span class="built_in">length</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.10 设置图例</span></span><br><span class="line">legend<span class="punctuation">(</span><span class="string">&quot;topright&quot;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;London&quot;</span><span class="punctuation">,</span> <span class="string">&quot;New York&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Singapore&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Mumbai&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">       fill <span class="operator">=</span> rainbow<span class="punctuation">(</span><span class="built_in">length</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">0.8</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">legend<span class="punctuation">(</span><span class="string">&quot;topright&quot;</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;London&quot;</span><span class="punctuation">,</span> <span class="string">&quot;New York&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Singapore&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Mumbai&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">       fill <span class="operator">=</span> rainbow<span class="punctuation">(</span><span class="built_in">length</span><span class="punctuation">(</span>x<span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">,</span> horiz <span class="operator">=</span> <span class="literal">TRUE</span><span class="punctuation">,</span> cex <span class="operator">=</span> <span class="number">0.5</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.11 绘制 3D 饼图</span></span><br><span class="line">install.packages<span class="punctuation">(</span><span class="string">&quot;plotrix&quot;</span><span class="punctuation">)</span></span><br><span class="line">library<span class="punctuation">(</span><span class="string">&quot;plotrix&quot;</span><span class="punctuation">)</span></span><br><span class="line">lbl <span class="operator">&lt;-</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;London&quot;</span><span class="punctuation">,</span> <span class="string">&quot;New York&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Singapore&quot;</span><span class="punctuation">,</span> <span class="string">&quot;Mumbai&quot;</span><span class="punctuation">)</span></span><br><span class="line">pie3D<span class="punctuation">(</span>x<span class="punctuation">,</span> labels <span class="operator">=</span> lbl<span class="punctuation">,</span> explode <span class="operator">=</span> <span class="number">0.1</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;城市 3D 饼图&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h5 id="2-12-3-R-语言散点图、折线图、散点矩阵图"><a href="#2-12-3-R-语言散点图、折线图、散点矩阵图" class="headerlink" title="2.12.3 R 语言散点图、折线图、散点矩阵图"></a>2.12.3 R 语言散点图、折线图、散点矩阵图</h5><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">####### 3. 绘制散点图、折线图、散点矩阵图</span></span><br><span class="line"><span class="comment"># 3.1 绘制散点图 plot()</span></span><br><span class="line"><span class="comment"># x: 横坐标, x轴的数据集合</span></span><br><span class="line"><span class="comment"># y: 纵坐标, y轴的数据集合</span></span><br><span class="line"><span class="comment"># type: 绘图的类型, type=&quot;p&quot; 为点(默认); </span></span><br><span class="line"><span class="comment">#                   type=&quot;l&quot; 在图形中数据显示为线;</span></span><br><span class="line"><span class="comment">#                   type=&quot;b&quot; 在图形中数据显示为点和连接线;</span></span><br><span class="line"><span class="comment">#                   type=&quot;o&quot; 在图形中数据点覆盖在线上;</span></span><br><span class="line"><span class="comment">#                   type=&quot;h&quot; 在图形中数据显示为从点到x轴的垂直线; </span></span><br><span class="line"><span class="comment">#                   type=&quot;s&quot; 在图形中数据显示为阶梯图;</span></span><br><span class="line"><span class="comment">#                   type=&quot;n&quot; 在图形中数据不显示</span></span><br><span class="line"><span class="comment"># main: 图表标题</span></span><br><span class="line"><span class="comment"># xlab/ylab: x轴/y轴的标签名称</span></span><br><span class="line"><span class="comment"># xlim/ylim: x轴/y轴的范围</span></span><br><span class="line"><span class="comment"># axes: 布尔值, 是否绘制两个坐标轴</span></span><br><span class="line"><span class="comment"># pch: 点的样式由 pch 的取值决定</span></span><br><span class="line"><span class="comment"># cex: 表示相对于默认大小缩放倍数的数值。默认大小为1, 1.5表示放大为默认值的1.5倍; 0.5表示做小为默认大小的0.5倍;</span></span><br><span class="line"></span><br><span class="line">cars        <span class="comment"># 加载车辆时速-刹车距离数据集</span></span><br><span class="line">cars<span class="operator">$</span>speed  <span class="comment"># 查看车辆时速</span></span><br><span class="line">cars<span class="operator">$</span>dist   <span class="comment"># 查看车辆刹车距离</span></span><br><span class="line"></span><br><span class="line">plot<span class="punctuation">(</span>cars<span class="operator">$</span>speed<span class="punctuation">,</span> cars<span class="operator">$</span>dist<span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>cars<span class="punctuation">[</span><span class="punctuation">,</span> <span class="number">1</span><span class="punctuation">]</span><span class="punctuation">,</span> cars<span class="punctuation">[</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>cars<span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">plot<span class="punctuation">(</span>cars<span class="punctuation">,</span> main<span class="operator">=</span><span class="string">&quot;车辆时速-刹车距离散点图&quot;</span><span class="punctuation">,</span> xlab<span class="operator">=</span><span class="string">&quot;车速&quot;</span><span class="punctuation">,</span> ylab<span class="operator">=</span><span class="string">&quot;刹车距离&quot;</span><span class="punctuation">,</span></span><br><span class="line">     col<span class="operator">=</span><span class="string">&quot;red&quot;</span><span class="punctuation">,</span> pch<span class="operator">=</span><span class="number">4</span><span class="punctuation">,</span> cex<span class="operator">=</span><span class="number">1</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">with<span class="punctuation">(</span>classData<span class="punctuation">,</span> plot<span class="punctuation">(</span>height<span class="punctuation">,</span> weight<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.2 绘制折线图 plot()</span></span><br><span class="line"><span class="comment"># type: 绘图的类型, type=&quot;p&quot; 为点(默认); </span></span><br><span class="line"><span class="comment">#                   type=&quot;l&quot; 在图形中数据显示为线;</span></span><br><span class="line"><span class="comment">#                   type=&quot;b&quot; 在图形中数据显示为点和连接线;</span></span><br><span class="line"><span class="comment">#                   type=&quot;o&quot; 在图形中数据点覆盖在线上;</span></span><br><span class="line"><span class="comment">#                   type=&quot;h&quot; 在图形中数据显示为从点到 x 轴的垂直线(直线条形图);</span></span><br><span class="line"><span class="comment">#                   type=&quot;s&quot; 在图形中数据显示为阶梯图;</span></span><br><span class="line"><span class="comment">#                   type=&quot;c&quot; 在图形中数据虚线图;</span></span><br><span class="line"><span class="comment">#                   type=&quot;n&quot; 在图形中数据不显示</span></span><br><span class="line">plot<span class="punctuation">(</span>cars<span class="operator">$</span>speed<span class="punctuation">,</span> cars<span class="operator">$</span>dist<span class="punctuation">,</span> type<span class="operator">=</span><span class="string">&quot;l&quot;</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>cars<span class="operator">$</span>speed<span class="punctuation">,</span> cars<span class="operator">$</span>dist<span class="punctuation">,</span> type<span class="operator">=</span><span class="string">&quot;b&quot;</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>cars<span class="operator">$</span>speed<span class="punctuation">,</span> cars<span class="operator">$</span>dist<span class="punctuation">,</span> type<span class="operator">=</span><span class="string">&quot;o&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># plot 可以配合lines() 函数绘制出多条折线图</span></span><br><span class="line"><span class="comment"># lines() 函数必须与 plot() 函数配合才能使用, 先用 plot() 函数画出一个图形</span></span><br><span class="line"><span class="comment"># round(x, digits = 0) 舍入函数, x 为数值向量, digits表示有效位数, 可以为负数, 负数表示舍入十位(-1)、百位(-2)...等</span></span><br><span class="line">x <span class="operator">&lt;-</span> 1<span class="operator">:</span> <span class="number">10</span></span><br><span class="line">beijing <span class="operator">&lt;-</span> <span class="built_in">round</span><span class="punctuation">(</span>rnorm<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span> mean <span class="operator">=</span> <span class="number">20</span><span class="punctuation">,</span> sd <span class="operator">=</span> <span class="number">2</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">beijing</span><br><span class="line">shanghai <span class="operator">&lt;-</span> <span class="built_in">round</span><span class="punctuation">(</span>rnorm<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span> mean <span class="operator">=</span> <span class="number">23</span><span class="punctuation">,</span> sd <span class="operator">=</span> <span class="number">3</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">shanghai</span><br><span class="line">guangzhou <span class="operator">&lt;-</span> <span class="built_in">round</span><span class="punctuation">(</span>rnorm<span class="punctuation">(</span><span class="number">10</span><span class="punctuation">,</span> mean <span class="operator">=</span> <span class="number">18</span><span class="punctuation">,</span> sd <span class="operator">=</span> <span class="number">1</span><span class="punctuation">)</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">guangzhou</span><br><span class="line"></span><br><span class="line">plot<span class="punctuation">(</span>x<span class="punctuation">,</span> beijing<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;l&quot;</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">16</span><span class="punctuation">,</span> <span class="number">30</span><span class="punctuation">)</span><span class="punctuation">,</span> lwd<span class="operator">=</span><span class="number">2</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;北上广近十天气温变化趋势图&quot;</span><span class="punctuation">)</span></span><br><span class="line">lines<span class="punctuation">(</span>x<span class="punctuation">,</span> shanghai<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;b&quot;</span><span class="punctuation">,</span> col<span class="operator">=</span><span class="string">&quot;blue&quot;</span><span class="punctuation">,</span> lwd<span class="operator">=</span><span class="number">2</span><span class="punctuation">)</span></span><br><span class="line">lines<span class="punctuation">(</span>x<span class="punctuation">,</span> guangzhou<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;l&quot;</span><span class="punctuation">,</span> col<span class="operator">=</span><span class="string">&quot;red&quot;</span><span class="punctuation">,</span> lwd<span class="operator">=</span><span class="number">2</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用 plot() 会单独绘制一张新图</span></span><br><span class="line">plot<span class="punctuation">(</span>x<span class="punctuation">,</span> shanghai<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;l&quot;</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">16</span><span class="punctuation">,</span> <span class="number">30</span><span class="punctuation">)</span><span class="punctuation">,</span> lwd<span class="operator">=</span><span class="number">2</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;北上广近十天气温变化趋势图&quot;</span><span class="punctuation">)</span></span><br><span class="line">plot<span class="punctuation">(</span>x<span class="punctuation">,</span> guangzhou<span class="punctuation">,</span> type <span class="operator">=</span> <span class="string">&quot;l&quot;</span><span class="punctuation">,</span> ylim <span class="operator">=</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="number">16</span><span class="punctuation">,</span> <span class="number">30</span><span class="punctuation">)</span><span class="punctuation">,</span> lwd<span class="operator">=</span><span class="number">2</span><span class="punctuation">,</span> main <span class="operator">=</span> <span class="string">&quot;北上广近十天气温变化趋势图&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.3 绘制散点矩阵图</span></span><br><span class="line">mtcars     <span class="comment"># 加载 mtcars 数据集, 数据来自1974年美国汽车趋势杂志, 包括32辆汽车(1973-74款) 的油耗和10个方面的汽车设计和性能</span></span><br><span class="line">           <span class="comment"># mpg(Miles Per Gallon): 油耗(每加仑英里(美国)), 功能更强大, 更重的汽车往往消耗更多的燃油</span></span><br><span class="line">           <span class="comment"># cyl(cylinders): 汽缸数, 功率更大的汽车通常具有更多的汽缸</span></span><br><span class="line">           <span class="comment"># disp(displacement, in cubic inches): 排量(立方英寸), 发动机气缸的总容积</span></span><br><span class="line">           <span class="comment"># hp(horsepower): 总马力：这是汽车产生的功率的量度</span></span><br><span class="line">           <span class="comment"># drat：driveshaft ratio:后轴比率：这描述了驱动轴的转动与车轮的转动如何对应。较高的值会降低燃油效率。</span></span><br><span class="line">           <span class="comment"># wt(weight): 重量(1000磅)</span></span><br><span class="line">           <span class="comment"># qsec(1/4 mile time; a measure of acceleration): 1/4英里时间：汽车的速度和加速度</span></span><br><span class="line">           <span class="comment"># vs(‘V’ or straight - engine shape): 发动机缸体, 表示车辆的发动机形状是&quot;V&quot; 形还是更常见的直形。</span></span><br><span class="line">           <span class="comment"># am(transmission; auto or manual): 变速箱, 这表示汽车的变速箱是自动(0)还是手动(1)。</span></span><br><span class="line">           <span class="comment"># gear(abbreviation of gears): 前进挡的数量, 跑车往往具有更多的挡位</span></span><br><span class="line">           <span class="comment"># carb(abbreviation of carburetors): 化油器数量, 与更强大的发动机相关</span></span><br><span class="line"></span><br><span class="line">pairs<span class="punctuation">(</span>mtcars<span class="punctuation">[</span><span class="punctuation">,</span> <span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;wt&quot;</span><span class="punctuation">,</span> <span class="string">&quot;mpg&quot;</span><span class="punctuation">,</span> <span class="string">&quot;disp&quot;</span><span class="punctuation">,</span> <span class="string">&quot;cyl&quot;</span><span class="punctuation">)</span><span class="punctuation">]</span><span class="punctuation">)</span></span><br><span class="line">pairs<span class="punctuation">(</span>vs<span class="operator">~</span>wt <span class="operator">+</span> mpg <span class="operator">+</span> disp <span class="operator">+</span> cyl<span class="punctuation">,</span> data<span class="operator">=</span>mtcars<span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h5 id="2-12-4-R-语言绘制直方图"><a href="#2-12-4-R-语言绘制直方图" class="headerlink" title="2.12.4 R 语言绘制直方图"></a>2.12.4 R 语言绘制直方图</h5><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="2-12-5-R-语言绘制核密度图"><a href="#2-12-5-R-语言绘制核密度图" class="headerlink" title="2.12.5 R 语言绘制核密度图"></a>2.12.5 R 语言绘制核密度图</h5><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="2-12-6-R-语言绘制箱线图"><a href="#2-12-6-R-语言绘制箱线图" class="headerlink" title="2.12.6 R 语言绘制箱线图"></a>2.12.6 R 语言绘制箱线图</h5><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="2-12-7-R-语言小提琴图"><a href="#2-12-7-R-语言小提琴图" class="headerlink" title="2.12.7 R 语言小提琴图"></a>2.12.7 R 语言小提琴图</h5><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">####### 7. 小提琴图 </span></span><br><span class="line"><span class="comment"># vioplot 包中的 vioplot 函数用于绘制小提琴图, 小提琴图是核密度图与箱线图的结合</span></span><br><span class="line"><span class="comment"># install.packages(&quot;vioplot&quot;)</span></span><br><span class="line"><span class="comment"># install.packages(&quot;vioplot&quot;)</span></span><br><span class="line">library<span class="punctuation">(</span><span class="string">&quot;vioplot&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># `==` 意为比较等号两端是否相等</span></span><br><span class="line">mpg4 <span class="operator">&lt;-</span> mtcars<span class="operator">$</span>mpg<span class="punctuation">[</span>mtcars<span class="operator">$</span>cyl <span class="operator">==</span> <span class="number">4</span><span class="punctuation">]</span></span><br><span class="line">mpg4</span><br><span class="line">mpg6 <span class="operator">&lt;-</span> mtcars<span class="operator">$</span>mpg<span class="punctuation">[</span>mtcars<span class="operator">$</span>cyl <span class="operator">==</span> <span class="number">6</span><span class="punctuation">]</span></span><br><span class="line">mpg6</span><br><span class="line">mpg8 <span class="operator">&lt;-</span> mtcars<span class="operator">$</span>mpg<span class="punctuation">[</span>mtcars<span class="operator">$</span>cyl <span class="operator">==</span> <span class="number">8</span><span class="punctuation">]</span></span><br><span class="line">mpg8</span><br><span class="line"></span><br><span class="line">vioplot<span class="punctuation">(</span>mpg4<span class="punctuation">,</span> mpg6<span class="punctuation">,</span> mpg8<span class="punctuation">,</span> <span class="built_in">names</span><span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;4-cyl&quot;</span><span class="punctuation">,</span> <span class="string">&quot;6-cyl&quot;</span><span class="punctuation">,</span> <span class="string">&quot;8-cyl&quot;</span><span class="punctuation">)</span><span class="punctuation">,</span> col<span class="operator">=</span><span class="string">&quot;gold&quot;</span><span class="punctuation">)</span></span><br><span class="line">title<span class="punctuation">(</span><span class="string">&quot;四/六/八缸 车辆的油耗 (英里/加仑)&quot;</span><span class="punctuation">,</span> ylab<span class="operator">=</span><span class="string">&quot;Miles Per Gallon&quot;</span><span class="punctuation">,</span> xlab<span class="operator">=</span><span class="string">&quot;Num Of Cylinders&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 图片的保存</span></span><br><span class="line">pdf<span class="punctuation">(</span>file<span class="operator">=</span><span class="string">&quot;fig-vioplot.pdf&quot;</span><span class="punctuation">,</span> height <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> width <span class="operator">=</span> <span class="number">10</span><span class="punctuation">,</span> family <span class="operator">=</span> <span class="string">&quot;GB1&quot;</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">vioplot<span class="punctuation">(</span>mpg<span class="operator">~</span>cyl<span class="punctuation">,</span> data<span class="operator">=</span>mtcars<span class="punctuation">,</span> xlab<span class="operator">=</span><span class="string">&quot;气缸数&quot;</span><span class="punctuation">,</span> ylab<span class="operator">=</span><span class="string">&quot;加仑每英里&quot;</span><span class="punctuation">,</span> main<span class="operator">=</span><span class="string">&quot;里程数据&quot;</span><span class="punctuation">,</span> <span class="built_in">names</span><span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="string">&quot;4-cyl&quot;</span><span class="punctuation">,</span> <span class="string">&quot;6-cyl&quot;</span><span class="punctuation">,</span> <span class="string">&quot;8-cyl&quot;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">dev.off   <span class="comment"># 关闭图像设备, 我们经常使用图像设备来创建和保存图形输出</span></span><br><span class="line">          <span class="comment"># 当我们完成图形绘制并且不再需要将图形输出到设备上时, 我们需要关闭图像设备以释放系统资源并确保图形正确保存</span></span><br><span class="line">          <span class="comment"># 在 R 中, 我们可以使用 dev.off() 函数来关闭当前活动的图像设备</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="2-13-R-绘图常用拓展库-ggplot2-绘图"><a href="#2-13-R-绘图常用拓展库-ggplot2-绘图" class="headerlink" title="2.13 R 绘图常用拓展库 ggplot2 绘图"></a>2.13 <code>R</code> 绘图常用拓展库 <code>ggplot2</code> 绘图</h4><p><strong>简介：</strong><code>ggplot2</code>是一款强大的图形可视化R包，其作图方式易于理解，且生成的图形精美，定制化程度也很高，是 R 语言中很流行的可视化工具之一。</p>
<p><code>ggplot2</code> 包是 <code>R</code> 的一个作图用的扩展包，它实现了 <em><strong>图形的语法</strong></em>，将一个作图任务分成若干子任务，只需要完成各个子任务就可以完成作图。在绘制常用图形时，只需要两个步骤：</p>
<ol>
<li><p>将图形所展现的数据输入到 <code>ggplot()</code> 函数中</p>
</li>
<li><p>调用某个 <code>geom_xxx()</code> 函数，指定图形类型，如散点图、面积图、曲线图、盒型图等。<code>geom_xxx()</code> 提供了各种基本图形，如<code>geom_blank()</code> 不绘制图形、<code>geom_point()</code> 每个观测为一个散点、<code>geom_hline(), geom_vline(), geom_abline()</code> 绘制线等。</p>
</li>
</ol>
<p><code>ggplot2</code> 的作图的一般步骤为：</p>
<ol>
<li><strong>准备数据：</strong>一般为数据框，且一般为长表，即每个观测时间占一行，每个观测变量占一列</li>
<li><strong>输入数据：</strong>将数据输入到 <code>ggplot()</code> 函数中，并指定参与作图的每个变量分别映射到哪些图形特性</li>
<li><strong>选择图形类型：</strong>选择一个合适的图形类型，函数名以 <code>geom_</code> 开头，如 <code>geom_point()</code> 表示散点图。</li>
<li>设定标题和图例位置等，如 <code>labs()</code>，仍用加号连接。</li>
</ol>
<p>模板如下：</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data <span class="operator">=</span> <span class="operator">&lt;</span>输入数据框<span class="operator">&gt;</span><span class="punctuation">,</span> </span><br><span class="line">            mapping <span class="operator">=</span> aes<span class="punctuation">(</span><span class="operator">&lt;</span>维度<span class="operator">&gt;=</span><span class="operator">&lt;</span>变量名<span class="operator">&gt;</span><span class="punctuation">,</span> </span><br><span class="line">                          <span class="operator">&lt;</span>维度<span class="operator">&gt;=</span><span class="operator">&lt;</span>变量名<span class="operator">&gt;</span><span class="punctuation">,</span> </span><br><span class="line">                          <span class="operator">&lt;</span>...<span class="operator">&gt;=</span><span class="operator">&lt;</span>...<span class="operator">&gt;</span><span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">p <span class="operator">+</span> geom_<span class="operator">&lt;</span>图形类型<span class="operator">&gt;</span><span class="punctuation">(</span><span class="operator">&lt;</span>...<span class="operator">&gt;</span><span class="punctuation">)</span> <span class="operator">+</span> </span><br><span class="line">	scala_<span class="operator">&lt;</span>映射<span class="operator">&gt;</span>_<span class="operator">&lt;</span>类型<span class="operator">&gt;</span><span class="punctuation">(</span><span class="operator">&lt;</span>...<span class="operator">&gt;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	coord_<span class="operator">&lt;</span>类型<span class="operator">&gt;</span><span class="punctuation">(</span><span class="operator">&lt;</span>...<span class="operator">&gt;</span><span class="punctuation">)</span> <span class="operator">+</span></span><br><span class="line">	labs<span class="punctuation">(</span><span class="operator">&lt;</span>...<span class="operator">&gt;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h5 id="2-13-1-ggplot2-绘制散点图"><a href="#2-13-1-ggplot2-绘制散点图" class="headerlink" title="2.13.1 ggplot2 绘制散点图"></a>2.13.1 <code>ggplot2</code> 绘制散点图</h5><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">####### ggplot2 绘图</span></span><br><span class="line"><span class="comment"># install.packages(&quot;ggplot2&quot;)     # 安装 ggplot2 绘图库</span></span><br><span class="line"><span class="comment"># install.packages(&quot;gapminder&quot;)   # 安装 gapminder 数据集</span></span><br><span class="line"></span><br><span class="line">library<span class="punctuation">(</span><span class="string">&quot;ggplot2&quot;</span><span class="punctuation">)</span>                <span class="comment"># 绘图包</span></span><br><span class="line">library<span class="punctuation">(</span><span class="string">&quot;gapminder&quot;</span><span class="punctuation">)</span>              <span class="comment"># 数据集包</span></span><br><span class="line"></span><br><span class="line">gapminder</span><br><span class="line"></span><br><span class="line">dev.new<span class="punctuation">(</span><span class="punctuation">)</span>                         <span class="comment"># 打开绘图设备</span></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data <span class="operator">=</span> gapminder<span class="punctuation">,</span></span><br><span class="line">            mapping <span class="operator">=</span> aes<span class="punctuation">(</span></span><br><span class="line">              x <span class="operator">=</span> gdpPercap<span class="punctuation">,</span></span><br><span class="line">              y <span class="operator">=</span> lifeExp<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data <span class="operator">=</span> gapminder<span class="punctuation">,</span></span><br><span class="line">            aes<span class="punctuation">(</span>gdpPercap<span class="punctuation">,</span> lifeExp<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">p <span class="operator">+</span> geom_point<span class="punctuation">(</span><span class="punctuation">)</span>  <span class="comment"># 散点图</span></span><br><span class="line">p <span class="operator">+</span> geom_smooth<span class="punctuation">(</span><span class="punctuation">)</span> <span class="comment"># 拟合曲线图</span></span><br><span class="line">p <span class="operator">+</span> geom_point<span class="punctuation">(</span><span class="punctuation">)</span> <span class="operator">+</span> geom_smooth<span class="punctuation">(</span><span class="punctuation">)</span></span><br><span class="line">dev.off<span class="punctuation">(</span><span class="punctuation">)</span>		  <span class="comment"># 关闭绘图设备</span></span><br></pre></td></tr></table></figure>

<h5 id="2-13-2-ggplot2-绘制面积图"><a href="#2-13-2-ggplot2-绘制面积图" class="headerlink" title="2.13.2 ggplot2 绘制面积图"></a>2.13.2 <code>ggplot2</code> 绘制面积图</h5><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 面积图</span></span><br><span class="line"><span class="comment"># 定义数据框 data.frame</span></span><br><span class="line">df <span class="operator">&lt;-</span> data.frame<span class="punctuation">(</span></span><br><span class="line">  year<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span><span class="number">1700</span><span class="punctuation">,</span> <span class="number">1701</span><span class="punctuation">,</span> <span class="number">1702</span><span class="punctuation">,</span> <span class="number">1703</span><span class="punctuation">,</span> <span class="number">1704</span><span class="punctuation">,</span> </span><br><span class="line">         <span class="number">1705</span><span class="punctuation">,</span> <span class="number">1706</span><span class="punctuation">,</span> <span class="number">1707</span><span class="punctuation">,</span> <span class="number">1708</span><span class="punctuation">,</span> <span class="number">1709</span><span class="punctuation">,</span></span><br><span class="line">         <span class="number">1710</span><span class="punctuation">,</span> <span class="number">1711</span><span class="punctuation">,</span> <span class="number">1712</span><span class="punctuation">,</span> <span class="number">1713</span><span class="punctuation">,</span> <span class="number">1714</span><span class="punctuation">,</span></span><br><span class="line">         <span class="number">1715</span><span class="punctuation">,</span> <span class="number">1716</span><span class="punctuation">)</span><span class="punctuation">,</span></span><br><span class="line">  sunspots<span class="operator">=</span><span class="built_in">c</span><span class="punctuation">(</span> <span class="number">5.0</span><span class="punctuation">,</span> <span class="number">11.0</span><span class="punctuation">,</span> <span class="number">16.0</span><span class="punctuation">,</span> <span class="number">23.0</span><span class="punctuation">,</span> <span class="number">36.0</span><span class="punctuation">,</span></span><br><span class="line">             <span class="number">58.0</span><span class="punctuation">,</span> <span class="number">29.0</span><span class="punctuation">,</span> <span class="number">20.0</span><span class="punctuation">,</span> <span class="number">10.0</span><span class="punctuation">,</span>  <span class="number">8.0</span><span class="punctuation">,</span></span><br><span class="line">              <span class="number">3.0</span><span class="punctuation">,</span>  <span class="number">0.0</span><span class="punctuation">,</span>  <span class="number">0.0</span><span class="punctuation">,</span>  <span class="number">2.0</span><span class="punctuation">,</span> <span class="number">11.0</span><span class="punctuation">,</span></span><br><span class="line">             <span class="number">27.0</span><span class="punctuation">,</span> <span class="number">47.0</span><span class="punctuation">)</span></span><br><span class="line"><span class="punctuation">)</span></span><br><span class="line"></span><br><span class="line">df</span><br><span class="line"></span><br><span class="line">p <span class="operator">&lt;-</span> ggplot<span class="punctuation">(</span>data <span class="operator">=</span> df<span class="punctuation">,</span> mapping <span class="operator">=</span> aes<span class="punctuation">(</span>year<span class="punctuation">,</span> sunspots<span class="punctuation">)</span><span class="punctuation">)</span></span><br><span class="line">p <span class="operator">+</span> geom_area<span class="punctuation">(</span>fill <span class="operator">=</span> <span class="string">&quot;blue&quot;</span><span class="punctuation">,</span> alpha <span class="operator">=</span> <span class="number">0.2</span><span class="punctuation">,</span> col <span class="operator">=</span> <span class="string">&quot;red&quot;</span><span class="punctuation">)</span></span><br></pre></td></tr></table></figure>

<h5 id="2-13-3-ggplot2-绘制堆叠面积图"><a href="#2-13-3-ggplot2-绘制堆叠面积图" class="headerlink" title="2.13.3 ggplot2 绘制堆叠面积图"></a>2.13.3 <code>ggplot2</code> 绘制堆叠面积图</h5><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="🎫-3-ECharts-ECharts的简单使用"><a href="#🎫-3-ECharts-ECharts的简单使用" class="headerlink" title="🎫 3. ECharts - ECharts的简单使用"></a>🎫 3. <code>ECharts</code> - <code>ECharts</code>的简单使用</h3><h4 id="3-1-ECharts-简介"><a href="#3-1-ECharts-简介" class="headerlink" title="3.1 ECharts 简介"></a>3.1 ECharts 简介</h4><ul>
<li><em>ECharts</em> 概念：一个基于 <em><strong>JavaScript</strong></em> 的开源可视化图表库（别人写好了 <code>.js</code>，我直接使用），可以流畅的运行在 PC 和移动设备上，兼容当前绝大部分浏览器（<em>IE 9&#x2F;10&#x2F;11</em>，<em>Chrome</em>，<em>Firefox</em>，<em>Safari</em> 等），底层依赖矢量图形库 *<a target="_blank" rel="noopener" href="https://github.com/ecomfe/zrender">ZRender</a>*，提供直观，交互丰富，可高度个性化定制的数据可视化图表。</li>
<li>官网：<a target="_blank" rel="noopener" href="https://echarts.apache.org/zh/download.html">ECharts</a></li>
<li>特性：<a target="_blank" rel="noopener" href="https://echarts.apache.org/zh/feature.html">ECharts Feature</a></li>
<li>获取 <code>Apache ECharts</code><ul>
<li><p>通过 <code>GitHub</code> 获取</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/apache/echarts">Apache&#x2F;ECharts</a> 项目的 <a target="_blank" rel="noopener" href="https://github.com/apache/echarts/releases">release</a> 页面可以找到各个版本的链接。点击下载页面下方 <code>Assets</code> 中的 <code>Source code</code>，解压后即为包含完整 ECharts 功能的文件。</li>
<li><code>echarts-5.4.0/echarts-5.4.0/dist/echarts.common.js </code>  与 <code>echarts-5.4.0/echarts-5.4.0/dist/echarts.common.min.js</code>：体积适中，常用版，支持常见的图表和组件</li>
<li><code>echarts-5.4.0/echarts-5.4.0/dist/echarts.js</code> 与 <code>echarts-5.4.0/echarts-5.4.0/dist/echarts.min.js</code>：体积最大，完整版，包含所有支持的图表和组件。</li>
<li><code>echarts-5.4.0/echarts-5.4.0/dist/echarts.simple.js</code> 与 <code>echarts-5.4.0/echarts-5.4.0/dist/echarts.simple.min.js</code>：体积较小，精简版，包含最常用的图表和组件。</li>
</ul>
</li>
<li><p>从 <code>npm</code> 获取</p>
<ul>
<li><code>npm install echarts</code></li>
</ul>
</li>
<li><p>从 <code>CDN</code> 获取</p>
<ul>
<li><code>&lt;script src=&quot;https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js&quot;&gt;&lt;/script&gt;</code></li>
</ul>
</li>
<li><p>在线定制</p>
</li>
</ul>
</li>
</ul>
<h4 id="3-2-第一个-ECharts-程序"><a href="#3-2-第一个-ECharts-程序" class="headerlink" title="3.2 第一个 ECharts 程序"></a>3.2 第一个 <code>ECharts</code> 程序</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>第一个 ECharts 程序<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 1. 引入 ECharts.js 类库文件 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot;js/echarts.js&quot;&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">window</span>.<span class="property">onload</span>=<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 3. 实例化 ECharts 对象</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> dom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;main&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> myChart = echarts.<span class="title function_">init</span>(dom);</span></span><br><span class="line"><span class="language-javascript">                </span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 4. 指定图表的配置项和数据</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> option = &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">title</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">text</span>: <span class="string">&quot;ECharts 入门案例&quot;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">tooltip</span>: &#123; &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">legend</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">data</span>: [<span class="string">&#x27;销量&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">data</span>: [<span class="string">&#x27;衬衫&#x27;</span>, <span class="string">&#x27;羊毛衫&#x27;</span>, <span class="string">&#x27;雪纺衫&#x27;</span>, <span class="string">&#x27;帽子&#x27;</span>, <span class="string">&#x27;高跟鞋&#x27;</span>, <span class="string">&#x27;袜子&#x27;</span>] </span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">yAxis</span>: &#123; &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">series</span>: [&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">name</span>: <span class="string">&#x27;销量&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">data</span>: [<span class="number">5</span>, <span class="number">20</span>, <span class="number">26</span>, <span class="number">10</span>, <span class="number">20</span>, <span class="number">8</span>]</span></span><br><span class="line"><span class="language-javascript">                    &#125;]</span></span><br><span class="line"><span class="language-javascript">                &#125;;</span></span><br><span class="line"><span class="language-javascript">                </span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 5. 使用刚指定的配置项和数据显示图表</span></span></span><br><span class="line"><span class="language-javascript">                myChart.<span class="title function_">setOption</span>(option);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">	    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 2. 准备一个放图表的容器 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 900px; height: 400px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-3-ECharts-绘图流程"><a href="#3-3-ECharts-绘图流程" class="headerlink" title="3.3 ECharts 绘图流程"></a>3.3 ECharts 绘图流程</h4><ol>
<li>新建一个 HTML 文件，并在网页头部 <code>&lt;head&gt; ... &lt;/head&gt;</code> 部分引入在线的 <code>ECharts</code> 类库或者本地已经下载好的类库。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 引入在线的 ECharts 类库或者本地已经下载好的类库 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot;js/echarts.js&quot;&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在网页创建一个容器，为 <code>ECharts</code> 准备一个具备大小（宽高）的 <strong><code>DOM</code></strong> <em>（Document Object Model, 文件对象模型 )</em> 。</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 为 ECharts 准备一个具备大小(宽高)的 DOM --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 600px; height: 400px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>当页面加载时，获取 <code>DOM</code>，并初始化 <code>ECharts</code> 对象</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">onload</span>=<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> dom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;main&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> myChart = echarts.<span class="title function_">init</span>(dom);</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>指定配置项信息</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">onload</span>=<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 省略上一步的操作</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> options = &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">title</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">text</span>: <span class="string">&quot;ECharts 入门案例&quot;</span></span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">tooltip</span>: &#123; &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">legend</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>: [<span class="string">&#x27;销量&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">data</span>: [<span class="string">&#x27;衬衫&#x27;</span>, <span class="string">&#x27;羊毛衫&#x27;</span>, <span class="string">&#x27;雪纺衫&#x27;</span>, <span class="string">&#x27;裤子&#x27;</span>, <span class="string">&#x27;高跟鞋&#x27;</span>, <span class="string">&#x27;袜子&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">            &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">yAxis</span>: &#123; &#125;,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123;<span class="attr">name</span>:<span class="string">&#x27;销量&#x27;</span>, <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>, <span class="attr">data</span>: [<span class="number">5</span>, <span class="number">20</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">20</span>]&#125;</span></span><br><span class="line"><span class="language-javascript">            ]</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>用刚指定的配置项和数据显示图表</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="variable language_">window</span>.<span class="property">onload</span>=<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 省略上一步的操作...</span></span></span><br><span class="line"><span class="language-javascript">        myChart.<span class="title function_">setOption</span>(option);        </span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-4-ECharts-常用配置项详解"><a href="#3-4-ECharts-常用配置项详解" class="headerlink" title="3.4 ECharts 常用配置项详解"></a>3.4 ECharts 常用配置项详解</h4><p>完成简单柱状图的绘制需要包含的组件包括：</p>
<ul>
<li><code>xAxis</code>：X 轴组件</li>
<li><code>yAxis</code>：Y 轴组件</li>
<li><code>series</code>：系列组件（我更喜欢称其序列组件）</li>
</ul>
<p>完善图形补充组件：</p>
<ul>
<li><code>title</code>：标题组件</li>
<li><code>legend</code>：图例组件</li>
<li><code>tooltip</code>：提示框组件</li>
<li><code>toolbox</code>：工具栏配置项</li>
<li><code>datazoom</code>：数据区域缩放</li>
</ul>
<h4 id="3-5-ECharts-样式设置"><a href="#3-5-ECharts-样式设置" class="headerlink" title="3.5 ECharts 样式设置"></a>3.5 ECharts 样式设置</h4><h5 id="3-5-1-ECharts-颜色主题-Theme"><a href="#3-5-1-ECharts-颜色主题-Theme" class="headerlink" title="3.5.1 ECharts 颜色主题(Theme)"></a>3.5.1 ECharts 颜色主题(Theme)</h5><ul>
<li>内置颜色主题（<code>dark</code>、<code>light</code>）</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>样式设置<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot;js/echarts.min.js&quot;&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.staticfile.org/jquery/2.2.4/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span> <span class="attr">style</span>=<span class="string">&quot;height=900px; width:400px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">window</span>.<span class="property">onload</span>=<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> dom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;main&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 内置颜色主题</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// var myCharts = echarts.init(dom, &quot;light&quot;);</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> myCharts = echarts.<span class="title function_">init</span>(dom, <span class="string">&quot;dark&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> options = &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">title</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">text</span>: <span class="string">&quot;ECharts 入门案例&quot;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">tooltip</span>: &#123; &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">legend</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">data</span>: [<span class="string">&#x27;销量&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">data</span>: [<span class="string">&#x27;衬衫&#x27;</span>, <span class="string">&#x27;羊毛衫&#x27;</span>, <span class="string">&#x27;雪纺衫&#x27;</span>, <span class="string">&#x27;裤子&#x27;</span>, <span class="string">&#x27;高跟鞋&#x27;</span>, <span class="string">&#x27;袜子&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">yAxis</span>: &#123; &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                        &#123;<span class="attr">name</span>:<span class="string">&#x27;销量&#x27;</span>, <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>, <span class="attr">data</span>: [<span class="number">5</span>, <span class="number">20</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">20</span>]&#125;</span></span><br><span class="line"><span class="language-javascript">                    ]</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">                myCharts.<span class="title function_">setOption</span>(options);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>自定义颜色主题</p>
<ul>
<li>通过 <code>JavaScript</code> 定义颜色主题</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">  </span><br></pre></td></tr></table></figure>

<ul>
<li>通过 <code>Json + jQuery</code> 定义颜色主题</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">  </span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="3-5-2-ECharts-调色盘"><a href="#3-5-2-ECharts-调色盘" class="headerlink" title="3.5.2 ECharts 调色盘"></a>3.5.2 ECharts 调色盘</h5><ul>
<li>全局调色盘</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>ECharts 全局调色盘<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot;js/echarts.min.js&quot;&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.staticfile.org/jquery/2.2.4/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 900px; height: 400px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        	<span class="variable language_">window</span>.<span class="property">onload</span>=<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> dom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;main&#x27;</span>);	<span class="comment">// 获取到 DOM</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> myCharts = echarts.<span class="title function_">init</span>(dom);			<span class="comment">// 初始化 ECharts对象</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 定义选项</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> options = &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// 颜色组件——全局调色盘</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>: [<span class="string">&quot;red&quot;</span>, <span class="string">&quot;blue&quot;</span>, <span class="string">&quot;yellow&quot;</span>],</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">show</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">position</span>: <span class="string">&quot;bottom&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">data</span>: [<span class="string">&#x27;衬衫&#x27;</span>, <span class="string">&#x27;羊毛衫&#x27;</span>, <span class="string">&#x27;雪纺衫&#x27;</span>, <span class="string">&#x27;裤子&#x27;</span>, <span class="string">&#x27;高跟鞋&#x27;</span>, <span class="string">&#x27;袜子&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">yAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">max</span>: <span class="number">50</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// 系列组件</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                        &#123; <span class="attr">type</span>: <span class="string">&quot;bar&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;销量1&quot;</span>, <span class="attr">data</span>: [<span class="number">5</span>, <span class="number">20</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">20</span>] &#125;,</span></span><br><span class="line"><span class="language-javascript">                        &#123; <span class="attr">type</span>: <span class="string">&quot;line&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;销量2&quot;</span>, <span class="attr">data</span>: [<span class="number">4</span>, <span class="number">30</span>, <span class="number">26</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">15</span>] &#125;</span></span><br><span class="line"><span class="language-javascript">                    ]</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">                myCharts.<span class="title function_">setOption</span>(options);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>系列调色盘</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>ECharts 系列调色盘<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot;js/echarts.min.js&quot;&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.staticfile.org/jquery/2.2.4/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 900px; height: 400px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        	<span class="variable language_">window</span>.<span class="property">onload</span>=<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> dom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;main&#x27;</span>);	<span class="comment">// 获取到 DOM</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> myCharts = echarts.<span class="title function_">init</span>(dom);			<span class="comment">// 初始化 ECharts对象</span></span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 定义选项</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> options = &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// 颜色组件——全局调色盘</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">color</span>: [<span class="string">&quot;red&quot;</span>, <span class="string">&quot;blue&quot;</span>, <span class="string">&quot;yellow&quot;</span>],</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">show</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">position</span>: <span class="string">&quot;bottom&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">data</span>: [<span class="string">&#x27;衬衫&#x27;</span>, <span class="string">&#x27;羊毛衫&#x27;</span>, <span class="string">&#x27;雪纺衫&#x27;</span>, <span class="string">&#x27;裤子&#x27;</span>, <span class="string">&#x27;高跟鞋&#x27;</span>, <span class="string">&#x27;袜子&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">yAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">max</span>: <span class="number">50</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// 系列组件</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                        &#123; <span class="attr">type</span>: <span class="string">&quot;bar&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;销量1&quot;</span>, <span class="attr">data</span>: [<span class="number">5</span>, <span class="number">20</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">20</span>], <span class="attr">color</span>: [<span class="string">&quot;red&quot;</span>, <span class="string">&quot;green&quot;</span>] &#125;,</span></span><br><span class="line"><span class="language-javascript">                        &#123; <span class="attr">type</span>: <span class="string">&quot;line&quot;</span>, <span class="attr">name</span>: <span class="string">&quot;销量2&quot;</span>, <span class="attr">data</span>: [<span class="number">4</span>, <span class="number">30</span>, <span class="number">26</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">15</span>] &#125;</span></span><br><span class="line"><span class="language-javascript">                    ]</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">                myCharts.<span class="title function_">setOption</span>(options);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>系列调色盘与全局调色盘同时出现：<ul>
<li>当系列调色盘与全局调色盘同时出现时，图表使用系列调色盘中配置的颜色。</li>
</ul>
</li>
</ul>
<h5 id="3-5-3-ECharts-直接样式设置"><a href="#3-5-3-ECharts-直接样式设置" class="headerlink" title="3.5.3 ECharts 直接样式设置"></a>3.5.3 ECharts 直接样式设置</h5><p>直接样式设置（<code>itemStyle</code>、<code>lineStyle</code>、<code>areaStyle</code>、<code>label</code>、…）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>ECharts 全局调色盘<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot;js/echarts.min.js&quot;&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.staticfile.org/jquery/2.2.4/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:900px; height: 400px;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        	<span class="variable language_">window</span>.<span class="property">onload</span>=<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> dom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;main&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> myChart = echarts.<span class="title function_">init</span>(dom);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> options = &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">show</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">position</span>: <span class="string">&#x27;bottom&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">data</span>: [<span class="string">&#x27;衬衫&#x27;</span>, <span class="string">&#x27;羊毛衫&#x27;</span>, <span class="string">&#x27;雪纺衫&#x27;</span>, <span class="string">&#x27;裤子&#x27;</span>, <span class="string">&#x27;高跟鞋&#x27;</span>, <span class="string">&#x27;袜子&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">yAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">max</span>: <span class="number">50</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                        &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">type</span>: <span class="string">&#x27;scatter&#x27;</span>, </span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">name</span>: <span class="string">&#x27;销量1&#x27;</span>, </span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">data</span>: [<span class="number">5</span>, <span class="number">20</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">20</span>], </span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">symbol</span>: <span class="string">&#x27;triangle&#x27;</span>, </span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">symbolSize</span>:<span class="number">20</span>, </span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">itemStyle</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">borderWidth</span>: <span class="number">2</span>,</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">borderColor</span>: <span class="string">&#x27;blue&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">emphasis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">itemStyle</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                                    <span class="attr">color</span>: <span class="string">&#x27;green&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                                &#125;,</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">label</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                                    <span class="attr">show</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">                                    <span class="attr">formmatter</span>: <span class="string">&quot;&#123;a&#125;\n&#123;b&#125;&#123;c&#125;&quot;</span>, <span class="comment">// 这是一个 label</span></span></span><br><span class="line"><span class="language-javascript">                                    <span class="attr">position</span>: <span class="string">&#x27;right&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                                &#125;</span></span><br><span class="line"><span class="language-javascript">                            &#125;</span></span><br><span class="line"><span class="language-javascript">                        &#125;,&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">type</span>: <span class="string">&#x27;scatter&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">name</span>: <span class="string">&#x27;销量2&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">data</span>: [<span class="number">4</span>, <span class="number">30</span>, <span class="number">26</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">15</span>]</span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    ],</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">title</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">show</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">text</span>: <span class="string">&#x27;主标题-点击访问百度&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">link</span>: <span class="string">&#x27;https//www.baidu.com/&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">target</span>: <span class="string">&#x27;blank&#x27;</span>,	<span class="comment">// 或者 self 也可以</span></span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">subtext</span>: <span class="string">&#x27;副标题-点击访问个人网站&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">sublink</span>: <span class="string">&#x27;http://hello-nilera.com/&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        subtarget</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">textStyle</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">fontSize</span>: <span class="number">30</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">fontStyle</span>: <span class="string">&#x27;italic&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">fontWeight</span>: <span class="string">&#x27;normal&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">                </span></span><br><span class="line"><span class="language-javascript">                myChart.<span class="title function_">setOption</span>(options);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="3-5-4-ECharts-视觉映射-Visual-Map"><a href="#3-5-4-ECharts-视觉映射-Visual-Map" class="headerlink" title="3.5.4 ECharts 视觉映射(Visual Map)"></a>3.5.4 ECharts 视觉映射(Visual Map)</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>样式设置——视觉映射组件<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot;js/echarts.min.js&quot;&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.staticfile.org/jquery/2.2.4/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 900px; height: 400px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        	<span class="variable language_">window</span>.<span class="property">onload</span>=<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> dom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;main&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> myChart = echarts.<span class="title function_">init</span>(dom);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> options = &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// 连续型视觉映射组件</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">/*</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                    visualMap: [</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                        &#123;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                            type: &#x27;continuous&#x27;,</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                            min: 0,</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                            max: 40,</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                            range: [4, 15],</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                            calculable: true</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                        &#125;</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                    ],</span></span></span><br><span class="line"><span class="comment"><span class="language-javascript">                    */</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// 分段型视觉映射组件</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">visualMap</span>: [&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>: <span class="string">&#x27;piecewise&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">min</span>: <span class="number">0</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">max</span>: <span class="number">40</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;],</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">title</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">text</span>: <span class="string">&#x27;ECharts 视觉映射组件&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">tooltip</span>: &#123; &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">legend</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">data</span>: [<span class="string">&#x27;销量&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">data</span>: [<span class="string">&#x27;衬衫&#x27;</span>, <span class="string">&#x27;羊毛衫&#x27;</span>, <span class="string">&#x27;雪纺衫&#x27;</span>, <span class="string">&#x27;裤子&#x27;</span>, <span class="string">&#x27;高跟鞋&#x27;</span>, <span class="string">&#x27;袜子&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">yAxis</span>: &#123; &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                        &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">name</span>: <span class="string">&#x27;销量 1&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">data</span>: [<span class="number">5</span>, <span class="number">20</span>, <span class="number">36</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">20</span>]</span></span><br><span class="line"><span class="language-javascript">                        &#125;,&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">name</span>: <span class="string">&#x27;销量 2&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">type</span>: <span class="string">&#x27;bar&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">data</span>: [<span class="number">8</span>, <span class="number">12</span>, <span class="number">30</span>, <span class="number">15</span>, <span class="number">18</span>, <span class="number">26</span>]</span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    ]</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">                myChart.<span class="title function_">setOption</span>(options);</span></span><br><span class="line"><span class="language-javascript">            &#125;        </span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="3-6-ECharts-中的事件和行为"><a href="#3-6-ECharts-中的事件和行为" class="headerlink" title="3.6 ECharts 中的事件和行为"></a>3.6 ECharts 中的事件和行为</h4><p><strong>概念：</strong>在 <code>Apache ECharts</code> 的图表中用户的操作将会触发相应的事件。开发者可以监听这些事件，然后通过回调函数做相应的处理。</p>
<p><strong>事件分类：</strong> 在 <code>ECharts</code> 中事件分为两种类型，一种是用户鼠标操作点击，或者 <code>hover</code> 图表的图形时触发的事件，还有一种是用户在使用可以交互的组件后触发的行为事件，例如在切换图例开关时触发的 <a target="_blank" rel="noopener" href="https://echarts.apache.org/api.html#events.legendselectchanged"><code>legendselectchanged</code></a> 事件（这里需要注意切换图例开关是不会触发事件的），数据区域缩放时触发的 <a target="_blank" rel="noopener" href="https://echarts.apache.org/api.html#events.legendselectchanged"><code>datazoom</code></a> 事件等等。</p>
<h4 id="3-7-ECharts-实例"><a href="#3-7-ECharts-实例" class="headerlink" title="3.7 ECharts 实例"></a>3.7 ECharts 实例</h4><h5 id="3-7-1-柱状图"><a href="#3-7-1-柱状图" class="headerlink" title="3.7.1 柱状图"></a>3.7.1 柱状图</h5><p>绘制简单的柱状图，一些配置项：</p>
<ul>
<li><code>xAxis/yAxis</code><ul>
<li><code>type</code>：<code>category</code> 类目轴；<code>value</code> 数值轴；<code>time</code> 时间；<code>log</code> 对数轴</li>
<li><code>data</code>：设置类目的数据（数组）</li>
</ul>
</li>
<li><code>series</code><ul>
<li><code>type</code>：设置系列的类型（设置绘制什么图表）</li>
<li><code>name</code>：设置系列名称，会用在 <code>tooltip</code> 和 <code>legend</code> 中</li>
<li><code>data</code>：系列中的数据内容数组，定义当前这个系列中每个柱子的高度</li>
<li><code>label</code>：设置图形上的文本标签（把数值显示在每个柱子上)</li>
<li><code>itemStyle</code>：设置图形样式</li>
<li><code>showBackground</code>：设置是否显示背景色（默认不显示）</li>
<li><code>backgroundStyle</code>：设置背景色</li>
</ul>
</li>
</ul>
<h5 id="3-7-2-折线图、堆叠折线图"><a href="#3-7-2-折线图、堆叠折线图" class="headerlink" title="3.7.2 折线图、堆叠折线图"></a>3.7.2 折线图、堆叠折线图</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot;js/echarts.min.js&quot;&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.staticfile.org/jquery/2.2.4/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width: 900px; height: 400px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        	<span class="variable language_">window</span>.<span class="property">onload</span>=<span class="keyword">function</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> dom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;main&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> myCharts = echarts.<span class="title function_">init</span>(dom);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> options = &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">xAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>: <span class="string">&#x27;category&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">data</span>: [<span class="string">&#x27;周一&#x27;</span>, <span class="string">&#x27;周二&#x27;</span>, <span class="string">&#x27;周三&#x27;</span>, <span class="string">&#x27;周四&#x27;</span>, <span class="string">&#x27;周五&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">yAxis</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>: <span class="string">&#x27;value&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                        &#123; <span class="attr">type</span>: <span class="string">&#x27;line&#x27;</span>, <span class="attr">data</span>: [<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">20</span>, <span class="number">10</span>]&#125;</span></span><br><span class="line"><span class="language-javascript">                    ],</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">toolbox</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">feature</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">show</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">dataZoom</span>: &#123; <span class="comment">// 数据区域缩放</span></span></span><br><span class="line"><span class="language-javascript">                                <span class="comment">// 框选型数据区域缩放组件(dataZoomSelect): 提供一个选框进行区域缩放。</span></span></span><br><span class="line"><span class="language-javascript">                                <span class="comment">// 即 toolbox.feature.dataZoom</span></span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">yAxisIndex</span>: <span class="string">&#x27;none&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">dataView</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">readOnly</span>: <span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">magicType</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">type</span>: [<span class="string">&#x27;line&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>]</span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">restore</span>: &#123; <span class="comment">// 配置项还原</span></span></span><br><span class="line"><span class="language-javascript">                            &#125;,</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">saveAsImage</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                                <span class="attr">type</span>: <span class="string">&#x27;jpg&#x27;</span></span></span><br><span class="line"><span class="language-javascript">                            &#125;</span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">                myCharts.<span class="title function_">setOption</span>(options);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="3-7-3-面积图和堆叠面积图"><a href="#3-7-3-面积图和堆叠面积图" class="headerlink" title="3.7.3 面积图和堆叠面积图"></a>3.7.3 面积图和堆叠面积图</h5><h5 id="3-7-4-雷达图"><a href="#3-7-4-雷达图" class="headerlink" title="3.7.4 雷达图"></a>3.7.4 雷达图</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;script type=&quot;text/javascript&quot; src=&quot;js/echarts.min.js&quot;&gt;&lt;/script&gt; --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span> <span class="attr">src</span>=<span class="string">&quot;http://cdn.staticfile.org/jquery/2.2.4/jquery.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;main&quot;</span> <span class="attr">class</span>=<span class="string">&quot;main&quot;</span> <span class="attr">style</span>=<span class="string">&quot;width:900px; height: 400px&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> dom = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;main&quot;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> myCharts = echarts.<span class="title function_">init</span>(dom);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> options = &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">radar</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">indicator</span>: [</span></span><br><span class="line"><span class="language-javascript">                        &#123; <span class="attr">name</span>: <span class="string">&#x27;身高&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                        &#123; <span class="attr">name</span>: <span class="string">&#x27;体重&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                        &#123; <span class="attr">name</span>: <span class="string">&#x27;年龄&#x27;</span> &#125;,</span></span><br><span class="line"><span class="language-javascript">                        &#123; <span class="attr">name</span>: <span class="string">&#x27;跑步速度&#x27;</span> &#125;</span></span><br><span class="line"><span class="language-javascript">                    ],</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">series</span>: [</span></span><br><span class="line"><span class="language-javascript">                    &#123; </span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">type</span>: <span class="string">&#x27;radar&#x27;</span>, </span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">data</span>: [</span></span><br><span class="line"><span class="language-javascript">                            &#123; <span class="attr">name</span>: <span class="string">&#x27;训练前&#x27;</span>, <span class="attr">value</span>: [<span class="number">178</span>, <span class="number">60</span>, <span class="number">20</span>, <span class="number">50</span>] &#125;, </span></span><br><span class="line"><span class="language-javascript">                            &#123; <span class="attr">name</span>: <span class="string">&#x27;训练后&#x27;</span>, <span class="attr">value</span>: [<span class="number">178</span>, <span class="number">58</span>, <span class="number">20</span>, <span class="number">52</span>] &#125;, </span></span><br><span class="line"><span class="language-javascript">                            &#123; <span class="attr">name</span>: <span class="string">&#x27;训练一年后&#x27;</span>, <span class="attr">value</span>: [<span class="number">180</span>, <span class="number">55</span>, <span class="number">21</span>, <span class="number">55</span>]&#125;</span></span><br><span class="line"><span class="language-javascript">                        ] </span></span><br><span class="line"><span class="language-javascript">                    &#125;,</span></span><br><span class="line"><span class="language-javascript">                ],</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">tooltip</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    </span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">toolbox</span>: &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">show</span>:<span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">feature</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="attr">saveAsImage</span>:&#123;</span></span><br><span class="line"><span class="language-javascript">                            <span class="attr">show</span>:<span class="literal">true</span></span></span><br><span class="line"><span class="language-javascript">                        &#125;</span></span><br><span class="line"><span class="language-javascript">                	&#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">            </span></span><br><span class="line"><span class="language-javascript">            myCharts.<span class="title function_">setOption</span>(options);</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>





</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-06-22T07:55:58.000Z" title="2024/6/22 15:55:58">2024-06-22</time>发表</span><span class="level-item"><time dateTime="2024-07-08T01:54:01.794Z" title="2024/7/8 09:54:01">2024-07-08</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF/">大数据技术</a><span> / </span><a class="link-muted" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF/HBase/">HBase</a></span><span class="level-item">44 分钟读完 (大约6534个字)</span></div></div><p class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2024/06/22/HBaseExamReview/">HBaseExamReview</a></p><div class="content"><h2 id="HBase-考察知识点复习"><a href="#HBase-考察知识点复习" class="headerlink" title="HBase 考察知识点复习"></a>HBase 考察知识点复习</h2><h3 id="知识点（选择）"><a href="#知识点（选择）" class="headerlink" title="知识点（选择）"></a>知识点（选择）</h3><ol>
<li><p>Region的分裂</p>
<p>在<strong>HBase</strong>中，<code>Region</code> 是数据管理的基本单位，类似于关系型数据库中的分区。它是 <strong>HBase</strong> 数据存储和组织的核心概念之一。<br><code>Region</code> 的概念和特点：<br><code>Region</code> 是 <code>HBase</code> 数据管理的基本单位，它负责存储一定范围内的数据。每个 <code>Region</code> 由一个起始 <code>RowKey</code> 和 终止 <code>RowKey</code> 定义，负责存储该范围内的数据。与关系型数据库中的分区类似，<code>HBase</code> 中的 <code>Region</code> 可以根据数据量的大小进行动态调整。当一个<code>Region</code> 的数据量过大时，它会被 <strong>分裂</strong> 成两个新的 <code>Region</code>。相反，当数据量较小时，两个或多个 <code>Region</code> 可能会合并成一个新的<code>Region</code>。</p>
<p>当 <code>MemStore</code> 的数据超过阈值时，将数据溢写磁盘，生成一个 <code>StoreFile</code> 文件。当 <code>Region</code> 中最大<code>Store</code> 的大小超过阈值时，<code>Region</code> 分裂，等分成两个 <code>Region</code>，实现数据访问的负载均衡。新的 <code>Region</code> 的位置由 <code>HMaster</code> 来确定在哪个<code>RegionServer</code> 中。</p>
</li>
<li><p>查看表结构的命令</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[subowen@bigdata ~]$ hbase shell</span><br><span class="line">2024-07-05 23:04:35,655 WARN  [main] util.NativeCodeLoader: Unable to load native-hadoop library <span class="keyword">for</span> your platform... using builtin-java classes <span class="built_in">where</span> applicable</span><br><span class="line">HBase Shell</span><br><span class="line">Use <span class="string">&quot;help&quot;</span> to get list of supported commands.</span><br><span class="line">Use <span class="string">&quot;exit&quot;</span> to quit this interactive shell.</span><br><span class="line">For Reference, please visit: http://hbase.apache.org/2.0/book.html<span class="comment">#shell</span></span><br><span class="line">Version 2.1.8, rd8333e556c8ed739cf39dab58ddc6b43a50c0965, Tue Nov 19 15:29:04 UTC 2019</span><br><span class="line">Took 0.0028 seconds</span><br><span class="line">hbase(main):001:0&gt; list</span><br><span class="line">TABLE</span><br><span class="line">logs</span><br><span class="line">logs_20240606</span><br><span class="line">logs_20240607</span><br><span class="line">user</span><br><span class="line">sdutcm:bigdata</span><br><span class="line">5 row(s)</span><br><span class="line">Took 1.2756 seconds</span><br><span class="line">=&gt; [<span class="string">&quot;logs&quot;</span>, <span class="string">&quot;logs_20240606&quot;</span>, <span class="string">&quot;logs_20240607&quot;</span>, <span class="string">&quot;user&quot;</span>, <span class="string">&quot;sdutcm:bigdata&quot;</span>]</span><br><span class="line"></span><br><span class="line">hbase(main):002:0&gt; describe <span class="string">&#x27;sdutcm:bigdata&#x27;</span></span><br><span class="line">Table sdutcm:bigdata is ENABLED</span><br><span class="line">sdutcm:bigdata</span><br><span class="line">COLUMN FAMILIES DESCRIPTION</span><br><span class="line">&#123;NAME =&gt; <span class="string">&#x27;info&#x27;</span>, VERSIONS =&gt; <span class="string">&#x27;5&#x27;</span>, EVICT_BLOCKS_ON_CLOSE =&gt; <span class="string">&#x27;false&#x27;</span>, NEW_VERSION_BEHAVIOR =&gt; <span class="string">&#x27;false&#x27;</span>, KEEP_DELETED_CELLS =&gt; <span class="string">&#x27;FALSE&#x27;</span>, CACHE_DATA_ON_WRITE =&gt; <span class="string">&#x27;false&#x27;</span>, DATA_BLOCK_ENCODING =&gt; <span class="string">&#x27;NONE&#x27;</span>, TTL =&gt; <span class="string">&#x27;FOREVER&#x27;</span>, MIN_VERSIONS =&gt; <span class="string">&#x27;0&#x27;</span>, REPLICATION_SCOPE =&gt; <span class="string">&#x27;0&#x27;</span>, BLOOMFILTER =&gt; <span class="string">&#x27;ROW&#x27;</span>, CACHE_INDEX_ON_WRITE =&gt; <span class="string">&#x27;false&#x27;</span>, IN_MEMORY =&gt; <span class="string">&#x27;false&#x27;</span>, CACHE_BLOOMS_ON_WRITE =&gt; <span class="string">&#x27;false&#x27;</span>, PREFETCH_BLOCKS_ON_OPEN =&gt; <span class="string">&#x27;false&#x27;</span>, COMPRESSION =&gt; <span class="string">&#x27;NONE&#x27;</span>, BLOCKCACHE =&gt; <span class="string">&#x27;true&#x27;</span>, BLOCKSIZE =&gt; <span class="string">&#x27;65536&#x27;</span>&#125;</span><br><span class="line">&#123;NAME =&gt; <span class="string">&#x27;msg&#x27;</span>, VERSIONS =&gt; <span class="string">&#x27;5&#x27;</span>, EVICT_BLOCKS_ON_CLOSE =&gt; <span class="string">&#x27;false&#x27;</span>, NEW_VERSION_BEHAVIOR =&gt; <span class="string">&#x27;false&#x27;</span>, KEEP_DELETED_CELLS =&gt; <span class="string">&#x27;FALSE&#x27;</span>, CACHE_DATA_ON_WRITE =&gt; <span class="string">&#x27;false&#x27;</span>, DATA_BLOCK_ENCODING =&gt; <span class="string">&#x27;NONE&#x27;</span>, TTL =&gt; <span class="string">&#x27;FOREVER&#x27;</span>, MIN_VERSIONS =&gt; <span class="string">&#x27;0&#x27;</span>, REPLICATION_SCOPE =&gt; <span class="string">&#x27;0&#x27;</span>, BLOOMFILTER =&gt; <span class="string">&#x27;ROW&#x27;</span>, CACHE_INDEX_ON_WRITE =&gt; <span class="string">&#x27;false&#x27;</span>, IN_MEMORY =&gt; <span class="string">&#x27;false&#x27;</span>, CACHE_BLOOMS_ON_WRITE =&gt; <span class="string">&#x27;false&#x27;</span>, PREFETCH_BLOCKS_ON_OPEN =&gt; <span class="string">&#x27;false&#x27;</span>, COMPRESSION =&gt; <span class="string">&#x27;NONE&#x27;</span>, BLOCKCACHE =&gt; <span class="string">&#x27;true&#x27;</span>, BLOCKSIZE =&gt; <span class="string">&#x27;65536&#x27;</span>&#125;</span><br><span class="line">2 row(s)</span><br><span class="line">Took 0.3826 seconds</span><br><span class="line"></span><br><span class="line">hbase(main):003:0&gt; scan <span class="string">&#x27;sdutcm:bigdata&#x27;</span></span><br><span class="line">ROW                                      COLUMN+CELL</span><br><span class="line"> 2001                                    column=info:name, timestamp=1719026353219, value=wang</span><br><span class="line">1 row(s)</span><br><span class="line">Took 0.2295 seconds</span><br><span class="line">hbase(main):004:0&gt; </span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>启动和关闭 <code>HBase Shell</code> 的命令</p>
<p>启动 <code>HBase Shell</code> 之前需要保证 <code>ZooKeeper</code>、<code>Hadoop HDFS</code> 和 <code>HBase</code> 已经启动。可以使用 <code>hbase shell</code> 进入 <code>HBase Shell</code>，在 <code>HBase Shell</code> 中可以使用 <code>exit</code> 或 <code>quit</code> 退出。</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[subowen@bigdata ~]$ zkServer.sh start</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /home/subowen/apps/zookeeper-3.4.12/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line"></span><br><span class="line">[subowen@bigdata ~]$ zkServer.sh status</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /home/subowen/apps/zookeeper-3.4.12/bin/../conf/zoo.cfg</span><br><span class="line">Mode: standalone</span><br><span class="line"></span><br><span class="line">[subowen@bigdata ~]$ start-dfs.sh</span><br><span class="line">Starting namenodes on [bigdata]</span><br><span class="line">bigdata: starting namenode, logging to /home/subowen/apps/hadoop-2.7.6/logs/hadoop-subowen-namenode-bigdata.out</span><br><span class="line">bigdata: starting datanode, logging to /home/subowen/apps/hadoop-2.7.6/logs/hadoop-subowen-datanode-bigdata.out</span><br><span class="line">Starting secondary namenodes [0.0.0.0]</span><br><span class="line">0.0.0.0: starting secondarynamenode, logging to /home/subowen/apps/hadoop-2.7.6/logs/hadoop-subowen-secondarynamenode-bigdata.out</span><br><span class="line"></span><br><span class="line">[subowen@bigdata ~]$ start-hbase.sh</span><br><span class="line">running master, logging to /home/subowen/apps/hbase-2.1.8/logs/hbase-subowen-master-bigdata.out</span><br><span class="line">bigdata: running regionserver, logging to /home/subowen/apps/hbase-2.1.8/logs/hbase-subowen-regionserver-bigdata.out</span><br><span class="line"></span><br><span class="line">[subowen@bigdata ~]$ jps</span><br><span class="line">1746 NameNode</span><br><span class="line">1572 QuorumPeerMain</span><br><span class="line">2071 SecondaryNameNode</span><br><span class="line">2874 Jps</span><br><span class="line">2379 HRegionServer</span><br><span class="line">1852 DataNode</span><br><span class="line">2285 HMaster</span><br><span class="line"></span><br><span class="line">[subowen@bigdata ~]$ hbase shell</span><br><span class="line">2024-07-05 22:47:57,331 WARN  [main] util.NativeCodeLoader: Unable to load native-hadoop library <span class="keyword">for</span> your platform... using builtin-java classes <span class="built_in">where</span> applicable</span><br><span class="line">HBase Shell</span><br><span class="line">Use <span class="string">&quot;help&quot;</span> to get list of supported commands.</span><br><span class="line">Use <span class="string">&quot;exit&quot;</span> to quit this interactive shell.</span><br><span class="line">For Reference, please visit: http://hbase.apache.org/2.0/book.html<span class="comment">#shell</span></span><br><span class="line">Version 2.1.8, rd8333e556c8ed739cf39dab58ddc6b43a50c0965, Tue Nov 19 15:29:04 UTC 2019</span><br><span class="line">Took 0.0051 seconds</span><br><span class="line">hbase(main):001:0&gt; <span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line">[subowen@bigdata ~]$ hbase shell</span><br><span class="line">2024-07-05 22:52:46,337 WARN  [main] util.NativeCodeLoader: Unable to load native-hadoop library <span class="keyword">for</span> your platform... using builtin-java classes <span class="built_in">where</span> applicable</span><br><span class="line">HBase Shell</span><br><span class="line">Use <span class="string">&quot;help&quot;</span> to get list of supported commands.</span><br><span class="line">Use <span class="string">&quot;exit&quot;</span> to quit this interactive shell.</span><br><span class="line">For Reference, please visit: http://hbase.apache.org/2.0/book.html<span class="comment">#shell</span></span><br><span class="line">Version 2.1.8, rd8333e556c8ed739cf39dab58ddc6b43a50c0965, Tue Nov 19 15:29:04 UTC 2019</span><br><span class="line">Took 0.0025 seconds</span><br><span class="line">hbase(main):001:0&gt; quit</span><br><span class="line">[subowen@bigdata ~]$</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>启动<code>ZooKeeper</code>和查看 <code>ZooKeeper</code> 的运行状态的命令</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[subowen@bigdata ~]$ zkServer.sh start</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /home/subowen/apps/zookeeper-3.4.12/bin/../conf/zoo.cfg</span><br><span class="line">Starting zookeeper ... STARTED</span><br><span class="line"></span><br><span class="line">[subowen@bigdata ~]$ zkServer.sh status</span><br><span class="line">ZooKeeper JMX enabled by default</span><br><span class="line">Using config: /home/subowen/apps/zookeeper-3.4.12/bin/../conf/zoo.cfg</span><br><span class="line">Mode: standalone</span><br></pre></td></tr></table></figure>

<ol start="5">
<li><p>修改表结构的命令</p>
<p>使用 <code>alter</code> 命令可以对表的结构进行修改：</p>
<p>表名创建时写的所有和列族相关的信息，都可以后续通过<code>alter</code>修改，包括<strong>增加</strong>、<strong>删除</strong>列族。</p>
<p>① 增加列族和修改信息都使用覆盖的方法</p>
<p>​	修改列族的版本，<code>VERSIONS =&gt; 6</code>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):001:0&gt; alter &#x27;bigdata:person&#x27;, NAME =&gt; &#x27;name&#x27;, VERSIONS =&gt; 6</span><br><span class="line">Updating all regions with the new schema...</span><br><span class="line">1/1 regions updated.</span><br><span class="line">Done.</span><br><span class="line">Took 4.0145 seconds</span><br></pre></td></tr></table></figure>

<p>​	添加列族 <code>tel</code>：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):002:0&gt; alter &#x27;bigdata:person&#x27;, NAME =&gt; &#x27;tel&#x27;, VERSIONS =&gt; 6</span><br><span class="line">Updating all regions with the new schema...</span><br><span class="line">1/1 regions updated.</span><br><span class="line">Done.</span><br><span class="line">Took 2.4498 seconds</span><br></pre></td></tr></table></figure>

<p>​	查看修改后的数据：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):003:0&gt; describe &#x27;bigdata:person&#x27;</span><br><span class="line">Table bigdata:person is ENABLED</span><br><span class="line">bigdata:person</span><br><span class="line">COLUMN FAMILIES DESCRIPTION</span><br><span class="line">&#123;NAME =&gt; &#x27;msg&#x27;, VERSIONS =&gt; &#x27;6&#x27;, EVICT_BLOCKS_ON_CLOSE =&gt; &#x27;false&#x27;, NEW_VERSION_BEHAVIOR =&gt; &#x27;false&#x27;, KEEP_DELETED_CELLS =&gt; &#x27;FALSE&#x27;, CACHE_DATA_ON_WRITE =&gt; &#x27;fal</span><br><span class="line">se&#x27;, DATA_BLOCK_ENCODING =&gt; &#x27;NONE&#x27;, TTL =&gt; &#x27;FOREVER&#x27;, MIN_VERSIONS =&gt; &#x27;0&#x27;, REPLICATION_SCOPE =&gt; &#x27;0&#x27;, BLOOMFILTER =&gt; &#x27;ROW&#x27;, CACHE_INDEX_ON_WRITE =&gt; &#x27;false&#x27;, IN</span><br><span class="line">_MEMORY =&gt; &#x27;false&#x27;, CACHE_BLOOMS_ON_WRITE =&gt; &#x27;false&#x27;, PREFETCH_BLOCKS_ON_OPEN =&gt; &#x27;false&#x27;, COMPRESSION =&gt; &#x27;NONE&#x27;, BLOCKCACHE =&gt; &#x27;true&#x27;, BLOCKSIZE =&gt; &#x27;65536&#x27;&#125;</span><br><span class="line"></span><br><span class="line">&#123;NAME =&gt; &#x27;name&#x27;, VERSIONS =&gt; &#x27;5&#x27;, EVICT_BLOCKS_ON_CLOSE =&gt; &#x27;false&#x27;, NEW_VERSION_BEHAVIOR =&gt; &#x27;false&#x27;, KEEP_DELETED_CELLS =&gt; &#x27;FALSE&#x27;, CACHE_DATA_ON_WRITE =&gt; &#x27;fa</span><br><span class="line">lse&#x27;, DATA_BLOCK_ENCODING =&gt; &#x27;NONE&#x27;, TTL =&gt; &#x27;FOREVER&#x27;, MIN_VERSIONS =&gt; &#x27;0&#x27;, REPLICATION_SCOPE =&gt; &#x27;0&#x27;, BLOOMFILTER =&gt; &#x27;ROW&#x27;, CACHE_INDEX_ON_WRITE =&gt; &#x27;false&#x27;, I</span><br><span class="line">N_MEMORY =&gt; &#x27;false&#x27;, CACHE_BLOOMS_ON_WRITE =&gt; &#x27;false&#x27;, PREFETCH_BLOCKS_ON_OPEN =&gt; &#x27;false&#x27;, COMPRESSION =&gt; &#x27;NONE&#x27;, BLOCKCACHE =&gt; &#x27;true&#x27;, BLOCKSIZE =&gt; &#x27;65536&#x27;&#125;</span><br><span class="line"></span><br><span class="line">&#123;NAME =&gt; &#x27;tel&#x27;, VERSIONS =&gt; &#x27;6&#x27;, EVICT_BLOCKS_ON_CLOSE =&gt; &#x27;false&#x27;, NEW_VERSION_BEHAVIOR =&gt; &#x27;false&#x27;, KEEP_DELETED_CELLS =&gt; &#x27;FALSE&#x27;, CACHE_DATA_ON_WRITE =&gt; &#x27;fal</span><br><span class="line">se&#x27;, DATA_BLOCK_ENCODING =&gt; &#x27;NONE&#x27;, TTL =&gt; &#x27;FOREVER&#x27;, MIN_VERSIONS =&gt; &#x27;0&#x27;, REPLICATION_SCOPE =&gt; &#x27;0&#x27;, BLOOMFILTER =&gt; &#x27;ROW&#x27;, CACHE_INDEX_ON_WRITE =&gt; &#x27;false&#x27;, IN</span><br><span class="line">_MEMORY =&gt; &#x27;false&#x27;, CACHE_BLOOMS_ON_WRITE =&gt; &#x27;false&#x27;, PREFETCH_BLOCKS_ON_OPEN =&gt; &#x27;false&#x27;, COMPRESSION =&gt; &#x27;NONE&#x27;, BLOCKCACHE =&gt; &#x27;true&#x27;, BLOCKSIZE =&gt; &#x27;65536&#x27;&#125;</span><br><span class="line">3 row(s)</span><br><span class="line">Took 0.0795 seconds</span><br></pre></td></tr></table></figure>

<p>② 删除列族</p>
<p>​	删除列族可以用以下两种方式：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):001:0&gt; alter &#x27;bigdata:person&#x27;, NAME =&gt; &#x27;tel&#x27;, METHOD =&gt; &#x27;delete&#x27;</span><br><span class="line">Updating all regions with the new schema...</span><br><span class="line">1/1 regions updated.</span><br><span class="line">Done.</span><br><span class="line">Took 2.1046 seconds</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hbase(main):002:0&gt; alter &#x27;bigdata:person&#x27;, &#x27;delete&#x27; =&gt; &#x27;msg&#x27;</span><br><span class="line">Updating all regions with the new schema...</span><br><span class="line">1/1 regions updated.</span><br><span class="line">Done.</span><br><span class="line">Took 2.9721 seconds</span><br></pre></td></tr></table></figure>

</li>
<li><p><code>HBase</code> 的 <code>Java API</code>中，数据表描述的对象是什么？<code>TableDescriptor</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TableDescriptor</span><br></pre></td></tr></table></figure>

</li>
<li><p><code>ZooKeeper</code> 的访问端口号，<code>HBase</code> 的Web访问端口号</p>
<p><code>ZooKeeper</code> 的访问端口号为 <code>2181</code></p>
<p><code>HBase</code> 的 Web 访问端口号为 <code>16010</code></p>
</li>
<li><p>修改表中列族的<code>Version</code>版本的命令</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter <span class="string">&#x27;table_name&#x27;</span>, &#123;NAME =&gt; <span class="string">&#x27;column_family&#x27;</span>, VERSIONS =&gt; number_of_versions&#125;</span><br></pre></td></tr></table></figure>

<ol start="9">
<li><p>删除表中数据的命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delete <span class="string">&#x27;ns:tb&#x27;</span>, <span class="string">&#x27;rk&#x27;</span>, <span class="string">&#x27;cf:col&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>启动和关闭ZooKeeper的命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动 ZooKeeper</span></span><br><span class="line">zkServer.sh start</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭 ZooKeeper</span></span><br><span class="line">zkServer.sh stop</span><br></pre></td></tr></table></figure>

</li>
<li><p>更新表数据的命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter <span class="string">&#x27;ns:tb&#x27;</span>, &#123;NAME =&gt; <span class="string">&#x27;cf:col&#x27;</span>, VERSIONS =&gt; 5&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>HBase安装时，配置文件有那几个？</p>
<ul>
<li><code>hbase-env.sh</code></li>
<li><code>hbase-site.xml</code></li>
<li><code>regionservers</code></li>
<li><code>.bashrc</code></li>
</ul>
</li>
<li><p>关于NoSQL数据库有哪些？</p>
<ul>
<li><code>HBase</code></li>
<li><code>Cassandra</code></li>
<li><code>BigTable</code></li>
</ul>
</li>
<li><p>删除表操作</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">disable</span> <span class="string">&#x27;ns:tb&#x27;</span></span><br><span class="line">drop <span class="string">&#x27;ns:tb&#x27;</span></span><br></pre></td></tr></table></figure>

<ol start="15">
<li><p>HBase进程名，ZooKeeper 的进程名等相关进程</p>
<ul>
<li><code>HMaster</code></li>
<li><code>HRegionServer</code></li>
<li><code>QuorumPeerMain</code></li>
</ul>
</li>
<li><p><code>HBase</code> 依托于哪个文件存储系统？</p>
<p><code>HBase</code> 主要依托于 <code>Hadoop HDFS</code>。</p>
</li>
<li><p>创建表的语法结构</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create <span class="string">&#x27;ns:tb&#x27;</span>, &#123;NAME =&gt; <span class="string">&#x27;cf&#x27;</span>, VERSIONS=5&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询表数据的Shell语法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">get <span class="string">&#x27;r1&#x27;</span>, &#123;COLUMN =&gt; <span class="string">&#x27;cf:col&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">scan <span class="string">&#x27;ns:tb&#x27;</span></span><br></pre></td></tr></table></figure>

</li>
<li><p>什么是列族<code>COLUMN FAMILY</code></p>
</li>
<li><p>HBase的数据类型</p>
<ul>
<li>数据类型<ul>
<li>基本数据类型<ul>
<li>字符串(String)：用于存储文本数据，如名称、描述等。</li>
<li>整数(Int)：用于存储整数数据，如计数、编号等。</li>
<li>浮点数(Float)：用于存储小数数据，如金额、比率等。</li>
<li>布尔值(Boolean)：用于存储逻辑值，如是否、有效等。</li>
</ul>
</li>
<li>复合数据类型<ul>
<li>列族(Column Family)：列族是HBase表中数据的组织方式，用于存储一组相关的列。列族是HBase表中数据的基本组织单位，每个列族对应一个数据节点。</li>
<li>列(Column)：列是HBase表中数据的基本单位，用于存储一组相关的单元格。列可以包含多个单元格，每个单元格对应一个数据值。</li>
<li>单元格(Cell)：单元格是HBase表中数据的基本单位，用于存储一组相关的数据值。单元格包含一个键(Row Key)、一个列(Column)和一个值(Value)。</li>
</ul>
</li>
</ul>
</li>
<li>数据模型<ul>
<li>NameSpace：命名空间，类似于关系型数据库的 <code>Database</code> 概念，每个命名空间下有多个表。HBase 两个自带的命名空间，分别是 <code>hbase</code> 和 <code>default</code>，<code>hbase</code> 中存放的是 <code>HBase</code> 内置的表，<code>default</code>表是用户默认使用的命名空间。</li>
<li>Table：类似于关系型数据库的表概念。不同的是，HBase 定义表时只需要声明列族即可，不需要声明具体的列。因为数据存储是稀疏的，所以往 HBase 写入数据时，字段可以动态、按需指定。因此，和关系型数据库相比，HBase 能够轻松应对字段变更的场景。</li>
<li>Row：<code>HBase</code> 表中的每行数据都由一个 <strong>RowKey</strong> 和多个 <strong>Column</strong>（列）组成，数据是按照 <code>RowKey</code> 的字典顺序存储的，并且查询数据时只能根据 <code>RowKey</code> 进行检索，所以 <code>RowKey</code> 的设计十分重要。</li>
<li>Column：<code>HBase</code> 中的每个列都由 <code>Column Family</code>(列族)和 <code>Column Qualifier</code>（列限定符）进行限定，例如 <code>info：name</code>，<code>info：age</code>。建表时，只需指明列族，而列限定符无需预先定义。</li>
<li>Time Stamp：用于标识数据的不同版本<code>Version</code>，每条数据写入时，系统会自动为其加上该字段，其值为写入 <code>HBase</code> 的时间。</li>
<li>Cell：由 <code>&#123;rowkey, column Family:Column Qualifier, timestamp&#125;</code> 唯一确定的单元。<code>Cell</code> 中的数据全部是字节码形式存贮。</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="判断题"><a href="#判断题" class="headerlink" title="判断题"></a>判断题</h3><ol>
<li><p><code>HBase</code> 本身是用 <code>C++</code> 语言编写的，因此具有很高的执行效率。（ × ）</p>
<p><code>HBase</code> 本身是由 <code>Java</code> 语言编写的，尽管使用 <code>Java</code>，其执行效率还是较高的。</p>
</li>
<li><p><code>HBase</code> 优化目前主要工作集中于 <code>Rowkey</code> 优化。（ × ）</p>
<p><code>HBase</code> 的优化目前主要工作集中在 <code>RowKey</code> 的设计、参数优化、<code>JVM</code>调优等方面。</p>
</li>
<li><p>可以想象 <code>HBase</code> 是通过**”三维”**的表来存储数据的，通过时间戳保存数据的历史版本。（ √ ）</p>
</li>
<li><p>安装 <code>HBase</code> 完全分布式时，需要确保 <code>SSH</code> 和 <code>JDK</code> 是可以正常使用的。（ √ ）</p>
<p>在安装 HBase 的完全分布式部署时，确保 <code>SSH</code> 和 <code>JDK</code> 可以正常使用是非常重要的。具体来说：</p>
<ul>
<li><p><strong>SSH</strong>：在分布式部署中，<code>HBase</code> 的各个节点之间需要进行通信和协作，而 <code>SSH</code> 是用于在不同节点之间建立安全连接的工具。确保节点之间可以互相访问、通信和传输文件是部署 <code>HBase</code> 所必需的。通常需要设置免密登录，以便在节点之间进行信息交换而无需手动输入密码。</p>
</li>
<li><p><strong>JDK</strong>：HBase 是基于 <code>Java</code> 编程语言开发的，因此必须确保在每个节点上安装并配置了适当的 <code>JDK</code>。<code>HBase</code> 运行需要 <code>Java</code> 环境，且为了确保 <code>HBase</code> 能够正常工作，必须保证每个节点都能够使用正确的 <code>JDK</code> 版本。</p>
</li>
</ul>
</li>
<li><p><code>Hadoop</code> 中引入 <code>HBase</code> 的其中一个原因是：<code>HDFS</code> 在处理连续数据时比较吃力。（ × ）·</p>
<p><code>HDFS</code> 的设计目标之一就是为了有效地处理大规模数据，包括连续数据（如大文件、数据流等）和离散数据（如小文件、批量数据等）。<code>Hadoop</code> 中之所以引入 <code>HBase</code>，是需要 <code>HBase</code> 提供实时访问数据的能力，使得 <code>Hadoop</code> 生态系统更全面（此外还有高可伸缩性、高容错、多版本策略等）。</p>
</li>
<li><p>利用 <code>HBase</code> 技术可在廉价 <code>PC Server</code> 上搭建起大规模结构化存储集群。（ √ ）</p>
</li>
<li><p><code>HBase</code> 是 <code>Hadoop</code> 生态系统的一个组成部分。（ √ ）</p>
<p><code>HBase</code> 是继 <code>Google Bigtable</code> 之后创建的分布式、开源、版本化、非关系型数据库。它是 <code>Hadoop</code> 生态系统的重要组件，利用 <code>HDFS</code> 的容错功能，提供对数据的实时读写访问。 <code>HBase</code> 尽管是数据库，但也可以称为数据存储系统，因为它不提供触发器、查询语言和二级索引等 <code>RDBMS</code> 功能。</p>
</li>
<li><p>使用 <code>HBase</code> 时，无需启动服务就可以直接在开发环境中调用 <code>HBase</code> 的相关功能。（ × ）</p>
<p><code>HBase</code> 是基于 <code>Hadoop</code> 的，在使用 <code>HBase</code> 之前需要启动 <code>ZooKeeper</code> 和 <code>Hadoop</code> 才能使用 <code>HBase</code>。</p>
</li>
<li><p>配置 <code>HBase</code> 分布式部署的过程中，可以通过 <code>cp</code> 命令把文件复制到运行在不同机器上的节点中。（ × ）</p>
<p>可以使用 <code>scp</code> 命令、<code>rsync</code>命令，或者基于 <code>rsync</code> 编写工具 <code>xsync</code> 进行传输。</p>
</li>
</ol>
<h3 id="填空题"><a href="#填空题" class="headerlink" title="填空题"></a>填空题</h3><ol>
<li><p>判断表是否存在，禁用表，删除表，创建表，查看命名空间等 <code>Shell</code> 命令。</p>
<ul>
<li>判断表是否存在 ：<code>exists &#39;namespace_name:table_name&#39;</code></li>
<li>禁用&#x2F;启用表：<code>disable &#39;namespace_name:table_name&#39;</code> &#x2F; <code>enable namespace_name:table_name</code></li>
<li>删除表：删除表之前需要禁用表，<code>disable &#39;namespace_name:table_name&#39;</code>，然后再删除表，<code>drop &#39;namespace_name:tablename&#39;</code></li>
<li>创建表：<code>create &#39;namespace_name:table_name&#39;, &#123;NAME =&gt; &#39;cf1&#39;, VERSION=5&#125;, &#123;NAME =&gt; &#39;cf2&#39;, VERSION=5&#125;</code></li>
<li>查看命名空间：<code>list_namespace</code></li>
</ul>
</li>
<li><p><code>HBase</code> 的进程有哪些：关于这些进程的详细说明见 <a href="https://hello-nilera.com/2024/06/02/QuickPassHBase/"><code>QuickPassHBase</code></a> 或 <strong>简答题 T4</strong>。</p>
<ul>
<li><code>HBase</code> 的主要进程：<code>HMaster</code>、<code>HRegionServer</code></li>
<li><code>HBase</code> 所依赖的两个外部的服务：<code>ZooKeeper</code>、<code>HDFS</code></li>
</ul>
</li>
<li><p>行键是什么：<code>rowkey</code></p>
<p>在 <code>HBase</code> 中，行键唯一标识了 <code>HBase</code> 表的一行，可以通过单个行键或行键区间的方式访问表。行键保存为 <em>字节数组</em> ，以<em>字典序</em> 排序存储。</p>
</li>
<li><p><code>HBase</code> 是一个什么样的分布式存储系统。（非关系型）</p>
<p><code>Apache HBase™</code> 是以 <code>HDFS</code> 为数据存储的，一种<strong>分布式</strong>、<strong>可扩展</strong>的 <code>NoSQL</code> 数据库。<strong>HBase</strong> 是一款面向列存储，用于存储处理海量数据的 <strong>NoSQL</strong> 数据库。</p>
<p><em><strong>HBase</strong></em> 的理论原型是 <strong>Google</strong> 的 <strong>BigTable</strong> 论文。他是一个<strong>高可靠性</strong>、<strong>高性能</strong>、<strong>面向列</strong>、<strong>可伸缩</strong>的<strong>分布式</strong>存储系统。</p>
</li>
</ol>
<h3 id="简答题"><a href="#简答题" class="headerlink" title="简答题"></a>简答题</h3><ol>
<li><p><code>HBase</code> 的基础核心组件有哪些？分别什么作用？</p>
<ul>
<li><p>HBase-Client<br>客户端，用来访问 <code>HBase</code> 集群。可以和 <code>Hbase</code> 交互，也可以和 <code>HRegionServer</code> 交互。通过 <code>HBase RPC</code> 来访问对应的接口。</p>
<p>这里的客户端模式有多种，可以是 <code>Thrift</code>、<code>Avro</code>、<code>Rest</code> 等。</p>
<p>另外，<code>hbase-client</code> 自身会缓存 <code>region</code> 的一些信息。</p>
</li>
<li><p>ZooKeeper<br>作用：</p>
<ul>
<li><code>HMaster</code> 的高可用</li>
<li>存储 <code>ROOT</code> 表的地址、<code>HMaster</code> 的地址</li>
<li>存储所有 <code>HRegionServer</code> 的状态，监控 <code>HRegionServer</code> 的上下限</li>
<li>存储 <code>HBase</code> 的一些 <code>Schema</code> 和 <code>Table</code> 的元数据</li>
</ul>
</li>
<li><p>HMaster</p>
<p>HMaster可以启动多个，通过选举机制来保证只有一个 <code>HMaster</code> 正常运行并提供服务，其他的 <code>HMaster</code> 作为 <code>standby</code> 来保证高可用。<code>HMaster</code> 主要负责 <strong>表</strong> 和 <strong>Region</strong> 的管理工作。如：</p>
<ul>
<li>用户对表的增删改查</li>
<li>管理 <code>RegionServer</code> 的负载均衡，调整 <code>Region</code> 的分布</li>
<li>在 <code>RegionServer</code> 宕机或下线后，负责迁移 <code>RegionServer</code> 上的 <code>Region</code> 到其他的 <code>RegionServer</code> 上</li>
<li><code>Region</code> 在分裂后，负责分配新的 <code>Region</code></li>
</ul>
</li>
<li><p>HRegionServer<br><code>HRegionServer</code> 是 <code>HBase</code> 中真正的工作节点，主要负责响应用户的 I&#x2F;O 请求，向 HDFS 文件系统读写数据，以及 Region 的数据文件的合并和拆分等，是 HBase 中最核心的模块。</p>
<p>在 <code>HBase</code> 中，一张表由多个的 <code>HRegion</code> 组成，一个 <code>HRegionServer</code> 中管理着多个 <code>HRegion</code> 对象。而一个 <code>HRegion</code> 由多个<code>HStore</code> 组成，每个<code>HStore</code>对象都对应着表的一个列族 （Column Family）。之后，一个<code>HStore</code>又由一个<code>MemStore</code>和多个<code>StoreFile</code>组成。这些 <code>StoreFile</code> 就是<code>hbase</code> 存储在 <code>HDFS</code>上的数据文件，<code>MemStore</code> 表示还在内存中未刷新到文件上的那些数据。</p>
</li>
</ul>
</li>
<li><p><code>HBase</code> 的写流程， 读流程？</p>
<ul>
<li><p>写流程</p>
<p>写流程顺序正如 <code>API</code> 编写顺序，首先创建 <code>HBase</code> 的重量级连接。</p>
<p>① 首先访问 <code>ZooKeeper</code>，获取 <code>hbase:meta</code> 表位于哪个 <code>Region Server</code> </p>
<p>② 访问对应的 <code>Region Server</code>，获取 <code>hbase:meta</code> 表，将其缓存到连接中，作为连接属性 <code>MetaCache</code>，由于 <code>meta</code> 表具有一定的数据量，导致了创建连接比较慢；</p>
<p>之后使用创建的连接获取 <code>Table</code>，这是一个轻量级的连接，只有在第一次创建的时候会检查表格是否存在访问<code>RegionServer</code>，之后在获取 <code>Table</code> 时不会访问 <code>RegionServer</code></p>
<p>③ 调用 <code>Table</code> 的 <code>put</code> 方法写入数据，此时还需要解析 <code>RowKey</code>，对照缓存的 <code>MetaCache</code>，查看具体写入的位置有哪个 <code>RegionServer</code></p>
<p>④ 将数据顺序写入（追加）到 <code>WAL</code>，此处写入是直接落盘的，并设置专门的线程控制 <code>WAL</code> 预写日志的滚动（类似 Flume）；</p>
<p>⑤ 根据写入命令的 <code>RowKey</code> 和 <code>ColumnFamily</code> 查看具体写入到哪个 <code>MemStore</code>，并且在 <code>MemStore</code> 中排序</p>
<p>⑥ 向客户端发送 <code>ACK</code></p>
<p>⑦ 等达到 <code>MemStore</code> 的刷写时机后，将数据刷写到对应的 <code>Store</code> 中。</p>
</li>
<li><p>读流程</p>
<p>读流程创建连接的方式同写流程。创建完连接后：</p>
<p>① 创建 <code>Table</code> 对象发送 <code>get</code> 请求。</p>
<p>② 优先访问 <code>Block Cache</code>（读缓存），查找是否之前读取过，并且可以读取 <code>HFile</code> 的索引信息和布隆过滤器。</p>
<p>③ 不管读缓存中是否已经有数据了（可能已经过期了），都需要再次读取写缓存和 <code>store</code> 中的文件。</p>
<p>④ 最终将所有读取到的数据合并版本，按照 <code>get</code> 的要求返回即可。</p>
</li>
</ul>
</li>
<li><p><code>HBase</code> 的特点有哪些？优点或缺点？</p>
<p><em><strong>HBase的特点：</strong></em>(强 &#x2F; 自动 &#x2F; 高 &#x2F; 海集 &#x2F; 并 &#x2F; 列 &#x2F; 多 &#x2F; 块 &#x2F; 运行 &#x2F; 稀)</p>
<ul>
<li><p><strong>强一致性的读&#x2F;写</strong>：<code>HBase</code>不是”最终一致性”数据库，它非常适合于诸如高速计数器聚合等任务。</p>
</li>
<li><p><strong>自动分片</strong>：<code>HBase</code> 中的表通过 <code>Region</code> 分布在集群上，而且 <code>Region</code> 会随着数据的增长自动拆分和重新分布。</p>
</li>
<li><p><strong>高可靠性</strong>：自动 <code>RegionServer</code> 故障转移，<code>WAL</code> 机制保证了数据写入时不会因集群异常而导致写入数据丢失，<code>Replication</code> 机制保证了在集群出现严重的问题时，数据不会发生丢失或损坏。而且 <code>HBase</code> 底层使用 <code>HDFS</code>，<code>HDFS</code> 本身也有备份。</p>
</li>
<li><p><strong><code>Hadoop/HDFS</code> 集成&amp;海量存储</strong>：，<code>HBase</code>支持 <code>HDFS</code>开箱即用作为其分布式文件系统。HBase 作为一个开源的分布式 <code>Key-Value</code> 数据库，其主要作用是面向 <strong>PB</strong> 级别数据的实时入库和快速随机访问。这主要源于上述易扩展的特点，使得 <code>HBase</code> 通过扩展来存储海量的数据。</p>
</li>
<li><p><strong>并行处理</strong>：<code>HBase</code> 通过 <code>MapReduce</code> 支持大规模并行处理，将 <code>HBase</code> 用作源和接收器。</p>
</li>
<li><p><strong>列式存储</strong>：<code>HBase</code> 是根据列族来存储数据的。列族下面可以有非常多的列。列式存储的最大好处就是，其数据在表中是按照某列存储的，这样在查询只需要少数几个字段时，能大大减少读取的数据量。（面向列）</p>
</li>
<li><p><strong>多种语言的 API</strong>：<code>HBase</code> 支持使用 <code>Java</code> 的 <code>API</code> 来编程进行数据的存取，还支持使用 <code>Thrift</code> 语言和 <code>REST</code> 语言的 <code>API</code> 来编程进行数据的存取。</p>
</li>
<li><p><strong>块缓存和布隆过滤器</strong>：<code>HBase</code>支持 <code>Block Cache</code> 和 <code>Bloom</code>过滤器进行大容量查询优化。</p>
</li>
<li><p><strong>运行管理</strong>：<code>HBase</code> 为业务洞察和 <code>JMX</code> 度量提供内置网页。</p>
</li>
<li><p><strong>稀疏性</strong>：为空的列可以不占存储空间，表可以设计的非常稀疏。</p>
</li>
</ul>
<p><em><strong>HBase 的优点和缺点</strong></em></p>
<ul>
<li><p>HBase的优点：(动节&#x2F;海存&#x2F;负载&#x2F;并拓)</p>
<ul>
<li><strong>动态增加&amp;节省空间</strong>：在传统的关系数据库中，如果数据结构发生了变化，就需要停机维护，而且需要修改表结构，而在 HBase 中数据表内的列可以做到动态增加，并且列为空的时候不存储数据，从而节省存储空间。</li>
<li><strong>海量数据存储</strong>：<code>HBase</code> 适合存储 <strong>PB</strong> 数量级的海量数据，<strong>PB</strong> 级的数据在只采用廉价 PC 来存储的情况下，也可以在几十到一百毫秒内返回数据。这与 <code>HBase</code> 的极易扩展息息相关，正因如此，HBase 为海量数据的存储提供了便利。</li>
<li><strong>负载均衡</strong>：传统的通用关系数据库无法应对在数据规模剧增时导致的系统扩展性问题和性能问题。<code>HBase</code> 可以做到自动切分数据，并且会随着数据的增长自动地拆分和重新分布。</li>
<li><strong>高并发</strong>：<code>HBase</code> 可以提供高并发的读写操作，而且可以利用廉价的计算机来处理超过 10 亿行的表数据</li>
<li><strong>高拓展性</strong>：<code>HBase</code> 具有可伸缩性，如果当前集群的处理能力明显下降，可以增加集群的服务器数量来维持甚至提高处理能力。</li>
</ul>
</li>
<li><p><code>HBase</code> 的缺点：（条查&#x2F;复杂&#x2F;JOIN&#x2F;ACID&#x2F;SQL）</p>
<ul>
<li><strong>不支持条件查询</strong>：不能支持条件查询，只支持按照 <code>RowKey</code>（行键）来查询，也就是只能按照主键来查询。这样在设计 <code>RowKey</code> 时，就需要完美的方案以设计出符合业务的查询。</li>
<li><strong>架构设计复杂</strong>：架构设计复杂，且使用 <code>HDFS</code> 作为分布式存储，因此只是存储少量数据，它也不会很快。在大数据量时，它慢的不会很明显。</li>
<li><strong>不支持 <code>Join</code> 操作</strong>：<code>HBase</code> 不支持表的关联操作，因此数据分析是 <code>HBase</code> 的弱项。常见的 <code>group by</code> 或 <code>order by</code> 只能通过编写 <code>MapReduce</code> 来实现。</li>
<li><strong>不支持ACID</strong>：<code>HBase</code>部分支持了 <code>ACID</code></li>
<li><strong>不支持SQL语句查询</strong>：查询 <code>HBase</code> 时不支持通过 <code>SQL</code> 语句进行查询。</li>
</ul>
</li>
</ul>
</li>
<li><p><code>Master</code> 和 <code>RegionServer</code> 的作用是什么？</p>
<p><code>HBase</code> 包含一个 <code>Master</code> 和许多个 <code>RegionServer</code> 。</p>
<ul>
<li><p><code>Master</code>：实现类为 <code>HMaster</code>，负责监控集群中所有的 <code>RegionServer</code> 实例。主要作用如下：</p>
<ul>
<li><p>管理元数据表格 <code>hbase:meta</code>，接收用户对表格创建修改删除的命令并执行</p>
</li>
<li><p>监控 <code>Region</code> 是否需要进行负载均衡，故障转移和 <code>Region</code> 的拆分。</p>
</li>
</ul>
</li>
<li><p><code>RegionServer</code>：实现类为 <code>HRegionServer</code>，主要作用如下: </p>
<ul>
<li><p>负责数据 <code>Cell</code> 的处理，例如写入数据 <code>put</code>，查询数据 <code>get</code> 等。</p>
</li>
<li><p>拆分合并 <code>Region</code> 的实际执行者，有 <code>master</code> 监控，有 <code>RegionServer</code> 执行。</p>
</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3 id="编程题"><a href="#编程题" class="headerlink" title="编程题"></a>编程题</h3><h4 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h4><ol>
<li><p>创建命名空间的 Shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create_namespace <span class="string">&#x27;namespace_name&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>创建表的 Shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create <span class="string">&#x27;namespace_name:table_name&#x27;</span>, &#123;NAME =&gt; <span class="string">&#x27;cf1&#x27;</span>, VERSION =&gt; 5&#125; </span><br></pre></td></tr></table></figure>
</li>
<li><p>修改表的 Shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter <span class="string">&#x27;namespace_name:table_name&#x27;</span>, NAME =&gt; <span class="string">&#x27;cf1&#x27;</span>, METHOD =&gt; <span class="string">&#x27;delete&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>插入数据的 Shell</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">put <span class="string">&#x27;ns:tb&#x27;</span>, <span class="string">&#x27;rk&#x27;</span>, <span class="string">&#x27;cf:col&#x27;</span>, <span class="string">&#x27;value&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>查询数据的 Shell</p>
<ul>
<li><code>get</code> 最大范围是一行数据，也可以进行列的过滤，读取的结果为多行 <code>Cell</code>。 <code>Cell</code> 的格式如下：<code>&#123;rowkey, column Familycolumn Qualifier, time Stamp&#125;</code>。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">get <span class="string">&#x27;ns:tb&#x27;</span>, <span class="string">&#x27;rk&#x27;</span> , &#123;COLUMN =&gt; <span class="string">&#x27;cf:col&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>scan</code> 用于扫描数据，能够读取多行数据，不建议扫描过多的数据，推荐使用 <code>startRow</code> 和 <code>stopRow</code> 来控制读取的数据，默认范围<strong>左闭右开</strong>。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scan <span class="string">&#x27;namespace_name:table_name&#x27;</span>, &#123;STARTROW =&gt; <span class="string">&#x27;1001&#x27;</span>,STOPROW =&gt; <span class="string">&#x27;1002&#x27;</span>&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="API"><a href="#API" class="headerlink" title="API"></a>API</h4><p>读写操作时</p>
<ol>
<li>加载配置信息</li>
<li>获取 <code>HBase</code> 的链接对象</li>
<li>获取 <code>Admin</code> 对象</li>
<li>构造 <code>TableName</code> 对象</li>
<li>判断表是否存在</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="type">Configuration</span> <span class="variable">conf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Configuration</span>();			<span class="comment">// 加载配置信息</span></span><br><span class="line">        conf.set(<span class="string">&quot;hbase.zookeeper.quorum&quot;</span>, <span class="string">&quot;bigdata&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            connection = ConnectionFactory.createConnection(conf);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">closeConntction</span><span class="params">()</span> <span class="keyword">throw</span> IOException &#123;</span><br><span class="line">        <span class="keyword">if</span> (connection != <span class="literal">null</span>) &#123;</span><br><span class="line">            connection.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@brief</span> 判断表格是否存在</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> namespace 命名空间名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableName 表名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 存在; false 不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">boolean</span> <span class="title function_">isTableExists</span><span class="params">(String namespace, String tableName)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1. 获得 admin</span></span><br><span class="line">        <span class="type">Admin</span> <span class="variable">admin</span> <span class="operator">=</span> HBaseConnection.connection.getAdmin();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 使用对应的方法, 判断表格是否存在</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            result = admin.tableExists(TableName.valueOf(namespace, tableName));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 关闭 admin</span></span><br><span class="line">        admin.close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 返回结果</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@brief</span> 向表格中插入数据</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> namespace 命名空间名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableName 表名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rowKey 行键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> columnFamily 列族名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> columnName 列名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 插入值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">putCell</span><span class="params">(String namespace,</span></span><br><span class="line"><span class="params">                               String tableName,</span></span><br><span class="line"><span class="params">                               String rowKey,</span></span><br><span class="line"><span class="params">                               String columnFamily,</span></span><br><span class="line"><span class="params">                               String columnName,</span></span><br><span class="line"><span class="params">                               String value)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1. 获取 Table</span></span><br><span class="line">        <span class="type">Table</span> <span class="variable">table</span> <span class="operator">=</span> connection.getTable(TableName.valueOf(namespace, tableName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 调用相关方法插入数据</span></span><br><span class="line">        <span class="comment">// 2.1 创建 Put 对象</span></span><br><span class="line">        <span class="type">Put</span> <span class="variable">put</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Put</span>(Bytes.toBytes(rowKey));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.2. 给 Put 对象添加数据</span></span><br><span class="line">        put.addColumn(Bytes.toBytes(columnFamily), Bytes.toBytes(columnName), Bytes.toBytes(value));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.3 将对象写入对应的方法</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            table.put(put);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 关闭 Table</span></span><br><span class="line">        table.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@brief</span> 读取数据 读取对应一行的某一列</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> namespace 命名空间名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> tableName 表名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rowKey 行键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> columnFamily 列族名</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> columnName 列名</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">getCells</span><span class="params">(String namespace,</span></span><br><span class="line"><span class="params">                                String tableName,</span></span><br><span class="line"><span class="params">                                String rowKey,</span></span><br><span class="line"><span class="params">                                String columnFamily,</span></span><br><span class="line"><span class="params">                                String columnName)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// 1. 获取 Table</span></span><br><span class="line">        <span class="type">Table</span> <span class="variable">table</span> <span class="operator">=</span> connection.getTable(TableName.valueOf(namespace, tableName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 调用相关方法插入数据</span></span><br><span class="line">        <span class="comment">// 2.1 创建 Get 对象</span></span><br><span class="line">        <span class="type">Get</span> <span class="variable">get</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Get</span>(Bytes.toBytes(rowKey));   <span class="comment">// 如果此时不使用 addColumn 进行参数的添加, 此时则读取一整行的数据</span></span><br><span class="line">        <span class="comment">// 2.2 如果想读取某一列的数据, 需要添加对应的参数</span></span><br><span class="line">        get.addColumn(Bytes.toBytes(columnFamily), Bytes.toBytes(columnName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2.3 也可以设置读取数据的版本</span></span><br><span class="line">        get.readAllVersions();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 3. 读取数据, 写入 Result 对象</span></span><br><span class="line">            <span class="type">Result</span> <span class="variable">result</span> <span class="operator">=</span> table.get(get);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 4. 处理数据</span></span><br><span class="line">            Cell[] cells = result.rawCells();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 5. 测试方法: 直接把读取到的数据打印到控制台</span></span><br><span class="line">            <span class="comment">// 如果是实际开发, 需要再额外写方法, 对应处理数据</span></span><br><span class="line">            <span class="keyword">for</span> (Cell cell : cells) &#123;</span><br><span class="line">                <span class="comment">// Cell 存储数据比较底层, 需要进一步处理</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(CellUtil.cloneValue(cell));</span><br><span class="line">                System.out.println(value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6. 关闭 Table</span></span><br><span class="line">        table.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throw</span> IOException &#123;</span><br><span class="line">        putCell(<span class="string">&quot;sdutcm&quot;</span>, <span class="string">&quot;bigdata&quot;</span>, <span class="string">&quot;2001&quot;</span>, <span class="string">&quot;info&quot;</span>, <span class="string">&quot;name&quot;</span>, <span class="string">&quot;zhangsan&quot;</span>);</span><br><span class="line">        connection.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/leslies2/p/9530378.html">Hadoop 综合揭秘——HBase的原理与应用 - 风尘浪子 - 博客园 (cnblogs.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/u013332124/article/details/100125269">HBase的组件</a></p>
</div></article></div><nav class="pagination" role="navigation" aria-label="pagination"><div class="pagination-previous is-invisible is-hidden-mobile"><a href="/page/0/">上一页</a></div><div class="pagination-next"><a href="/page/2/">下一页</a></div><ul class="pagination-list is-hidden-mobile"><li><a class="pagination-link is-current" href="/">1</a></li><li><a class="pagination-link" href="/page/2/">2</a></li><li><a class="pagination-link" href="/page/3/">3</a></li><li><a class="pagination-link" href="/page/4/">4</a></li></ul></nav></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="/img/avatarMyself.jpg" alt="NilEra"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">NilEra</p><p class="is-size-6 is-block">C/C++ Developer!</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Jinan Shandong</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">31</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">27</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">32</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/NilEra-K" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/NilEra-K"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Facebook" href="https://facebook.com"><i class="fab fa-facebook"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Twitter" href="https://twitter.com"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Dribbble" href="https://dribbble.com"><i class="fab fa-dribbble"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://github.com/NilEra-K" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">GitHub</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li><li><a class="level is-mobile" href="https://nano.chemtian.top/" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">Thymol Blue</span></span><span class="level-right"><span class="level-item tag">nano.chemtian.top</span></span></a></li></ul></div></div></div><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/CppDev/"><span class="level-start"><span class="level-item">CppDev</span></span><span class="level-end"><span class="level-item tag">3</span></span></a><ul><li><a class="level is-mobile" href="/categories/CppDev/Gaming/"><span class="level-start"><span class="level-item">Gaming</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/CppDev/QT6/"><span class="level-start"><span class="level-item">QT6</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/CppDev/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/"><span class="level-start"><span class="level-item">多线程编程</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/Linux/"><span class="level-start"><span class="level-item">Linux</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/Linux/%E8%BD%AF%E4%BB%B6%E6%BA%90/"><span class="level-start"><span class="level-item">软件源</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF/"><span class="level-start"><span class="level-item">大数据技术</span></span><span class="level-end"><span class="level-item tag">8</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF/ECharts/"><span class="level-start"><span class="level-item">ECharts</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF/HBase/"><span class="level-start"><span class="level-item">HBase</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF/Scala/"><span class="level-start"><span class="level-item">Scala</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF/Spark/"><span class="level-start"><span class="level-item">Spark</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF/%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/"><span class="level-start"><span class="level-item">数据可视化</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF/%E9%A1%B9%E7%9B%AE/"><span class="level-start"><span class="level-item">项目</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"><span class="level-start"><span class="level-item">开发工具</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Axure-RP-9/"><span class="level-start"><span class="level-item">Axure RP 9</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Docker/"><span class="level-start"><span class="level-item">Docker</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/Git/"><span class="level-start"><span class="level-item">Git</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/VSCode/"><span class="level-start"><span class="level-item">VSCode</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E7%AE%97%E6%B3%95/"><span class="level-start"><span class="level-item">数据结构/算法</span></span><span class="level-end"><span class="level-item tag">4</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E7%AE%97%E6%B3%95/%E5%93%88%E5%B8%8C-Hash/"><span class="level-start"><span class="level-item">哈希(Hash)</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E7%AE%97%E6%B3%95/%E6%A0%88-Stack/"><span class="level-start"><span class="level-item">栈(Stack)</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84-%E7%AE%97%E6%B3%95/%E6%A0%91-Tree/"><span class="level-start"><span class="level-item">树(Tree)</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"><span class="level-start"><span class="level-item">深度学习</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/Kaggle/"><span class="level-start"><span class="level-item">Kaggle</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/PyTorch/"><span class="level-start"><span class="level-item">PyTorch</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/%E9%97%B2%E8%81%8A/"><span class="level-start"><span class="level-item">闲聊</span></span><span class="level-end"><span class="level-item tag">1</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E9%97%B2%E8%81%8A/%E8%AE%A1%E5%88%92/"><span class="level-start"><span class="level-item">计划</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></li></ul></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">订阅更新</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="订阅"></div></div></form></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-08-01T07:29:16.000Z">2024-08-01</time></p><p class="title"><a href="/2024/08/01/LLM-General-Education/">LLM_General_Education</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-30T14:55:47.000Z">2024-07-30</time></p><p class="title"><a href="/2024/07/30/MyBatisPlus/">MyBatisPlus</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-30T14:36:18.000Z">2024-07-30</time></p><p class="title"><a href="/2024/07/30/SpringCloud/">SpringCloud</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-29T07:32:17.000Z">2024-07-29</time></p><p class="title"><a href="/2024/07/29/Cpp-Muti-Threaded/">Cpp_Muti_Threaded</a></p><p class="categories"><a href="/categories/CppDev/">CppDev</a> / <a href="/categories/CppDev/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/">多线程编程</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-07-29T07:29:04.000Z">2024-07-29</time></p><p class="title"><a href="/2024/07/29/Cpp-Network-Programming/">Cpp_Network_Programming</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/08/"><span class="level-start"><span class="level-item">八月 2024</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/07/"><span class="level-start"><span class="level-item">七月 2024</span></span><span class="level-end"><span class="level-item tag">6</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/06/"><span class="level-start"><span class="level-item">六月 2024</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/05/"><span class="level-start"><span class="level-item">五月 2024</span></span><span class="level-end"><span class="level-item tag">10</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/04/"><span class="level-start"><span class="level-item">四月 2024</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/03/"><span class="level-start"><span class="level-item">三月 2024</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Axure-RP-9/"><span class="tag">Axure RP 9</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CppDev/"><span class="tag">CppDev</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Docker/"><span class="tag">Docker</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ECharts/"><span class="tag">ECharts</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/EasyX/"><span class="tag">EasyX</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GameDev/"><span class="tag">GameDev</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Git/"><span class="tag">Git</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/HBase/"><span class="tag">HBase</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hadoop/"><span class="tag">Hadoop</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JavaDev/"><span class="tag">JavaDev</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Kaggle/"><span class="tag">Kaggle</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/MyBatis-Plus/"><span class="tag">MyBatis-Plus</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/PyTorch/"><span class="tag">PyTorch</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/QT6/"><span class="tag">QT6</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/R/"><span class="tag">R</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Scala/"><span class="tag">Scala</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Spark/"><span class="tag">Spark</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Tomcat/"><span class="tag">Tomcat</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/VSCode/"><span class="tag">VSCode</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ZooKeeper/"><span class="tag">ZooKeeper</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B%E7%BC%96%E7%A8%8B/"><span class="tag">多线程编程</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF/"><span class="tag">大数据技术</span><span class="tag">8</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/"><span class="tag">开发工具</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/"><span class="tag">数据结构</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/"><span class="tag">机器学习</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/"><span class="tag">深度学习</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%AE%97%E6%B3%95/"><span class="tag">算法</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%A1%E5%88%92/"><span class="tag">计划</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%BD%AF%E4%BB%B6%E6%BA%90/"><span class="tag">软件源</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%97%B2%E8%81%8A/"><span class="tag">闲聊</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E9%A1%B9%E7%9B%AE/"><span class="tag">项目</span><span class="tag">1</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/StarLogo.svg" alt="Hello, NilEra :-)" height="28"></a><p class="is-size-7"><span>&copy; 2024 NilEra</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2024 前方⚡高能</p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/NilEra-K"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdnjs.loli.net/ajax/libs/jquery/3.3.1/jquery.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script><script src="https://cdnjs.loli.net/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer></script><script>moment.locale("zh-cn");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdnjs.loli.net/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdnjs.loli.net/ajax/libs/lightgallery/1.10.0/js/lightgallery.min.js" defer></script><script src="https://cdnjs.loli.net/ajax/libs/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script type="text/javascript" id="MathJax-script" async>MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      },
      svg: {
        fontCache: 'global'
      },
      chtml: {
        matchFontHeight: false
      }
    };</script><script src="https://cdnjs.loli.net/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js"></script><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container" id="algolia-input"></div><div id="algolia-poweredby" style="display:flex;margin:0 .5em 0 1em;align-items:center;line-height:0"></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div><div class="searchbox-footer"></div></div></div><script src="https://cdnjs.loli.net/ajax/libs/algoliasearch/4.0.3/algoliasearch-lite.umd.js" crossorigin="anonymous" defer></script><script src="https://cdnjs.loli.net/ajax/libs/instantsearch.js/4.3.1/instantsearch.production.min.js" crossorigin="anonymous" defer></script><script src="/js/algolia.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadAlgolia({"applicationId":"2TB5ZZYPCO","apiKey":"00a43f1d62ca7b24c8b78d5f0223c065","indexName":"dev_nilera_blog"}, {"hint":"想要查找什么...","no_result":"未找到搜索结果","untitled":"(无标题)","empty_preview":"(无内容预览)"});
        });</script></body></html>